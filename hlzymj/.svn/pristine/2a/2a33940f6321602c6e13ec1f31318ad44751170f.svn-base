{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\activity\\consecutiveVictories/assets\\scripts\\hall\\activity\\consecutiveVictories\\ConsecutiveVictoriesLayer.js"],"names":["HallResources","require","ConsecutiveVictoriesLayer","cc","Class","extends","Component","properties","bg","default","type","Node","showWinPrefab","Prefab","onLoad","node","on","EventType","TOUCH_START","onTouch","event","poisition","touch","getLocation","locationInNode","convertToNodeSpace","s","getContentSize","rect","width","height","rectContainsPoint","closeAndChangeScaleAction","initData","data","removeAllChildren","nowProgressingIndex","i","length","CanAward","item","instantiate","getComponent","setProgressing","parent","offsetY","y","setPosition","self","action1","scaleTo","action2","fadeOut","action3","callFunc","active","TSCommon","dispatchEvent","onChangeShadow","sequence","runAction","clickCloseBtn","getInstance","playCloseEffect","module","exports"],"mappings":";;;;;;AAAA;;AACA,IAAIA,gBAAgBC,QAAQ,eAAR,CAApB;AACA,IAAIC,4BAA4BC,GAAGC,KAAH,CAAS;AACrCC,aAASF,GAAGG,SADyB;;AAGrCC,gBAAY;AACRC,YAAI;AACAC,qBAAS,IADT;AAEAC,kBAAMP,GAAGQ;AAFT,SADI;AAKRC,uBAAc;AACVH,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC;AALN,KAHyB;;AAcrC;;AAEAC,YAAQ,kBAAY;AAChB,aAAKC,IAAL,CAAUC,EAAV,CAAab,GAAGQ,IAAH,CAAQM,SAAR,CAAkBC,WAA/B,EAA4C,KAAKC,OAAjD,EAA0D,IAA1D;AACH,KAlBoC;;AAoBrCA,aAAS,iBAAUC,KAAV,EAAiB;AACtB,YAAIC,YAAYD,MAAME,KAAN,CAAYC,WAAZ,EAAhB;AACA,YAAIC,iBAAiB,KAAKhB,EAAL,CAAQiB,kBAAR,CAA2BJ,SAA3B,CAArB;AACA,YAAIK,IAAI,KAAKlB,EAAL,CAAQmB,cAAR,EAAR;AACA,YAAIC,OAAOzB,GAAGyB,IAAH,CAAQ,CAAR,EAAW,CAAX,EAAcF,EAAEG,KAAhB,EAAuBH,EAAEI,MAAzB,CAAX;AACA,YAAI3B,GAAG4B,iBAAH,CAAqBH,IAArB,EAA2BJ,cAA3B,CAAJ,EAAgD;AAC5C;AACH,SAFD,MAGK;AACD;AACA,iBAAKQ,yBAAL;AACH;AACJ,KAhCoC;;AAkCrCC,cAAS,kBAASC,IAAT,EACT;AACI,aAAK1B,EAAL,CAAQ2B,iBAAR;AACA,YAAIC,sBAAsB,CAA1B;AACA,aAAI,IAAIC,IAAI,CAAZ,EAAcA,IAAEH,KAAKI,MAArB,EAA4BD,GAA5B,EACA;AACI,gBAAKH,KAAKG,CAAL,EAAQE,QAAR,IAAoB,CAAzB,EAA4B;AACxBH,sCAAsBC,CAAtB;AACA;AACH;AACJ;AACD,YAAKD,uBAAuB,CAAxB,IAA6BF,KAAKA,KAAKI,MAAL,GAAY,CAAjB,EAAoBC,QAApB,IAAgC,CAAjE,EACA;AACI;AACAH,kCAAsBF,KAAKI,MAA3B;AACH;AACD,aAAI,IAAID,IAAI,CAAZ,EAAcA,IAAEH,KAAKI,MAArB,EAA4BD,GAA5B,EACA;AACI,gBAAIG,OAAOrC,GAAGsC,WAAH,CAAe,KAAK7B,aAApB,CAAX;AACA4B,iBAAKE,YAAL,CAAkB,0BAAlB,EAA8CT,QAA9C,CAAuDC,KAAKG,CAAL,CAAvD;;AAEA,gBAAIA,KAAGD,mBAAP,EAA2B;AACvB;AACAI,qBAAKE,YAAL,CAAkB,0BAAlB,EAA8CC,cAA9C,CAA6D,IAA7D;AACH;AACDH,iBAAKI,MAAL,GAAc,KAAKpC,EAAnB;AACA,gBAAIqC,UAAU,GAAd;AACA;AACA,gBAAIC,IAAI,KAAGT,IAAIQ,OAAf;AACAL,iBAAKO,WAAL,CAAiB,CAAjB,EAAmBD,CAAnB;AACH;AACJ,KAjEoC;;AAmErCd,6BAnEqC,uCAmEV;AACvB,YAAIgB,OAAO,IAAX;AACA;AACA,YAAIC,UAAU9C,GAAG+C,OAAH,CAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,CAAd;AACA,YAAIC,UAAShD,GAAGiD,OAAH,CAAW,IAAX,CAAb;;AAEA,YAAIC,UAAUlD,GAAGmD,QAAH,CAAY,YAAU;AAChCN,iBAAKjC,IAAL,CAAUwC,MAAV,GAAmB,KAAnB;;AAEAC,+BAASC,aAAT,CAAuBzD,cAAc0D,cAArC,EAAoD,KAApD;AACH,SAJa,CAAd;AAKA,YAAIC,WAAWxD,GAAGwD,QAAH,CAAYV,OAAZ,EAAqBE,OAArB,EAA8BE,OAA9B,CAAf;AACA,aAAKtC,IAAL,CAAU6C,SAAV,CAAoBD,QAApB;AACH,KAhFoC;;;AAmFrCE,mBAAe,yBAAY;AACvB7D,sBAAc8D,WAAd,GAA4BC,eAA5B;AACA;AACA,aAAK/B,yBAAL;AACH;;AAED;AAzFqC,CAAT,CAAhC;;AA4FAgC,OAAOC,OAAP,GAAiB/D,yBAAjB","file":"ConsecutiveVictoriesLayer.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\activity\\consecutiveVictories","sourcesContent":["import {TSCommon} from \"TSCommon\";\r\nvar HallResources = require(\"HallResources\");\r\nvar ConsecutiveVictoriesLayer = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        bg: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        showWinPrefab:{\r\n            default: null,\r\n            type: cc.Prefab,\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad: function () {\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouch, this);\r\n    },\r\n\r\n    onTouch: function (event) {\r\n        var poisition = event.touch.getLocation();\r\n        var locationInNode = this.bg.convertToNodeSpace(poisition);\r\n        var s = this.bg.getContentSize();\r\n        var rect = cc.rect(0, 0, s.width, s.height);\r\n        if (cc.rectContainsPoint(rect, locationInNode)) {\r\n            // this.node.active = true;\r\n        }\r\n        else {\r\n            // this.node.active = false;\r\n            this.closeAndChangeScaleAction();\r\n        }\r\n    },\r\n\r\n    initData:function(data)\r\n    {\r\n        this.bg.removeAllChildren();\r\n        var nowProgressingIndex = 0;\r\n        for(var i = 0;i<data.length;i++)\r\n        {\r\n            if ((data[i].CanAward == 0)){\r\n                nowProgressingIndex = i;\r\n                break;\r\n            }\r\n        }\r\n        if ((nowProgressingIndex == 0)&&(data[data.length-1].CanAward == 1))\r\n        {\r\n            //目的是搞一个读取不到的数来阻止显示当前进度\r\n            nowProgressingIndex = data.length;\r\n        }\r\n        for(var i = 0;i<data.length;i++)\r\n        {\r\n            var item = cc.instantiate(this.showWinPrefab);\r\n            item.getComponent(\"ConsecutiveVictoriesItem\").initData(data[i]);\r\n            \r\n            if (i==nowProgressingIndex){\r\n                //显示正在进行中\r\n                item.getComponent(\"ConsecutiveVictoriesItem\").setProgressing(true);\r\n            } \r\n            item.parent = this.bg;\r\n            var offsetY = 100;\r\n            //.初始化位置\r\n            var y = 70-i * offsetY;\r\n            item.setPosition(0,y);\r\n        }\r\n    },\r\n\r\n    closeAndChangeScaleAction(){\r\n        var self = this;\r\n        // self.node.active = false;\r\n        var action1 = cc.scaleTo(0.2, 0.3, 0.3);\r\n        var action2 =cc.fadeOut(0.01);\r\n        \r\n        var action3 = cc.callFunc(function(){\r\n            self.node.active = false;\r\n            \r\n            TSCommon.dispatchEvent(HallResources.onChangeShadow,false);\r\n        });\r\n        var sequence = cc.sequence(action1, action2, action3);\r\n        this.node.runAction(sequence);\r\n    },\r\n\r\n\r\n    clickCloseBtn: function () {\r\n        HallResources.getInstance().playCloseEffect();\r\n        // this.node.active = false;\r\n        this.closeAndChangeScaleAction();\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n\r\nmodule.exports = ConsecutiveVictoriesLayer;"]}