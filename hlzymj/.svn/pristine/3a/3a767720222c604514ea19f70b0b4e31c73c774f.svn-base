{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\game\\gameOver/assets\\scripts\\hall\\game\\gameOver\\GameOverLayer.js"],"names":["GameDefs","require","Resources","cc","Class","extends","Component","properties","laiyouType","default","type","Node","fanNum","laiyouZi","onLoad","onDestroy","stopLeftTimer","onEnable","m_bIsLiuju","node","getChildByName","active","loadRes","setHuFan","setLaiyouZi","startLeftTimer","HallResources","recordPlayerLogToServer","recordList","count_page","self","loader","SpriteFrame","err","spriteFrame","m_yingLaiYouFrame","setHuType","m_ruanLaiYouFrame","m_yingZiMoFrame","m_ruanZiMoFrame","m_youZhongYouFrame","init","bIsLiuju","huType","laiyouValue","showDetailResult","m_huType","m_fanNum","m_laiyouValue","m_showDetailResult","m_leftTimerStop","m_leftTime","getLeftLeaveTime","frame","EndStatus","RuanPai","getComponent","Sprite","Label","string","undefined","frameName","get_frameName","parent","mj1_face_dao","getSpriteFrame","leftTimerNode","callback","label","TSCommon","performWithDelay","getInstance","getGameLib","leaveGameRoom","onLeaveGameClicked","DeskScene","onDetailResultClicked","onReadyClicked","GameCfg","dispatchEvent","GAME_RESTART","isReady"],"mappings":"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","file":"GameOverLayer.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\game\\gameOver","sourcesContent":["/**\r\n * 此处结算界面是金币场内的结算界面\r\n */\r\n\r\n\r\nvar GameDefs = require(\"GameDefs\");\r\nvar Resources = require(\"Resources\");\r\nimport {TSCommon} from \"../../TSCommon\";\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        laiyouType: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        fanNum: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        laiyouZi:{\r\n            default: null,\r\n            type: cc.Node,  \r\n        },\r\n\r\n    },\r\n\r\n    onLoad:function(){\r\n        \r\n    },\r\n\r\n    onDestroy:function(){\r\n        this.stopLeftTimer();\r\n    },\r\n\r\n    onEnable:function(){\r\n        \r\n\r\n        //如果流局\r\n        if(this.m_bIsLiuju){\r\n            this.node.getChildByName(\"hutype_bg\").active = false;\r\n            this.node.getChildByName(\"laiyouzi_bg\").active = false;\r\n        }\r\n        else{       \r\n            this.node.getChildByName(\"hutype_bg\").active = true;\r\n            this.node.getChildByName(\"laiyouzi_bg\").active = true;     \r\n            \r\n            this.loadRes();\r\n            this.setHuFan();\r\n            this.setLaiyouZi();\r\n        }\r\n\r\n        this.startLeftTimer();\r\n\r\n        var HallResources = require(\"HallResources\");\r\n        HallResources.recordPlayerLogToServer(HallResources.recordList.count_page);\r\n    },\r\n\r\n    loadRes:function(){\r\n\r\n        var self = this;\r\n\r\n        //硬癞油\r\n        cc.loader.loadRes(\"texture/game/gameOver/yingLaiYou\", cc.SpriteFrame, function(err, spriteFrame){\r\n            self.m_yingLaiYouFrame = spriteFrame;\r\n            self.setHuType();\r\n        })\r\n\r\n        //软癞油\r\n        cc.loader.loadRes(\"texture/game/gameOver/ruanLaiYou\", cc.SpriteFrame, function(err, spriteFrame){\r\n            self.m_ruanLaiYouFrame = spriteFrame;\r\n            self.setHuType();\r\n        })\r\n\r\n        //硬自摸\r\n        cc.loader.loadRes(\"texture/game/gameOver/yingZiMo\", cc.SpriteFrame, function(err, spriteFrame){\r\n            self.m_yingZiMoFrame = spriteFrame;\r\n            self.setHuType();\r\n        })\r\n\r\n        //软自摸\r\n        cc.loader.loadRes(\"texture/game/gameOver/ruanZiMo\", cc.SpriteFrame, function(err, spriteFrame){\r\n            self.m_ruanZiMoFrame = spriteFrame;\r\n            self.setHuType();\r\n        })\r\n\r\n        //油中油\r\n        cc.loader.loadRes(\"texture/game/gameOver/youZhongYou\", cc.SpriteFrame, function(err, spriteFrame){\r\n            self.m_youZhongYouFrame = spriteFrame;\r\n            self.setHuType();\r\n        })\r\n\r\n        \r\n    },\r\n\r\n    /*\r\n     * 初始化\r\n     * @huType 胡牌类型 \r\n     * @fanNum 胡牌番数\r\n     * @laiyouValue 癞油字的牌值\r\n    */\r\n    init:function(bIsLiuju, huType, fanNum, laiyouValue, showDetailResult){\r\n        this.m_bIsLiuju = bIsLiuju;\r\n        this.m_huType = huType;\r\n        this.m_fanNum = fanNum;\r\n        this.m_laiyouValue = laiyouValue;\r\n        this.m_showDetailResult = showDetailResult;\r\n\r\n        this.m_leftTimerStop = false;\r\n        this.m_leftTime = 25;\r\n    },\r\n\r\n\r\n    getLeftLeaveTime:function(){\r\n        return this.m_leftTime;\r\n    },\r\n\r\n    setHuType:function(){\r\n        var frame;\r\n\r\n        //软自摸\r\n        if(this.m_huType == GameDefs.EndStatus.RuanPai){\r\n            frame = this.m_ruanZiMoFrame;\r\n        }\r\n\r\n        //硬自摸\r\n        else if(this.m_huType == GameDefs.EndStatus.RuanPai){\r\n            frame = this.m_yingZiMoFrame;\r\n        }\r\n\r\n        //软癞油\r\n        else if(this.m_huType == GameDefs.EndStatus.RuanPai){\r\n            frame = this.m_ruanLaiYouFrame;\r\n        }\r\n\r\n        //硬癞油\r\n        else if(this.m_huType == GameDefs.EndStatus.RuanPai){\r\n            frame = this.m_yingLaiYouFrame;\r\n        }\r\n\r\n        //油中油\r\n        else if(this.m_huType == GameDefs.EndStatus.RuanPai){\r\n            frame = this.m_youZhongYouFrame;\r\n        }\r\n\r\n        if(!frame){\r\n            return;\r\n        }\r\n\r\n        this.laiyouType.active = true;\r\n        this.laiyouType.getComponent(cc.Sprite).spriteFrame = frame;\r\n    },\r\n\r\n    //设定胡牌翻数\r\n    setHuFan:function(){\r\n        this.fanNum.getComponent(cc.Label).string = this.m_fanNum + \"翻\";\r\n    },\r\n\r\n    setLaiyouZi:function(){\r\n        if(this.m_laiyouValue == undefined || this.m_laiyouValue == null){\r\n            return;\r\n        }\r\n        var frameName = Resources.get_frameName(\"hh_dao_\", this.m_laiyouValue);\r\n\r\n        var frame = this.node.parent.getComponent(\"MjResourceMgr\").mj1_face_dao.getSpriteFrame(frameName);\r\n\r\n        if(frame){\r\n            this.laiyouZi.getComponent(cc.Sprite).spriteFrame = frame;\r\n        }\r\n    },\r\n\r\n    //开始离开房间的按钮\r\n    startLeftTimer:function(){\r\n        var leftTimerNode = this.node.getChildByName(\"ready_btn\").getChildByName(\"leave_timer\");\r\n        leftTimerNode.active = true;\r\n        leftTimerNode.getComponent(cc.Label).string = \"(\" + this.m_leftTime + \")\";\r\n\r\n        var self = this;\r\n        var callback = function(){\r\n            if(self.m_leftTimerStop){\r\n                return;\r\n            }\r\n\r\n            self.m_leftTime -= 1;\r\n            var label = leftTimerNode.getComponent(cc.Label);\r\n            label.string = \"(\" + self.m_leftTime + \")\";\r\n\r\n            if(self.m_leftTime > 0){\r\n                TSCommon.performWithDelay(self, callback, 1);\r\n            }\r\n            else{\r\n                leftTimerNode.getComponent(cc.Label).string = \"\";\r\n                leftTimerNode.active = false;\r\n                require('GameLibSink').getInstance().getGameLib().leaveGameRoom();\r\n            }\r\n        }\r\n\r\n        TSCommon.performWithDelay(this, callback, 1);\r\n    },\r\n\r\n    stopLeftTimer:function(){\r\n        this.m_leftTimerStop = true;\r\n    },\r\n\r\n    //离开按钮点击\r\n    onLeaveGameClicked:function(){\r\n        var DeskScene = this.node.parent.getComponent(\"DeskScene\");\r\n        \r\n        // if(DeskScene.IsCXZ()){\r\n        //     G.goldGameReady = 3;\r\n        // }\r\n        // else{\r\n        //     G.goldGameReady = 4;\r\n        // }\r\n\r\n        require('GameLibSink').getInstance().getGameLib().leaveGameRoom();       \r\n    },\r\n\r\n\r\n    //详细结算按钮\r\n    onDetailResultClicked:function(){\r\n        if(this.m_showDetailResult){\r\n            this.m_showDetailResult();\r\n        }\r\n    },\r\n\r\n    //准备按钮\r\n    onReadyClicked:function(){\r\n    \r\n        this.node.active = false;\r\n        var GameCfg = require(\"GameCfg\");\r\n        TSCommon.dispatchEvent(GameCfg.GAME_RESTART, {isReady : true});\r\n    },\r\n\r\n});\r\n"]}