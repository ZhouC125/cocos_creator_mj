{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\weixin/assets\\scripts\\hall\\weixin\\WeixinManager.ts"],"names":[],"mappings":";;;;;AAAC,oCAAiC;AAClC,iDAAoD;AACpD,wCAAuC;AACvC,wCAA2C;AAC3C,gDAAmD;AAiBnD;IAWI;QACI,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC;IAC3B,CAAC;IACL,qBAAC;AAAD,CAfA,AAeC,IAAA;AAfY,wCAAc;AAiB3B;IAYI;QACI,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACnB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,CAAC;IAhBa,yBAAW,GAAzB;QACI,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI;YACtB,IAAI,CAAC,SAAS,GAAG,IAAI,aAAa,EAAE,CAAC;QACzC,OAAO,IAAI,CAAC,SAAS,CAAC;IAC1B,CAAC;IAcO,4BAAI,GAAZ;QACI,cAAc;QACd,wBAAwB;IAC5B,CAAC;IAED;;OAEG;IACK,sCAAc,GAAtB;QAAA,iBAWC;QAVG,IAAI,OAAO,GAAW,eAAM,CAAC,UAAU,GAAG,4BAA4B,GAAG,eAAM,CAAC,YAAY,GAAG,OAAO;YAClG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QAChC,IAAI,UAAU,GAAG,IAAI,UAAU,EAAE,CAAC;QAClC,UAAU,CAAC,OAAO,CAAC,OAAO,EAAE,EAAE,EAAE,UAAC,SAAiB,EAAC,IAAW;YAC1D,KAAI,CAAC,WAAW,GAAgB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YACjD,0DAA0D;YAC1D,MAAM;YACN,KAAI,CAAC,eAAe,EAAE,CAAC;QAE3B,CAAC,EAAE,KAAK,CAAC,CAAC;IACd,CAAC;IAED;;OAEG;IACK,uCAAe,GAAvB;QACI;;;;;;;;;;WAUG;QACH,MAAM;QACN,IAAI,UAAU,GAAG,IAAI,UAAU,EAAE,CAAC;QAClC,UAAU,CAAC,KAAK,GAAG,IAAI,CAAC,CAAA,8EAA8E;QACtG,UAAU,CAAC,KAAK,GAAG,eAAM,CAAC,YAAY,CAAC,CAAA,cAAc;QACrD,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,CAAA,cAAc;QAChE,UAAU,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAA,cAAc;QAC9D,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,CAAA,aAAa;QAC/D,UAAU,CAAC,SAAS,GAAG;YACnB,uBAAuB;YACvB,YAAY;YACZ,qBAAqB;YACrB,uBAAuB;YACvB,eAAe;YACf,kBAAkB;YAClB,eAAe;YACf,eAAe;YACf,wBAAwB;YACxB,wBAAwB;YACxB,gBAAgB;YAChB,aAAa;YACb,YAAY;YACZ,WAAW;YACX,YAAY;YACZ,WAAW;YACX,aAAa;YACb,eAAe;YACf,aAAa;YACb,cAAc;YACd,aAAa;YACb,eAAe;YACf,gBAAgB;YAChB,cAAc;YACd,aAAa;YACb,gBAAgB;YAChB,gBAAgB;YAChB,aAAa;YACb,YAAY;YACZ,aAAa;YACb,yBAAyB;YACzB,SAAS;YACT,YAAY;YACZ,UAAU,CAAA,cAAc;SAC3B,CAAC;QACF,EAAE,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;IAC1B,CAAC;IAEM,uCAAe,GAAtB,UAAuB,KAAa,EAAE,IAAY,EAAE,IAAY,EAAE,MAAc;QAC5E,EAAE,CAAC,qBAAqB,CAAC;YACrB,KAAK,EAAE,KAAK;YACZ,IAAI,EAAE,IAAI;YACV,IAAI,EAAE,IAAI;YACV,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,EAAE;YACR,OAAO,EAAE,EAAE;YACX,OAAO,EAAE;gBACL,iBAAiB;YACrB,CAAC;YACD,MAAM,EAAE;gBACJ,iBAAiB;YACrB,CAAC;YACD,OAAO,EAAE;gBACL,iBAAiB;YACrB,CAAC;YACD,IAAI,EAAE;gBACF,iBAAiB;YACrB,CAAC;SACJ,CAAC,CAAC;IACP,CAAC;IAEM,qCAAa,GAApB,UAAqB,KAAa,EAAE,IAAY,EAAE,MAAc;QAC5D,EAAE,CAAC,mBAAmB,CAAC;YACnB,KAAK,EAAE,KAAK;YACZ,IAAI,EAAE,IAAI;YACV,MAAM,EAAE,MAAM;YACd,OAAO,EAAE;gBACL,iBAAiB;YACrB,CAAC;YACD,MAAM,EAAE;gBACJ,iBAAiB;YACrB,CAAC;YACD,OAAO,EAAE;gBACL,iBAAiB;YACrB,CAAC;YACD,IAAI,EAAE;gBACF,iBAAiB;YACrB,CAAC;SACJ,CAAC,CAAC;IACP,CAAC;IAEM,+BAAO,GAAd,UAAe,KAAa,EAAE,IAAY,EAAE,IAAY,EAAE,MAAc;QACpE,EAAE,CAAC,aAAa,CAAC;YACb,KAAK,EAAE,KAAK;YACZ,IAAI,EAAE,IAAI;YACV,IAAI,EAAE,IAAI;YACV,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,EAAE;YACR,OAAO,EAAE,EAAE;YACX,OAAO,EAAE;gBACL,iBAAiB;YACrB,CAAC;YACD,MAAM,EAAE;gBACJ,iBAAiB;YACrB,CAAC;YACD,OAAO,EAAE;gBACL,iBAAiB;YACrB,CAAC;YACD,IAAI,EAAE;gBACF,iBAAiB;YACrB,CAAC;YACD,QAAQ,EAAE;gBACN,iBAAiB;YACrB,CAAC;SACJ,CAAC,CAAC;IACP,CAAC;IAEM,2BAAG,GAAV,UAAW,SAAiB,EAAE,KAAa;QACvC,IAAI,WAAW,GAAW,eAAM,CAAC,gBAAgB,GAAG,SAAS,GAAG,eAAM,CAAC,YAAY;YAC/E,UAAU,GAAG,cAAc,CAAC,QAAQ,GAAG,kCAAkC,GAAG,KAAK,GAAG,aAAa,GAAG,SAAS,CAAC;QAClH,IAAI,UAAU,GAAG,IAAI,UAAU,EAAE,CAAC;QAClC,UAAU,CAAC,OAAO,CAAC,WAAW,EAAE,EAAE,EAAE,UAAC,SAAiB,EAAC,IAAW;YAC9D,IAAI,GAAG,GAAY,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YACpC,IAAI,GAAG,CAAC,MAAM,IAAI,CAAC,EAAE;gBACjB,SAAS;gBACT,mBAAQ,CAAC,aAAa,CAAC,mBAAQ,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;gBACvD,OAAO;aACV;YACD,EAAE,CAAC,WAAW,CAAC;gBACX,SAAS,EAAE,GAAG,CAAC,SAAS;gBACxB,QAAQ,EAAE,GAAG,CAAC,QAAQ;gBACtB,OAAO,EAAE,YAAY,GAAG,GAAG,CAAC,QAAQ;gBACpC,QAAQ,EAAE,MAAM;gBAChB,OAAO,EAAE,GAAG,CAAC,SAAS;gBACtB,OAAO,EAAE,UAAU,GAAG;oBAClB,aAAa;oBACb,mBAAQ,CAAC,aAAa,CAAC,mBAAQ,CAAC,cAAc,EAAE,EAAE,CAAC,CAAC;gBACxD,CAAC;aACJ,CAAC,CAAC;QAEP,CAAC,EAAE,KAAK,CAAC,CAAC;IAEd,CAAC;IAEO,wCAAgB,GAAxB;QACI,cAAc,CAAC,oBAAoB,EAAE,0CAA0C,CAAC,CAAC;IACrF,CAAC;IAEM,kCAAU,GAAjB,UAAkB,OAAe;QAC7B,IAAI,EAAE,GAAG,SAAS,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC;QAC3C,mBAAQ,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QACjB,IAAI,QAAQ,GAAG,KAAK,CAAC;QACrB,IAAI,EAAE,CAAC,OAAO,CAAC,gBAAgB,CAAC,GAAG,CAAC;YAChC,QAAQ,GAAG,IAAI,CAAC;QAEpB,IAAG,SAAS,CAAC,wBAAwB,EAAE,EAAC;YACpC,IAAI,CAAC,WAAW,EAAE,CAAC;YACnB,OAAO;SACV;QAED;;;;WAIG;QAEH,IAAI,MAAM,GAAW,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC;QAE1C,IAAI,UAAU,GAAW,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAC7C,IAAI,SAAiB,CAAC;QACtB,IAAI,UAAU,GAAG,CAAC,EAAE;YAChB,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC;YACtC,IAAI,CAAC,GAAa,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YACpC,KAAK,IAAI,GAAG,IAAI,CAAC,EAAE;gBACf,IAAI,MAAM,GAAa,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACzC,IAAI,MAAM,CAAC,CAAC,CAAC,IAAI,OAAO;oBACpB,SAAS,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;aACxC;YACD,OAAO,CAAC,GAAG,CAAC,cAAc,GAAG,SAAS,CAAC,CAAC;YACxC,aAAa,CAAC,WAAW,EAAE,CAAC,QAAQ,GAAmB,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;YAC7E,aAAa,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,SAAS,GAAG,aAAa,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,UAAU,CAAC;YACjG,IAAG,CAAC,OAAO;gBACP,OAAO,IAAI,CAAC;SACnB;QACD,mBAAQ,CAAC,GAAG,CAAC,cAAc,GAAG,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACtE,IAAG,CAAC,OAAO;YACP,OAAO,KAAK,CAAC;QAEjB,IAAI,aAAa,CAAC,WAAW,EAAE,CAAC,QAAQ,IAAI,IAAI,EAAE;YAC9C,IAAI,QAAQ;gBACR,MAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,eAAM,CAAC,UAAU,GAAG,uCAAuC,GAAG,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;iBAC3H;gBACD,MAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,qDAAqD,GAAG,eAAM,CAAC,gBAAgB;oBAClG,wHAAwH;sBACtH,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC;aACrE;YACD,OAAO,KAAK,CAAC;SAChB;QACD,OAAO,IAAI,CAAC;IAChB,CAAC;IAEM,oCAAY,GAAnB,UAAoB,QAAe;QAEhC,wDAAwD;QACvD,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,EAAE,CAAC,mBAAmB,CAAC;YAEnB,IAAI,EAAE,MAAM;YAEZ,GAAG,EAAE,eAAM,CAAC,GAAG;YAEf,OAAO,EAAE,YAAY;YAErB,QAAQ,EAAE,SAAS;YAEnB,YAAY,EAAE,eAAM,CAAC,YAAY;YAEjC,WAAW,EAAE,QAAQ,GAAC,EAAE;YAExB,MAAM,EAAE,GAAG;YAEX,OAAO,EAAC,UAAS,GAAG;gBAEhB,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;gBACnB,mBAAQ,CAAC,aAAa,CAAC,aAAa,CAAC,2BAA2B,EAAE,IAAI,CAAC,CAAC;gBACxE,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;gBAChB,aAAa;gBACb,qCAAqC;gBACrC,qHAAqH;gBACrH,qEAAqE;gBACrE,+BAA+B;gBAC/B,8CAA8C;gBAC9C,8CAA8C;gBAG9C,QAAQ;gBACR,KAAK;YAET,CAAC;YAED,IAAI,EAAC,UAAS,GAAG;gBAEb,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;gBAEnB,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;YAEpB,CAAC;YAED,QAAQ,EAAC,UAAS,GAAG;gBAEjB,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;gBACpB,mBAAQ,CAAC,aAAa,CAAC,aAAa,CAAC,2BAA2B,EAAE,IAAI,CAAC,CAAC;gBAExE,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YAErB,CAAC;SAEJ,CAAC,CAAA;IACN,CAAC;IAGM,mCAAW,GAAlB;QAGG,IAAI,IAAI,GAAG,IAAI,CAAC;QACnB,yDAAyD;QACrD,EAAE,CAAC,KAAK,CAAC;YACL,OAAO,EAAE,UAAU,GAAG;gBAClB,qDAAqD;gBACrD,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBACjB,IAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;gBACpB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;gBACpB,IAAI,UAAU,GAAG,IAAI,UAAU,EAAE,CAAC;gBAClC,IAAI,YAAY,GAAG,eAAM,CAAC,OAAO,GAAC,iCAAiC,GAAC,IAAI,CAAC;gBACzE,UAAU,CAAC,OAAO,CAAC,YAAY,EAAE,EAAE,EAAG,UAAU,SAAS,EAAE,IAAI;oBAC3D,IAAI,SAAS,IAAI,IAAI,EAAE;wBACnB,IAAI,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;wBAClC,OAAO,CAAC,GAAG,CAAC,YAAY,GAAC,UAAU,CAAC,MAAM,CAAC,CAAC;wBAC5C,uEAAuE;wBACvE,aAAa,CAAC,WAAW,EAAE,CAAC,QAAQ,GAAG,IAAI,cAAc,EAAE,CAAC;wBAC5D,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC;wBAChC,IAAI,CAAC,QAAQ,GAAG,UAAU,CAAC,QAAQ,CAAC;wBACpC,EAAE,CAAC,WAAW,CAAC;4BACX,UAAU,EAAE,CAAC,aAAa,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;4BACzD,IAAI,EAAE,OAAO;4BACb,IAAI,EAAE,UAAU,GAAG;4BAEnB,CAAC;4BACD,OAAO,EAAE,UAAU,GAAG;gCAClB,IAAI,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC;gCAC1B,aAAa,CAAC,WAAW,EAAE,CAAC,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC;gCACpD,aAAa,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;gCAC1D,aAAa,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC;gCAC7D,aAAa,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,MAAM,GAAG,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC;gCAClE,mBAAQ,CAAC,GAAG,CAAC,qBAAqB,GAAC,OAAO,CAAC,CAAC;gCAC5C,mBAAQ,CAAC,aAAa,CAAC,mBAAQ,CAAC,oBAAoB,EAAE,EAAE,CAAC,CAAC;4BAC9D,CAAC;yBACJ,CAAC,CAAC;qBACN;gBACL,CAAC,CAAC,CAAA;YACN,CAAC;SACJ,CAAC,CAAA;IACN,CAAC;IAiCL,oBAAC;AAAD,CArYA,AAqYC,IAAA;AArYY,sCAAa","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\weixin","sourcesContent":["﻿import {Domain} from \"../Domain\";\r\nimport WebRequest = require(\"../common/WebRequest\");\r\nimport { TSCommon } from \"../TSCommon\";\r\nimport HallUtils = require(\"../HallUtils\");\r\nimport HallResources = require(\"../HallResources\");\r\n// import AladinSDK = require(\"../../aladinSDK\");\r\ndeclare function webWeixinLogin(appid: string, redirect_uri: string);\r\ninterface SignPackage {\r\n    nonceStr: string;\r\n    timestamp: number;\r\n    signature: string;\r\n}\r\n\r\ninterface PaySign {\r\n    retult: number;\r\n    nonceStr: string;\r\n    timestamp: number;\r\n    signature: string;\r\n    prepayid: string;\r\n}\r\n\r\nexport class WeixinUserInfo {\r\n    openid: string;\r\n    nickname: string;\r\n    sex: string;\r\n    province: string;\r\n    city: string;\r\n    country: string;\r\n    headimgurl: string;\r\n    privilege: string;\r\n    unionid: string;\r\n    avatarUrl:string;\r\n    constructor() {\r\n        this.unionid = \"test\";\r\n        this.nickname = \"test\";\r\n    }\r\n}\r\n\r\nexport class WeixinManager {\r\n    private static _instance: WeixinManager;\r\n    public static getInstance(): WeixinManager {\r\n        if (this._instance == null)\r\n            this._instance = new WeixinManager();\r\n        return this._instance;\r\n    }\r\n\r\n\r\n    private signPackage: SignPackage;\r\n    public userInfo: WeixinUserInfo;\r\n\r\n    private constructor() {\r\n        this.userInfo = null;\r\n        this.openid = null;\r\n        this.uinionid = null;\r\n        this.js_code = null;\r\n        this.init();\r\n    }\r\n\r\n    private init() {\r\n        //获取签名        \r\n        //this.getSignPackage();\r\n    }\r\n\r\n    /**\r\n     * 获取签名分享\r\n     */\r\n    private getSignPackage() {\r\n        var signUrl: string = Domain.WEIXIN_URL + \"/genWeixinSign.aspx?appid=\" + Domain.WEIXIN_APPID + \"&url=\" + \r\n            location.href.split(\"#\")[0];\r\n        var webRequest = new WebRequest();\r\n        webRequest.getData(signUrl, \"\", (succeeded:boolean,data:string) => {\r\n            this.signPackage = <SignPackage>JSON.parse(data);\r\n            //........................................................\r\n            //基本配置\r\n            this.getWeiXinConfig();\r\n\r\n        }, false);\r\n    }\r\n\r\n    /**\r\n     * 获取微信配置\r\n     */\r\n    private getWeiXinConfig() {\r\n        /*\r\n         * 注意：\r\n         * 1. 所有的JS接口只能在公众号绑定的域名下调用，公众号开发者需要先登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS接口安全域名”。\r\n         * 2. 如果发现在 Android 不能分享自定义内容，请到官网下载最新的包覆盖安装，Android 自定义分享接口需升级至 6.0.2.58 版本及以上。\r\n         * 3. 完整 JS-SDK 文档地址：http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html\r\n         *\r\n         * 如有问题请通过以下渠道反馈：\r\n         * 邮箱地址：weixin-open@qq.com\r\n         * 邮件主题：【微信JS-SDK反馈】具体问题\r\n         * 邮件内容说明：用简明的语言描述问题所在，并交代清楚遇到该问题的场景，可附上截屏图片，微信团队会尽快处理你的反馈。\r\n         */\r\n        //配置参数\r\n        var bodyConfig = new BodyConfig();\r\n        bodyConfig.debug = true;// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。\r\n        bodyConfig.appId = Domain.WEIXIN_APPID;// 必填，公众号的唯一标识\r\n        bodyConfig.timestamp = this.signPackage.timestamp;// 必填，生成签名的时间戳\r\n        bodyConfig.nonceStr = this.signPackage.nonceStr;// 必填，生成签名的随机串\r\n        bodyConfig.signature = this.signPackage.signature;// 必填，签名，见附录1\r\n        bodyConfig.jsApiList = [// 必填，需要使用的JS接口列表，所有JS接口列表见附录2\r\n            // 所有要调用的 API 都要加到这个列表中\r\n            'checkJsApi',//判断当前客户端是否支持指定JS接口\r\n            'onMenuShareTimeline',//获取“分享到朋友圈”按钮点击状态及自定义分享内容接口\r\n            'onMenuShareAppMessage',//获取“分享给朋友”按钮点击状态及自定义分享内容接口\r\n            'onMenuShareQQ',//获取“分享到QQ”按钮点击状态及自定义分享内容接口\r\n            'onMenuShareWeibo',//获取“分享到腾讯微博”按钮点击状态及自定义分享内容接口\r\n            'hideMenuItems',//批量隐藏功能按钮接口\r\n            'showMenuItems',//批量显示功能按钮接口\r\n            'hideAllNonBaseMenuItem',//隐藏所有非基础按钮接口\r\n            'showAllNonBaseMenuItem',//显示所有功能按钮接口\r\n            'translateVoice',//识别音频并返回识别结果接口\r\n            'startRecord',//开始录音接口\r\n            'stopRecord',//停止录音接口\r\n            'playVoice',//播放语音接口\r\n            'pauseVoice',//暂停播放接口\r\n            'stopVoice',//停止播放接口\r\n            'uploadVoice',//上传语音接口\r\n            'downloadVoice',//下载语音接口\r\n            'chooseImage',//拍照或从手机相册中选图接口\r\n            'previewImage',//预览图片接口\r\n            'uploadImage',//上传图片接口\r\n            'downloadImage',//下载图片接口\r\n            'getNetworkType',//获取网络状态接口\r\n            'openLocation',//使用微信内置地图查看位置接口\r\n            'getLocation',//获取地理位置接口\r\n            'hideOptionMenu',//隐藏右上角菜单接口\r\n            'showOptionMenu',//显示右上角菜单接口\r\n            'closeWindow',//关闭当前网页窗口接口\r\n            'scanQRCode',//调起微信扫一扫接口\r\n            'chooseWXPay',//发起一个微信支付请求\r\n            'openProductSpecificView',//跳转微信商品页接口\r\n            'addCard',//批量添加卡券接口\r\n            'chooseCard',//调起适用于门店的卡券列表并获取用户选择列表\r\n            'openCard'//查看微信卡包中的卡券接口\r\n        ];\r\n        wx.config(bodyConfig);\r\n    }\r\n\r\n    public shareAppMessage(title: string, desc: string, link: string, imgUrl: string) {\r\n        wx.onMenuShareAppMessage({\r\n            title: title, // 分享标题\r\n            desc: desc, // 分享描述\r\n            link: link, // 分享链接\r\n            imgUrl: imgUrl, // 分享图标\r\n            type: '', // 分享类型,music、video或link，不填默认为link\r\n            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空\r\n            success: function () {\r\n                // 用户确认分享后执行的回调函数\r\n            },\r\n            cancel: function () {\r\n                // 用户取消分享后执行的回调函数\r\n            },\r\n            trigger: function () {\r\n                // 用户取消分享后执行的回调函数\r\n            },\r\n            fail: function () {\r\n                // 用户取消分享后执行的回调函数\r\n            }\r\n        });\r\n    }\r\n\r\n    public shareTimeline(title: string, link: string, imgUrl: string) {\r\n        wx.onMenuShareTimeline({\r\n            title: title, // 分享标题           \r\n            link: link, // 分享链接\r\n            imgUrl: imgUrl, // 分享图标           \r\n            success: function () {\r\n                // 用户确认分享后执行的回调函数\r\n            },\r\n            cancel: function () {\r\n                // 用户取消分享后执行的回调函数\r\n            },\r\n            trigger: function () {\r\n                // 用户取消分享后执行的回调函数\r\n            },\r\n            fail: function () {\r\n                // 用户取消分享后执行的回调函数\r\n            }\r\n        });\r\n    }\r\n\r\n    public shareQQ(title: string, desc: string, link: string, imgUrl: string) {\r\n        wx.onMenuShareQQ({\r\n            title: title, // 分享标题\r\n            desc: desc, // 分享描述\r\n            link: link, // 分享链接\r\n            imgUrl: imgUrl, // 分享图标  \r\n            type: '', // 分享类型,music、video或link，不填默认为link\r\n            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空\r\n            success: function () {\r\n                // 用户确认分享后执行的回调函数\r\n            },\r\n            cancel: function () {\r\n                // 用户取消分享后执行的回调函数\r\n            },\r\n            trigger: function () {\r\n                // 用户取消分享后执行的回调函数\r\n            },\r\n            fail: function () {\r\n                // 用户取消分享后执行的回调函数\r\n            },\r\n            complete: function () {\r\n                // 用户取消分享后执行的回调函数\r\n            }\r\n        });\r\n    }\r\n\r\n    public pay(productID: string, price: number) {\r\n        var genorderURL: string = Domain.PAY_GENORDER_URL + \"?appid=\" + Domain.WEIXIN_APPID +\r\n            \"&userid=\" + PublicUserInfo.userDBID + \"&gameid=0&partnerID=10101&price=\" + price + \"&productid=\" + productID;\r\n        var webRequest = new WebRequest();\r\n        webRequest.getData(genorderURL, \"\", (succeeded:boolean,data:string) => {\r\n            var pay = <PaySign>JSON.parse(data);\r\n            if (pay.retult != 1) {\r\n                // 生成订单失败\r\n                TSCommon.dispatchEvent(TSCommon.onPayFailed, \"生成订单失败\");\r\n                return;\r\n            }\r\n            wx.chooseWXPay({\r\n                timestamp: pay.timestamp, // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符\r\n                nonceStr: pay.nonceStr, // 支付签名随机串，不长于 32 位\r\n                package: 'prepay_id=' + pay.prepayid, // 统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=***）\r\n                signType: 'SHA1', // 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'\r\n                paySign: pay.signature, // 支付签名\r\n                success: function (res) {\r\n                    // 支付成功后的回调函数\r\n                    TSCommon.dispatchEvent(TSCommon.onPaySucceeded, \"\");\r\n                }\r\n            });\r\n\r\n        }, false);\r\n\r\n    }\r\n\r\n    private weixinLoginByWeb() {\r\n        webWeixinLogin(\"wx9077e9fe86b5ae1b\", \"http://weixin.ss2007.com/weixinauth.aspx\");\r\n    }\r\n\r\n    public checkLogin(doLogin:boolean): boolean {\r\n        var ua = navigator.userAgent.toLowerCase();\r\n        TSCommon.log(ua);\r\n        var isweixin = false;\r\n        if (ua.indexOf(\"micromessenger\") > 0)\r\n            isweixin = true;\r\n\r\n        if(HallUtils.judeIsPhoneWXGameBrowser()){\r\n            this.wxGameLogin();\r\n            return;\r\n        }\r\n\r\n        /*if (!isweixin) {\r\n            //this.userInfo = new WeixinUserInfo();            \r\n            this.weixinLoginByWeb();\r\n            return false;\r\n        }*/\r\n\r\n        var params: string = window.location.href;\r\n\r\n        var paramBegin: number = params.indexOf(\"?\");\r\n        var paramJson: string;\r\n        if (paramBegin > 0) {\r\n            params = params.slice(paramBegin + 1);\r\n            var p: string[] = params.split(\"&\");\r\n            for (var key in p) {\r\n                var param1: string[] = p[key].split(\"=\");\r\n                if (param1[0] == \"param\")\r\n                    paramJson = decodeURI(param1[1]);\r\n            }\r\n            console.log(\"paramJson = \" + paramJson);\r\n            WeixinManager.getInstance().userInfo = <WeixinUserInfo>JSON.parse(paramJson);\r\n            WeixinManager.getInstance().userInfo.avatarUrl = WeixinManager.getInstance().userInfo.headimgurl;\r\n            if(!doLogin)\r\n                return true;\r\n        }\r\n        TSCommon.log(\"encodeURI = \" + encodeURI(location.href.split(\"#\")[0]));\r\n        if(!doLogin)\r\n            return false;\r\n\r\n        if (WeixinManager.getInstance().userInfo == null) {\r\n            if (isweixin)\r\n                window.location.href = Domain.WEIXIN_URL + \"/OAuth/weixinlogin.aspx?redirect_uri=\" + encodeURI(location.href.split(\"#\")[0]);\r\n            else {                \r\n                window.location.href = \"https://open.weixin.qq.com/connect/qrconnect?appid=\" + Domain.WEIXIN_WEB_APPID +\r\n                    \"&redirect_uri=http%3A%2F%2Fweixin.ss2007.com%2FOAuthWeb%2Fweixinauth.aspx&response_type=code&scope=snsapi_login&state=\"\r\n                    + encodeURI(location.href.split(\"#\")[0]) + \"#wechat_redirect\";\r\n            }\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public wxBuyDiamond(useCount:number)\r\n    {\r\n       // console.log(\"useCount===\"+useCount+\"    nEnv=\"+nEnv);\r\n        var self = this;\r\n        wx.requestMidasPayment({\r\n\r\n            mode: \"game\",\r\n\r\n            env: Domain.ENV,\r\n\r\n            offerId: '1450016157',\r\n\r\n            platform: \"android\",\r\n            \r\n            currencyType: Domain.CURRENCYTYPE,\r\n            \r\n            buyQuantity: useCount*10,\r\n\r\n            zoneId: \"1\",\r\n\r\n            success:function(res) {\r\n\r\n                console.log(\"购买成功\")\r\n                TSCommon.dispatchEvent(HallResources.onRefreshPlayerDiamondCount, this);\r\n                console.log(res)\r\n                //告知服务器去微信拿钻石\r\n                // var webRequest = new WebRequest();\r\n                // var getOpenIdUrl = Domain.WebRoot+\"GetGameCurrency.aspx?UserID=\"+PublicUserInfo.userDBID+\"&js_code=\"+self.js_code;\r\n                // webRequest.getData(getOpenIdUrl, \"\",  function (isSucceed, data) {\r\n                //     if (isSucceed == true) {\r\n                //         var jsonObject = JSON.parse(data); \r\n                //         console.log(\"获得钻石：\"+jsonObject.gc);\r\n\r\n                        \r\n                //     }\r\n                // })\r\n\r\n            },\r\n\r\n            fail:function(res) {\r\n\r\n                console.log(\"购买失败\")\r\n\r\n                console.log(res)\r\n\r\n            },\r\n\r\n            complete:function(res) {\r\n\r\n                console.log(\"购买完成\");\r\n                TSCommon.dispatchEvent(HallResources.onRefreshPlayerDiamondCount, this);\r\n\r\n                console.log(res);\r\n\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n\r\n    public wxGameLogin()\r\n    {\r\n       \r\n       var self = this;\r\n    // //    AladinSDK.report(AladinSDK.ReportTypes.LOGIN,'')\r\n        wx.login({\r\n            success: function (res) {\r\n                // // AladinSDK.report(AladinSDK.ReportTypes.AUTH,'')\r\n                console.log(res);\r\n                var code = res.code; \r\n                self.js_code = code;\r\n                var webRequest = new WebRequest();\r\n                var getOpenIdUrl = Domain.WebRoot+\"CodeToAccessToken.aspx?js_code=\"+code;\r\n                webRequest.getData(getOpenIdUrl, \"\",  function (isSucceed, data) {\r\n                    if (isSucceed == true) {\r\n                        var jsonObject = JSON.parse(data); \r\n                        console.log(\"获得openid为：\"+jsonObject.openid);\r\n                        // // AladinSDK.report(AladinSDK.ReportTypes.OPEN_ID,jsonObject.openid)\r\n                        WeixinManager.getInstance().userInfo = new WeixinUserInfo();\r\n                        self.openid = jsonObject.openid;\r\n                        self.uinionid = jsonObject.uinionid;\r\n                        wx.getUserInfo({\r\n                            openIdList: [WeixinManager.getInstance().userInfo.openid],\r\n                            lang: 'zh_CN',\r\n                            fail: function (res) {\r\n                                \r\n                            },\r\n                            success: function (res) {\r\n                                var rawData = res.rawData;\r\n                                WeixinManager.getInstance().userInfo = res.userInfo;\r\n                                WeixinManager.getInstance().userInfo.openid = self.openid;\r\n                                WeixinManager.getInstance().userInfo.unionid = self.uinionid;\r\n                                WeixinManager.getInstance().userInfo.gender = res.userInfo.gender;\r\n                                TSCommon.log(\"wxUserinfo rawData=\"+rawData);\r\n                                TSCommon.dispatchEvent(TSCommon.onGeWXtUserInfoLogin, \"\");\r\n                            }\r\n                        });\r\n                    }\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n            //     var genorderURL = \"https://api.weixin.qq.com/sns/jscode2session?appid=\"+Domain.WEIXIN_APPID+\"&secret=656ab89aa1e794cc47b357ad8fc7e188&js_code=\"+code+\"&grant_type=authorization_code\";\r\n            //     var webRequest = new WebRequest();\r\n            //     webRequest.getData(genorderURL, \"\",  function (isSucceed, data) {\r\n            //         if (isSucceed == true) {\r\n                        \r\n            //             WeixinManager.getInstance().userInfo = new WeixinUserInfo();\r\n            //             TSCommon.log(data)\r\n            //             var jsonObject = JSON.parse(data)\r\n            //             TSCommon.log(jsonObject)}\r\n            //             WeixinManager.getInstance().userInfo.openid = jsonObject.openid;\r\n\r\n            //             wx.getUserInfo({\r\n            //                 openIdList: [WeixinManager.getInstance().userInfo.openid],\r\n            //                 lang: 'zh_CN',\r\n            //                 fail: function (res) {\r\n                                \r\n            //                 },\r\n            //                 success: function (res) {\r\n            //                     var rawData = res.rawData;\r\n            //                     WeixinManager.getInstance().userInfo = res.userInfo;\r\n            //                     WeixinManager.getInstance().userInfo.openid = jsonObject.openid;\r\n            //                     TSCommon.log(\"wxUserinfo rawData=\"+rawData);\r\n            //                     TSCommon.dispatchEvent(TSCommon.onGeWXtUserInfoLogin, \"\");\r\n            //                 }\r\n            //             });\r\n            //         }\r\n\r\n            //     , false);\r\n\r\n                \r\n            // }\r\n}"]}