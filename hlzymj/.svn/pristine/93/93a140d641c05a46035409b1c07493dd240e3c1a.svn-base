{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\mall/assets\\scripts\\hall\\mall\\MallScrollList.js"],"names":["MallScrollList","cc","Class","extends","Component","properties","mallItem","Prefab","clickTips","onLoad","m_coinList","Array","content","node","getComponent","ScrollView","initData","maxHeight","start","type","self","height","removeAllChildren","listData","require","getInstance","getEXchangeList","i","length","item","index","count","gm","getIcon","needIcon","need","da","clickFunc","useCount","getCount","clickLayer","instantiate","data","titleIcon","msg","showIcon","showIconLabel","buttonIcon2","button2Func","clickCloseBtn","onExchange","bolSuccess","removeLoading","HallResources","jsonObject","JSON","parse","console","log","RetCode","myBalance","myMoney","getPublicUserInfo","nDiamond","nGold","TSCommon","dispatchEvent","onShowFlyMessage","onGoldOrDiamondChanged","onRefreshPlayerDiamondCount","sys","browserType","myOpenId","WeixinManager","userInfo","openid","exchangeMoneyByDiamond","buttonIcon3","button3Func","parent","setPosition","push","getShoppingList","rmb","wxRmb","wxBuyDiamond","initView","x","width","y","Math","floor","newHeight","ceil","module","exports"],"mappings":"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","file":"MallScrollList.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\mall","sourcesContent":["import {TSCommon} from \"../TSCommon\";\r\nimport {WeixinManager} from \"../weixin/WeixinManager\";\r\nvar MallScrollList = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        mallItem: cc.Prefab,\r\n        clickTips: cc.Prefab,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad:function() {\r\n        this.m_coinList = new Array();\r\n        //.滚动区域\r\n        this.content = this.node.getComponent(cc.ScrollView).content;\r\n        //.初始化数据\r\n        this.initData();\r\n        this.maxHeight = 0;\r\n         \r\n    },\r\n\r\n    start:function() {\r\n\r\n    },\r\n\r\n    // update (dt) {},\r\n    \r\n    //.生成假数据（自己按需生成）\r\n    initData:function(type){\r\n        // for(var i = 0; i < this.content.childrenCount; i++){\r\n        //     this.content.children[i].destroy();\r\n        // }\r\n        var self = this;\r\n        self.maxHeight = this.content.height;\r\n        this.content.removeAllChildren();\r\n        var listData = [];\r\n        \r\n        if (type == null || type == 1){\r\n            self.m_coinList= require('HallControl').getInstance().getEXchangeList();\r\n            for(var i=0; i<self.m_coinList.length; i++){\r\n                var item = {\r\n                    index: i + 1,\r\n                    count: self.m_coinList[i].gm+\"金币\",\r\n                    getIcon: \"texture/hallRes/mallInfo/mallGold\"+(i+1)+\".png\",\r\n                    needIcon: \"texture/commonRes/money/diamondCoin.png\",\r\n                    need: self.m_coinList[i].da,\r\n                };\r\n                item.clickFunc = function(useCount,getCount){\r\n                    var clickLayer = cc.instantiate(self.clickTips);\r\n                    var data = [];\r\n                    data.titleIcon = \"texture/hallRes/mallInfo/mallBuyTitle\";\r\n                    data.msg = \"确定使用\"+useCount+\"钻石来兑换\"+getCount+\"数量的金币么？\";\r\n                    data.showIcon = \"texture/hallRes/mallInfo/mallGold\"+(i+1)+\".png\";\r\n                    data.showIconLabel = \"*\"+getCount;\r\n                    data.buttonIcon2 = \"texture/commonRes/button/sureBtn\";\r\n                    data.button2Func = function(){\r\n                        clickLayer.getComponent(\"commonTipsLayer\").clickCloseBtn();\r\n                        var onExchange = function(bolSuccess,data){\r\n                            if (bolSuccess) {\r\n                                if (bolSuccess) {\r\n                                    require('HallResources').getInstance().removeLoading();\r\n                                    var HallResources = require(\"HallResources\");\r\n                                    var jsonObject = JSON.parse(data)\r\n                                    console.log(\"-----------------xcxGetUserBalance.aspx返回数据----------------------------\")\r\n                                    console.log(jsonObject)\r\n                                    // { \"RetCode\": 1, \"myBalance\": 40, \"myMoney\": 14000 }\r\n                                    var RetCode = jsonObject.RetCode; //返回标记\r\n                                    var myBalance = jsonObject.myBalance; //钻石数\r\n                                    var myMoney = jsonObject.myMoney;\r\n                                    // RetCode(1=成功  0,255,-1=其他错误, 254=access_token错误, 253=openId错误, 252=offer_id错误, 251=session_key错误, 90010=登录失败, 90013=余额不足)\r\n                                    if(RetCode == 1)\r\n                                    {\r\n                                        console.log(\"兑换成功\");\r\n                                        require(\"HallControl\").getInstance().getPublicUserInfo().nDiamond = myBalance;\r\n                                        require(\"HallControl\").getInstance().getPublicUserInfo().nGold = myMoney;\r\n                                        TSCommon.dispatchEvent(HallResources.onShowFlyMessage,[\"+\"+getCount,\"texture/hallRes/roomInfo/gold\"]);            \r\n                                        //刷新金币和钻石\r\n                                        TSCommon.dispatchEvent(HallResources.onGoldOrDiamondChanged,true);\r\n                                        TSCommon.dispatchEvent(HallResources.onRefreshPlayerDiamondCount, this);\r\n                                    }\r\n                                    else if(RetCode == 90013)\r\n                                    {\r\n                                        TSCommon.dispatchEvent(HallResources.onShowFlyMessage,[\"亲，钻石太少了，请去商店获取钻石\"]);\r\n                                    }\r\n                                    else\r\n                                    {\r\n                                        TSCommon.dispatchEvent(this.onShowFlyMessage,[\"兑换失败\"]);\r\n                                    }\r\n                                }\r\n                            }\r\n                            \r\n                        }\r\n                        if(cc.sys.browserType == \"mqqbrowser\" || \"wechatgame\" == cc.sys.browserType){\r\n                            var myOpenId = WeixinManager.getInstance().userInfo.openid;\r\n                            require('HallWebRequest').getInstance().exchangeMoneyByDiamond(useCount,myOpenId,onExchange);\r\n                        }\r\n                        // require('HallControl').getInstance().exchangeGold(useCount, onExchange,0)\r\n                    };\r\n                    data.buttonIcon3 = \"texture/commonRes/button/cancelBtn\";\r\n                    data.button3Func = function(){\r\n                        clickLayer.getComponent(\"commonTipsLayer\").clickCloseBtn();\r\n                    };\r\n\r\n                    clickLayer.parent = this.node.parent.parent.parent.parent;\r\n                    clickLayer.getComponent(\"commonTipsLayer\").initData(data);   \r\n                    clickLayer.setPosition(0,0);\r\n                };\r\n                listData.push(item);\r\n            }\r\n        }\r\n        else\r\n        {\r\n            self.m_coinList= require('HallControl').getInstance().getShoppingList();\r\n            for(var i=0; i<self.m_coinList.length; i++){\r\n                var item = {\r\n                    index: i+1,\r\n                    count:  self.m_coinList[i].gm+\"钻石\",\r\n                    getIcon: \"texture/hallRes/mallInfo/mallDiamond\"+(i+1)+\".png\",\r\n                    needIcon: \"\",//\"texture/hallRes/mallInfo/rmbIcon.png\",\r\n                    need:  (self.m_coinList[i].rmb/100) + \"元\",\r\n                    wxRmb:(self.m_coinList[i].rmb/100),\r\n                };\r\n                item.clickFunc = function(useCount,getCount,wxRmb){\r\n                    // var clickLayer = cc.instantiate(self.clickTips);\r\n                    // var data = [];\r\n                    // data.titleIcon = \"texture/hallRes/mallInfo/mallBuyTitle\";\r\n                    // data.msg = \"确定使用\"+useCount+\"来购买\"+getCount+\"数量的钻石么？\";\r\n                    // data.showIcon = \"texture/hallRes/mallInfo/mallDiamond\"+(i+1)+\".png\";\r\n                    // data.showIconLabel = \"*\"+getCount;\r\n                    // data.buttonIcon2 = \"texture/commonRes/button/sureBtn\";\r\n                    // data.button2Func = function(){\r\n                        // clickLayer.getComponent(\"commonTipsLayer\").clickCloseBtn();\r\n                        console.log(wxRmb+\"使用\"+useCount+\"来购买\"+getCount+\"数量的钻石\");\r\n                        WeixinManager.getInstance().wxBuyDiamond(wxRmb)\r\n                        \r\n                    // };\r\n                    // data.buttonIcon3 = \"texture/commonRes/button/cancelBtn\";\r\n                    // data.button3Func = function(){\r\n                    //     clickLayer.getComponent(\"commonTipsLayer\").clickCloseBtn();\r\n                        \r\n                    // };\r\n\r\n                    // clickLayer.parent = this.node.parent.parent.parent.parent;\r\n                    // clickLayer.getComponent(\"commonTipsLayer\").initData(data);   \r\n                    // clickLayer.setPosition(0,0);\r\n                };\r\n                listData.push(item);\r\n            }\r\n        }\r\n\r\n        for(var i=0; i<listData.length; i++){\r\n            var item = cc.instantiate(this.mallItem);\r\n            item.parent = this.content;\r\n            item.getComponent(\"MallScrollListItem\").initView(listData[i]);      \r\n            //.初始化位置\r\n            var x = 140 + (i)%3 * (item.width + 10);\r\n            var y = -110-Math.floor((i)/3)*(item.height + 5); \r\n            item.setPosition(x,y);\r\n        }\r\n\r\n        var newHeight = (this.mallItem.data.height+5) * Math.ceil(listData.length/3);\r\n        this.content.height = (newHeight>self.maxHeight)?self.maxHeight:newHeight;\r\n        \r\n    }\r\n});\r\n\r\nmodule.exports = MallScrollList;"]}