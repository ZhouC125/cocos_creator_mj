{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\game\\gameOver/assets\\scripts\\hall\\game\\gameOver\\XueLiuGameOverLayer.js"],"names":["GameDefs","require","Resources","cc","Class","extends","Component","properties","resultList","default","type","ScrollView","playerPrefab","Prefab","showPlayerNode","Node","onLoad","onDestroy","stopLeftTimer","onEnable","startLeftTimer","HallResources","recordPlayerLogToServer","recordList","count_page","init","stWinStruct","players","playersName","playerAvatorUrls","myChair","showDetailResult","m_showDetailResult","m_stWinStruct","m_playersInfo","m_stPlayerName","m_playerAvators","m_myChair","m_leftTimerStop","m_leftTime","initData","getLeftLeaveTime","leftTimerNode","node","getChildByName","active","getComponent","Label","string","self","callback","label","TSCommon","performWithDelay","getInstance","getGameLib","leaveGameRoom","onLeaveGameClicked","DeskScene","parent","onDetailResultClicked","onReadyClicked","GameCfg","dispatchEvent","GAME_RESTART","isReady","removeAllChildren","maxScore","nFinalScore","i","PLAYER_COUNT","console","log","playerResultItem","instantiate","setPosition","cbWriteScoreTimes","stSingleScore"],"mappings":"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","file":"XueLiuGameOverLayer.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\game\\gameOver","sourcesContent":["/**\r\n * 此处结算界面是金币场内的结算界面\r\n */\r\n\r\n\r\nvar GameDefs = require(\"GameDefs\");\r\nvar Resources = require(\"Resources\");\r\nimport {TSCommon} from \"../../TSCommon\";\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        resultList:{\r\n            default: null,\r\n            type: cc.ScrollView,\r\n        },\r\n        playerPrefab:{\r\n            default: null,\r\n            type: cc.Prefab,\r\n        },\r\n        showPlayerNode:{\r\n            default: null,\r\n            type: cc.Node,\r\n        }\r\n    },\r\n\r\n    onLoad:function(){\r\n        \r\n    },\r\n\r\n    onDestroy:function(){\r\n        this.stopLeftTimer();\r\n    },\r\n\r\n    onEnable:function(){\r\n        \r\n\r\n        this.startLeftTimer();\r\n\r\n        var HallResources = require(\"HallResources\");\r\n        HallResources.recordPlayerLogToServer(HallResources.recordList.count_page);\r\n    },\r\n\r\n    \r\n    /*\r\n     * 初始化\r\n     * @huType 胡牌类型 \r\n     * @fanNum 胡牌番数\r\n     * @laiyouValue 癞油字的牌值\r\n    */\r\n    init:function(stWinStruct, players,playersName,playerAvatorUrls,myChair,showDetailResult){\r\n        this.m_showDetailResult = showDetailResult;\r\n        this.m_stWinStruct = stWinStruct;\r\n        this.m_playersInfo = players;\r\n        this.m_stPlayerName = playersName;\r\n        this.m_playerAvators = playerAvatorUrls;\r\n        this.m_myChair = myChair;\r\n        this.m_leftTimerStop = false;\r\n        this.m_leftTime = 25;\r\n        this.initData();\r\n    },\r\n\r\n\r\n    getLeftLeaveTime:function(){\r\n        return this.m_leftTime;\r\n    },\r\n\r\n    //开始离开房间的按钮\r\n    startLeftTimer:function(){\r\n        var leftTimerNode = this.node.getChildByName(\"ready_btn\").getChildByName(\"leave_timer\");\r\n        leftTimerNode.active = true;\r\n        leftTimerNode.getComponent(cc.Label).string = \"(\" + this.m_leftTime + \")\";\r\n\r\n        var self = this;\r\n        var callback = function(){\r\n            if(self.m_leftTimerStop){\r\n                return;\r\n            }\r\n\r\n            self.m_leftTime -= 1;\r\n            var label = leftTimerNode.getComponent(cc.Label);\r\n            label.string = \"(\" + self.m_leftTime + \")\";\r\n\r\n            if(self.m_leftTime > 0){\r\n                TSCommon.performWithDelay(self, callback, 1);\r\n            }\r\n            else{\r\n                leftTimerNode.getComponent(cc.Label).string = \"\";\r\n                leftTimerNode.active = false;\r\n                require('GameLibSink').getInstance().getGameLib().leaveGameRoom();\r\n            }\r\n        }\r\n\r\n        TSCommon.performWithDelay(this, callback, 1);\r\n    },\r\n\r\n    stopLeftTimer:function(){\r\n        this.m_leftTimerStop = true;\r\n    },\r\n\r\n    //离开按钮点击\r\n    onLeaveGameClicked:function(){\r\n        var DeskScene = this.node.parent.getComponent(\"DeskScene\");\r\n        \r\n        // if(DeskScene.IsCXZ()){\r\n        //     G.goldGameReady = 3;\r\n        // }\r\n        // else{\r\n        //     G.goldGameReady = 4;\r\n        // }\r\n\r\n        require('GameLibSink').getInstance().getGameLib().leaveGameRoom();       \r\n    },\r\n\r\n\r\n    //详细结算按钮\r\n    onDetailResultClicked:function(){\r\n        if(this.m_showDetailResult){\r\n            this.m_showDetailResult();\r\n        }\r\n    },\r\n\r\n    //准备按钮\r\n    onReadyClicked:function(){\r\n    \r\n        this.node.active = false;\r\n        var GameCfg = require(\"GameCfg\");\r\n        TSCommon.dispatchEvent(GameCfg.GAME_RESTART, {isReady : true});\r\n    },\r\n\r\n    initData:function(){\r\n        this.showPlayerNode.removeAllChildren();\r\n        //四个玩家的内容\r\n        var maxScore = this.m_stWinStruct.nFinalScore[0];\r\n        for (var i = 1;i<GameDefs.PLAYER_COUNT; i++){\r\n            if (maxScore < this.m_stWinStruct.nFinalScore[i])\r\n            {\r\n                maxScore = this.m_stWinStruct.nFinalScore[i];\r\n            }\r\n        }\r\n        console.log(\"这次结算的最高分\"+maxScore);\r\n        for (var i = 0;i<GameDefs.PLAYER_COUNT; i++){\r\n            var playerResultItem = cc.instantiate(this.playerPrefab);\r\n            playerResultItem.parent = this.showPlayerNode;\r\n            playerResultItem.getComponent(\"XueLiuPlayerResultItem\").initData(this.m_stPlayerName[i],this.m_playerAvators[i],this.m_stWinStruct.nFinalScore[i],maxScore,i,this.m_myChair);   \r\n            playerResultItem.setPosition(-70 + i*290,0);\r\n        }\r\n        console.log(\"滑动列表数据处理\");\r\n        this.resultList.getComponent(\"XueLiuGameOverScrollList\").initData(this.m_stWinStruct.cbWriteScoreTimes[this.m_myChair],this.m_stWinStruct.stSingleScore[this.m_myChair],this.m_myChair);\r\n    },\r\n});\r\n"]}