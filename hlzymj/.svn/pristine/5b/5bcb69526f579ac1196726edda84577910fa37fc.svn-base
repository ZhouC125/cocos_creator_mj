{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\game/assets\\scripts\\hall\\game\\GameLibSink.js"],"names":["ClientFrameSink","require","HallResources","GameLibSink","cc","Class","statics","instance","m_gameLib","_clientFrameSink","ctor","CGameLib","getInstance","run","gameID","logonIP","logonPort","webRoot","createGamelib","getGameLib","onLogonFinished","log","onPlazaGoldChanged","onRefreshUserInfo","onChargeInfoRefeshRet","result","onSendSpeakerRet","cbRetCode","onLogonFailed","errorStr","nFaileType","onEnteredGameRoom","tableCount","chairCount","m_chairCount","director","loadScene","removeLoading","recordPlayerLogToServer","recordList","room_res_end","onEnterGameRoomFailed","onRoomConnectClosed","onEnterGameView","onLeaveGameView","onRoomUserEnter","userID","onRoomUserExit","onRoomUserInfoUpdated","pMyself","getMyself","getUserID","logonInfo","getUserLogonInfo","dwGold","getGold","nScore","getScoreField","gamelibcommon","enScore_Score","nWin","enScore_Win","nLose","enScore_Loss","nFlee","enScore_Flee","nDraw","enScore_Draw","m_dataEventHandler","emit","user","TSCommon","performWithDelay","pUser","getUser","getUserTableID","onTableInfoChanged","tableID","onRecvHallChat","chat","onRecvTableChat","chatMsg","onShowAlertMsg","msg","onLogonGameRoomSucceeded","onChangeUserInfoRet","onTaskInfo","pTaskList","onTaskGift","nTaskID","onNewStatus","nNewMissionDone","nNewMail","nNewActivity","nNewFriend","bLoginGift","onBankInfo","nBankAmount","nBankCapacity","onCreatePrivateTableFailed","lpszErrorMsg","onEnterPrivateTableFailed","onGameBankOpeReturn","succeeded","gold","bank","onShowGameSystemMsg","onSpeaker","priorty","module","exports"],"mappings":"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","file":"GameLibSink.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\game","sourcesContent":["﻿var ClientFrameSink  = require('ClientFrameSink');\r\nimport {CGameLib} from \"../gamelib/CGameLib\";\r\nimport {TSCommon} from \"../TSCommon\";\r\nimport {gamelibcommon} from \"../gamelib/gamelibcommon\"\r\nvar HallResources = require(\"HallResources\");\r\nvar GameLibSink = cc.Class({\r\n\tstatics:{\r\n\t\tinstance:null,\r\n\t},\r\n    m_gameLib:null,\r\n    _clientFrameSink:null,\r\n\r\n    ctor:function()\r\n    {\r\n        this._clientFrameSink = new ClientFrameSink();\r\n        this.m_gameLib = CGameLib.getInstance();\r\n    },\r\n\r\n    run:function(gameID,logonIP,logonPort,webRoot)\r\n    {\r\n\r\n        // cc.log(\"call the GameLibSink of run\");\r\n        // cc.log(\"logonIP =========\", logonIP);\r\n        // cc.log(\"logonPort ========\", logonPort);\r\n        // cc.log(\"webRoot =======\", webRoot);\r\n        if (gameID){\r\n            CGameLib.getInstance().createGamelib(gameID,1,this,this._clientFrameSink,\r\n            10001,10101,logonIP,logonPort,webRoot);\r\n        }\r\n        //require('HallResources').getInstance().showLoading();\r\n    },\r\n\t\r\n    getGameLib:function()\r\n    {\r\n        return this.m_gameLib;\r\n    },\r\n\r\n    onLogonFinished:function(){\r\n        cc.log(\"onLogonFinished\");\r\n        // CGameLib.getInstance().autoEnterGameRoom(\"练习场1\")\r\n\r\n\r\n        // cc.director.loadScene(\"GameScene\");\r\n    },\r\n\t\r\n    onPlazaGoldChanged(){\r\n\r\n    },\r\n\r\n    onRefreshUserInfo(){\r\n\r\n    },\r\n\r\n    onChargeInfoRefeshRet(result){\r\n\r\n    },\r\n\r\n    onSendSpeakerRet(cbRetCode){\r\n\r\n    },\r\n\r\n    onLogonFailed(errorStr, nFaileType){\r\n\r\n    },\r\n\r\n    onEnteredGameRoom(tableCount, chairCount){\r\n        cc.log(\"GameLibSink:onEnteredGameRoom\")\r\n\r\n        this.m_chairCount = chairCount;\r\n\r\n        cc.director.loadScene('XueLiuGameScene', function(){\r\n            require('HallResources').getInstance().removeLoading();\r\n\r\n            //记录日志\r\n            HallResources.recordPlayerLogToServer(HallResources.recordList.room_res_end);\r\n        });\r\n\r\n        cc.log(\"onEnteredGameRoom\");\r\n        \r\n        //CGameLib.getInstance().autoSit();\r\n    },\r\n\r\n    onEnterGameRoomFailed(errorStr){\r\n\r\n    },\r\n\r\n    onRoomConnectClosed(){\r\n        // cc.log(\" --------------onRoomConnectClosed--------------\")\r\n        cc.director.loadScene('HallPlatformScene');\r\n    },\r\n\r\n    onEnterGameView(){\r\n\r\n    },\r\n\r\n    onLeaveGameView(){\r\n    },\r\n\r\n    onRoomUserEnter(userID){\r\n        cc.log(\"onRoomUserEnter\");\r\n    },\r\n\r\n    onRoomUserExit(userID){},\r\n\r\n\r\n    onRoomUserInfoUpdated(userID){\r\n        var pMyself = this.getGameLib().getMyself();\r\n\r\n        if(!pMyself){\r\n            return;\r\n        }\r\n\r\n        if(userID == pMyself.getUserID()){\r\n            var logonInfo = this.getGameLib().getUserLogonInfo()\r\n            logonInfo.dwGold = pMyself.getGold()\r\n            logonInfo.nScore = pMyself.getScoreField(gamelibcommon.enScore_Score)\r\n            logonInfo.nWin = pMyself.getScoreField(gamelibcommon.enScore_Win)\r\n            logonInfo.nLose = pMyself.getScoreField(gamelibcommon.enScore_Loss)\r\n            logonInfo.nFlee = pMyself.getScoreField(gamelibcommon.enScore_Flee)\r\n            logonInfo.nDraw = pMyself.getScoreField(gamelibcommon.enScore_Draw)\r\n\r\n            if(this._clientFrameSink.m_dataEventHandler){\r\n                this._clientFrameSink.m_dataEventHandler.emit(\"updateUserInfo\", {\r\n                    user : pMyself, \r\n                })\r\n            }\r\n            else{\r\n                TSCommon.performWithDelay(this, this.onRoomUserInfoUpdated, 0.2);\r\n            }\r\n        }\r\n        else{\r\n            var pUser = this.getGameLib().getUser(userID);\r\n            if(!pUser)\r\n                return;\r\n\r\n            if(pMyself.getUserTableID() != pUser.getUserTableID())\r\n                return;\r\n\r\n            if(this._clientFrameSink.m_dataEventHandler){\r\n                this._clientFrameSink.m_dataEventHandler.emit(\"updateUserInfo\", {\r\n                    user : pMyself, \r\n                })\r\n            }\r\n            else{\r\n                TSCommon.performWithDelay(this, this.onRoomUserInfoUpdated, 0.2);\r\n            }\r\n        }\r\n    },\r\n\r\n    onTableInfoChanged(tableID){\r\n\r\n    },\r\n\r\n    onRecvHallChat(chat){\r\n        \r\n    },\r\n\r\n    //收到语音聊天的消息\r\n    onRecvTableChat(chat){\r\n        if(this._clientFrameSink.m_dataEventHandler){\r\n            this._clientFrameSink.m_dataEventHandler.emit(\"onRecvTableChat\", {\r\n                chatMsg:chat, \r\n            })\r\n        }\r\n        else{\r\n            TSCommon.performWithDelay(this, this.onRecvTableChat, 0.2);\r\n        }\r\n    },\r\n\r\n    onShowAlertMsg(msg){},\r\n\r\n    onLogonGameRoomSucceeded(){},\r\n\r\n    onChangeUserInfoRet(cbRetCode){},\r\n\r\n    onTaskInfo(cbRetCode, pTaskList){},\r\n\r\n    onTaskGift(nTaskID, cbRetCode){},\r\n\r\n    onNewStatus(nNewMissionDone, nNewMail, nNewActivity, nNewFriend, bLoginGift){},\r\n\r\n    onBankInfo(nBankAmount, nBankCapacity){},\r\n\r\n    onCreatePrivateTableFailed(lpszErrorMsg){},\r\n\r\n    onEnterPrivateTableFailed(lpszErrorMsg){},\r\n\r\n\r\n    onGameBankOpeReturn(succeeded, gold, bank){},\r\n\r\n    onShowGameSystemMsg(msg){},\r\n\r\n    onSpeaker(msg, priorty){},\r\n});\r\n\r\nGameLibSink.getInstance=function(){\r\n    if(GameLibSink.instance == null)\r\n    {\r\n        GameLibSink.instance = new GameLibSink();\r\n    }\r\n    return GameLibSink.instance;\r\n};\r\n\r\nmodule.exports = GameLibSink"]}