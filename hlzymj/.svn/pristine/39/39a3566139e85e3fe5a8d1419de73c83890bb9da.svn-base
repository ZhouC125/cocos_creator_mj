{"version":3,"sources":["GameRoom.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\gamelib\\room","sourcesContent":["﻿import { ByteArray } from \"../../common/ByteArray\";\r\nimport { TSCommon } from \"../../TSCommon\";\r\nimport { UserInfo } from \"../UserInfo\";\r\nimport { IGameLibSink } from \"../IGameLibSink\";\r\nimport { IClientFrameSink } from \"../IClientFrameSink\";\r\nimport { ClientFrame } from \"../frame/ClientFrame\";\r\nimport { tagGameServerEx } from \"../tagGameServerEx\";\r\nimport { UserManager } from \"../room/UserManager\";\r\nimport { TableManager } from \"../room/TableManager\";\r\nimport { GameCmds } from \"../room/GameCmds\";\r\nimport { tagClientInfo } from \"../tagClientInfo\";\r\nimport { CGameLib } from \"../CGameLib\";\r\nimport { ScoreParser } from \"./ScoreParser\";\r\nimport { tagUserInfoBroad } from \"./tagUserInfoBroad\";\r\nimport { gamelibcommon } from \"../gamelibcommon\";\r\nimport { Chair } from \"../Chair\";\r\nimport { CMD_GR_BroadCast_UserStatus } from \"./CMD_GR_BroadCast_UserStatus\";\r\nimport { HtmlChat } from \"./HtmlChat\";\r\nimport { CMD_GR_BroadCast_UserScore } from \"../room/GameCmds\";\r\nimport { CMD_GR_BroadCast_TableStatus } from \"../room/GameCmds\";\r\nimport { CMD_GR_GameInfo } from \"../room/GameCmds\";\r\nimport { CMD_CM_SysteMessage } from \"../CMD_CM_SysteMessage\";\r\nimport { CMD_CM_SysteMessageEx } from \"../CMD_CM_SysteMessage\";\r\nimport { CMD_GR_RoomOption } from \"../room/GameCmds\";\r\nimport { CMD_GR_Req_UserSit } from \"../room/GameCmds\";\r\nimport { CMD_GR_Req_UserLookOn } from \"../room/GameCmds\";\r\nimport { FrameCmds } from \"../frame/FrameCmds\";\r\nimport { Table } from \"../Table\";\r\nimport { CMD_GR_Logon_ByVnet } from \"./CMD_GR_Logon_ByVnet\";\r\nimport PublicUserInfo = require(\"../../PublicUserInfo\");\r\nimport HallUtils = require(\"../../HallUtils\");\r\nimport { StringConvert } from \"../../common/StringConvert\";\r\n\r\nexport class GameRoom {\r\n    private m_socket: WebSocket;\r\n    private m_mySelf: UserInfo;\r\n    private m_sink: IGameLibSink;\r\n    private m_clientFrameSink: IClientFrameSink;\r\n    private m_clientFrame: ClientFrame;\r\n    private m_dwLastPingTime: number;\r\n    private m_pGameServer: tagGameServerEx;\r\n    private m_dwUserID: number;\r\n    private m_gameVersion: number;\r\n    private m_userManager: UserManager;\r\n    private m_tableManager: TableManager;\r\n    private m_wLastFindTable: number;\r\n    private m_pGameLib: CGameLib;\r\n    private m_bIsPrivateRoom : boolean;\r\n    private m_dwLastSendTableChat: number;\r\n    private m_cbLastChairID: number;\r\n    private m_nNetLag: number;\r\n    private m_nSendPingTime: number;\r\n    private m_timer_ping: number;\r\n    private m_lostPingCount: number;\r\n\r\n    private m_uPort: number;\r\n    private m_strServerIP: string;\r\n    private m_dwServerIP: number;\r\n    private m_szPass: string;    \r\n\r\n    private LAST_PING_LOST_TIME: number = 5000;\r\n    \r\n    private _publicUserInfo: PublicUserInfo;\r\n    public constructor(pGameLib: CGameLib,publicUserInfo) {\r\n        this.m_socket = null;\r\n        this.m_mySelf = null;\r\n        \r\n        \r\n        this.m_pGameLib = pGameLib;\r\n        this.m_clientFrame = new ClientFrame(this,pGameLib);\r\n        this.m_dwLastPingTime = 0;\r\n        this.m_lostPingCount = 0;\r\n        this.m_userManager = new UserManager();\r\n        this._publicUserInfo = publicUserInfo;\r\n    }\r\n\r\n    public setSink(pSink){\r\n        this.m_sink = pSink;\r\n    }\r\n\r\n\r\n    public enterGameRoom(gameServer: tagGameServerEx, userID: number, password: string, version: number): boolean{\r\n        if (gameServer == null)\r\n            return false;\r\n        if (this.isServicing()) {\r\n            this.trace(\"enterGameRoom close\");\r\n            this.m_socket.close();\r\n            this.m_socket = null;\r\n        }\r\n        this.m_dwServerIP = gameServer.dwServerIP;\r\n        this.m_strServerIP = this.changeIP(this.m_dwServerIP);\r\n        this.m_uPort = gameServer.uServerPort;\r\n        this.m_pGameServer = gameServer;\r\n        this.m_dwUserID = userID;\r\n        this.m_szPass = password;\r\n        this.m_gameVersion = version;\r\n        if (this.m_socket == null) {\r\n            this.initWebSocket(this.m_strServerIP, this.m_uPort);\r\n        }\r\n    }\r\n\r\n    public enterGameRoomByIP(ipaddress: string, port: number, userID: number, password: string, version: number, gameServer: tagGameServerEx) {\r\n        if (this.isServicing()) {\r\n            this.trace(\"enterGameRoomByIP close\");\r\n            this.m_socket.close();\r\n            this.m_socket = null;\r\n        }        \r\n        this.m_strServerIP = ipaddress;\r\n        this.m_uPort = port;\r\n        this.m_pGameServer = gameServer;\r\n        this.m_dwUserID = userID;\r\n        this.m_szPass = password;\r\n        this.m_gameVersion = version;\r\n        if (this.m_socket == null) {\r\n            this.initWebSocket(this.m_strServerIP, this.m_uPort);\r\n        }\r\n    }\r\n\r\n    public getCurrentGameRoom(){\r\n        if (!this.isServicing())\r\n            return;\r\n        return this.m_pGameServer;\r\n    }\r\n\r\n    public isServicing(): boolean {\r\n        if (this.m_socket == null)\r\n            return false;\r\n        if(this.m_socket.readyState != WebSocket.OPEN)\r\n            return false;\r\n        return this.m_mySelf != null;\r\n    }\r\n\r\n    private changeIP(ip: number): string {\r\n        var ba: ByteArray = new ByteArray();\r\n        ba.writeUnsignedInt(ip);\r\n        ba.position = 0;\r\n        return ba.readUnsignedByte() + \".\" + ba.readUnsignedByte() + \".\" + ba.readUnsignedByte() + \".\" + ba.readUnsignedByte();\r\n    }\r\n\r\n    private initWebSocket(serverIP: string,serverPort:number): void {\r\n        //创建 WebSocket 对象\r\n        // this.m_socket = new WebSocket();\r\n        // //设置数据格式为二进制，默认为字符串\r\n        // this.m_socket.type = WebSocket.TYPE_BINARY;\r\n        // //添加收到数据侦听，收到数据会调用此方法\r\n        // this.m_socket.addEventListener(egret.ProgressEvent.SOCKET_DATA, this.onReceiveMessage, this);\r\n        // //添加链接打开侦听，连接成功会调用此方法\r\n        // this.m_socket.addEventListener(egret.Event.CONNECT, this.onSocketOpen, this);\r\n        // //添加链接关闭侦听，手动关闭或者服务器关闭连接会调用此方法\r\n        // this.m_socket.addEventListener(egret.Event.CLOSE, this.onSocketClose, this);\r\n        // //添加异常侦听，出现异常会调用此方法\r\n        // this.m_socket.addEventListener(egret.IOErrorEvent.IO_ERROR, this.onSocketError, this);\r\n        // //连接服务器\r\n        // this.m_socket.connect(serverIP, serverPort);\r\n        \r\n        serverIP = HallUtils.getDoMainFromIp(serverIP);\r\n       \r\n\r\n        TSCommon.log(\"connect to \" + serverIP + \":\" + serverPort);\r\n        this.m_socket = new WebSocket(\"wss://\" + serverIP + \":\" + serverPort);\r\n        //设置数据格式为二进制，默认为字符串\r\n        this.m_socket.binaryType = \"arraybuffer\";\r\n        // //添加收到数据侦听，收到数据会调用此方法\r\n        // this.m_socket.addEventListener(egret.ProgressEvent.SOCKET_DATA, this.onReceiveMessage, this);\r\n        // //添加链接打开侦听，连接成功会调用此方法\r\n        // this.m_socket.addEventListener(egret.Event.CONNECT, this.onSocketOpen, this);\r\n        // //添加链接关闭侦听，手动关闭或者服务器关闭连接会调用此方法\r\n        // this.m_socket.addEventListener(egret.Event.CLOSE, this.onSocketClose, this);\r\n        // //添加异常侦听，出现异常会调用此方法\r\n        // this.m_socket.addEventListener(egret.IOErrorEvent.IO_ERROR, this.onSocketError, this);\r\n        var socket: WebSocket = this.m_socket;\r\n        var self = this;\r\n        this.m_socket.onopen = function (evt) {\r\n            self.onSocketOpen();\r\n        };        \r\n\r\n        this.m_socket.onmessage = function (event) {           \r\n            self.onReceiveMessage(event.data);\r\n        };\r\n\r\n        this.m_socket.onerror = function (event) {\r\n            self.onSocketError();\r\n            self.m_socket = null;\r\n        };\r\n\r\n        this.m_socket.onclose = function (event) {\r\n            self.trace(\"this.m_socket.onclose\");\r\n            self.onSocketClose();\r\n            self.m_socket = null;\r\n        };\r\n    }  \r\n\r\n    private onSocketOpen(): void {\r\n        this.trace(\"WebSocketOpen\");\r\n        this.sendLoginCmd();\r\n        this.m_dwLastPingTime =new Date().getTime();\r\n        this.startCheckPing()\r\n    }\r\n\r\n    private onSocketClose(): void {\r\n        this.trace(\"WebSocketClose\");\r\n        this.m_mySelf = null;\r\n        this.m_pGameServer = null;\r\n        if (this.m_userManager)\r\n            this.m_userManager.clearAllUser();\r\n        this.m_clientFrame.clear();\r\n        /*if (this.m_socket)\r\n            this.m_socket.close();*/\r\n        \r\n        this.m_socket = null;\r\n        \r\n        this.m_cbLastChairID = 0xff;\r\n        this.m_pGameLib.refreshGold();\r\n        this.m_sink.onRoomConnectClosed();\r\n        this.stopCheckPing();\r\n    }\r\n\r\n    private onSocketError(): void {\r\n        this.trace(\"WebSocketError\");\r\n    }\r\n\r\n    private onReceiveMessage(arrayBuffer: ArrayBuffer): void {\r\n        //创建 ByteArray 对象\r\n        var byte: ByteArray = new ByteArray(arrayBuffer);\r\n        //读取数据\r\n        var nLen = byte.length;\r\n        var cbMainCmd = byte.readUnsignedByte();\r\n        this.trace(\"onReceiveMessage mainCmd = \" + cbMainCmd + \",len = \" + nLen);\r\n\r\n        if(cbMainCmd < 100){\r\n            var data: ByteArray = new ByteArray();            \r\n            byte.readBytes(data);\r\n            this.recvData(cbMainCmd, 0, 0, data);\r\n            return;\r\n        }\r\n\r\n        var cbSubCmd = byte.readUnsignedByte();\r\n        var cbHandleCode = byte.readUnsignedByte();\r\n                \r\n        var nRealDataLen = nLen - 4;\r\n        if (nRealDataLen <= 0) {\r\n            if (nLen < 3)\r\n                return;\r\n\r\n            this.recvData(cbMainCmd, cbSubCmd, cbHandleCode, null);\r\n            return\r\n        }\r\n        var data: ByteArray = new ByteArray();\r\n        byte.readUnsignedByte();\r\n        byte.readBytes(data);\r\n        this.recvData(cbMainCmd, cbSubCmd, cbHandleCode, data);\r\n    }\r\n\r\n    private recvData(cbMainCmd: number, cbSubCmd: number, cbHandleCode: number, buf: ByteArray) {\r\n        var s: string = \"Recv other MainCmd = \" + cbMainCmd + \" SubCmd = \" + cbSubCmd;\r\n        //this.trace(s);\r\n        switch (cbMainCmd) {\r\n            case GameCmds.MAIN_GR_LOGON:\r\n                return this.recvLogonMessage(cbSubCmd, cbHandleCode, buf);\r\n            case GameCmds.MAIN_GR_ROOM_STATUS:\r\n                return this.recvRoomStatus(cbSubCmd, cbHandleCode, buf);            \r\n            case GameCmds.MAIN_GR_CONFIG:\r\n                return this.recvConfigMsg(cbSubCmd, cbHandleCode, buf);\r\n            case GameCmds.MAIN_GR_USER:\r\n                return this.recvUserMessage(cbSubCmd, cbHandleCode, buf);\r\n            case GameCmds.CMD_HTML_HALL_CHAT:\r\n                return ;\r\n            case GameCmds.CMD_HTML_TABLE_CHAT:\r\n                return this.recvTableChat(buf);            \r\n            case GameCmds.CMD_MANAGER:\r\n                // 网管命令，暂时不处理                \r\n                return true;\r\n            case GameCmds.CMD_SERVER_PING:\r\n                // 服务器ping\r\n                //if (nLen!=1+4) return true;\r\n                var data: ByteArray = new ByteArray();\r\n                data.writeInt(0);\r\n                this.sendOldCommand(GameCmds.CMD_SERVER_PING, GameCmds.IDC_SP_ANWSER_PING, data);\r\n                return true;\r\n\r\n            case GameCmds.MAIN_CM_SERVICE:\r\n                return this.recvCMMessage(cbSubCmd, buf);\r\n            case GameCmds.MAIN_CM_DOWN_LOAD:\r\n                // 下载，不处理\r\n                return true;\r\n            case GameCmds.CMD_GAME: // 游戏命令\r\n                this.m_clientFrame.recvGameCmd(buf);\r\n                return true;\r\n            case GameCmds.CMD_USER:\r\n                {\r\n                    var cbSubCmd = buf.readUnsignedByte();\r\n                    if (cbSubCmd == GameCmds.IDS_USER_ANS_SIT_DOWN) {\r\n                        var bEnable = (buf.readByte() != 0);\r\n                        if (!bEnable)\r\n                            this.m_sink.onShowAlertMsg(\"坐下失败\");\r\n                    }\r\n                    return true;\r\n                }\r\n            case GameCmds.CMD_PING_USER:\r\n                this.recvAnswerPing();\r\n                return true;\r\n            default:\r\n                var s: string = \"Recv other MainCmd = \" + cbMainCmd + \" SubCmd = \" + cbSubCmd;\r\n                this.trace(s);\r\n                break;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private recvLogonMessage(cbSubCmd: number, cbHandleCode: number, buf: ByteArray): boolean\t{\r\n        buf.position = 0;\r\n        switch (cbSubCmd) {\r\n            case GameCmds.SUB_GR_LOGON_SUCCESS:\r\n                this.trace(\"SUB_GR_LOGON_SUCCESS\");\r\n                var uUserID: number = buf.readUnsignedInt();\r\n                //GlobalObjects.g_MainPage.SetConnectingViewContent(\"登录房间成功，正在获取房间信息,请稍候......\");\r\n\r\n                this.m_userManager.clearAllUser();\r\n                this.m_userManager.setMyDBID(uUserID);\r\n                this.m_sink.onLogonGameRoomSucceeded();\r\n                break;\r\n            case GameCmds.SUB_GR_LOGON_FINISH:\r\n                //发送房间设置\r\n                this.sendOptionsMessage();\r\n                this.m_sink.onEnteredGameRoom(this.m_tableManager.getTableCount(), this.m_tableManager.getChairCount());                \r\n                this.m_dwLastSendTableChat = 0\r\n                break;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private recvRoomStatus(cbSubCmd: number, cbHandleCode: number, buf: ByteArray): boolean{\r\n        switch (cbSubCmd) {\r\n            case GameCmds.SUB_GR_BROADCAST_TABLE_STATUS:\t\t//广播桌子状态\r\n                {\r\n                    //trace(\"SUB_GR_BROADCAST_TABLE_STATUS\");\r\n                    //if (m_TableManager == null)\r\n                    //\treturn true;\r\n                    //处理数据\r\n                    var pTableStatus: CMD_GR_BroadCast_TableStatus = new CMD_GR_BroadCast_TableStatus();\r\n                    pTableStatus.deserialize(buf);\r\n                    var table: Table = this.m_tableManager.getTable(pTableStatus.wTableID);\r\n\r\n                    if (table == null) {\r\n                        this.trace(\"查找桌子失败\");\r\n                        return false;\r\n                    }\r\n                    table._isLocked = ((pTableStatus.cbTableStatus & Table.TABLE_LOCKED) != 0);\r\n                    table._isPlaying = ((pTableStatus.cbTableStatus & Table.TABLE_PLAYING) != 0);\r\n                    this.m_sink.onTableInfoChanged(pTableStatus.wTableID);\r\n                    return true;\r\n                }\r\n\r\n            default:\r\n                {\r\n                    return true;\r\n                }\r\n        }\r\n    }\r\n\r\n    private recvConfigMsg(cbSubCmd: number, cbHandleCode: number, buf: ByteArray): boolean{\r\n        switch (cbSubCmd) {\r\n            case GameCmds.SUB_GR_ROOM_INFO:\t\t\t//房间配置 \r\n                {\r\n                    this.trace(\"SUB_GR_ROOM_INFO\");\r\n                    var pGameInfo: CMD_GR_GameInfo = new CMD_GR_GameInfo();\r\n                    pGameInfo.deserialize(buf);\r\n                    if(pGameInfo.bufReserved.readUnsignedByte() > 1){\r\n                        pGameInfo.bufReserved.readUnsignedByte(); \r\n                        let cbPrivate = pGameInfo.bufReserved.readUnsignedByte();       //数组从0 开始  第一个值解析的是长度\r\n\t\t\t            this.m_bIsPrivateRoom = (cbPrivate > 0);\r\n                    }\r\n                    this.m_tableManager = new TableManager(pGameInfo.wTableCount, pGameInfo.cbTableUser);\r\n                    return true;\r\n                }\r\n            case GameCmds.SUB_GR_SCORE_HEADER:\t\t//分数信息\r\n                {\r\n                    //Trace(\"GameCmds.SUB_GR_SCORE_HEADER\");\r\n                    ScoreParser.getInstance().setScoreHeader(buf);\r\n                    return true;\r\n                }  \r\n            case GameCmds.SUB_GR_TABLE_INFO:\t\t//分数信息\r\n                {\r\n                    var tableID: number = buf.readByte();\r\n                    var table: Table = this.m_tableManager.getTable(tableID);\r\n                    if (table) {\r\n                        var tableBuf = new ByteArray();\r\n                        buf.readBytes(tableBuf);\r\n                        table.setTableBuffer(tableBuf);\r\n                    }\r\n                    return true;\r\n                }\r\n            case GameCmds.SUB_GR_COLUMN_INFO: {\r\n                this.trace(\"SUB_GR_COLUMN_INFO \" + buf.length);\r\n                return true;\r\n            }    \r\n            default:\r\n                {\r\n                    this.trace(\"UnKnow MAIN_GR_CONFIG Message\" + cbSubCmd);\r\n                    return true;\r\n                }\r\n        }\r\n    }\r\n\r\n    private recvUserMessage(cbSubCmd:number, cbHandleCode:number, buf:ByteArray):boolean\t{\r\n        var ret: boolean;\r\n        switch (cbSubCmd) {\r\n            case GameCmds.SUB_GR_BROADCAST_USER_COME:\t\t//用户进入\r\n                {\r\n                    ret = this.onSubUserComeMessage(buf);\r\n                    break;\r\n                }\r\n            case GameCmds.SUB_GR_BROADCAST_USER_LEFT:\t\t//用户离开\r\n                {\r\n                    ret = this.onSubUserLeftMessage(buf);\r\n                    break;\r\n                }\r\n            case GameCmds.SUB_GR_BROADCAST_USER_STATUS:\t\t//用户状态\r\n                {\r\n                    ret = this.onSubUserStatusMessage(buf);\r\n                    break;\r\n                }\r\n            case GameCmds.SUB_GR_BROADCAST_USER_SCORE:\t\t//用户分数\r\n                {\r\n                    ret = this.onSubUserScoreMessage(buf);\r\n                    break;\r\n                }\r\n            case GameCmds.SUB_GR_CAN_SIT_TABLE_RESPONSE:\r\n                {\r\n                    return true;\r\n                }\r\n            case GameCmds.SUB_GR_BROADCAST_USER_FAME_EX:\r\n                {\r\n                    return false;\r\n                }\r\n            case GameCmds.SUB_GR_FRAG_COUNT:\r\n                {\r\n                    //this.m_pGameLib.updateMyFragCount(buf.readInt());\r\n                    this._publicUserInfo.nFrag = buf.readUnsignedInt();\r\n                    //EventDispatcher.getInstance().dispatch(EventDispatcher.onFragChanged, this._publicUserInfo.nFrag);\r\n                    this.m_sink.onRoomUserInfoUpdated(this.m_mySelf.getUserID());\r\n                    ret = true;\r\n                    break;\r\n                }\r\n            case GameCmds.SUB_GR_BANK_VALUE:\r\n                {\r\n                    this.m_mySelf._bankValue = buf.readInt();\r\n                    ret = true;\r\n                    break;\r\n                }\r\n            default:\r\n                {\r\n                    this.trace(\"MAIN_GR_USER Message subid = \" + cbSubCmd);\r\n                    // 其他新命令码暂时不处理\r\n                    ret = true;\r\n                }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private onSubUserComeMessage(buf:ByteArray):boolean{\r\n        var user: tagUserInfoBroad = new tagUserInfoBroad();\r\n        user.deserialize(buf);\r\n        this.trace(user.szName + \"进来了\");\r\n        var bExist = true\r\n        var userItem = this.m_userManager.getUser(user.wUserIndex);\r\n\r\n        if (userItem == null) {\r\n            userItem = new UserInfo();\r\n            bExist = false\r\n        }\r\n        // 如果是我自己        \r\n        userItem._name = user.szName;\r\n        userItem._userIndex = user.wUserIndex;\r\n        userItem._userRountIC = user.wRoundCount;\r\n        userItem._faceID = user.wFaceID;\r\n        userItem._netLag = user.wNetTimelag;\r\n        userItem._tableID = user.wTableID;\r\n        userItem._chairID = user.cbChairID;\r\n        userItem._status = user.cbUserStatus;\r\n        userItem._userDBID = user.lUserDBID;\r\n        userItem._groupID = user.dwGroupID;\r\n        userItem._userLevel = user.dwUserLevel;\r\n        userItem._sex = user.cbSex;\r\n        userItem._scoreBuf = user.szScores;\r\n        userItem._age = user.nAge;    \r\n        if (!bExist)\r\n            this.m_userManager.addUser(userItem);        \r\n       \r\n\r\n        if (userItem._userDBID == this.m_userManager.getMyDBID())    // 我自己\r\n        {\r\n            this.m_userManager.setMyUserID(userItem._userIndex);\r\n            this.m_mySelf = userItem;\r\n            this.m_clientFrame.setMyself(userItem);\r\n            //this.m_pGameLib.updateMyScore();\r\n        }\r\n        // 如果状态大于坐下\r\n        if (userItem._status > gamelibcommon.USER_WAIT_SIT\r\n            && userItem._status < gamelibcommon.USER_WATCH_GAME) {\r\n            var table: Table = this.m_tableManager.getTable(userItem._tableID);\r\n            if (table != null) {\r\n                var chair: Chair = table.getChair(userItem._chairID);\r\n                if (chair != null) {\r\n                    chair.setEmpty(false);\r\n                    chair.setUserID( userItem._userIndex);\r\n                }\r\n            }\r\n        }\r\n        if (!bExist)\r\n            this.m_sink.onRoomUserEnter(userItem._userIndex);\r\n        return true;\r\n    }\r\n\r\n    private onSubUserLeftMessage(buf: ByteArray): boolean{\t\t\r\n        var dwUserDBID: number = buf.readUnsignedInt();\r\n        var user: UserInfo = this.m_userManager.getUserByDBID(dwUserDBID);\r\n        if (user == null) {\r\n            this.trace(\"用户离开的时候居然没找到！\");\r\n            return true;\r\n        }\r\n        this.m_sink.onRoomUserExit(user._userIndex);\r\n        this.m_userManager.removeUser(user._userIndex);\r\n        return true;\r\n    }\r\n\r\n    private onSubUserStatusMessage(buf: ByteArray): boolean {\r\n        var userstatus: CMD_GR_BroadCast_UserStatus = new CMD_GR_BroadCast_UserStatus();\r\n        userstatus.deserialize(buf);\r\n        // 查找用户        \r\n        var user: UserInfo = this.m_userManager.getUserByDBID(userstatus.dwUserDBID);\r\n        if (user == null) {\r\n            this.trace(\"用户状态改变的时候居然没找到！\");\r\n            return true;\r\n        } \r\n        var wNowTableID: number = userstatus.wTableID;\r\n        var wLastTableID: number = user._tableID;\r\n        var cbNowChairID: number = userstatus.cbChairID;\r\n        var cbLastChairID: number = user._chairID;\r\n        var cbNowStatus: number = userstatus.cbUserStatus;\r\n        var cbLastStatus: number = user._status;\r\n\r\n        //设置数据\r\n        user._tableID = wNowTableID;\r\n        user._chairID = cbNowChairID;\r\n        user._status = cbNowStatus;\r\n        user._netLag = userstatus.wNetTimelag;\r\n\r\n        var nowTable: Table = this.m_tableManager.getTable(wNowTableID);\r\n        var oldTable: Table = this.m_tableManager.getTable(wLastTableID);\r\n        var nowChair: Chair = ((nowTable != null) ? nowTable.getChair(cbNowChairID) : null);\r\n        var oldChair: Chair = ((oldTable != null) ? oldTable.getChair(cbLastChairID) : null);\r\n\r\n        var changeTableStatus = false;\r\n        if (wNowTableID != wLastTableID)\r\n            changeTableStatus = true;\r\n\r\n        if (cbNowChairID != cbLastChairID)\r\n            changeTableStatus = true;\r\n\r\n        if (gamelibcommon.isSitTable(cbLastStatus) != gamelibcommon.isSitTable(cbNowStatus))\r\n            changeTableStatus = true;\r\n\r\n\r\n        if (oldTable != null) {\r\n            if (oldChair != null && gamelibcommon.isSitTable(cbLastStatus) && !oldChair.isEmpty()) {\r\n                oldChair.setEmpty(true);\r\n                this.m_sink.onTableInfoChanged(wLastTableID);\r\n            }\r\n        }\r\n\r\n        if (nowTable != null) {\r\n            if (nowChair != null && gamelibcommon.isSitTable(cbNowStatus) && !nowChair.isEmpty()) {\r\n                nowChair.setEmpty(false);\r\n                nowChair.setUserID(user._userIndex);\r\n                this.m_sink.onTableInfoChanged(wNowTableID);\r\n            }\r\n        }\r\n\r\n        var wMeTableID: number = this.m_mySelf._tableID;\r\n\r\n        this.m_sink.onRoomUserInfoUpdated(user._userIndex);\r\n\r\n        //判断是否自己\r\n        if (user._userDBID == this.m_userManager.getMyDBID()) {\r\n            // 保留上一次有效椅子号\r\n            if (cbLastChairID < this.m_tableManager.getChairCount()) {\r\n                this.m_cbLastChairID = cbLastChairID;\r\n            }\r\n            if (cbNowChairID < this.m_tableManager.getChairCount()) {\r\n                this.m_cbLastChairID = cbNowChairID;\r\n            }\r\n            if (cbNowStatus >= gamelibcommon.USER_SIT_TABLE) {\r\n                if (cbLastStatus < gamelibcommon.USER_SIT_TABLE || wNowTableID != wLastTableID || cbLastStatus == gamelibcommon.USER_OFF_LINE) {\r\n                    this.m_clientFrame.meEnterGame(this.m_tableManager.getChairCount());\r\n                    this.m_sink.onEnterGameView();\r\n                    this.m_clientFrameSink.onUserEnterTable(cbNowChairID, this.m_mySelf._userIndex, this.m_mySelf.isPlayer());\r\n\r\n                }\r\n\r\n                if ((wNowTableID != wLastTableID) || (cbLastStatus == gamelibcommon.USER_OFF_LINE)) {\r\n                    //sendAllUserExitTableToMe(wLastTableID);\r\n                    for (var i: number = 0; i < this.m_userManager.m_userList.length; i++) {\r\n                        var userEnter: UserInfo = this.m_userManager.m_userList[i];\r\n                        if (userEnter._userIndex == user._userIndex)\r\n                            continue;\r\n                        if (userEnter._tableID == wNowTableID)\r\n                            this.m_clientFrameSink.onUserEnterTable(userEnter._chairID, userEnter._userIndex, userEnter.isPlayer());\r\n                    }\r\n                }\r\n\r\n                if (gamelibcommon.isSitTable(cbLastStatus) || gamelibcommon.isSitTable(cbNowStatus)) {\r\n                    this.m_clientFrameSink.onPlayerStateChanged(this.m_mySelf._chairID, cbLastStatus, cbNowStatus);\r\n                }\r\n\r\n\r\n                if (cbNowStatus == gamelibcommon.USER_PLAY_GAME) {\r\n                }\r\n                else if (cbNowStatus == gamelibcommon.USER_SIT_TABLE ||\r\n                    cbNowStatus == gamelibcommon.USER_FREE_STATUS) {\r\n                }\r\n                return true;\r\n            }\r\n            else\t//我自己离开位置\r\n            {\r\n                //_clientFrame.meExitGame();\r\n                this.sendAllUserExitTableToMe(wLastTableID);\r\n                this.m_sink.onLeaveGameView();\r\n                //this.m_clientFrameSink.onUserExitTable(this.m_mySelf._chairID,this.m_mySelf._userIndex,this.m_mySelf.isPlayer());\r\n\r\n                return true;\r\n            }\r\n        }\r\n\r\n        // 如果我没有椅子号\r\n        if (wMeTableID == gamelibcommon.INVALI_TABLE_ID)\r\n            return true;\r\n\r\n        //发送游戏用户状态\r\n\r\n        if (((wMeTableID == wNowTableID) || (wMeTableID == wLastTableID))) {\r\n            if ((wMeTableID == wNowTableID) && (wMeTableID != wLastTableID)) {\r\n                //发送进入消息\r\n                this.m_clientFrameSink.onUserEnterTable(user._chairID, user._userIndex, user.isPlayer());\r\n            }\r\n            else if ((wMeTableID != wNowTableID) && (wMeTableID == wLastTableID)) {\r\n                //发送离开消息\r\n                this.m_clientFrameSink.onUserExitTable(cbLastChairID, user._userIndex, cbLastStatus >= gamelibcommon.USER_SIT_TABLE && cbLastStatus < gamelibcommon.USER_WATCH_GAME);\r\n            }\r\n\r\n            if (gamelibcommon.isSitTable(cbLastStatus) || gamelibcommon.isSitTable(cbNowStatus))\r\n                this.m_clientFrameSink.onPlayerStateChanged(user._chairID, cbLastStatus, cbNowStatus);            \r\n        }\r\n        return true;\r\n    }\r\n\r\n    private onSubUserScoreMessage(buf:ByteArray):boolean\t\t    {\r\n        var userScore: CMD_GR_BroadCast_UserScore = new CMD_GR_BroadCast_UserScore();\r\n        userScore.deserialize(buf);\r\n        //更新分数\r\n\r\n        var pUserItem: UserInfo = this.m_userManager.getUserByDBID(userScore.dwUserDBID);\r\n        if (pUserItem != null) {\r\n            this.m_userManager.updateUserScore(pUserItem._userIndex, userScore.cbScoreBuf);\r\n            this.m_sink.onRoomUserInfoUpdated(pUserItem._userIndex);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public recvTableChat(buf: ByteArray): boolean\t{\r\n        var chat: HtmlChat = new HtmlChat();\r\n        chat.deserialize(buf);\r\n        this.m_sink.onRecvTableChat(chat);\r\n        return true;\r\n    }\r\n    private recvCMMessage(cbSubCmd: number, buf: ByteArray): boolean{\r\n        switch (cbSubCmd) {\r\n            case GameCmds.SUB_CM_MESSAGE:\t//系统消息\r\n                {\r\n                    var pSystemMessage: CMD_CM_SysteMessage = new CMD_CM_SysteMessage();\r\n                    pSystemMessage.deserialize(buf);\r\n                    //判断关闭连接\r\n                    if (pSystemMessage.bCloseLine) {\r\n                        this.trace(\"SUB_CM_MESSAGE 断开连接\");\r\n                        this.m_socket.close();\r\n                    }\r\n\r\n                    //显示消息\r\n                    if (pSystemMessage.wMessageLen > 0)\r\n                        this.m_sink.onShowAlertMsg(pSystemMessage.szMessage);\r\n\r\n                    //判断是否关闭房间\r\n                    return true;\r\n                }\r\n\r\n            case GameCmds.SUB_CM_MESSAGE_EX:\r\n                {\r\n                    var sm: CMD_CM_SysteMessageEx = new CMD_CM_SysteMessageEx();\r\n                    sm.deserialize(buf);\r\n                    if (sm.bCloseLine){\r\n                        this.trace(\"SUB_CM_MESSAGE_EX 断开连接\");\r\n                        this.m_socket.close();\r\n                    }\r\n                    if (sm.wMessageLen > 0)\r\n                        this.m_sink.onShowAlertMsg(sm.szMessage);\r\n                    return true;\r\n                }\r\n            case GameCmds.SUB_CM_YESORNO_REQ:\r\n                {\r\n                    return true;\r\n                }\r\n            case GameCmds.SUB_CM_SHOW_WEB:\r\n                {\r\n                    return true;\r\n                }\r\n            case GameCmds.SUB_CM_MSG_BOX_REQ:\r\n                {\r\n                    return true;\r\n                }\r\n            case GameCmds.SUB_CR_MSG_BOX_REQ_WITH_TIMER:\r\n                {\r\n                    // 没有处理 \r\n                    return true;\r\n                }\r\n            case GameCmds.SUB_GR_MSG_AUTO_CLOSE:\r\n                {\r\n                    // 没有处理\r\n                    return true;\r\n                }\r\n            default:\r\n                {\r\n                    this.trace(\"MAIN_GR_MESSAGE Message subcmd = \" + cbSubCmd);\r\n                    return true;\r\n                }\r\n        }\r\n    }\r\n\r\n    private sendAllUserExitTableToMe(tableID: number) {\r\n        for (var i = 0;i < this.m_userManager.m_userList.length;i++){\r\n            var user = this.m_userManager.m_userList[i];\r\n            if (user._tableID == tableID) {\r\n                this.m_clientFrameSink.onUserExitTable(user._chairID, user._userIndex, user.isPlayer());\r\n            }\r\n        }\r\n    }\r\n\r\n    //发送房间设置\r\n    private sendOptionsMessage(): void{\r\n        \t\t\r\n        var RoomOption: CMD_GR_RoomOption = new CMD_GR_RoomOption();\r\n        var buf = RoomOption.serialize();\r\n        this.sendCommand(GameCmds.MAIN_GR_CONFIG, GameCmds.SUB_GR_ROOM_OPTION, 0, buf);     \r\n    }\r\n\r\n    private trace(msg: any): void {\r\n        TSCommon.log(msg);\r\n    }\r\n\r\n    private startCheckPing() {\r\n        if (this.m_timer_ping<=0)\r\n            return;\r\n        this.m_lostPingCount = 0;\r\n       \r\n        var mcurTimer = new Date().getTime();\r\n        var self = this;\r\n        this.m_timer_ping=window.setInterval(function(){\r\n            if (mcurTimer - this.m_dwLastPingTime >= this.LAST_PING_LOST_TIME) {\r\n                this.m_lostPingCount++;\r\n                //可能已经断线，进行重连\r\n                if (this.m_lostPingCount >= 2) {\r\n                    this.reconnect();\r\n                    this.stopCheckPing();\r\n                    return\r\n                }\r\n                this.m_dwLastPingTime =new Date().getTime();//egret.getTimer();\r\n            }\r\n\t\t    else\r\n                this.m_lostPingCount = 0;\r\n       \r\n\t\t    //if getTickCount() - this.m_dwLastPingTime >= this.CHECK_PING_TIME * 1000 {\t\t\t\r\n            self.sendPingCmd();\r\n        },5000); \r\n        // this.m_timer_ping.addEventListener(egret.TimerEvent.TIMER, (event) => {\r\n        //     TSCommon.log(\"timerFunc count\" + (<egret.Timer>event.target).currentCount);\r\n        //     if (egret.getTimer() - this.m_dwLastPingTime >= this.LAST_PING_LOST_TIME) {\r\n        //         this.m_lostPingCount++;\r\n        //         //可能已经断线，进行重连\r\n        //         if (this.m_lostPingCount >= 2) {\r\n        //             this.reconnect();\r\n        //             this.stopCheckPing();\r\n        //             return\r\n        //         }\r\n        //         this.m_dwLastPingTime =new Date().getTime();//egret.getTimer();\r\n        //     }\r\n\t\t//     else\r\n        //         this.m_lostPingCount = 0;\r\n       \r\n\t\t//     //if getTickCount() - this.m_dwLastPingTime >= this.CHECK_PING_TIME * 1000 {\t\t\t\r\n        //     this.sendPingCmd();\r\n        // }, this);\r\n    }\r\n\r\n    private stopCheckPing() {\r\n        if (this.m_timer_ping <= 0)\r\n            return;\r\n        //this.m_timer_ping.stop();\r\n        window.clearInterval(this.m_timer_ping)\r\n        this.m_timer_ping = 0;\r\n    }\r\n\r\n    private reconnect() {\r\n        if (this.m_uPort == null)\r\n            return;        \r\n        if (this.m_dwServerIP == null && this.m_strServerIP == null)\r\n            return;\r\n        \r\n        if (this.isServicing()) {\r\n            this.trace(\"reconnect close socket\");\r\n            this.m_socket.close();            \r\n            //this.m_socket = null;\r\n        }\r\n\r\n        if (this.m_socket == null) {\r\n            if (this.m_strServerIP == null)\r\n                this.m_strServerIP = this.changeIP(this.m_dwServerIP);\r\n            this.initWebSocket(this.m_strServerIP, this.m_uPort);\r\n        }\r\n    }\r\n\r\n    public sendGameCmd(cmdID: number, buf: ByteArray) {\r\n        if (!this.isServicing())\r\n            return false;\r\n        var ba = new ByteArray();\r\n        ba.writeByte(cmdID)\r\n        if (buf != null)\r\n            ba.writeBytes(buf);\r\n        \r\n        this.sendOldGameCmd(GameCmds.CMD_GAME, ba);\r\n        return true\r\n    }\r\n\r\n    public sendCommand(mainCmd: number, subCmd: number, handleCode: number, buf: ByteArray) {\r\n        var b: ByteArray = new ByteArray();\r\n        b.writeByte(mainCmd);\r\n        b.writeByte(subCmd);\r\n        b.writeByte(handleCode);\r\n        b.writeByte(0);\r\n        if(buf)\r\n            b.writeBytes(buf);\r\n        TSCommon.log(\"sendData len = \" + b.length);\r\n        this.m_socket.send(b.buffer);\r\n    }\r\n\r\n    public sendOldCommand(mainCmd: number, subCmd: number, buf: ByteArray) {\r\n        var b: ByteArray = new ByteArray();\r\n        b.writeByte(mainCmd);\r\n        b.writeByte(subCmd); \r\n        if(buf)   \r\n            b.writeBytes(buf);\r\n        TSCommon.log(\"sendData len = \" + b.length);\r\n        this.m_socket.send(b.buffer);\r\n    }\r\n\r\n    public sendOldGameCmd(cmdID: number, buf: ByteArray) {\r\n        var b: ByteArray = new ByteArray();\r\n        b.writeByte(cmdID);\r\n        if(buf) \r\n            b.writeBytes(buf);\r\n        TSCommon.log(\"sendData len = \" + b.length);\r\n        this.m_socket.send(b.buffer);\r\n    }\r\n\r\n    public sendPingCmd(){\r\n        if (!this.isServicing())\r\n            return;\r\n        var ba = new ByteArray();\r\n        ba.writeByte(GameCmds.IDC_PING_ME);\r\n        ba.writeUnsignedInt(new Date().getTime());\r\n        this.sendOldGameCmd(GameCmds.CMD_PING_USER, ba);\r\n        this.m_nSendPingTime = new Date().getTime();\r\n        this.trace(\"sendPingCmd---\");\r\n    }\r\n\r\n    public recvAnswerPing(){    \r\n        this.m_nNetLag = new Date().getTime() - this.m_nSendPingTime;\r\n        return true;\r\n    }\r\n\r\n    private sendLoginCmd()\t{\r\n        var logonByVNET = new CMD_GR_Logon_ByVnet();\r\n        logonByVNET.lUserDBID = this.m_dwUserID;\r\n        logonByVNET.szEncryptPass = this.m_szPass;\r\n        this.trace(\"sendLoginCmd pass = \" + this.m_szPass);\r\n\r\n        logonByVNET.ConnectInfo.wSize = 14;        \r\n        logonByVNET.ConnectInfo.dwConnectDelay = 0;\r\n        logonByVNET.ConnectInfo.dwGameInstallVer = this.m_gameVersion;        \r\n        logonByVNET.VersionInfo = this.m_pGameLib.VersionInfo;\r\n        logonByVNET.ClientInfo = this.m_pGameLib.ClientInfo;\r\n        var ba = logonByVNET.serialize();\r\n        this.sendCommand(GameCmds.MAIN_GR_LOGON, GameCmds.SUB_GR_LOGON_BY_VNET, 0, ba);        \r\n    }\r\n\r\n    public enterTable(wTable:number, cbChair:number):boolean\r\n\t\t{\r\n        if (!this.isServicing())\r\n            return false;\r\n        var table: Table = this.m_tableManager.getTable(wTable);\r\n        if (table == null) {\r\n            this.trace(\"桌子号无效\");\r\n            return false;\r\n        }\r\n        var chair: Chair = table.getChair(cbChair);\r\n        if (chair == null) {\r\n            this.trace(\"椅子号无效\");\r\n            return false;\r\n        }\r\n        if (table._isPlaying) {\r\n            // 旁观\r\n            this.sendWatchMessage(wTable, cbChair);\r\n            return true;\r\n        }\r\n        if (!chair.isEmpty()) {\r\n            this.trace(\"椅子已经有人了，请换一个\");\r\n            return false;\r\n        }\r\n        this.sendSitMessage(wTable, cbChair, null);\r\n        return true;\r\n    }\r\n\r\n    public leftRoom(): void {\r\n        if (!this.isServicing())\r\n            return;\r\n        this.trace(\"leftRoom\");\r\n        this.m_socket.close();\r\n        //this.m_socket = null;\r\n    }\r\n\r\n    public standup(): void {\r\n        var buf: ByteArray = new ByteArray();\r\n        buf.writeByte(GameCmds.IDC_USER_STAND_UP);\r\n        this.sendOldGameCmd(GameCmds.CMD_USER, buf);\r\n    }\r\n\r\n    //发送坐下命令\r\n    private sendSitMessage(wTableIndex: number, cbChairID: number, szTablePass: String): boolean {\r\n        if (!this.isServicing())\r\n            return false;\r\n        //构造数据\r\n        var RegSit: CMD_GR_Req_UserSit = new CMD_GR_Req_UserSit();\r\n        RegSit.wNetSpeed = 0;\r\n        RegSit.wTableID = wTableIndex;\r\n        RegSit.cbChairID = cbChairID;        \r\n        var buf: ByteArray = RegSit.serialize();\r\n        this.sendCommand(GameCmds.MAIN_GR_USER, GameCmds.SUB_GR_REQ_SIT_TABLE, 0, buf);\r\n        return true;\r\n    }\r\n\r\n    //发送旁观命令\r\n    public sendWatchMessage(wTableIndex: number, cbChairID: number): boolean {\r\n        if (!this.isServicing())\r\n            return false;\r\n\r\n        var RegLonkOn: CMD_GR_Req_UserLookOn = new CMD_GR_Req_UserLookOn();\r\n        RegLonkOn.wNetSpeed = 0;\r\n        RegLonkOn.wTableID = wTableIndex;\r\n        RegLonkOn.cbChairID = cbChairID;\r\n        RegLonkOn.cbPassLen = 0;\r\n        var buf: ByteArray = RegLonkOn.serialize();\r\n        this.sendCommand(GameCmds.MAIN_GR_USER, GameCmds.SUB_GR_REQ_LOOK_ON_TABLE, 0, buf);\r\n        return true;\r\n    }\r\n\r\n    public sendSoftReady() {\r\n        this.sendOldGameCmd(FrameCmds.CLIENTSITE_SOFT_READY, null);\r\n    }\r\n\r\n    public sendReady(): boolean{\r\n        if (!this.isServicing())\r\n            return false;\r\n        if (this.m_mySelf == null)\r\n            return false;\r\n        if (this.m_mySelf._status == gamelibcommon.USER_PLAY_GAME) {\r\n            // 发送软开始\r\n            this.sendSoftReady();\r\n            return true;\r\n        }\r\n        if (this.m_mySelf._status == gamelibcommon.USER_SIT_TABLE) {\r\n            this.sendOldCommand(GameCmds.CMD_USER, GameCmds.IDC_USER_AGREE_START, null);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public sendCancelReady(): boolean {\r\n        if (!this.isServicing())\r\n            return false;\r\n        if (this.m_mySelf == null)\r\n            return false;\r\n        if (this.m_mySelf._status != gamelibcommon.USER_READY_STATUS) {\r\n            return false;\r\n        }\r\n       \r\n        this.sendOldCommand(GameCmds.CMD_USER, GameCmds.IDC_USER_CANCEL_READY, null);\r\n        return true;      \r\n    }\r\n\r\n    public SendChatMsg(objChatContent: HtmlChat) {\r\n        var ba = objChatContent.serialize();\r\n        this.sendOldGameCmd(GameCmds.CMD_HTML_HALL_CHAT, ba);\r\n    }\r\n\r\n    public GetUserName(wUserID: number): string {\r\n        var user = this.m_userManager.getUser(wUserID);\r\n        if (user == null)\r\n            return \"\";\r\n        return user.getUserName();\r\n    }\r\n\r\n    public GetMyID(): number {\r\n        return this.m_userManager.getMyUserID();\r\n    }\r\n\r\n    public autoSit(): boolean{\r\n        if (!this.isServicing())\r\n            return false;\r\n        if (!this.m_mySelf)\r\n            return false;\r\n        var cbUserStatus: number = this.m_mySelf._status;\r\n\r\n        //判断自己的状态\r\n        if (cbUserStatus == gamelibcommon.USER_PLAY_GAME) {\r\n            //MessageBox.Show(\"你正在游戏中，不能换位置，请先结束游戏！\");\r\n            return false;\r\n        }\r\n       \r\n        var tableID: number = 0xFFFF;\r\n        var chairID: number = 0xFF - 1;\r\n        this.sendSitMessage(tableID, chairID, \"\");\r\n        return true;\r\n    }\r\n\r\n    public getTable(tableID: number): Table {\r\n        if (!this.isServicing())\r\n            return null;        \r\n        return this.m_tableManager.getTable(tableID);\r\n    }\r\n    public getTableList(): Table[] {\r\n        if (!this.isServicing())\r\n            return null;\r\n        return this.m_tableManager.getTableList();\r\n    }\r\n\r\n    public getUserByChair(chair:number): UserInfo{\r\n        if(!this.isServicing())\r\n            return null;\r\n        if (chair >= this.m_tableManager.getChairCount())\r\n            return null;\r\n        if (this.m_mySelf.getUserTableID() >= this.m_tableManager.getTableCount())\r\n            return null;\r\n        for (var i: number = 0; i < this.m_userManager.m_userList.length; i++) {\r\n            var user: UserInfo = this.m_userManager.m_userList[i];\r\n            if (user._tableID != this.m_mySelf.getUserTableID())\r\n                continue;\r\n            if (user.getUserChair() != chair)\r\n                continue;\r\n            if (user._status >= gamelibcommon.USER_SIT_TABLE && user._status < gamelibcommon.USER_WATCH_GAME)\r\n                return user;            \r\n        }\r\n        return null;\r\n    }\r\n\r\n    public getMyself() {\r\n        if (!this.isServicing())\r\n            return null;\r\n        return this.m_mySelf;\r\n    }\r\n\r\n    public getUser(wUserID: number) {\r\n        return this.m_userManager.getUser(wUserID);\r\n    }\r\n\r\n    public getUserByDBID(userDBID: number) {\r\n        return this.m_userManager.getUserByDBID(userDBID);\r\n    }\r\n\r\n    public refreshGold() {\r\n        if (!this.isServicing())\r\n            return;\r\n        this.sendCommand(GameCmds.MAIN_GR_USER, GameCmds.SUB_GR_QUERY_GOLD, 0, null);\r\n    }\r\n\r\n    public sendTableChat(lpszMsg: string) {\r\n        if (!this.isServicing()) {\r\n            return GameCmds.SEND_TABLE_CHAT_OFFLINE;\r\n        }\r\n        if(lpszMsg == null){\r\n            return GameCmds.SEND_TABLE_CHAT_NULL_CONTENT;\r\n        }\r\n        var msg = lpszMsg;\r\n        var nLen = msg.length;\r\n        if (nLen == 0) {\r\n            return GameCmds.SEND_TABLE_CHAT_NULL_CONTENT;\r\n        }\r\n        //是否太频繁\r\n        var nMinTime = 2000\r\n        var dwNow = new Date().getTime();\r\n        if (this.m_dwLastSendTableChat != 0 && dwNow - this.m_dwLastSendTableChat < nMinTime) {\r\n            return GameCmds.SEND_TABLE_CHAT_BUSY;\r\n        }\r\n        this.m_dwLastSendTableChat = dwNow;\r\n        var chat = new HtmlChat();\r\n        chat._dwSpeaker = this.m_mySelf.getUserID()\r\n        chat._dwListener = 0xFFFFFFFF\r\n        chat._dwSubCode = 0\r\n        chat._dwChannelIDLength = 4\r\n        chat._szContent = msg;\r\n        var ba = chat.serialize();\r\n        var cmd = GameCmds.CMD_HTML_TABLE_CHAT;        \r\n        this.sendOldGameCmd(cmd, ba);\r\n        return GameCmds.SEND_TABLE_CHAT_OK\r\n    }\r\n\r\n    public getRelativePos(cbChair:number){\r\n        if (cbChair == 255) {\r\n            return 0;\r\n        }\r\n        if (cbChair >= this.m_tableManager.getChairCount()) {\r\n            return cbChair;\r\n        }\r\n        if (this.m_mySelf == null) {\r\n            return cbChair;\r\n        }\r\n        var cbMyChair = this.m_mySelf.getUserChair();\r\n        if (cbMyChair >= this.m_tableManager.getChairCount()) {\r\n            cbMyChair = this.m_cbLastChairID;\r\n        }\r\n\r\n        if (cbMyChair < 0 || cbMyChair >= this.m_tableManager.getChairCount()) {\r\n            return cbChair;\r\n        }\r\n        return (cbChair + this.m_tableManager.getChairCount() - cbMyChair) % this.m_tableManager.getChairCount();\r\n    }\r\n\r\n\r\n    public getRealChair(cbPos:number){\r\n        if (cbPos >= this.m_tableManager.getChairCount()) {\r\n            return cbPos;\r\n        }\r\n\r\n        if (this.m_mySelf == null) {\r\n            return cbPos;\r\n        }\r\n        var cbMyChair = this.m_mySelf.getUserChair();\r\n        if (cbMyChair >= this.m_tableManager.getChairCount()) {\r\n            cbMyChair = this.m_cbLastChairID;\r\n        }\r\n        if (cbMyChair < 0 || cbMyChair >= this.m_tableManager.getChairCount()) {\r\n            return cbPos;\r\n        }\r\n        return (cbPos + cbMyChair) % this.m_tableManager.getChairCount();\r\n    }\r\n\r\n    public isPrivteRoom(){\r\n        return this.m_bIsPrivateRoom;\r\n    }\r\n\r\n    public sendSoundToTableUser(pBuf: ByteArray) {\r\n        if (!this.isServicing()) {\r\n            return false;\r\n        }\r\n        if (this.m_mySelf == null) {\r\n            return false;\r\n        }\r\n        if (this.m_mySelf.getUserStatus() < gamelibcommon.USER_SIT_TABLE) {\r\n            return false;\r\n        }\r\n        TSCommon.log(\"sendSoundToTableUser \" + pBuf.length);\r\n        if (pBuf.length <= 0 ){\r\n            return;\r\n        }\r\n        this.sendOldGameCmd(FrameCmds.CLIENTSITE_SEND_SOUND, pBuf);\r\n    }\r\n    public getNetLag() {\r\n        if (!this.isServicing()) {\r\n            return 0;\r\n        }\r\n\r\n        return this.m_nNetLag\r\n    }\r\n\r\n    public getUserList() {\r\n        if (!this.isServicing()) {\r\n            return null;\r\n        }\r\n        return this.m_userManager.m_userList;\r\n    }\r\n\r\n    public setClientFrameSink(sink: IClientFrameSink) {\r\n        this.m_clientFrameSink = sink;\r\n        this.m_clientFrame.setSink(sink);\r\n    }\r\n}"]}