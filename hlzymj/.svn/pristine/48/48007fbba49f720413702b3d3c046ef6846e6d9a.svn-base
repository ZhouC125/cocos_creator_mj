{"version":3,"sources":["DeskScene.js"],"names":["GameCfg","require","GameLibSink","GameDefs","Tools","sendCMD","Resources","HallResources","cc","Class","extends","Component","properties","bg","default","type","Node","myself","right","top","left","gameOverLayer","matchGameOverLayer","gameResultLayer","moreSettingLayer","levelUpgradeLayer","protectScoreLayer","listenCardLayer","directAtlas","SpriteAtlas","commonTipsPrefab","Prefab","mallLayer","chatAtlas","bgMusic","url","AudioClip","xuanPaiTipsLayer","huanPaiTipsLayer","queYiMenTipsLayer","queYiMenButtonLayer","xuanPaiTipsTimes","Label","GAMETIMER_COUNT","XUANPAI_COUNT","onLoad","self","isIPhoneX","sys","isNative","isMobile","canvasFit","node","getComponent","Canvas","fitHeight","fitWidth","loadIphoneXBgRes","loadNomalBgRes","loader","loadRes","err","clip","mj_actionClip","me_actionClip","left_actionClip","right_actionClip","top_actionClip","loadResDir","assets","hupaiAssets","on","event","onUserEnterTable","detail","chair","wUserID","isPlayer","onUserExitTable","onPlayerStateChanged","nOldState","nNewState","onSceneChanged","data","onGameMessage","cCmdID","onRecvTableChat","chatMsg","updateUserInfo","user","init","initUI","TSCommon","addEvent","changeDeskBg","onChangeDeskBg","GAME_RESTART","onGameReStart","NOTIFICATION_LISTENCARD","judgeIsTingCard","openBgMusic","onPlayBgMusic","closeBgMusic","onCloseBgMusic","NOTIFICATION_ROBOT","onRobot","getIsPrivateRoom","getGameLib","sitTable","getGameLibSink","s_nPrivateRoomTableNo","s_nPrivateRoomChairNo","autoSit","IsCXZ","SpriteFrame","spriteFrame","getChildByName","Sprite","bgMusicOpen","parseInt","localStorage","getItem","G","matchGameReady","setChangedDeskBtnEnabled","onDestroy","scheduler","director","getScheduler","unscheduleCallbackForTarget","_signalUpdate","_timerUpdate","removeEvent","m_stSaveSceneData","_clientFrameSink","m_dataEventHandler","log","index","m_bg1Frame","m_bg2Frame","m_bg3Frame","m_bIsOffLine","gameInfoNode","active","nPos","PLAYER_COUNT","getPlayerByPos","holdCardsNode","i","childrenCount","cardNode","children","outCardsNode","outLaiziGangNode","penggangNodes","Player","stopWinAction","arrow","diceBg","timeLabel","laiziNode","showSignalUI","setIndex","console","m_bgMusicAudioID","audioEngine","play","undefined","stop","m_stSceneData","cbPhase","GamePhase","PhaseEnd","sendCMD_PO_ROBOTPLAYSTART","ShowToast","getInstance","PosFromChair","cbChair","gamelib","getRelativePos","m_chairCount","m_cbMyChair","ChairFromPos","getRealChair","isInPrivateRoom","sit","GetMyInfo","m_pMyself","getMyself","getUserChair","ret","curRoom","getCurrentGameRoom","szGameRoomName","indexOf","m_nChairCount","MyState","gamelibcommon","USER_NO_STATUS","getUserStatus","getTotalMjCount","total","MAJIANG_COUNT","getRestMjCount","cbCurrentIndex","cbLastIndex","nChair","bIsPlayer","userInfo","getUser","playCommonEffect","initAddDirection","USER_PLAY_GAME","USER_OFF_LINE","player","Come","Leave","getUserDBID","refreshGold","getGold","Pub_IsValidChair","getIsGameRunning","PhasePlayDingque","getIsGameChangeMjing","PhaseExchange","nMyChair","directTable","nListSize","length","arrowNode","directNode","OneTable","strBgImgName","strForeImgName","bgFrame","getSpriteFrame","foreImgFrame","USER_READY_STATUS","setIsReady","m_playerStatus","Array","hideLeaveTimer","gamebuttonLayer","setStartBtnVisible","USER_SIT_TABLE","setIsoffLine","setRestMjCount","gameSystemNode","restMjNum","string","signalProgress","myDate","Date","update","dt","hours","getHours","minutes","getMinutes","formatTime","netLagValue","getNetLag","nProgress","ProgressBar","progress","scheduleCallbackForTarget","macro","REPEAT_FOREVER","setRoomInfo","m_roomInfo","roomScoreLabel","nTurnBasicGold","roomLevelLabel","roomLevel","dwRuleID","baseInfoBg","gameInfo","gameInfoStr","nPlayerCount","cbLaiType","RichText","addLaiziInfo","laizNode","laiziInfoNode","laiziMj","mjValue","cbLaizi","get_face_li_SpriteFrame","addGameWaitStartAction","waitStartArary","lpData","ba","GameScene","setLeaveBtnEnabled","setAllOperateButtonIsVis","isSetInfo","getIsValidPlayer","playerCardLayer","setPlayerPos","setPlayerMj","players","removeEatOrGangMoresCardToast","outCardLayer","huCardLayer","cancelRobotNode","isRobot","onCancelRobot","setCancelRobotBtnCallBack","reportResultToWx","gameOver","cbWhosTurn","PhaseOutCard","setCanOutCard","PhaseStart","isEmptyObject","LastAction","nAction","PlayerAction","paHu","setAllOutData","pos","nStyle","cbDingque","setQueWanHeadIconSpIsVis","paOutCard","setActionState","putOutMj","nParam","nCardValue","playMjSoundEffect","getSex","m_nClickCardTing","setTingCardLeftNum","refreshTingCard","paPeng","playOperateEffects","EffectList","No_1pen","randIndex","Math","floor","random","playPengEffect","cbCurrentCard","paGang","mjPlayer","nWeaveType","WeaveType","MingGang","MAX_WEAVE","showCardSuits","cbWeaveKind","InvalidType","No_2gang","playGuaFengEffects","playGangEffect","revealSuit","stRevealGang","cbCardData","XuGang","AnGang","paEat","No_2chi","nGetPos","nHuCount","nFangPaoChair","vHuChair","nHuParam","nFangPaoReal","nHuMoreParam","operationChangeData","No_2hu","playHuEffect","No_2ZiMo","playerData","putHuMj","setGrayForCannotUpCard","setChaDaJiaoSpIsVis","nBankerPos","cbBanker","startGameAction","cbFirstDice","cbSecondDice","paGet1CardFromHeader","getOneMj","paGet1CardFromTail","paPatchFlower","setIsDirectionVis","turnToOutPlayCardIsVis","startTimer","showChoiceButton","PhaseWaitChoice","cbHoldCards","cbHoldCardCount","m_saveTingCardList","vTingList","addThreeSelectCardUI","PhasePlayExchange","isClick","deleteThreeMjRefresh","stopTimer","changeMjAction","exchangeCardAniation","PhaseDingque","addDingQueYiMenUI","dingQueYiMenAniation","lpBuf","MJ_CMD_GANG","gangScoreArray","bytesAvailable","nGangScore","readInt","setTempChangeGold","MJ_CMD_ROOMINFO","ST_RoomInfo","MJ_CMD_Set_XueFei","MJ_CMD_AUTOOUT","readUnsignedByte","setIsRobot","MJ_CMD_Cancel_AutoOut","MSG_ROBOT_ACTIVE","MJ_DISSOLVE_ROOM","MJ_DISSOLVE_RESULT","MJ_CMD_SETINFO","m_roomSetInfo","ST_SetInfo","CMD_Notify_UpGrade","m_nNewLevel","MJ_CMD_DissINFO","MJ_CMD_Exchange","setSelectCardSpIsVis","MJ_CMD_DingQue","nQueMen","setQueWanSpIsVis","setDingqueSpIsVis","firstDice","secondDice","setScale","playStartActionEnd","holds","animation","addComponent","Animation","addClip","animState","speed","resetAllHandCardPosWithNoDiff","onEnd","putSelfHandCards","m_mj1_back_right_frame","m_mj1_back_top_frame","m_mj1_back_left_frame","MAX_HOLD_CARD","cardCount","playStartAction","groupIndex","playGetOneGroupCardAction","playNextGroup","j","onPlayAnimatiEnd","strCount","quedingLaizi","stopAllActions","direct","act1","fadeOut","act2","fadeIn","seq","sequence","runAction","repeatForever","choice","ChoiceAction","myMJPlayer","vUpCards","GameJudge","nValidLen","pEatCase","bIsLeft","CanShunLeft","bIsMiddle","CanShunMid","bIsRight","CanShunRight","stEat","push","MJ_CMD_EATLEFT","MJ_CMD_EATMID","MJ_CMD_EATRIGHT","onChiClickCallBack","sendCMD_PO_EAT","eatMoresCardToast","setChiClickBtnCallBack","setGuoBtnVisible","setChiBtnVisible","setPengBtnVisible","nV","fourSameResult","handCardIsHaveFourSame","bIsExistAnGang","bIsExist","anGangArray","vCardArray","threeSameResult","handCardIsHaveThreeSame","bIsExistMingGang","nVCard","vCardValue","oneSameResult","handCardIsHaveOneSameToWave","bIsExistXuGang","xuGangArray","gangTable","anGangInfo","nGangCard","nGangType","xuGangInfo","onGangClickCallBack","sendCMD_PO_GANG","gangMoresCardToast","onChaoTianClickCallBack","onGuoClickCallBack","mySelectGangNode","sendCMD_PO_PASS","setGangClickBtnCallBack","setGuoClickBtnCallBack","setChaoTianClickBtnCallBack","setGangBtnVisible","setZiMoBtnVisible","setHuBtnVisible","bFreshPutCard","bolHu","cbIsHu","doCards","overTimeFunc","nDowntime","strLeftTime","nOutCard","nCount","nTingCount","cbTingCount","cbTingCard","cbLeftCount","swapCardFinshcallBack","runActionFun","tb","cbBeExchange","insertThreeCard","showShunRotateAction","changeCardsNode","action","action1","action2","action3","spawn","scaleTo","moveBy","callFunc","delayTime","setQueYiMenStyleType","setQueYiMenMjGray","bIsVis","nType","bShow","waitTimer","upThreeCardByType","startXuanPaiTime","onXuanPaiButtonClick","schedule","dealComfirm","unschedule","vCardSpList","getThreeUpCradList","getMjColor","sendCMD_PO_Exchange","y","vTingCard","vTingFan","vTingLeft","cbOutCard","cbFan","ListenCardLayer","setlaiziValue","vCardList","cardValue","chat","chatChair","tableUser","_dwSpeaker","iChair","playerNode","stChat","szNickname","getUserName","sysHead","vipHead","speakContent","getChatMsg","szHead","substr","szHead2","faceIndex","substring","face","Number","cbType","cbFace","FACE_CHAT_MAX_NUM","showChatFaceInfo","showChatTextInfo","szChatContent","wordIndex","QUICK_SEND_CHATS","effectFile","posY","moveTime","posX","showScrollWords","moveToX","moveToY","bgRandom","winSize","getWinSize","bgNode","sprite","frame","addChild","x","width","getContentSize","textWord","wordsNode","wordsSprite","moveTo","p","clean","removeSelf","bIsZimo","onPlayEnd","nFangPaoPos","mjNode","getLastOutCard","offset","hupaiNode","convetPos","convertToNodeSpace","getPosition","dragonDisplay","dragonBones","ArmatureDisplay","DragonBonesAsset","dragonAsset","DragonBonesAtlasAsset","dragonAtlasAsset","armatureName","playAnimation","m_hupaiActionmature","callback","removeFromParent","addEventListener","EventObject","COMPLETE","callBackFunc","success","removeLoading","jsonObject","JSON","parse","table","playerRankNum","RankNum","playerOpenID","OpenID","playerScore","Score","kvDataList","key","value","wx","setUserCloudStorage","KVDataList","wxUserInfo","WeixinManager","myOpenId","openid","getPlayerData","stPlayer","stWinStruct","playHuEffectEnd","cbHuType","nWeaveCount","weaveItem","tWeaveItem","FangGang","playersName","playerAvatorUrls","name","getPlayerName","faceUrl","getFaceUrl","showDetailResult","showResultLayer","httpCallback","myselfWinOrLoseScore","nScore","matchLevel","cbGradeIndex","bIsLiuju","laiyouCardValue","getScore","ContinuityWin","upgradelevelLayer","showProtectScoreLayer","szBatchID","performWithDelay","getContinuityWinGetInfo","chaDaJiaoAndHuaZhu","vSinleScore","stSingleScore","nChaDaJiao","nChaHuaZhu","stSinleScore","cbScoreType","scoreType","scoreChaDaJiao","ScoreChaHuaZhu","nil","gameOverCallback","isSetting","setIsWinner","cbWinChair","cbEndType","EndType","Liuju","setLastGoldOnGameOver","nFinalScore","nCost","leftTime","getLeftLeaveTime","gameOverView","setWinStructInfo","mj1_face_dao","mj1_face_li","loadUI","bIsReady","isReady","cleanPlayers","showLeaveTimer","stopLeftTimer","stopLeaveTimer","nGold","pCurrentRoom","dwMinGold","sendCMD_PO_RESTART","showGoldNotEnoughTips","startClickedCallback","setStartClickBtnCallBack","showMallLayer","showGoldNode","getReward","leftReward","showRuptRewardTips","goldNotEnoughLayer","instantiate","titleIcon","msg","showIcon","buttonIcon1","button1Func","clickCloseBtn","initData","setPosition","requestRuptRewardInfo","ruptRewardLayer","bankruptAwardAmount","showIconLabel","buttonIcon2","womenThink","button2Func","buttonIcon3","button3Func","browserType","shareAppMessage","title","imageUrl","rupShareImgUrl","res","getRuptReward","fail","otherText1","otherText2","totalAwardTimes","curAwardTimes","otherText3","TotalAwardTimes","AwardAmount","CurAwardTimes","getBankruptInfo","backMsg","RetCode","getBankruptReward"],"mappings":";;;;;;AAAA;;AACA;;AACA;;AACA;;AACA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;AACA,IAAIC,cAAcD,QAAQ,aAAR,CAAlB;AACA,IAAIE,WAAWF,QAAQ,UAAR,CAAf;AACA,IAAIG,QAAQH,QAAQ,OAAR,CAAZ;AACA,IAAII,UAAUJ,QAAQ,SAAR,CAAd;AACA,IAAIK,YAAYL,QAAQ,WAAR,CAAhB;AACA,IAAIM,gBAAgBN,QAAQ,eAAR,CAApB;AACAO,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,YAAI;AACAC,qBAAS,IADT;AAEAC,kBAAMP,GAAGQ;AAFT,SADI;;AAMRC,gBAAQ;AACJH,qBAAS,IADL;AAEJC,kBAAMP,GAAGQ;AAFL,SANA;;AAWRE,eAAO;AACHJ,qBAAS,IADN;AAEHC,kBAAMP,GAAGQ;AAFN,SAXC;;AAgBRG,aAAK;AACDL,qBAAS,IADR;AAEDC,kBAAMP,GAAGQ;AAFR,SAhBG;;AAqBRI,cAAM;AACFN,qBAAS,IADP;AAEFC,kBAAMP,GAAGQ;AAFP,SArBE;;AA0BR;AACAK,uBAAe;AACXP,qBAAS,IADE;AAEXC,kBAAMP,GAAGQ;AAFE,SA3BP;;AAgCR;AACAM,4BAAmB;AACfR,qBAAS,IADM;AAEfC,kBAAMP,GAAGQ;AAFM,SAjCX;;AAsCR;AACAO,yBAAiB;AACbT,qBAAS,IADI;AAEbC,kBAAMP,GAAGQ;AAFI,SAvCT;;AA4CR;AACAQ,0BAAkB;AACdV,qBAAS,IADK;AAEdC,kBAAMP,GAAGQ;AAFK,SA7CV;;AAkDR;AACAS,2BAAkB;AACdX,qBAAS,IADK;AAEdC,kBAAMP,GAAGQ;AAFK,SAnDV;;AAwDRU,2BAAkB;AACdZ,qBAAS,IADK;AAEdC,kBAAMP,GAAGQ;AAFK,SAxDV;;AA6DR;AACAW,yBAAiB;AACbb,qBAAS,IADI;AAEbC,kBAAMP,GAAGQ;AAFI,SA9DT;;AAmERY,qBAAa;AACTd,qBAAS,IADA;AAETC,kBAAMP,GAAGqB;AAFA,SAnEL;;AAwER;AACAC,0BAAkB;AACdhB,qBAAS,IADK;AAEdC,kBAAMP,GAAGuB;AAFK,SAzEV;;AA8ER;AACAC,mBAAW;AACPlB,qBAAS,IADF;AAEPC,kBAAMP,GAAGQ;AAFF,SA/EH;;AAoFR;AACAiB,mBAAW;AACPnB,qBAAS,IADF;AAEPC,kBAAMP,GAAGqB;AAFF,SArFH;;AA0FRK,iBAAS;AACLpB,qBAAS,IADJ;AAELqB,iBAAK3B,GAAG4B;AAFH,SA1FD;;AA+FR;AACAC,0BAAiB;AACbvB,qBAAS,IADI;AAEbC,kBAAMP,GAAGQ;AAFI,SAhGT;;AAqGR;AACAsB,0BAAiB;AACbxB,qBAAS,IADI;AAEbC,kBAAMP,GAAGQ;AAFI,SAtGT;;AA2GR;AACAuB,2BAAkB;AACdzB,qBAAS,IADK;AAEdC,kBAAMP,GAAGQ;AAFK,SA5GV;;AAiHR;AACAwB,6BAAoB;AAChB1B,qBAAS,IADO;AAEhBC,kBAAMP,GAAGQ;AAFO,SAlHZ;;AAuHRyB,0BAAiB;AACb3B,qBAAS,IADI;AAEbC,kBAAMP,GAAGkC;AAFI,SAvHT;;AA4HRC,yBAAiB,EA5HT;AA6HRC,uBAAe;AA7HP,KAHP;;AAmILC,YAAQ,kBAAY;AAAA;;AAEhB,YAAIC,OAAO,IAAX;;AAEA,YAAI7C,QAAQ,WAAR,EAAqB8C,SAArB,EAAJ,EAAsC;AAClC,gBAAI,CAACvC,GAAGwC,GAAH,CAAOC,QAAR,IAAoBzC,GAAGwC,GAAH,CAAOE,QAA/B,EAAyC;AACrC,oBAAIC,YAAY,KAAKC,IAAL,CAAUC,YAAV,CAAuB7C,GAAG8C,MAA1B,CAAhB;AACAH,0BAAUI,SAAV,GAAsB,IAAtB;AACAJ,0BAAUK,QAAV,GAAqB,KAArB;AACH;;AAED,iBAAKC,gBAAL;AACH,SARD,MASI;AACA,iBAAKC,cAAL;AACH;;AAEDlD,WAAGmD,MAAH,CAAUC,OAAV,CAAkB,iCAAlB,EAAqD,UAAUC,GAAV,EAAeC,IAAf,EAAqB;AACtE,gBAAI,CAACD,GAAL,EAAU;AACNf,qBAAKiB,aAAL,GAAqBD,IAArB;AACH;AACJ,SAJD;;AAMAtD,WAAGmD,MAAH,CAAUC,OAAV,CAAkB,iCAAlB,EAAqD,UAAUC,GAAV,EAAeC,IAAf,EAAqB;AACtE,gBAAI,CAACD,GAAL,EAAU;AACNf,qBAAKkB,aAAL,GAAqBF,IAArB;AACH;AACJ,SAJD;;AAMAtD,WAAGmD,MAAH,CAAUC,OAAV,CAAkB,mCAAlB,EAAuD,UAAUC,GAAV,EAAeC,IAAf,EAAqB;AACxE,gBAAI,CAACD,GAAL,EAAU;AACNf,qBAAKmB,eAAL,GAAuBH,IAAvB;AACH;AACJ,SAJD;;AAMAtD,WAAGmD,MAAH,CAAUC,OAAV,CAAkB,oCAAlB,EAAwD,UAAUC,GAAV,EAAeC,IAAf,EAAqB;AACzE,gBAAI,CAACD,GAAL,EAAU;AACNf,qBAAKoB,gBAAL,GAAwBJ,IAAxB;AACH;AACJ,SAJD;;AAMAtD,WAAGmD,MAAH,CAAUC,OAAV,CAAkB,kCAAlB,EAAsD,UAAUC,GAAV,EAAeC,IAAf,EAAqB;AACvE,gBAAI,CAACD,GAAL,EAAU;AACNf,qBAAKqB,cAAL,GAAsBL,IAAtB;AACH;AACJ,SAJD;;AAMAtD,WAAGmD,MAAH,CAAUS,UAAV,CAAqB,oCAArB,EAA2D,UAAUP,GAAV,EAAeQ,MAAf,EAAuB;AAC9EvB,iBAAKwB,WAAL,GAAmBD,MAAnB;AACH,SAFD;;AAIA,aAAKjB,IAAL,CAAUmB,EAAV,CAAa,kBAAb,EAAiC,UAACC,KAAD,EAAW;AACxC,kBAAKC,gBAAL,CAAsBD,MAAME,MAAN,CAAaC,KAAnC,EAA0CH,MAAME,MAAN,CAAaE,OAAvD,EAAgEJ,MAAME,MAAN,CAAaG,QAA7E;AACH,SAFD;;AAIA,aAAKzB,IAAL,CAAUmB,EAAV,CAAa,iBAAb,EAAgC,UAACC,KAAD,EAAW;AACvC,kBAAKM,eAAL,CAAqBN,MAAME,MAAN,CAAaC,KAAlC,EAAyCH,MAAME,MAAN,CAAaE,OAAtD,EAA+DJ,MAAME,MAAN,CAAaG,QAA5E;AACH,SAFD;;AAIA,aAAKzB,IAAL,CAAUmB,EAAV,CAAa,sBAAb,EAAqC,UAACC,KAAD,EAAW;AAC5C,kBAAKO,oBAAL,CAA0BP,MAAME,MAAN,CAAaC,KAAvC,EAA8CH,MAAME,MAAN,CAAaM,SAA3D,EAAsER,MAAME,MAAN,CAAaO,SAAnF;AACH,SAFD;;AAIA,aAAK7B,IAAL,CAAUmB,EAAV,CAAa,gBAAb,EAA+B,UAACC,KAAD,EAAW;AACtC,kBAAKU,cAAL,CAAoBV,MAAME,MAAN,CAAaS,IAAjC;AACH,SAFD,EAEG,IAFH;;AAIA,aAAK/B,IAAL,CAAUmB,EAAV,CAAa,eAAb,EAA8B,UAACC,KAAD,EAAW;AACrC,kBAAKY,aAAL,CAAmBZ,MAAME,MAAN,CAAaC,KAAhC,EAAuCH,MAAME,MAAN,CAAaW,MAApD,EAA4Db,MAAME,MAAN,CAAaS,IAAzE;AACH,SAFD,EAEG,IAFH;;AAIA,aAAK/B,IAAL,CAAUmB,EAAV,CAAa,iBAAb,EAAgC,UAACC,KAAD,EAAW;AACvC,kBAAKc,eAAL,CAAqBd,MAAME,MAAN,CAAaa,OAAlC;AACH,SAFD;;AAIA,aAAKnC,IAAL,CAAUmB,EAAV,CAAa,gBAAb,EAA+B,UAACC,KAAD,EAAW;AACtC,kBAAKgB,cAAL,CAAoBhB,MAAME,MAAN,CAAae,IAAjC;AACH,SAFD;;AAIA,aAAKC,IAAL;;AAEA,aAAKC,MAAL;;AAEAC,2BAASC,QAAT,CAAkB7F,QAAQ8F,YAA1B,EAAwC,KAAKC,cAA7C,EAA6D,IAA7D;;AAEAH,2BAASC,QAAT,CAAkB7F,QAAQgG,YAA1B,EAAwC,KAAKC,aAA7C,EAA4D,IAA5D;;AAEAL,2BAASC,QAAT,CAAkB7F,QAAQkG,uBAA1B,EAAmD,KAAKC,eAAxD,EAAyE,IAAzE;;AAEAP,2BAASC,QAAT,CAAkB7F,QAAQoG,WAA1B,EAAuC,KAAKC,aAA5C,EAA2D,IAA3D;;AAEAT,2BAASC,QAAT,CAAkB7F,QAAQsG,YAA1B,EAAwC,KAAKC,cAA7C,EAA6D,IAA7D;;AAGAX,2BAASC,QAAT,CAAkB7F,QAAQwG,kBAA1B,EAA8C,KAAKC,OAAnD,EAA4D,IAA5D;;AAEA,YAAG,KAAKC,gBAAL,EAAH,EAA2B;AACvB,iBAAKC,UAAL,GAAkBC,QAAlB,CAA2B,KAAKC,cAAL,GAAsBC,qBAAjD,EAAuE,KAAKD,cAAL,GAAsBE,qBAA7F;AACH,SAFD,MAGI;AACA,iBAAKJ,UAAL,GAAkBK,OAAlB;AACH;;AAGD;AACA,YAAG,KAAKC,KAAL,EAAH,EAAgB;AACZzG,eAAGmD,MAAH,CAAUC,OAAV,CAAkB,wBAAlB,EAA4CpD,GAAG0G,WAA/C,EAA4D,UAAUrD,GAAV,EAAesD,WAAf,EAA4B;;AAEpF,oBAAI,CAACtD,GAAL,EAAU;AACNf,yBAAKM,IAAL,CAAUgE,cAAV,CAAyB,WAAzB,EAAsC/D,YAAtC,CAAmD7C,GAAG6G,MAAtD,EAA8DF,WAA9D,GAA4EA,WAA5E;AACH;AACJ,aALD;AAMH;;AAED;AACA,YAAIG,cAAcC,SAAS/G,GAAGwC,GAAH,CAAOwE,YAAP,CAAoBC,OAApB,CAA4B,SAA5B,KAA0C,CAAnD,CAAlB;AACA,YAAIH,WAAJ,EAAiB;AACb,iBAAKjB,aAAL;AACH;;AAGD;AACAqB,UAAEC,cAAF,GAAmB,KAAnB;AACA;;AAEA,YAAG,KAAKjB,gBAAL,EAAH,EAA2B;AACvB,iBAAKlF,gBAAL,CAAsB6B,YAAtB,CAAmC,kBAAnC,EAAuDuE,wBAAvD,CAAgF,KAAhF;AACH;AACJ,KAnQI;;AAsQLC,eAAW,qBAAY;;AAEnB,YAAIC,YAAYtH,GAAGuH,QAAH,CAAYC,YAAZ,EAAhB;;AAEAF,kBAAUG,2BAAV,CAAsC,IAAtC,EAA4C,KAAKC,aAAjD;;AAEAJ,kBAAUG,2BAAV,CAAsC,IAAtC,EAA4C,KAAKE,YAAjD;;AAEAvC,2BAASwC,WAAT,CAAqBpI,QAAQgG,YAA7B,EAA2C,KAAKC,aAAhD,EAA+D,IAA/D;;AAEAL,2BAASwC,WAAT,CAAqBpI,QAAQ8F,YAA7B,EAA2C,KAAKC,cAAhD,EAAgE,IAAhE;;AAEAH,2BAASwC,WAAT,CAAqBpI,QAAQkG,uBAA7B,EAAsD,KAAKC,eAA3D,EAA4E,IAA5E;;AAEAP,2BAASwC,WAAT,CAAqBpI,QAAQwG,kBAA7B,EAAiD,KAAKC,OAAtD,EAA+D,IAA/D;;AAEA,aAAKF,cAAL;;AAEA,aAAK8B,iBAAL,GAAyB,IAAzB;;AAEA,aAAKxB,cAAL,GAAsByB,gBAAtB,CAAuCC,kBAAvC,GAA4D,IAA5D;AACA/H,WAAGgI,GAAH,CAAO,YAAP;AACH,KA5RI;;AA+RL9E,oBAAe,0BAAU;AACrB,YAAIZ,OAAO,IAAX;AACA,YAAI2F,QAAQjI,GAAGwC,GAAH,CAAOwE,YAAP,CAAoBC,OAApB,CAA4B,QAA5B,KAAyC,CAArD;AACAjH,WAAGmD,MAAH,CAAUC,OAAV,CAAkB,0BAAlB,EAA8CpD,GAAG0G,WAAjD,EAA8D,UAAUrD,GAAV,EAAesD,WAAf,EAA4B;AACtF,gBAAI,CAACtD,GAAL,EAAU;AACNf,qBAAK4F,UAAL,GAAkBvB,WAAlB;;AAEArE,qBAAKiD,cAAL,CAAoB,IAApB,EAA0B0C,KAA1B;AACH;AACJ,SAND;;AAQAjI,WAAGmD,MAAH,CAAUC,OAAV,CAAkB,0BAAlB,EAA8CpD,GAAG0G,WAAjD,EAA8D,UAAUrD,GAAV,EAAesD,WAAf,EAA4B;AACtF,gBAAI,CAACtD,GAAL,EAAU;AACNf,qBAAK6F,UAAL,GAAkBxB,WAAlB;AACArE,qBAAKiD,cAAL,CAAoB,IAApB,EAA0B0C,KAA1B;AACH;AACJ,SALD;;AAOAjI,WAAGmD,MAAH,CAAUC,OAAV,CAAkB,0BAAlB,EAA8CpD,GAAG0G,WAAjD,EAA8D,UAAUrD,GAAV,EAAesD,WAAf,EAA4B;AACtF,gBAAI,CAACtD,GAAL,EAAU;AACNf,qBAAK8F,UAAL,GAAkBzB,WAAlB;AACArE,qBAAKiD,cAAL,CAAoB,IAApB,EAA0B0C,KAA1B;AACH;AACJ,SALD;AAMH,KAvTI;;AAyTLhF,sBAAiB,4BAAU;AACvB,YAAIX,OAAO,IAAX;AACA,YAAI2F,QAAQjI,GAAGwC,GAAH,CAAOwE,YAAP,CAAoBC,OAApB,CAA4B,QAA5B,KAAyC,CAArD;AACAjH,WAAGmD,MAAH,CAAUC,OAAV,CAAkB,4BAAlB,EAAgDpD,GAAG0G,WAAnD,EAAgE,UAAUrD,GAAV,EAAesD,WAAf,EAA4B;AACxF,gBAAI,CAACtD,GAAL,EAAU;AACNf,qBAAK4F,UAAL,GAAkBvB,WAAlB;;AAEArE,qBAAKiD,cAAL,CAAoB,IAApB,EAA0B0C,KAA1B;AACH;AACJ,SAND;;AAQAjI,WAAGmD,MAAH,CAAUC,OAAV,CAAkB,4BAAlB,EAAgDpD,GAAG0G,WAAnD,EAAgE,UAAUrD,GAAV,EAAesD,WAAf,EAA4B;AACxF,gBAAI,CAACtD,GAAL,EAAU;AACNf,qBAAK6F,UAAL,GAAkBxB,WAAlB;AACArE,qBAAKiD,cAAL,CAAoB,IAApB,EAA0B0C,KAA1B;AACH;AACJ,SALD;;AAOAjI,WAAGmD,MAAH,CAAUC,OAAV,CAAkB,0BAAlB,EAA8CpD,GAAG0G,WAAjD,EAA8D,UAAUrD,GAAV,EAAesD,WAAf,EAA4B;AACtF,gBAAI,CAACtD,GAAL,EAAU;AACNf,qBAAK8F,UAAL,GAAkBzB,WAAlB;AACArE,qBAAKiD,cAAL,CAAoB,IAApB,EAA0B0C,KAA1B;AACH;AACJ,SALD;AAMH,KAjVI;;AAoVL/C,UAAM,gBAAY;AACd,aAAKmB,cAAL,GAAsByB,gBAAtB,CAAuCC,kBAAvC,GAA4D,KAAKnF,IAAjE;AACA,aAAKyF,YAAL,GAAoB,KAApB;AACH,KAvVI;;AA0VL;AACAlD,YAAQ,kBAAY;;AAEhB,YAAImD,eAAe,KAAK1F,IAAL,CAAUgE,cAAV,CAAyB,gBAAzB,CAAnB;;AAEA,YAAG,KAAKV,gBAAL,EAAH,EAA2B;AACvBoC,yBAAa1B,cAAb,CAA4B,gBAA5B,EAA8C2B,MAA9C,GAAuD,KAAvD;AACAD,yBAAa1B,cAAb,CAA4B,iBAA5B,EAA+C2B,MAA/C,GAAwD,IAAxD;AACH,SAHD,MAII;AACAD,yBAAa1B,cAAb,CAA4B,gBAA5B,EAA8C2B,MAA9C,GAAuD,IAAvD;AACAD,yBAAa1B,cAAb,CAA4B,iBAA5B,EAA+C2B,MAA/C,GAAwD,KAAxD;AACH;;AAED;AACA,aAAK,IAAIC,OAAO,CAAhB,EAAmBA,QAAQ7I,SAAS8I,YAApC,EAAkDD,MAAlD,EAA0D;AACtD,gBAAI5F,OAAO,KAAK8F,cAAL,CAAoBF,IAApB,CAAX;AACA,gBAAIG,gBAAgB/F,KAAKgE,cAAL,CAAoB,OAApB,CAApB;AACA,iBAAK,IAAIgC,IAAI,CAAb,EAAgBA,IAAID,cAAcE,aAAlC,EAAiDD,GAAjD,EAAsD;AAClD,oBAAIE,WAAWH,cAAcI,QAAd,CAAuBH,CAAvB,CAAf;AACAE,yBAASP,MAAT,GAAkB,KAAlB;AACH;;AAED,gBAAIS,eAAepG,KAAKgE,cAAL,CAAoB,UAApB,CAAnB;AACA,iBAAK,IAAIgC,IAAI,CAAb,EAAgBA,IAAII,aAAaH,aAAjC,EAAgDD,GAAhD,EAAqD;AACjDI,6BAAaD,QAAb,CAAsBH,CAAtB,EAAyBL,MAAzB,GAAkC,KAAlC;AACH;;AAED,gBAAIU,mBAAmBrG,KAAKgE,cAAL,CAAoB,cAApB,CAAvB;AACA,iBAAK,IAAIgC,IAAI,CAAb,EAAgBA,IAAIK,iBAAiBJ,aAArC,EAAoDD,GAApD,EAAyD;AACrDK,iCAAiBF,QAAjB,CAA0BH,CAA1B,EAA6BL,MAA7B,GAAsC,KAAtC;AACH;;AAED,gBAAIW,gBAAgBtG,KAAKgE,cAAL,CAAoB,WAApB,CAApB;AACA,iBAAK,IAAIgC,IAAI,CAAb,EAAgBA,IAAIM,cAAcL,aAAlC,EAAiDD,GAAjD,EAAsD;AAClDM,8BAAcH,QAAd,CAAuBH,CAAvB,EAA0BL,MAA1B,GAAmC,KAAnC;AACH;;AAED,gBAAIY,SAASvG,KAAKC,YAAL,CAAkB,QAAlB,CAAb;AACAsG,mBAAOC,aAAP;AACH;;AAED,YAAIC,QAAQ,KAAKzG,IAAL,CAAUgE,cAAV,CAAyB,OAAzB,CAAZ;AACA,YAAI0C,SAASD,MAAMzC,cAAN,CAAqB,SAArB,CAAb;AACA,YAAI2C,YAAYF,MAAMzC,cAAN,CAAqB,WAArB,CAAhB;AACA0C,eAAOf,MAAP,GAAgB,KAAhB;AACAgB,kBAAUhB,MAAV,GAAmB,KAAnB;;AAEA,YAAIiB,YAAY,KAAK5G,IAAL,CAAUgE,cAAV,CAAyB,OAAzB,CAAhB;AACA4C,kBAAUjB,MAAV,GAAmB,KAAnB;;AAGA,aAAKpH,eAAL,CAAqBoH,MAArB,GAA8B,KAA9B;AACA,aAAK1H,aAAL,CAAmB0H,MAAnB,GAA4B,KAA5B;;AAEA,aAAKzH,kBAAL,CAAwByH,MAAxB,GAAiC,KAAjC;AACA,aAAKxH,eAAL,CAAqBwH,MAArB,GAA8B,KAA9B;;AAEA,aAAKtH,iBAAL,CAAuBsH,MAAvB,GAAgC,KAAhC;;AAEA,aAAKrH,iBAAL,CAAuBqH,MAAvB,GAAgC,KAAhC;;AAEA,aAAK/G,SAAL,CAAe+G,MAAf,GAAwB,KAAxB;;AAEA,aAAKkB,YAAL;AACH,KA3ZI;;AA6ZLlE,oBAAgB,wBAAUvB,KAAV,EAAiB0F,QAAjB,EAA2B;;AAEvC,YAAIzB,QAAQ,CAAZ;;AAEA,YAAI,CAACjE,KAAL,EAAY;AACRiE,oBAAQyB,QAAR;AACH,SAFD,MAEO;AACHzB,oBAAQjE,MAAMW,IAAd;AACH;;AAED,YAAIgC,WAAJ;;AAEA;;AAEA,YAAIsB,SAAS,CAAb,EAAgB;AACZtB,0BAAc,KAAKuB,UAAnB;AACH,SAFD,MAGK,IAAID,SAAS,CAAb,EAAgB;AACjBtB,0BAAc,KAAKwB,UAAnB;AACH,SAFI,MAGA,IAAIF,SAAS,CAAb,EAAgB;AACjBtB,0BAAc,KAAKyB,UAAnB;AACH,SAFI,MAGA;AACDuB,oBAAQ3B,GAAR,CAAY,WAAZ;AACH;;AAED,YAAI,CAACrB,WAAL,EAAkB;AACd;AACH;AACD,aAAKtG,EAAL,CAAQwC,YAAR,CAAqB7C,GAAG6G,MAAxB,EAAgCF,WAAhC,GAA8CA,WAA9C;AACH,KA5bI;;AA8bLd,mBAAe,yBAAY;AACvB,YAAI,KAAKnE,OAAT,EAAkB;AACd,iBAAKkI,gBAAL,GAAwB5J,GAAG6J,WAAH,CAAeC,IAAf,CAAoB,KAAKpI,OAAzB,EAAkC,IAAlC,CAAxB;AACH;AACJ,KAlcI;;AAocLqE,oBAAgB,0BAAY;AACxB,YAAI,KAAK6D,gBAAL,IAAyBG,SAA7B,EAAwC;AACpC/J,eAAG6J,WAAH,CAAeG,IAAf,CAAoB,KAAKJ,gBAAzB;AACH;AACJ,KAxcI;;AA0cL3D,aAAQ,mBAAU;AACd,YAAI,KAAKgE,aAAL,IAAsB,KAAKA,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmBC,QAA3E,EACA;AACIvK,oBAAQwK,yBAAR;AACH,SAHD,MAII;AACAvK,sBAAUwK,SAAV,CAAoB,aAApB;AACH;AAEJ,KAndI;;AAqdLjE,oBAAgB,0BAAY;AACxB,eAAO5G,QAAQ,aAAR,EAAuB8K,WAAvB,EAAP;AACH,KAvdI;;AAydLpE,gBAAY,sBAAY;AACpB,eAAO1G,QAAQ,aAAR,EAAuB8K,WAAvB,GAAqCpE,UAArC,EAAP;AACH,KA3dI;;AA6dLqE,kBAAc,sBAAUC,OAAV,EAAmB;AAC7B,YAAIC,UAAU,KAAKvE,UAAL,EAAd;AACA,YAAIqC,OAAOkC,QAAQC,cAAR,CAAuBF,OAAvB,IAAkC,CAA7C;AACA;;AAEA,YAAG,KAAKpE,cAAL,GAAsBuE,YAAtB,IAAsC,CAAzC,EAA2C;;AAEvC,gBAAG,KAAKC,WAAL,IAAoB,CAApB,IAAyB,KAAKpE,KAAL,EAAzB,IAAyC+B,QAAQ,CAApD,EAAsD;AAClDA,uBAAO,CAAP;AACH,aAFD,MAGK,IAAG,KAAKqC,WAAL,IAAoB,CAApB,IAAyB,KAAKpE,KAAL,EAAzB,IAAyC+B,QAAQ,CAApD,EAAsD;AACvDA,uBAAO,CAAP;AACH;AACJ,SARD,MASK,IAAG,KAAKnC,cAAL,GAAsBuE,YAAtB,IAAsC,CAAzC,EAA2C;AAC5C,gBAAGpC,QAAQ,CAAX,EAAa;AACTA,uBAAO,CAAP;AACH;AACJ;;AAED,eAAOA,IAAP;AACH,KAlfI;;AAofLsC,kBAAc,sBAAUtC,IAAV,EAAgB;AAC1B,YAAI,KAAK/B,KAAL,MAAgB+B,QAAQ,CAA5B,EAA+B;AAC3BA,mBAAO,CAAP;AACH;AACD,YAAIkC,UAAU,KAAKvE,UAAL,EAAd;AACA,eAAOuE,QAAQK,YAAR,CAAqBvC,IAArB,CAAP;AACH,KA1fI;;AA4fLtC,sBAAkB,4BAAY;AAC1B;AACA,eAAO,KAAKC,UAAL,GAAkB6E,eAAlB,EAAP;AACH,KA/fI;;AAigBLC,SAAK,eAAY;AACb,aAAK9E,UAAL,GAAkBK,OAAlB;AACH,KAngBI;;AAqgBLkC,oBAAgB,wBAAUF,IAAV,EAAgB;AAC5B,YAAIA,QAAQ,CAAZ,EAAe;AACX,mBAAO,KAAK/H,MAAZ;AACH,SAFD,MAGK,IAAI+H,QAAQ,CAAZ,EAAe;AAChB,mBAAO,KAAK9H,KAAZ;AACH,SAFI,MAGA,IAAI8H,QAAQ,CAAZ,EAAe;AAChB,mBAAO,KAAK7H,GAAZ;AACH,SAFI,MAGA,IAAI6H,QAAQ,CAAZ,EAAe;AAChB,mBAAO,KAAK5H,IAAZ;AACH;AACJ,KAlhBI;;AAohBL;AACAsK,eAAW,qBAAY;AACnB,YAAIR,UAAU,KAAKvE,UAAL,EAAd;AACA,aAAKgF,SAAL,GAAiBT,QAAQU,SAAR,EAAjB;AACA,YAAI,KAAKD,SAAL,IAAkB,IAAtB,EAA4B;AACxB,iBAAKN,WAAL,GAAmB,KAAKM,SAAL,CAAeE,YAAf,EAAnB;;AAEA;AACH,SAJD,MAKK,CAEJ;AACJ,KAhiBI;;AAkiBL;AACA5E,WAAO,iBAAY;;AAEf,YAAI6E,MAAM,KAAV;AACA,YAAIC,UAAU,KAAKpF,UAAL,GAAkBqF,kBAAlB,EAAd;;AAEA,YAAGD,OAAH,EAAW;AACP,gBAAIA,QAAQE,cAAR,IAA0BF,QAAQE,cAAR,CAAuBC,OAAvB,CAA+B,KAA/B,KAAyC,CAAvE,EAA0E;AACtEJ,sBAAM,IAAN;AACH;AACJ,SAJD,MAKI;AACA;AACA,gBAAI,KAAKjF,cAAL,GAAsBsF,aAAtB,IAAuC,CAA3C,EAA6C;AACzCL,sBAAM,IAAN;AACH;AACJ;;AAED,eAAOA,GAAP;AACH,KArjBI;;AAujBL;AACAM,aAAS,mBAAY;AACjB,YAAI,CAAC,KAAKT,SAAV,EAAqB;AACjB,mBAAOU,6BAAcC,cAArB;AACH;;AAED,eAAO,KAAKX,SAAL,CAAeY,aAAf,EAAP;AACH,KA9jBI;;AAgkBLC,qBAAiB,2BAAY;AACzB,YAAIC,QAAQtM,SAASuM,aAArB;AACA,YAAI,KAAKzF,KAAL,EAAJ,EAAkB;AACdwF,oBAAQ,EAAR,CADc,CACI;AACrB,SAFD,MAGK;AACDA,oBAAQ,GAAR;AACH;;AAED,eAAOA,KAAP;AACH,KA1kBI;;AA4kBL;AACAE,oBAAgB,0BAAY;AACxB,YAAI,CAAC,KAAKlC,aAAN,IAAuB,CAAC,KAAKA,aAAL,CAAmBC,OAA/C,EACI,OAAO,CAAP;;AAEJ,eAAO,KAAK8B,eAAL,MAA0B,KAAK/B,aAAL,CAAmBmC,cAAnB,GAAoC,KAAKnC,aAAL,CAAmBoC,WAAjF,CAAP;AACH,KAllBI;;AAolBLpI,sBAAkB,0BAAUqI,MAAV,EAAkBlI,OAAlB,EAA2BmI,SAA3B,EAAsC;AACpD;AACA,YAAIA,aAAa,KAAjB,EAAwB;AACpBvM,eAAGgI,GAAH,CAAO,2BAAP;AACA;AACH;;AAED,aAAKkD,SAAL;;AAEA,YAAIsB,WAAW,KAAKrG,UAAL,GAAkBsG,OAAlB,CAA0BrI,OAA1B,CAAf;AACA,YAAIoI,YAAY,IAAhB,EAAsB;AAClBxM,eAAGgI,GAAH,CAAO,kBAAP;AACA;AACH;;AAEDlI,kBAAU4M,gBAAV,CAA2B,WAA3B;;AAEA,aAAKC,gBAAL,CAAsB,KAAKnC,YAAL,CAAkB,CAAlB,IAAuB,CAA7C;;AAEA,YAAI8B,UAAU,KAAKzB,WAAnB,EAAgC;AAC5B,gBAAI,KAAKe,OAAL,MAAkBC,6BAAce,cAAhC,IAAkD,KAAKhB,OAAL,MAAkBC,6BAAcgB,aAAtF,EAAqG;AACjG,qBAAKxE,YAAL,GAAoB,IAApB;AACH;AACJ;;AAGD,YAAIG,OAAO,KAAKgC,YAAL,CAAkB8B,MAAlB,CAAX;AACA,YAAI1J,OAAO,KAAK8F,cAAL,CAAoBF,IAApB,CAAX;AACA,YAAIsE,SAASlK,KAAKC,YAAL,CAAkB,QAAlB,CAAb;;AAEAiK,eAAOC,IAAP,CAAYvE,IAAZ,EAAkBgE,QAAlB;AACH,KAnnBI;;AAsnBLlI,qBAAiB,yBAAUgI,MAAV,EAAkBlI,OAAlB,EAA2BmI,SAA3B,EAAsC;AACnD,YAAIA,aAAa,KAAjB,EAAwB;AACpB;AACH;;AAED,YAAI/D,OAAO,KAAKgC,YAAL,CAAkB8B,MAAlB,CAAX;AACA,YAAI1J,OAAO,KAAK8F,cAAL,CAAoBF,IAApB,CAAX;AACA,YAAIsE,SAASlK,KAAKC,YAAL,CAAkB,QAAlB,CAAb;AACAiK,eAAOE,KAAP,CAAaxE,IAAb;;AAEA1I,kBAAU4M,gBAAV,CAA2B,UAA3B;;AAEA;AACA,YAAIJ,UAAU,KAAKzB,WAAnB,EAAgC,CAE/B,CAFD,MAGK;;AAED;AACH;AACJ,KA1oBI;;AA6oBL7F,oBAAgB,wBAAUC,IAAV,EAAgB;AAC5B,YAAIA,IAAJ,EAAU;AACN,iBAAKkG,SAAL,GAAiB,KAAKhF,UAAL,GAAkBiF,SAAlB,EAAjB;AACA,gBAAI,KAAKD,SAAL,IAAkBlG,KAAKgI,WAAL,MAAsB,KAAK9B,SAAL,CAAe8B,WAAf,EAA5C,EAA0E;AACtE,qBAAKvE,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,QAApC,EAA8CqK,WAA9C,CAA0DjI,KAAKkI,OAAL,EAA1D;AACA;AACH;;AAED,gBAAI1C,UAAUxF,KAAKoG,YAAL,EAAd;AACA,gBAAI7L,QAAQ4N,gBAAR,CAAyB3C,OAAzB,CAAJ,EAAuC;AACnC,qBAAK/B,cAAL,CAAoB,KAAK8B,YAAL,CAAkBC,OAAlB,CAApB,EAAgD5H,YAAhD,CAA6D,QAA7D,EAAuEqK,WAAvE,CAAmFjI,KAAKkI,OAAL,EAAnF;AACH;AACJ;AACJ,KA1pBI;;AA4pBL;AACAE,sBAAkB,4BAAY;AAC1B,YAAI,KAAKpD,aAAT,EAAwB;AACpB,mBAAO,KAAKA,aAAL,CAAmBC,OAAnB,GAA6BvK,SAASwK,SAAT,CAAmBmD,gBAAhD,IAAoE,KAAKrD,aAAL,CAAmBC,OAAnB,GAA6BvK,SAASwK,SAAT,CAAmBC,QAA3H;AACH;;AAED,eAAO,KAAP;AACH,KAnqBI;;AAqqBL;AACAmD,0BAAsB,gCAAY;AAC9B,YAAI,KAAKtD,aAAT,EAAwB;AACpB,mBAAO,KAAKA,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmBqD,aAAxD;AACH;;AAED,eAAO,KAAP;AACH,KA5qBI;;AA8qBLb,sBAAkB,0BAAUc,QAAV,EAAoB;AAClC,YAAIC,cAAc,CACd,CACI,CAAC,WAAD,CADJ,EACmB,CAAC,WAAD,CADnB,EACkC,CAAC,QAAD,CADlC,EAC8C,CAAC,UAAD,CAD9C,CADc,EAId,CACI,CAAC,UAAD,CADJ,EACkB,CAAC,YAAD,CADlB,EACkC,CAAC,SAAD,CADlC,EAC+C,CAAC,SAAD,CAD/C,CAJc,EAOd,CACI,CAAC,SAAD,CADJ,EACiB,CAAC,WAAD,CADjB,EACgC,CAAC,UAAD,CADhC,EAC8C,CAAC,UAAD,CAD9C,CAPc,EAUd,CACI,CAAC,UAAD,CADJ,EACkB,CAAC,UAAD,CADlB,EACgC,CAAC,SAAD,CADhC,EAC6C,CAAC,WAAD,CAD7C,CAVc,CAAlB;;AAeA,aAAKA,WAAL,GAAmBA,WAAnB;;AAEA,YAAIC,YAAYD,YAAYD,QAAZ,EAAsBG,MAAtC;;AAEA,YAAIC,YAAY,KAAKjL,IAAL,CAAUgE,cAAV,CAAyB,OAAzB,CAAhB;;AAEA,YAAIkH,aAAaD,UAAUjH,cAAV,CAAyB,WAAzB,CAAjB;;AAEA,aAAK,IAAIgC,IAAI,CAAb,EAAgBA,IAAI+E,SAApB,EAA+B/E,GAA/B,EAAoC;AAChC,gBAAImF,WAAWL,YAAYD,QAAZ,EAAsB7E,CAAtB,CAAf;AACA,gBAAIoF,eAAeD,SAAS,CAAT,IAAc,KAAjC;AACA,gBAAIE,iBAAiBF,SAAS,CAAT,CAArB;;AAEA,gBAAIG,UAAU,KAAK9M,WAAL,CAAiB+M,cAAjB,CAAgCH,YAAhC,CAAd;;AAEA,gBAAII,eAAe,KAAKhN,WAAL,CAAiB+M,cAAjB,CAAgCF,cAAhC,CAAnB;;AAEAH,uBAAW/E,QAAX,CAAoBH,CAApB,EAAuBL,MAAvB,GAAgC,IAAhC;AACAuF,uBAAW/E,QAAX,CAAoBH,CAApB,EAAuB/F,YAAvB,CAAoC7C,GAAG6G,MAAvC,EAA+CF,WAA/C,GAA6DuH,OAA7D;AACAJ,uBAAW/E,QAAX,CAAoBH,IAAI,CAAxB,EAA2B/F,YAA3B,CAAwC7C,GAAG6G,MAA3C,EAAmDF,WAAnD,GAAiEyH,YAAjE;AACH;AACJ,KAntBI;;AAqtBL;AACA7J,0BAAsB,8BAAU+H,MAAV,EAAkB9H,SAAlB,EAA6BC,SAA7B,EAAwC;AAC1DzE,WAAGgI,GAAH,CAAO,cAAcsE,MAAd,GAAuB,UAAvB,GAAoC7H,SAApC,GAAgD,WAAhD,GAA8DD,SAArE;AACA,aAAK0G,SAAL;;AAEA,YAAIoB,UAAU3M,SAAS8I,YAAvB,EACI;;AAGJ;AACA,YAAIhE,aAAaoH,6BAAcwC,iBAA/B,EAAkD;AAC9C,gBAAI,CAAC,KAAKxG,iBAAV,EAA6B;AACzB,qBAAKa,cAAL,CAAoB,KAAK8B,YAAL,CAAkB8B,MAAlB,CAApB,EAA+CzJ,YAA/C,CAA4D,QAA5D,EAAsEyL,UAAtE,CAAiF,IAAjF;AACH,aAFD,MAGK;AACD,qBAAKC,cAAL,GAAsB,KAAKA,cAAL,IAAuB,IAAIC,KAAJ,EAA7C;AACA,oBAAIhG,OAAO,KAAKgC,YAAL,CAAkB8B,MAAlB,CAAX;AACA,qBAAKiC,cAAL,CAAoB/F,IAApB,IAA4B,IAA5B;;AAEA;AACA,oBAAI,KAAKoD,OAAL,MAAkBC,6BAAcwC,iBAApC,EAAuD;AACnD,yBAAK3F,cAAL,CAAoB,KAAK8B,YAAL,CAAkB8B,MAAlB,CAApB,EAA+CzJ,YAA/C,CAA4D,QAA5D,EAAsE4L,cAAtE;AACA,yBAAK/F,cAAL,CAAoB,KAAK8B,YAAL,CAAkB8B,MAAlB,CAApB,EAA+CzJ,YAA/C,CAA4D,QAA5D,EAAsEyL,UAAtE,CAAiF,IAAjF;AACH;AACJ;;AAED;AACA,gBAAIhC,UAAU,KAAKzB,WAAnB,EAAgC;;AAE5B,oBAAI6D,kBAAkB,KAAK9L,IAAL,CAAUC,YAAV,CAAuB,iBAAvB,CAAtB;AACA6L,gCAAgBC,kBAAhB,CAAmC,KAAnC;AACH;AAEJ,SAvBD,MAuBO,IAAIlK,aAAaoH,6BAAc+C,cAA/B,EAA+C;;AAElD,iBAAKlG,cAAL,CAAoB,KAAK8B,YAAL,CAAkB8B,MAAlB,CAApB,EAA+CzJ,YAA/C,CAA4D,QAA5D,EAAsEyL,UAAtE,CAAiF,KAAjF;AACA;AACA;AACA;AACH,SANM,MAOF;AACD,iBAAK5F,cAAL,CAAoB,KAAK8B,YAAL,CAAkB8B,MAAlB,CAApB,EAA+CzJ,YAA/C,CAA4D,QAA5D,EAAsEyL,UAAtE,CAAiF,KAAjF;AACH;;AAED;AACA,YAAI7J,aAAaoH,6BAAcgB,aAA/B,EAA8C;;AAE1C,iBAAKnE,cAAL,CAAoB,KAAK8B,YAAL,CAAkB8B,MAAlB,CAApB,EAA+CzJ,YAA/C,CAA4D,QAA5D,EAAsEgM,YAAtE,CAAmF,IAAnF;AACH,SAHD,MAIK;AACD,iBAAKnG,cAAL,CAAoB,KAAK8B,YAAL,CAAkB8B,MAAlB,CAApB,EAA+CzJ,YAA/C,CAA4D,QAA5D,EAAsEgM,YAAtE,CAAmF,KAAnF;AACH;;AAED;AACA,YAAIpK,aAAaoH,6BAAce,cAA/B,EAA+C;;AAE3C,gBAAI8B,kBAAkB,KAAK9L,IAAL,CAAUC,YAAV,CAAuB,iBAAvB,CAAtB;AACA6L,4BAAgBC,kBAAhB,CAAmC,KAAnC;;AAEA,iBAAK,IAAIxK,QAAQ,CAAjB,EAAoBA,QAAQxE,SAAS8I,YAArC,EAAmDtE,OAAnD,EAA4D;AACxD,qBAAKuE,cAAL,CAAoB,KAAK8B,YAAL,CAAkBrG,KAAlB,CAApB,EAA8CtB,YAA9C,CAA2D,QAA3D,EAAqEyL,UAArE,CAAgF,KAAhF;AACH;AACJ;AACJ,KApxBI;;AAsxBL;AACAQ,oBAAgB,0BAAY;AACxB,YAAIC,iBAAiB,KAAKnM,IAAL,CAAUgE,cAAV,CAAyB,kBAAzB,CAArB;;AAEA,YAAIoI,YAAY,KAAK7C,cAAL,EAAhB;AACA,YAAG6C,YAAY,CAAf,EACIA,YAAY,GAAZ;AACJD,uBAAenI,cAAf,CAA8B,cAA9B,EAA8C/D,YAA9C,CAA2D7C,GAAGkC,KAA9D,EAAqE+M,MAArE,GAA8ED,SAA9E;AACH,KA9xBI;;AAiyBLvF,kBAAc,wBAAY;;AAEtB,YAAInC,YAAYtH,GAAGuH,QAAH,CAAYC,YAAZ,EAAhB;AACAF,kBAAUG,2BAAV,CAAsC,IAAtC,EAA4C,KAAKC,aAAjD;;AAEA,YAAIqH,iBAAiB,KAAKnM,IAAL,CAAUgE,cAAV,CAAyB,kBAAzB,CAArB;;AAEA,YAAI2C,YAAYwF,eAAenI,cAAf,CAA8B,YAA9B,CAAhB;;AAEA,YAAIsI,iBAAiBH,eAAenI,cAAf,CAA8B,qBAA9B,CAArB;;AAEAmI,uBAAenI,cAAf,CAA8B,cAA9B,EAA8C/D,YAA9C,CAA2D7C,GAAGkC,KAA9D,EAAqE+M,MAArE,GAA8E,CAA9E;;AAEA,YAAIE,SAAS,IAAIC,IAAJ,EAAb;;AAEA,YAAIC,SAAS,SAATA,MAAS,CAAUC,EAAV,EAAc;AACvB,gBAAIC,QAAQJ,OAAOK,QAAP,EAAZ;AACA,gBAAIC,UAAUN,OAAOO,UAAP,EAAd;AACA,gBAAID,UAAU,EAAd,EAAkB;AACdA,0BAAU,MAAMA,OAAhB;AACH;AACD,gBAAIE,aAAaJ,QAAQ,GAAR,GAAcE,OAA/B;AACAlG,sBAAU1G,YAAV,CAAuB7C,GAAGkC,KAA1B,EAAiC+M,MAAjC,GAA0CU,UAA1C;;AAEA,gBAAIC,cAAc,KAAKzJ,UAAL,GAAkB0J,SAAlB,EAAlB;;AAEA,gBAAIC,YAAY,CAAhB;AACA,gBAAIF,eAAe,EAAnB,EAAuB;AACnBE,4BAAY,CAAZ;AACH,aAFD,MAGK,IAAIF,cAAc,EAAd,IAAoBA,eAAe,GAAvC,EAA4C;AAC7CE,4BAAY,GAAZ;AACH,aAFI,MAGA,IAAIF,cAAc,GAAd,IAAqBA,eAAe,GAAxC,EAA6C;AAC9CE,4BAAY,GAAZ;AACH,aAFI,MAGA,IAAIF,cAAc,GAAd,IAAqBA,eAAe,GAAxC,EAA6C;AAC9CE,4BAAY,GAAZ;AACH,aAFI,MAGA,IAAIF,cAAc,GAAd,IAAqBA,eAAe,GAAxC,EAA6C;AAC9CE,4BAAY,GAAZ;AACH,aAFI,MAGA;AACDA,4BAAY,CAAZ;AACH;AACDZ,2BAAerM,YAAf,CAA4B7C,GAAG+P,WAA/B,EAA4CC,QAA5C,GAAuDF,SAAvD;AACH,SA/BD;;AAiCA,aAAKpI,aAAL,GAAqB2H,MAArB;;AAEA/H,kBAAU2I,yBAAV,CAAoC,IAApC,EAA0CZ,MAA1C,EAAkD,CAAlD,EAAqDrP,GAAGkQ,KAAH,CAASC,cAA9D,EAA8E,CAA9E,EAAiF,KAAjF;AACH,KAp1BI;;AAu1BLC,iBAAa,uBAAY;;AAErB,YAAI,CAAC,KAAKC,UAAV,EAAsB;AAClB;AACH;AACD,YAAI/H,eAAe,KAAK1F,IAAL,CAAUgE,cAAV,CAAyB,gBAAzB,CAAnB;;AAEA,YAAI0J,iBAAiBhI,aAAa1B,cAAb,CAA4B,gBAA5B,EAA8CA,cAA9C,CAA6D,kBAA7D,CAArB;AACA0J,uBAAezN,YAAf,CAA4B7C,GAAGkC,KAA/B,EAAsC+M,MAAtC,GAA+C,KAAKoB,UAAL,CAAgBE,cAAhB,GAAiC,GAAhF;;AAGA,YAAIC,iBAAiBlI,aAAa1B,cAAb,CAA4B,gBAA5B,EAA8CA,cAA9C,CAA6D,kBAA7D,CAArB;;AAEA,YAAI6J,YAAY,KAAhB;;AAEA,YAAIlF,UAAU,KAAKpF,UAAL,GAAkBqF,kBAAlB,EAAd;;AAEA,YAAID,OAAJ,EAAa;AACT,gBAAImF,WAAWnF,QAAQmF,QAAR,GAAmB,EAAlC;;AAEA,gBAAIA,YAAY,CAAhB,EAAmB;AACfD,4BAAY,KAAZ;AACH,aAFD,MAGK,IAAIC,YAAY,CAAhB,EAAmB;AACpBD,4BAAY,KAAZ;AACH,aAFI,MAGA,IAAIC,YAAY,CAAhB,EAAmB;AACpBD,4BAAY,KAAZ;AACH;AACJ;;AAEDD,uBAAe3N,YAAf,CAA4B7C,GAAGkC,KAA/B,EAAsC+M,MAAtC,GAA+CwB,SAA/C;;AAEA,YAAIE,aAAarI,aAAa1B,cAAb,CAA4B,cAA5B,CAAjB;;AAEA,YAAIgK,WAAWD,WAAW/J,cAAX,CAA0B,gBAA1B,CAAf;;AAEA,YAAIiK,cAAc,MAAlB;;AAEA,YAAI,KAAKR,UAAL,CAAgBS,YAAhB,IAAgC,CAApC,EAAuC;AACnCD,0BAAc,MAAd;AACH;;AAED;AACA,YAAI,KAAKR,UAAL,CAAgBU,SAAhB,GAA4B,CAAhC,EAAmC;AAC/B,gBAAI,KAAKV,UAAL,CAAgBU,SAAhB,IAA6B,CAAjC,EAAoC;AAChCF,+BAAe,KAAf;AACH,aAFD,MAGK;AACDA,+BAAe,OAAf;AACH;AACJ,SAPD,MAQK;AACDA,2BAAe,OAAf;AACH;;AAEDD,iBAAS/N,YAAT,CAAsB7C,GAAGgR,QAAzB,EAAmC/B,MAAnC,GAA4C4B,WAA5C;AACH,KAh5BI;;AAk5BLI,kBAAa,wBAAU;AACnB,YAAIC,WAAW,KAAKtO,IAAL,CAAUgE,cAAV,CAAyB,OAAzB,CAAf;AACA,YAAIuK,gBAAgBD,SAAStK,cAAT,CAAwB,YAAxB,CAApB;AACA,YAAIwK,UAAUD,cAAcvK,cAAd,CAA6B,UAA7B,CAAd;AACA,YAAIyK,UAAU,KAAKpH,aAAL,CAAmBqH,OAAjC;AACAF,gBAAQvO,YAAR,CAAqB7C,GAAG6G,MAAxB,EAAgCF,WAAhC,GAA8C,KAAK/D,IAAL,CAAUC,YAAV,CAAuB,eAAvB,EAAwC0O,uBAAxC,CAAgE,KAAhE,EAAuEF,OAAvE,CAA9C;AACH,KAx5BI;;AA05BL;AACAG,4BAAuB,kCAAU;AAC7B,aAAKC,cAAL,GAAsB,IAAIjD,KAAJ,EAAtB;AACA,aAAI,IAAI5F,IAAI,CAAZ,EAAeA,KAAK,EAApB,EAAwBA,GAAxB,EAA4B,CAE3B;AACJ,KAh6BI;;AAk6BLlE,oBAAgB,wBAAUgN,MAAV,EAAkB;AAAA;;AAC9B1R,WAAGgI,GAAH,CAAO,gCAAP,EAAyC0J,OAAO9D,MAAhD;;AAEA,aAAK/F,iBAAL,GAAyB,KAAKoC,aAAL,IAAsB,EAA/C;;AAEA,YAAI0H,KAAKD,MAAT;AACA,aAAKzH,aAAL,GAAqBtK,SAASiS,SAAT,CAAmBD,EAAnB,CAArB;;AAEA,aAAK3Q,gBAAL,CAAsB6B,YAAtB,CAAmC,kBAAnC,EAAuDgP,kBAAvD,CAA0E,KAA1E;AACA,aAAK7Q,gBAAL,CAAsB6B,YAAtB,CAAmC,kBAAnC,EAAuDuE,wBAAvD,CAAgF,KAAhF;AACA,YAAIsH,kBAAkB,KAAK9L,IAAL,CAAUC,YAAV,CAAuB,iBAAvB,CAAtB;AACA6L,wBAAgBoD,wBAAhB,CAAyC,KAAzC;;AAGA,YAAIC,YAAY,EAAhB;AACA,aAAK,IAAItH,UAAU,CAAnB,EAAsBA,UAAU9K,SAAS8I,YAAzC,EAAuDgC,SAAvD,EAAkE;AAC9D,gBAAIjC,OAAO,KAAKgC,YAAL,CAAkBC,OAAlB,CAAX;AACA,gBAAI,KAAK/B,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDmP,gBAAjD,MAAuE,CAACD,UAAUvJ,IAAV,CAA5E,EAA6F;AACzF,oBAAIyJ,kBAAkB,KAAKvJ,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,CAAtB;AACA;AACA;AACAoP,gCAAgBC,YAAhB,CAA6B1J,IAA7B;AACAyJ,gCAAgBE,WAAhB,CAA4B,KAAKlI,aAAL,CAAmBmI,OAAnB,CAA2B3H,OAA3B,CAA5B;;AAEA;AACA,oBAAIjC,QAAQ,CAAZ,EAAe;AACXyJ,oCAAgBI,6BAAhB;AACH;;AAED,oBAAIC,eAAe,KAAK5J,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,cAAvC,CAAnB;AACAyP,6BAAaJ,YAAb,CAA0B1J,IAA1B;AACA8J,6BAAaH,WAAb,CAAyB,KAAKlI,aAAL,CAAmBmI,OAAnB,CAA2B3H,OAA3B,CAAzB;AACA;AACA;;AAEA,oBAAI8H,cAAc,KAAK7J,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,aAAvC,CAAlB;AACA0P,4BAAYL,YAAZ,CAAyB1J,IAAzB;AACA+J,4BAAYJ,WAAZ,CAAwB,KAAKlI,aAAL,CAAmBmI,OAAnB,CAA2B3H,OAA3B,CAAxB;;AAEA;;AAEA,oBAAIA,WAAW,KAAKI,WAApB,EAAiC;AAC7B,wBAAI2H,kBAAkB,KAAK5P,IAAL,CAAUgE,cAAV,CAAyB,cAAzB,CAAtB;AACA,wBAAI6L,UAAU,KAAd,CAF6B,CAET;AACpBD,oCAAgBjK,MAAhB,GAAyBkK,UAAU,IAAV,GAAiB,KAA1C;;AAEA,wBAAIC,gBAAgB,SAAhBA,aAAgB,GAAY;AAC5BF,wCAAgBjK,MAAhB,GAAyB,KAAzB;AACH,qBAFD;;AAIA,yBAAK3F,IAAL,CAAUC,YAAV,CAAuB,iBAAvB,EAA0C8P,yBAA1C,CAAoED,aAApE;AACH;;AAEDX,0BAAUvJ,IAAV,IAAkB,IAAlB;AACH;AACJ;;AAED,YAAI,KAAKyB,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmBC,QAArD,EAA+D;;AAE3D;AACA,iBAAKwI,gBAAL;AACA,iBAAKC,QAAL;AACA;AACH;;AAED,YAAI,KAAK5I,aAAL,CAAmB6I,UAAnB,IAAiC,KAAKjI,WAAtC,IAAqD,KAAKZ,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmB4I,YAA1G,EAAwH;AACpH,iBAAKrK,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuDmQ,aAAvD,CAAqE,IAArE;AACH,SAFD,MAGK;AACD,iBAAKtK,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuDmQ,aAAvD,CAAqE,KAArE;AACH;;AAED;AACA,YAAI,KAAK/I,aAAL,CAAmBC,OAAnB,GAA6BvK,SAASwK,SAAT,CAAmB8I,UAApD,EAAgE;;AAE5D,iBAAK1E,cAAL,GAAsB,IAAIC,KAAJ,EAAtB;AACA,gBAAIX,YAAY,KAAKjL,IAAL,CAAUgE,cAAV,CAAyB,OAAzB,CAAhB;AACA,gBAAI0C,SAASuE,UAAUjH,cAAV,CAAyB,SAAzB,CAAb;AACA0C,mBAAOf,MAAP,GAAgB,IAAhB;;AAEA;AACA;;AAEA;;AAEA,iBAAKuG,cAAL;AACA;AACA,gBAAIlP,MAAMsT,aAAN,CAAoB,KAAKrL,iBAAzB,KAA+C,KAAKQ,YAAxD,EAAsE;AAClE;;AAEA,oBAAG/F,KAAK2H,aAAL,CAAmBkJ,UAAnB,CAA8BC,OAA9B,IAAyCzT,SAAS0T,YAAT,CAAsBC,IAAlE,EAAuE;AACnE,yBAAKC,aAAL;AACH;AACJ;AAEJ;AACD,YAAI,KAAKtJ,aAAL,CAAmBC,OAAnB,GAA6BvK,SAASwK,SAAT,CAAmBmD,gBAApD,EAAsE;AAClE;AACA,iBAAK,IAAIkG,MAAM,CAAf,EAAkBA,OAAO7T,SAAS8I,YAAlC,EAAgD+K,KAAhD,EAAuD;AACnD,oBAAIC,SAAS,KAAKxJ,aAAL,CAAmBmI,OAAnB,CAA2B,KAAKtH,YAAL,CAAkBtC,OAAO,CAAzB,CAA3B,EAAwDkL,SAArE;AACA,qBAAKhL,cAAL,CAAoB8K,GAApB,EAAyB3Q,YAAzB,CAAsC,QAAtC,EAAgD8Q,wBAAhD,CAAyE,IAAzE,EAA8EF,MAA9E;AACH;AACJ;;AAGD,YAAI,KAAKxJ,aAAL,CAAmBkJ,UAAnB,CAA8BC,OAA9B,IAAyCzT,SAAS0T,YAAT,CAAsBO,SAAnE,EAA8E;AAAI;;AAE9E,iBAAKL,aAAL;AACA,gBAAI/K,OAAO,KAAKgC,YAAL,CAAkB,KAAKP,aAAL,CAAmBkJ,UAAnB,CAA8B7G,MAAhD,CAAX;AACA,iBAAK5D,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0DgR,cAA1D,CAAyElU,SAAS0T,YAAT,CAAsBO,SAA/F;AACA,iBAAKlL,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,cAAvC,EAAuDiR,QAAvD,CAAgE,KAAK7J,aAAL,CAAmBkJ,UAAnB,CAA8BY,MAA9F;;AAEA,gBAAIC,aAAa,KAAK/J,aAAL,CAAmBkJ,UAAnB,CAA8BY,MAA/C;;AAEAjU,sBAAUmU,iBAAV,CAA4B,KAAKvL,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDqR,MAAjD,EAA5B,EAAuFF,UAAvF;;AAEA;AACA,gBAAI,KAAK/J,aAAL,CAAmB6I,UAAnB,IAAiC,KAAKjI,WAA1C,EAAuD;AACnD,qBAAKsJ,gBAAL,GAAwBH,UAAxB;AACH;AACD,iBAAKI,kBAAL,CAAwBJ,UAAxB,EAAoC,CAApC;AACA,iBAAKK,eAAL;AAEH,SAlBD,MAmBK,IAAI,KAAKpK,aAAL,CAAmBkJ,UAAnB,CAA8BC,OAA9B,IAAyCzT,SAAS0T,YAAT,CAAsBiB,MAAnE,EAA2E;AAAE;AAC9E,iBAAKf,aAAL;AACA,gBAAI/K,OAAO,KAAKgC,YAAL,CAAkB,KAAKP,aAAL,CAAmBkJ,UAAnB,CAA8B7G,MAAhD,CAAX;AACA,iBAAK5D,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0DgR,cAA1D,CAAyElU,SAAS0T,YAAT,CAAsBiB,MAA/F;;AAEA,iBAAK5L,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD0R,kBAAjD,CAAoE/U,QAAQgV,UAAR,CAAmBC,OAAvF,EAAgGjM,IAAhG;;AAEA1I,sBAAU4M,gBAAV,CAA2B,gBAA3B;AACA,gBAAIgI,YAAYC,KAAKC,KAAL,CAAWD,KAAKE,MAAL,KAAgB,CAA3B,CAAhB;AACA/U,sBAAUgV,cAAV,CAAyB,KAAKpM,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDqR,MAAjD,EAAzB,EAAoFQ,SAApF;;AAEA,iBAAKN,kBAAL,CAAwB,KAAKnK,aAAL,CAAmB8K,aAA3C,EAA0D,CAA1D;AACA,iBAAKV,eAAL;AACH,SAbI,MAcA,IAAI,KAAKpK,aAAL,CAAmBkJ,UAAnB,CAA8BC,OAA9B,IAAyCzT,SAAS0T,YAAT,CAAsB2B,MAAnE,EAA2E;AAAE;AAC9E,iBAAKzB,aAAL;AACA,gBAAI/K,OAAO,KAAKgC,YAAL,CAAkB,KAAKP,aAAL,CAAmBkJ,UAAnB,CAA8B7G,MAAhD,CAAX;AACA,iBAAK5D,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0DgR,cAA1D,CAAyElU,SAAS0T,YAAT,CAAsB2B,MAA/F;;AAEA,gBAAK,KAAKnN,iBAAL,CAAuBwE,WAAvB,IAAsCtC,SAAtC,IAAmD,KAAKE,aAAL,CAAmBoC,WAAnB,KAAmC,KAAKxE,iBAAL,CAAuBwE,WAA9G,IACA,KAAKpC,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmBC,QADrD,EAC+D;;AAE3D,oBAAI6K,WAAW,KAAKhL,aAAL,CAAmBmI,OAAnB,CAA2B,KAAKnI,aAAL,CAAmBkJ,UAAnB,CAA8B7G,MAAzD,CAAf;AACA,oBAAI4I,aAAavV,SAASwV,SAAT,CAAmBC,QAApC;AACA,qBAAK,IAAIxM,IAAI,CAAb,EAAgBA,IAAIjJ,SAAS0V,SAA7B,EAAwCzM,GAAxC,EAA6C;AACzC,wBAAIqM,SAASK,aAAT,CAAuB1M,CAAvB,EAA0B2M,WAA1B,IAAyC5V,SAASwV,SAAT,CAAmBK,WAAhE,EAA6E;AACzEN,qCAAaD,SAASK,aAAT,CAAuB1M,CAAvB,EAA0B2M,WAAvC;AACH;AACJ;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACI,qBAAK7M,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD0R,kBAAjD,CAAoE/U,QAAQgV,UAAR,CAAmBiB,QAAvF,EAAiGjN,IAAjG;AACA,qBAAKE,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD6S,kBAAjD,CAAoE,IAApE,EAAyElN,IAAzE;AACJ;;AAEA1I,0BAAU4M,gBAAV,CAA2B,gBAA3B;AACA5M,0BAAU6V,cAAV,CAAyB,KAAKjN,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDqR,MAAjD,EAAzB,EAAoF,CAApF;;AAEA,qBAAK,IAAItL,IAAIjJ,SAAS0V,SAAT,GAAqB,CAAlC,EAAqCzM,KAAK,CAA1C,EAA6CA,GAA7C,EAAkD;AAC9C,wBAAIgN,aAAa,KAAK3L,aAAL,CAAmBmI,OAAnB,CAA2B,KAAKtH,YAAL,CAAkBtC,OAAO,CAAzB,CAA3B,EAAwD8M,aAAxD,CAAsE1M,CAAtE,CAAjB;AACA,wBAAIiN,eAAeD,WAAWE,UAA9B;AACA,wBAAIF,WAAWL,WAAX,IAA0B5V,SAASwV,SAAT,CAAmBC,QAAjD,EAA2D;AACvD,4BAAIS,gBAAgBA,aAAajI,MAAb,GAAsB,CAA1C,EAA6C;AACzC,iCAAKwG,kBAAL,CAAwByB,aAAa,CAAb,CAAxB,EAAyC,CAAzC;AACA,iCAAKxB,eAAL;AACA;AACH;AACJ,qBAND,MAOK,IAAIuB,WAAWL,WAAX,IAA0B5V,SAASwV,SAAT,CAAmBY,MAAjD,EAAyD;AAC1D,4BAAIF,gBAAgBA,aAAajI,MAAb,GAAsB,CAA1C,EAA6C;AACzC,iCAAKwG,kBAAL,CAAwByB,aAAa,CAAb,CAAxB,EAAyC,CAAzC;AACA,iCAAKxB,eAAL;AACA;AACH;AACJ,qBANI,MAOA,IAAIuB,WAAWL,WAAX,IAA0B5V,SAASwV,SAAT,CAAmBa,MAAjD,EAAyD;AAC1D,4BAAIH,gBAAgBA,aAAajI,MAAb,GAAsB,CAA1C,EAA6C;AACzC,iCAAKwG,kBAAL,CAAwByB,aAAa,CAAb,CAAxB,EAAyC,CAAzC;AACA,iCAAKxB,eAAL;AACA;AACH;AACJ;AACJ;AACJ;AACJ,SA3DI,MA4DA,IAAI,KAAKpK,aAAL,CAAmBkJ,UAAnB,CAA8BC,OAA9B,IAAyCzT,SAAS0T,YAAT,CAAsB4C,KAAnE,EAA0E;AAAG;AAC9E,iBAAK1C,aAAL;AACA,gBAAI/K,OAAO,KAAKgC,YAAL,CAAkB,KAAKP,aAAL,CAAmBkJ,UAAnB,CAA8B7G,MAAhD,CAAX;AACA,iBAAK5D,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0DgR,cAA1D,CAAyElU,SAAS0T,YAAT,CAAsB4C,KAA/F;AACA,iBAAKvN,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD0R,kBAAjD,CAAoE/U,QAAQgV,UAAR,CAAmB0B,OAAvF,EAAgG1N,IAAhG;AACH,SALI,MAMA,IAAI,KAAKyB,aAAL,CAAmBkJ,UAAnB,CAA8BC,OAA9B,IAAyCzT,SAAS0T,YAAT,CAAsBC,IAAnE,EAAyE;AAAG;AAC7E,gBAAIhR,OAAO,IAAX;AACA,gBAAI6T,UAAU,KAAK3L,YAAL,CAAkB,KAAKP,aAAL,CAAmBkJ,UAAnB,CAA8B7G,MAAhD,CAAd;AACA,gBAAI8J,WAAW,KAAKnM,aAAL,CAAmBkJ,UAAnB,CAA8B7G,MAA9B,GAAqC,EAApD;AACA,gBAAI+J,gBAAgB1B,KAAKC,KAAL,CAAWtS,KAAK2H,aAAL,CAAmBkJ,UAAnB,CAA8B7G,MAA9B,GAAqC,EAAhD,CAApB,CAJ0E,CAIF;AACxE,gBAAIgK,WAAW,EAAf;AACA,gBAAIC,WAAWjU,KAAK2H,aAAL,CAAmBkJ,UAAnB,CAA8BY,MAA7C;AACA,gBAAIyC,eAAe7B,KAAKC,KAAL,CAAW2B,WAAS,IAApB,CAAnB;AACA,gBAAIE,eAAeF,WAAS,IAA5B;AACA,gBAAIH,YAAW,CAAf,EAAiB;AACbE,yBAAS,CAAT,IAAeG,eAAa,EAA5B;AACH;AACD,gBAAIL,YAAW,CAAf,EAAiB;;AAEbE,yBAAS,CAAT,IAAe3B,KAAKC,KAAL,CAAW6B,eAAa,EAAxB,CAAf;AACAH,yBAAS,CAAT,IAAeG,eAAa,EAA5B;AACH;AACD,gBAAIL,YAAW,CAAf,EAAiB;AACbE,yBAAS,CAAT,IAAe3B,KAAKC,KAAL,CAAW6B,eAAa,GAAxB,CAAf;AACAH,yBAAS,CAAT,IAAeG,eAAa,GAAb,GAAiB,EAAhC;AACAH,yBAAS,CAAT,IAAe3B,KAAKC,KAAL,CAAW6B,eAAa,GAAb,GAAiB,EAA5B,CAAf;AACH;AACD,iBAAKC,mBAAL;;AAEA,iBAAK,IAAI9N,IAAE,CAAX,EAAaA,IAAI0N,SAAS1I,MAA1B,EAAiChF,GAAjC,EAAqC;AACjC,oBAAIJ,OAAO,KAAKgC,YAAL,CAAkB8L,SAAS1N,CAAT,CAAlB,CAAX;AACA,qBAAKF,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0DgR,cAA1D,CAAyElU,SAAS0T,YAAT,CAAsBC,IAA/F;;AAEA,oBAAI+C,iBAAiB,CAArB,EAAuB;AACnB;AACA,yBAAK3N,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD0R,kBAAjD,CAAoE/U,QAAQgV,UAAR,CAAmBmC,MAAvF,EAA+FnO,IAA/F;AACA,yBAAKoO,YAAL,CAAkBN,SAAS1N,CAAT,CAAlB,EAA+B,KAA/B,EAAqC,YAAI;AAAE,+BAAK2K,aAAL;AAAuB,qBAAlE,EAAmEiD,YAAnE;AACH,iBAJD,MAKI;AACA,yBAAKjD,aAAL;AACA;AACA,yBAAK7K,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD0R,kBAAjD,CAAoE/U,QAAQgV,UAAR,CAAmBqC,QAAvF,EAAiGrO,IAAjG;AACA,wBAAIsO,aAAa,KAAK7M,aAAL,CAAmBmI,OAAnB,CAA2BkE,SAAS1N,CAAT,CAA3B,CAAjB;AACA,yBAAKF,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,aAAvC,EAAsDkU,OAAtD,CAA8D,IAA9D;AACH;;AAED,oBAAIT,SAAS1N,CAAT,KAAe,KAAKiC,WAAxB,EACI,KAAKnC,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuDmU,sBAAvD,CAA8E,KAA9E;AAEP;AAEJ;;AAED,YAAI,KAAK/M,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmB8I,UAArD,EAAiE;AAC7D,iBAAK,IAAIzK,OAAO,CAAhB,EAAmBiC,WAAW9K,SAAS8I,YAAvC,EAAqDgC,SAArD,EAAgE;AAC5D,qBAAK/B,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDoU,mBAAjD,CAAqE,KAArE;AACH;AACD,gBAAIrX,MAAMsT,aAAN,CAAoB,KAAKrL,iBAAzB,KAA+C,KAAKQ,YAAxD,EAAsE,CAAK;;AAE1E,aAFD,MAGK;AACD,oBAAI6O,aAAa,KAAK1M,YAAL,CAAkB,KAAKP,aAAL,CAAmBkN,QAArC,CAAjB;AACA,qBAAKC,eAAL,CAAqB,KAAKnN,aAAL,CAAmBoN,WAAxC,EAAqD,KAAKpN,aAAL,CAAmBqN,YAAxE,EAAsFJ,UAAtF;AACH;AACR,SAXG,MAYK,IAAI,KAAKjN,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmB4I,YAArD,EAAmE;AACpE/S,eAAGgI,GAAH,CAAO,cAAc,KAAKwC,YAAL,CAAkB,KAAKP,aAAL,CAAmB6I,UAArC,CAArB;AACA,gBAAItK,OAAO,KAAKgC,YAAL,CAAkB,KAAKP,aAAL,CAAmB6I,UAArC,CAAX;;AAEA;AACA,gBAAI,KAAK7I,aAAL,CAAmBmC,cAAnB,IAAqC,KAAKvE,iBAAL,CAAuBuE,cAAhE,EAAgF;AAC5E,qBAAK1D,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0DgR,cAA1D,CAAyElU,SAAS0T,YAAT,CAAsBkE,oBAA/F;AACA,qBAAK7O,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0D2U,QAA1D,CAAmE,KAAKvN,aAAL,CAAmB8K,aAAtF;AACH,aAHD,MAIK,IAAI,KAAK9K,aAAL,CAAmBoC,WAAnB,IAAkC,KAAKxE,iBAAL,CAAuBwE,WAA7D,EAA0E;AAC3E,qBAAK3D,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0DgR,cAA1D,CAAyElU,SAAS0T,YAAT,CAAsBoE,kBAA/F;AACA,qBAAK/O,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0D2U,QAA1D,CAAmE,KAAKvN,aAAL,CAAmB8K,aAAtF;AACH,aAHI,MAIA;AACD;AACA,oBAAI,KAAK9K,aAAL,CAAmBkJ,UAAnB,CAA8BC,OAA9B,IAAyCzT,SAAS0T,YAAT,CAAsB4C,KAA/D,IACA,KAAKhM,aAAL,CAAmBkJ,UAAnB,CAA8BC,OAA9B,IAAyCzT,SAAS0T,YAAT,CAAsB2B,MAD/D,IAEA,KAAK/K,aAAL,CAAmBkJ,UAAnB,CAA8BC,OAA9B,IAAyCzT,SAAS0T,YAAT,CAAsBiB,MAFnE,EAE2E;AACvE;AACA,yBAAK5L,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0DgR,cAA1D,CAAyElU,SAAS0T,YAAT,CAAsBqE,aAA/F;AACH;AACD,qBAAKhB,mBAAL;AACH;;AAED,gBAAI9W,MAAMsT,aAAN,CAAoB,KAAKrL,iBAAzB,KAA+C,KAAKQ,YAAxD,EAAsE;AAAK;AACvE,qBAAKqO,mBAAL;AACH;;AAED,gBAAIlO,OAAO,KAAKgC,YAAL,CAAkB,KAAKP,aAAL,CAAmB6I,UAArC,CAAX;AACA,iBAAK6E,iBAAL,CAAuBnP,IAAvB;;AAEA,iBAAK,IAAIgL,MAAM,CAAf,EAAkBA,OAAO7T,SAAS8I,YAAlC,EAAgD+K,KAAhD,EAAuD;AACnD,qBAAK9K,cAAL,CAAoB8K,GAApB,EAAyB3Q,YAAzB,CAAsC,QAAtC,EAAgD+U,sBAAhD,CAAuE,KAAvE;AACH;;AAED,iBAAKlP,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD+U,sBAAjD,CAAwE,IAAxE;;AAEA,iBAAKC,UAAL,CAAgB,IAAhB,EAAsB,KAAK1V,eAA3B;;AAEA,iBAAK2V,gBAAL;;AAEA,iBAAKhJ,cAAL;AAEH,SA3CI,MA4CA,IAAI,KAAK7E,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmB4N,eAArD,EAAsE;AACvE,iBAAKrB,mBAAL;;AAEA,iBAAK5H,cAAL;;AAEA;AACA,iBAAK6I,iBAAL,CAAuB,CAAvB;;AAEA,iBAAKG,gBAAL;;AAEA,iBAAKD,UAAL,CAAgB,IAAhB,EAAsB,KAAK1V,eAAL,GAAuB,CAA7C;;AAEA,gBAAI,KAAK8H,aAAL,CAAmB6I,UAAnB,IAAiC,KAAKjI,WAA1C,EAAuD;AACnD,oBAAIoK,WAAW,KAAKhL,aAAL,CAAmBmI,OAAnB,CAA2B,KAAKvH,WAAhC,CAAf;AACA,qBAAKsJ,gBAAL,GAAwBc,SAAS+C,WAAT,CAAqB/C,SAASgD,eAAT,GAA2B,CAAhD,CAAxB;AACA,qBAAKC,kBAAL,GAA0B,KAAKjO,aAAL,CAAmBkO,SAA7C;AACA,qBAAK9D,eAAL;AACH;AACJ,SAlBI,MAmBA,IAAI,KAAKpK,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmBqD,aAArD,EAAmE;AACpE;AACA,iBAAKqK,UAAL,CAAgB,IAAhB,EAAsB,KAAK1V,eAAL,GAAuB,CAA7C;AACA,iBAAKuU,mBAAL,CAAyB,IAAzB;AACA,iBAAK0B,oBAAL,CAA0B,IAA1B,EAA+B,CAA/B,EAAiC,IAAjC;AACH,SALI,MAMA,IAAI,KAAKnO,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmBkO,iBAArD,EAAuE;AACxE,gBAAI,CAAC,KAAKC,OAAV,EAAkB;AACd;AACA,qBAAK5P,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuD0V,oBAAvD;AACH;AACD;AACA,iBAAKC,SAAL;AACA,iBAAKJ,oBAAL,CAA0B,KAA1B,EAAgC,CAAhC,EAAkC,KAAlC;AACA,iBAAKK,cAAL;AACA,iBAAKC,oBAAL;AACH,SAVI,MAWA,IAAI,KAAKzO,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmBwO,YAArD,EAAkE;AACnE;AACA,iBAAKd,UAAL,CAAgB,IAAhB,EAAsB,KAAKzV,aAA3B;AACA,iBAAKsU,mBAAL;AACA,iBAAKkC,iBAAL,CAAuB,IAAvB,EAA4B,CAA5B,EAA8B,IAA9B;AACH,SALI,MAMA,IAAI,KAAK3O,aAAL,CAAmBC,OAAnB,IAA8BvK,SAASwK,SAAT,CAAmBmD,gBAArD,EAAsE;AACvE;AACA,iBAAKkL,SAAL;AACA,iBAAKI,iBAAL,CAAuB,KAAvB,EAA6B,CAA7B,EAA+B,KAA/B;AACA,iBAAKC,oBAAL;AACA,iBAAKnC,mBAAL,CAAyB,IAAzB;AACH;AACJ,KAvwCI;;AAywCL9R,mBAAe,uBAAUT,KAAV,EAAiBU,MAAjB,EAAyBiU,KAAzB,EAAgC;AAC3C;;;AAGA,YAAIjU,UAAUlF,SAASoZ,WAAvB,EAAoC;AAAS;AACzC,gBAAIC,iBAAiB,IAAIxK,KAAJ,EAArB;AACA,iBAAKlC,SAAS,CAAd,EAAiBA,SAAS3M,SAAS8I,YAAnC,EAAiD6D,QAAjD,EAA2D;AACvD,oBAAIwM,MAAMG,cAAN,GAAuB,CAA3B,EAA8B;AAC1B,wBAAIC,aAAaJ,MAAMK,OAAN,EAAjB;AACA,wBAAI3Q,OAAO,KAAKgC,YAAL,CAAkB8B,MAAlB,CAAX;AACA,wBAAI4M,cAAc,CAAlB,EAAqB;AACjB,6BAAKxQ,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDuW,iBAAjD,CAAmEF,UAAnE,EAA+E,IAA/E;AACH;AACJ;AACJ;AACJ,SAXD,MAeK,IAAIrU,UAAUlF,SAAS0Z,eAAvB,EAAwC;AACzC,iBAAKhJ,UAAL,GAAkB1Q,SAAS2Z,WAAT,CAAqBR,KAArB,CAAlB;;AAEA,iBAAK1I,WAAL;AACH,SAJI,MAMA,IAAIvL,UAAUlF,SAAS4Z,iBAAvB,EAA0C,CAE9C,CAFI,MAIA,IAAI1U,UAAUlF,SAAS6Z,cAAvB,EAAuC;AAAM;AAC9C,gBAAIlN,SAASwM,MAAMW,gBAAN,EAAb;AACA,gBAAIjR,OAAO,KAAKgC,YAAL,CAAkB8B,MAAlB,CAAX;AACA,iBAAK5D,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD6W,UAAjD,CAA4D,IAA5D;;AAEA,gBAAIpN,UAAU,KAAKzB,WAAnB,EAAgC;AAC5B,oBAAI2H,kBAAkB,KAAK5P,IAAL,CAAUgE,cAAV,CAAyB,cAAzB,CAAtB;;AAEA4L,gCAAgBjK,MAAhB,GAAyB,IAAzB;;AAEA,oBAAImK,gBAAgB,SAAhBA,aAAgB,GAAY;AAC5BF,oCAAgBjK,MAAhB,GAAyB,KAAzB;AACH,iBAFD;;AAIA,qBAAK3F,IAAL,CAAUC,YAAV,CAAuB,iBAAvB,EAA0C8P,yBAA1C,CAAoED,aAApE;AACH;AACJ,SAhBI,MAkBA,IAAI7N,UAAUlF,SAASga,qBAAvB,EAA8C;AAAG;AAClD,gBAAIrN,SAASwM,MAAMW,gBAAN,EAAb;AACA,gBAAIjR,OAAO,KAAKgC,YAAL,CAAkB8B,MAAlB,CAAX;;AAEA,iBAAK5D,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD6W,UAAjD,CAA4D,KAA5D;AACA,gBAAIpN,UAAU,KAAKzB,WAAnB,EAAgC;AAC5B,oBAAI2H,kBAAkB,KAAK5P,IAAL,CAAUgE,cAAV,CAAyB,cAAzB,CAAtB;;AAEA4L,gCAAgBjK,MAAhB,GAAyB,KAAzB;AACH;AACJ,SAVI,MAYA,IAAI1D,UAAUlF,SAASia,gBAAvB,EAAyC,CAE7C,CAFI,MAIA,IAAI/U,UAAUlF,SAASka,gBAAvB,EAAyC,CAE7C,CAFI,MAIA,IAAIhV,UAAUlF,SAASma,kBAAvB,EAA2C,CAE/C,CAFI,MAIA,IAAIjV,UAAUlF,SAASoa,cAAvB,EAAuC;AACxC,iBAAKC,aAAL,GAAqBra,SAASsa,UAAT,CAAoBnB,KAApB,CAArB;AAGH,SAJI,MAMA,IAAGjU,UAAUlF,SAASua,kBAAtB,EAAyC;AAAE;AAC5C,iBAAKC,WAAL,GAAmBrB,MAAMK,OAAN,EAAnB;AACH,SAFI,MAIA,IAAItU,UAAUlF,SAASya,eAAvB,EAAwC,CAE5C,CAFI,MAIA,IAAIvV,UAAUlF,SAAS0a,eAAvB,EAAwC;AACzC,gBAAI7R,OAAO,KAAKgC,YAAL,CAAkBrG,KAAlB,CAAX;AACA,gBAAIA,SAAS,KAAK0G,WAAlB,EAA8B;AAC1B,qBAAKnC,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDyX,oBAAjD,CAAsE,IAAtE,EAA2E,CAA3E;AACH;AACJ,SALI,MAMA,IAAIzV,UAAUlF,SAAS4a,cAAvB,EAAuC;AACxC,gBAAIC,UAAU1B,MAAMW,gBAAN,EAAd;AACA,gBAAItV,SAAS,KAAK0G,WAAlB,EAA8B;AAC1B,qBAAKnC,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,QAApC,EAA8C4X,gBAA9C,CAA+D,IAA/D,EAAoED,OAApE;AACA,qBAAKzY,iBAAL,CAAuBwG,MAAvB,GAAgC,KAAhC;AACA,qBAAKvG,mBAAL,CAAyBuG,MAAzB,GAAkC,KAAlC;AACH,aAJD,MAKI;AACA,oBAAIC,OAAO,KAAKgC,YAAL,CAAkBrG,KAAlB,CAAX;AACA,qBAAKuE,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD6X,iBAAjD,CAAmE,IAAnE,EAAwE,CAAxE;AACH;AACJ;AAEJ,KAj3CI;;AAm3CL;AACAtD,qBAAiB,yBAAUuD,SAAV,EAAqBC,UAArB,EAAiC1D,UAAjC,EAA6C;AAC1D,YAAI5U,OAAO,IAAX;;AAEA,YAAIyM,iBAAiB,KAAKnM,IAAL,CAAUgE,cAAV,CAAyB,kBAAzB,CAArB;;AAEA;AACA;;AAEA;AACA,aAAK,IAAI4B,OAAO,CAAhB,EAAmBA,QAAQ7I,SAAS8I,YAApC,EAAkDD,MAAlD,EAA0D;AACtD,gBAAI5F,OAAON,KAAKoG,cAAL,CAAoBF,IAApB,CAAX;AACA;AACA,gBAAIG,gBAAgB/F,KAAKgE,cAAL,CAAoB,OAApB,CAApB;AACA,iBAAK,IAAIgC,IAAI,CAAb,EAAgBA,IAAID,cAAcE,aAAlC,EAAiDD,GAAjD,EAAsD;AAClD,oBAAIE,WAAWH,cAAcI,QAAd,CAAuBH,CAAvB,CAAf;AACAE,yBAASjG,YAAT,CAAsB7C,GAAG6G,MAAzB,EAAiCF,WAAjC,GAA+C,IAA/C;AACAmC,yBAASP,MAAT,GAAkB,IAAlB;AACAO,yBAAS+R,QAAT,CAAkB,GAAlB;AACH;AACJ;;AAED,YAAIC,qBAAqB,SAArBA,kBAAqB,CAAUtS,IAAV,EAAgB;AACrC,gBAAIuS,QAAQzY,KAAKoG,cAAL,CAAoBF,IAApB,EAA0B5B,cAA1B,CAAyC,OAAzC,CAAZ;AACA,gBAAI4B,QAAQ,CAAZ,EAAe;;AAEX;AACA,qBAAK,IAAII,IAAI,CAAb,EAAgBA,IAAItG,KAAK2H,aAAL,CAAmBmI,OAAnB,CAA2B9P,KAAKuI,WAAhC,EAA6CoN,eAAjE,EAAkFrP,GAAlF,EAAuF;;AAEnF,wBAAIE,WAAWiS,MAAMhS,QAAN,CAAeH,CAAf,CAAf;AACA,wBAAIoS,YAAYlS,SAASmS,YAAT,CAAsBjb,GAAGkb,SAAzB,CAAhB;;AAEAF,8BAAUG,OAAV,CAAkB7Y,KAAKiB,aAAvB,EAAsC,WAAtC;AACA,wBAAI6X,YAAYJ,UAAUlR,IAAV,CAAe,WAAf,CAAhB;AACA,wBAAGsR,SAAH,EAAa;AACTA,kCAAUC,KAAV,GAAkB,GAAlB;AACH;;AAGDvb,8BAAU4M,gBAAV,CAA2B,eAA3B;;AAEA,wBAAI9D,KAAKtG,KAAK2H,aAAL,CAAmBmI,OAAnB,CAA2B9P,KAAKuI,WAAhC,EAA6CoN,eAA7C,GAA+D,CAAxE,EAA2E;AACvE3V,6BAAKoG,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0DyY,6BAA1D;AACA,4BAAIC,QAAQ,SAARA,KAAQ,GAAY;AACpBjZ,iCAAKoG,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0D2Y,gBAA1D;AACH,yBAFD;AAGAR,kCAAUjX,EAAV,CAAa,UAAb,EAAyBwX,KAAzB,EAAgCzS,QAAhC;AACH;AACJ;AAGJ,aA3BD,MA4BK;AACD,oBAAI3E,QAAQ7B,KAAKwI,YAAL,CAAkBtC,OAAO,CAAzB,CAAZ;;AAEA,oBAAI7B,WAAJ;;AAEA,oBAAI6B,QAAQ,CAAZ,EAAe;AACX7B,kCAAcrE,KAAKM,IAAL,CAAUC,YAAV,CAAuB,eAAvB,EAAwC4Y,sBAAtD;AACH,iBAFD,MAGK,IAAIjT,QAAQ,CAAZ,EAAe;AAChB7B,kCAAcrE,KAAKM,IAAL,CAAUC,YAAV,CAAuB,eAAvB,EAAwC6Y,oBAAtD;AACH,iBAFI,MAGA,IAAIlT,QAAQ,CAAZ,EAAe;AAChB7B,kCAAcrE,KAAKM,IAAL,CAAUC,YAAV,CAAuB,eAAvB,EAAwC8Y,qBAAtD;AACH,iBAFI,MAGA;AACDhS,4BAAQ3B,GAAR,CAAY,kBAAZ;AACH;AACD,qBAAK,IAAIY,IAAI,CAAb,EAAgBA,IAAIjJ,SAASic,aAA7B,EAA4ChT,GAA5C,EAAiD;AAC7CmS,0BAAMhS,QAAN,CAAeH,CAAf,EAAkBL,MAAlB,GAA2B,KAA3B;AACAwS,0BAAMhS,QAAN,CAAeH,CAAf,EAAkB/F,YAAlB,CAA+B7C,GAAG6G,MAAlC,EAA0CF,WAA1C,GAAwDA,WAAxD;AACH;;AAED,oBAAIkV,YAAY,EAAhB;AACA,oBAAIrT,QAAQ,CAAZ,EAAe;AACX,yBAAK,IAAII,IAAI,CAAb,EAAgBA,IAAIiT,SAApB,EAA+BjT,GAA/B,EAAoC;AAChCmS,8BAAMhS,QAAN,CAAeH,CAAf,EAAkBL,MAAlB,GAA2B,IAA3B;AACH;AACJ,iBAJD,MAKK;AACD,yBAAK,IAAIK,IAAIjJ,SAASic,aAAT,GAAyB,CAAtC,EAAyChT,KAAKjJ,SAASic,aAAT,GAAyBC,SAAvE,EAAkFjT,GAAlF,EAAuF;AACnFmS,8BAAMhS,QAAN,CAAeH,CAAf,EAAkBL,MAAlB,GAA2B,IAA3B;AACH;AACJ;;AAED;;AAEA;AACH;;AAGD;AACA;AACA;AACA;;AAEA,gBAAIuI,eAAe,CAAnB,CA3EqC,CA2EhB;AACrB/B,2BAAenI,cAAf,CAA8B,cAA9B,EAA8C/D,YAA9C,CAA2D7C,GAAGkC,KAA9D,EAAqE+M,MAArE,GAA8E3M,KAAK0J,eAAL,KAAyB,CAAC8E,eAAe,CAAhB,IAAqB,EAA9C,GAAmD,EAAjI;AAEH,SA9ED;;AAiFA,YAAIgL,kBAAkB,SAAlBA,eAAkB,CAAUtT,IAAV,EAAgB;AAClC,gBAAIuS,QAAQzY,KAAKoG,cAAL,CAAoBF,IAApB,EAA0B5B,cAA1B,CAAyC,OAAzC,CAAZ;AACA,gBAAImV,aAAa,CAAjB;AACA,gBAAIC,4BAA4B,SAA5BA,yBAA4B,GAAY;AAAM;;AAE9C,oBAAID,cAAc,CAAlB,EAAqB;;AAEjB;AACAjB,uCAAmBtS,IAAnB;AACA;AACH;;AAED,oBAAIyT,gBAAgB,KAApB;AACA,qBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,CAApB,EAAuBA,GAAvB,EAA4B;AACxB,wBAAIpT,QAAJ;AACA,wBAAIN,QAAQ,CAAZ,EAAe;AACXM,mCAAWiS,MAAMhS,QAAN,CAAe,MAAMgT,aAAa,CAAb,GAAiBG,CAAvB,CAAf,CAAX;AACH,qBAFD,MAGK;AACDpT,mCAAWiS,MAAMhS,QAAN,CAAegT,aAAa,CAAb,GAAiBG,CAAhC,CAAX;AACH;;AAED,wBAAIpT,QAAJ,EAAc;AACV,4BAAIkS,YAAYlS,SAASmS,YAAT,CAAsBjb,GAAGkb,SAAzB,CAAhB;;AAGA,4BAAI1S,QAAQ,CAAZ,EAAe;AACXwS,sCAAUG,OAAV,CAAkB7Y,KAAKkB,aAAvB,EAAsC,WAAtC;AACA,gCAAI4X,YAAYJ,UAAUlR,IAAV,CAAe,WAAf,CAAhB;AACA,gCAAGsR,SAAH,EAAa;AACTA,0CAAUC,KAAV,GAAkB,GAAlB;AACH;AACJ,yBAND,MAOK,IAAI7S,QAAQ,CAAZ,EAAe;AAChBwS,sCAAUG,OAAV,CAAkB7Y,KAAKoB,gBAAvB,EAAyC,cAAzC;AACAsX,sCAAUlR,IAAV,CAAe,cAAf;AACH,yBAHI,MAIA,IAAItB,QAAQ,CAAZ,EAAe;AAChBwS,sCAAUG,OAAV,CAAkB7Y,KAAKqB,cAAvB,EAAuC,YAAvC;AACAqX,sCAAUlR,IAAV,CAAe,YAAf;AACH,yBAHI,MAIA;AACDkR,sCAAUG,OAAV,CAAkB7Y,KAAKmB,eAAvB,EAAwC,aAAxC;AACAuX,sCAAUlR,IAAV,CAAe,aAAf;AACH;;AAEDhK,kCAAU4M,gBAAV,CAA2B,aAA3B;;AAEA,4BAAIyP,mBAAmB,SAAnBA,gBAAmB,CAAUnY,KAAV,EAAiB;AACpC,gCAAI,CAACiY,aAAL,EAAoB;;AAEhB,oCAAIG,WAAWrN,eAAenI,cAAf,CAA8B,cAA9B,EAA8C/D,YAA9C,CAA2D7C,GAAGkC,KAA9D,EAAqE+M,MAApF;AACA,oCAAID,YAAYoN,QAAhB;AACApN,4CAAYA,YAAY,CAAxB;AACAD,+CAAenI,cAAf,CAA8B,cAA9B,EAA8C/D,YAA9C,CAA2D7C,GAAGkC,KAA9D,EAAqE+M,MAArE,GAA8ED,SAA9E;AACA,oCAAIxG,QAAQ,CAAZ,EAAe;AACX,yCAAK,IAAIP,QAAQ,CAAjB,EAAoBA,QAAQ,CAA5B,EAA+BA,OAA/B,EAAwC;AACpC,4CAAIoJ,UAAU/O,KAAK2H,aAAL,CAAmBmI,OAAnB,CAA2B9P,KAAKuI,WAAhC,EAA6CmN,WAA7C,CAAyD+D,aAAa,CAAb,GAAiB9T,KAA1E,CAAd;AACA,4CAAItB,cAAcrE,KAAKM,IAAL,CAAUC,YAAV,CAAuB,eAAvB,EAAwC0O,uBAAxC,CAAgE,KAAhE,EAAuEF,OAAvE,CAAlB;AACA0J,8CAAMhS,QAAN,CAAegT,aAAa,CAAb,GAAiB9T,KAAhC,EAAuCpF,YAAvC,CAAoD7C,GAAG6G,MAAvD,EAA+DF,WAA/D,GAA6EA,WAA7E;AACH;AACJ;;AAEDoV,8CAAc,CAAd;;AAEAE,gDAAgB,IAAhB;AACAD,0DAA0BD,UAA1B;AACH;AACJ,yBApBD;AAqBAf,kCAAUjX,EAAV,CAAa,UAAb,EAAyBoY,gBAAzB,EAA2CrT,QAA3C;AACH;AACJ;AACJ,aArED;AAsEAkT,sCAA0BD,UAA1B;AACH,SA1ED;;AA4EA,aAAK,IAAIvT,OAAO,CAAhB,EAAmBA,QAAQ7I,SAAS8I,YAApC,EAAkDD,MAAlD,EAA0D;AACtD,gBAAI,KAAKE,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDmP,gBAAjD,EAAJ,EAAyE;AACrE8J,gCAAgBtT,IAAhB;AACH;AACJ;;AAED1I,kBAAU4M,gBAAV,CAA2B,eAA3B;AACH,KA7iDI;;AA+iDL2P,kBAAc,wBAAY;AACtB,YAAI,KAAKpS,aAAT,EAAwB;AACpB,gBAAIT,YAAY,KAAK5G,IAAL,CAAUgE,cAAV,CAAyB,OAAzB,CAAhB;AACA4C,sBAAUjB,MAAV,GAAmB,IAAnB;AACA,gBAAI5B,cAAc,KAAK/D,IAAL,CAAUC,YAAV,CAAuB,eAAvB,EAAwC0O,uBAAxC,CAAgE,KAAhE,EAAuE,KAAKtH,aAAL,CAAmBqH,OAA1F,CAAlB;AACA9H,sBAAU5C,cAAV,CAAyB,WAAzB,EAAsC/D,YAAtC,CAAmD7C,GAAG6G,MAAtD,EAA8DF,WAA9D,GAA4EA,WAA5E;AACH;AACJ,KAtjDI;;AAwjDLgR,uBAAmB,2BAAUnP,IAAV,EAAgB;AAC/B,aAAK0C,SAAL;AACA,YAAI,KAAKL,WAAL,IAAoB,IAAxB,EAA8B;AAC1B;AACH;;AAED,YAAIgD,YAAY,KAAKjL,IAAL,CAAUgE,cAAV,CAAyB,OAAzB,CAAhB;;AAEA,YAAIkH,aAAaD,UAAUjH,cAAV,CAAyB,WAAzB,CAAjB;;AAGA,aAAK,IAAIgC,IAAI,CAAb,EAAgBA,IAAIkF,WAAWjF,aAA/B,EAA8CD,GAA9C,EAAmD;AAC/CkF,uBAAW/E,QAAX,CAAoBH,CAApB,EAAuBL,MAAvB,GAAgC,KAAhC;AACAuF,uBAAW/E,QAAX,CAAoBH,CAApB,EAAuB0T,cAAvB;AAEH;;AAED,YAAI9T,QAAQ,CAAZ,EAAe;AACX,mBAAO,CAAP;AACH;;AAED,YAAI+T,SAASzO,WAAW/E,QAAX,CAAoB,IAAIP,IAAJ,GAAW,CAA/B,CAAb;;AAEA+T,eAAOD,cAAP;AACA,YAAIE,OAAOxc,GAAGyc,OAAH,CAAW,CAAX,CAAX;AACA,YAAIC,OAAO1c,GAAG2c,MAAH,CAAU,CAAV,CAAX;AACA,YAAIC,MAAM5c,GAAG6c,QAAH,CAAYL,IAAZ,EAAkBE,IAAlB,CAAV;AACAH,eAAOhU,MAAP,GAAgB,IAAhB;AACAgU,eAAOO,SAAP,CAAiB9c,GAAG+c,aAAH,CAAiBH,GAAjB,CAAjB;AAEH,KAtlDI;;AAwlDL9E,sBAAkB,4BAAY;AAC1B,YAAIkF,SAAS,KAAK/S,aAAL,CAAmBgT,YAAnB,CAAgC,KAAKpS,WAArC,CAAb;;AAEA,YAAIqS,aAAa,KAAKjT,aAAL,CAAmBmI,OAAnB,CAA2B,KAAKvH,WAAhC,CAAjB;;AAEA,YAAIsS,WAAW,IAAI3O,KAAJ,EAAf,CAL0B,CAKM;;AAEhC,YAAIE,kBAAkB,KAAK9L,IAAL,CAAUC,YAAV,CAAuB,iBAAvB,CAAtB;;AAEA,YAAIua,YAAY3d,QAAQ,WAAR,CAAhB;;AAEA;AACA,YAAIE,SAAS0T,YAAT,CAAsB4C,KAAtB,KAAgC+G,SAASrd,SAAS0T,YAAT,CAAsB4C,KAA/D,CAAJ,EAA2E;;AAEvE,gBAAIoH,YAAY,CAAhB;AACA,gBAAIC,WAAW,IAAI9O,KAAJ,EAAf;AACA,gBAAI+O,UAAUH,UAAUI,WAAV,CAAsB,KAAKvT,aAAL,CAAmB8K,aAAzC,EAAwDmI,WAAWlF,WAAnE,EAAgFkF,WAAWjF,eAA3F,EAA4G,KAAKhO,aAAL,CAAmBqH,OAA/H,CAAd;AACA,gBAAImM,YAAYL,UAAUM,UAAV,CAAqB,KAAKzT,aAAL,CAAmB8K,aAAxC,EAAuDmI,WAAWlF,WAAlE,EAA+EkF,WAAWjF,eAA1F,EAA2G,KAAKhO,aAAL,CAAmBqH,OAA9H,CAAhB;AACA,gBAAIqM,WAAWP,UAAUQ,YAAV,CAAuB,KAAK3T,aAAL,CAAmB8K,aAA1C,EAAyDmI,WAAWlF,WAApE,EAAiFkF,WAAWjF,eAA5F,EAA6G,KAAKhO,aAAL,CAAmBqH,OAAhI,CAAf;;AAEA,gBAAIiM,OAAJ,EAAa;AACTF,4BAAYA,YAAY,CAAxB;AACA,oBAAIQ,QAAQ,IAAIrP,KAAJ,EAAZ;AACAqP,sBAAMC,IAAN,CAAW,KAAK7T,aAAL,CAAmB8K,aAA9B;AACA8I,sBAAMC,IAAN,CAAW,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAA9C;AACA8I,sBAAMC,IAAN,CAAW,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAA9C;AACA8I,sBAAMC,IAAN,CAAWne,SAASoe,cAApB;AACAT,yBAASQ,IAAT,CAAcD,KAAd;;AAGAV,yBAASW,IAAT,CAAc,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAAjD;AACAoI,yBAASW,IAAT,CAAc,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAAjD;AACH;;AAED,gBAAI0I,SAAJ,EAAe;AACXJ,4BAAYA,YAAY,CAAxB;AACA,oBAAIQ,QAAQ,IAAIrP,KAAJ,EAAZ;AACAqP,sBAAMC,IAAN,CAAW,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAA9C;AACA8I,sBAAMC,IAAN,CAAW,KAAK7T,aAAL,CAAmB8K,aAA9B;AACA8I,sBAAMC,IAAN,CAAW,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAA9C;AACA8I,sBAAMC,IAAN,CAAWne,SAASqe,aAApB;AACAV,yBAASQ,IAAT,CAAcD,KAAd;;AAEAV,yBAASW,IAAT,CAAc,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAAjD;AACAoI,yBAASW,IAAT,CAAc,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAAjD;AACH;;AAED,gBAAI4I,QAAJ,EAAc;AACVN,4BAAYA,YAAY,CAAxB;AACA,oBAAIQ,QAAQ,IAAIrP,KAAJ,EAAZ;AACAqP,sBAAMC,IAAN,CAAW,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAA9C;AACA8I,sBAAMC,IAAN,CAAW,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAA9C;AACA8I,sBAAMC,IAAN,CAAW,KAAK7T,aAAL,CAAmB8K,aAA9B;AACA8I,sBAAMC,IAAN,CAAWne,SAASse,eAApB;AACAX,yBAASQ,IAAT,CAAcD,KAAd;;AAEAV,yBAASW,IAAT,CAAc,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAAjD;AACAoI,yBAASW,IAAT,CAAc,KAAK7T,aAAL,CAAmB8K,aAAnB,GAAmC,CAAjD;AACH;;AAED,gBAAIzS,OAAO,IAAX;AACA,gBAAI4b,qBAAqB,SAArBA,kBAAqB,GAAY;AACjC,oBAAIb,aAAa,CAAjB,EAAoB;AAChB;AACH,iBAFD,MAGK,IAAIA,aAAa,CAAjB,EAAoB;AACrBxd,4BAAQse,cAAR,CAAuBb,SAAS,CAAT,EAAY,CAAZ,CAAvB,EADqB,CACmB;AAC3C,iBAFI,MAGA;AACD;AACAhb,yBAAKoG,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuDub,iBAAvD,CAAyEf,SAAzE,EAAoFC,QAApF,EAA8Fhb,KAAK2H,aAAL,CAAmB8K,aAAjH;AACH;AACJ,aAXD;AAYArG,4BAAgB2P,sBAAhB,CAAuCH,kBAAvC;AACAxP,4BAAgB4P,gBAAhB,CAAiC,IAAjC;AACA5P,4BAAgB6P,gBAAhB,CAAiC,IAAjC;AACH;;AAED;AACA,YAAI5e,SAAS0T,YAAT,CAAsBiB,MAAtB,KAAiC0I,SAASrd,SAAS0T,YAAT,CAAsBiB,MAAhE,CAAJ,EAA6E;;AAEzE5F,4BAAgB4P,gBAAhB,CAAiC,IAAjC;AACA5P,4BAAgB8P,iBAAhB,CAAkC,IAAlC;AACArB,qBAASW,IAAT,CAAc,KAAK7T,aAAL,CAAmB8K,aAAjC;AACH;;AAED;AACA,YAAIpV,SAAS0T,YAAT,CAAsB2B,MAAtB,KAAiCgI,SAASrd,SAAS0T,YAAT,CAAsB2B,MAAhE,CAAJ,EAA6E;AACzE,gBAAIE,aAAavV,SAASwV,SAAT,CAAmBC,QAApC;AACA,gBAAIqJ,KAAK,CAAC,CAAV,CAFyE,CAEzD;;AAEhB;AACA;AACA;;;AAGA;AACA;AACA;;AAEA,gBAAIC,iBAAiBtB,UAAUuB,sBAAV,CAAiCzB,UAAjC,CAArB;AACA,gBAAI0B,iBAAiBF,eAAeG,QAApC;AACA,gBAAIC,cAAcJ,eAAeK,UAAjC;;AAEA,gBAAIC,kBAAkB5B,UAAU6B,uBAAV,CAAkC/B,UAAlC,EAA8C,KAAKjT,aAAL,CAAmB8K,aAAjE,CAAtB;AACA,gBAAImK,mBAAmBF,gBAAgBH,QAAvC;AACA,gBAAIM,SAASH,gBAAgBI,UAA7B;;AAGA,gBAAIC,gBAAgBjC,UAAUkC,2BAAV,CAAsCpC,UAAtC,CAApB;AACA,gBAAIqC,iBAAiBF,cAAcR,QAAnC;AACA,gBAAIW,cAAcH,cAAcN,UAAhC;;AAEA,gBAAIU,YAAY,IAAIjR,KAAJ,EAAhB;AACA,gBAAI,KAAK3D,WAAL,IAAoB,KAAKZ,aAAL,CAAmB6I,UAA3C,EAAuD;AAAG;AACtD,oBAAI8L,cAAJ,EAAoB;AAChB1J,iCAAavV,SAASwV,SAAT,CAAmBa,MAAhC;AACAyI,yBAAKK,YAAY,CAAZ,CAAL;AACA,yBAAK,IAAIlW,IAAI,CAAb,EAAgBA,IAAIkW,YAAYlR,MAAhC,EAAwChF,GAAxC,EAA6C;AACzC,4BAAI8W,aAAa,EAAjB;AACAA,mCAAWC,SAAX,GAAuBb,YAAYlW,CAAZ,CAAvB;AACA8W,mCAAWE,SAAX,GAAuB1K,UAAvB;AACAuK,kCAAU3B,IAAV,CAAe4B,UAAf;AACH;AACJ;;AAGD,oBAAIH,cAAJ,EAAoB;AAChBrK,iCAAavV,SAASwV,SAAT,CAAmBY,MAAhC;AACA0I,yBAAKe,YAAY,CAAZ,CAAL;AACA,yBAAK,IAAI5W,IAAI,CAAb,EAAgBA,IAAI4W,YAAY5R,MAAhC,EAAwChF,GAAxC,EAA6C;AACzC,4BAAIiX,aAAa,EAAjB;AACAA,mCAAWF,SAAX,GAAuBH,YAAY5W,CAAZ,CAAvB;AACAiX,mCAAWD,SAAX,GAAuB1K,UAAvB;AACAuK,kCAAU3B,IAAV,CAAe+B,UAAf;AACH;AACJ;;AAED;AACA;AACA;AACA;AACA;AAEH,aA9BD,MA+BK;;AAED,oBAAIX,gBAAJ,EAAsB;AAClBhK,iCAAavV,SAASwV,SAAT,CAAmBC,QAAhC;AACAqJ,yBAAKU,MAAL;AACH;;AAED;AACA;AACA;AACA;AACH;;AAID,gBAAI7c,OAAO,IAAX;AACA,gBAAIwd,sBAAsB,SAAtBA,mBAAsB,GAAY;AAClC,oBAAIZ,oBAAoBO,UAAU7R,MAAV,IAAoB,CAA5C,EAA+C;AAC3C/N,4BAAQkgB,eAAR,CAAwBtB,EAAxB,EAA4BvJ,UAA5B;AACH,iBAFD,MAGK,IAAIuK,UAAU7R,MAAV,IAAoB,CAAxB,EAA2B;AAC5B/N,4BAAQkgB,eAAR,CAAwBtB,EAAxB,EAA4BvJ,UAA5B;AACH,iBAFI,MAGA;AACD;AACA5S,yBAAKoG,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuDmd,kBAAvD,CAA0EP,SAA1E;AACH;AACJ,aAXD;;AAaA,gBAAIQ,0BAA0B,SAA1BA,uBAA0B,GAAY;AACtCpgB,wBAAQkgB,eAAR,CAAwBtB,EAAxB,EAA4BvJ,UAA5B;AACH,aAFD;;AAIA;AACA,gBAAIgL,qBAAqB,SAArBA,kBAAqB,GAAY;AACjC,oBAAIC,mBAAmB7d,KAAKoG,cAAL,CAAoB,CAApB,EAAuB9B,cAAvB,CAAsC,kBAAtC,CAAvB;;AAEA;AACA,oBAAIuZ,iBAAiBtX,aAAjB,GAAiC,CAArC,EAAwC;AACpCvG,yBAAKoG,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuDmd,kBAAvD,CAA0EP,SAA1E;AACH,iBAFD,MAGK;AACD5f,4BAAQugB,eAAR;AACA,wBAAI1R,kBAAkBpM,KAAKM,IAAL,CAAUC,YAAV,CAAuB,iBAAvB,CAAtB;AACA6L,oCAAgBoD,wBAAhB,CAAyC,KAAzC;AACH;AACJ,aAZD;AAaApD,4BAAgB2R,uBAAhB,CAAwCP,mBAAxC;AACApR,4BAAgB4R,sBAAhB,CAAuCJ,kBAAvC;AACAxR,4BAAgB6R,2BAAhB,CAA4CN,uBAA5C;AACAvR,4BAAgB4P,gBAAhB,CAAiC,IAAjC;AACA;AACA;AACA;AACA;AACI5P,4BAAgB8R,iBAAhB,CAAkC,IAAlC;AACJ;AACArD,qBAASW,IAAT,CAAcW,EAAd;AACH;;AAED;AACA,YAAI9e,SAAS0T,YAAT,CAAsBC,IAAtB,KAA+B0J,SAASrd,SAAS0T,YAAT,CAAsBC,IAA9D,CAAJ,EAAyE;;AAErE;AACA5E,4BAAgB4P,gBAAhB,CAAiC,IAAjC;AACA,gBAAI,KAAKrU,aAAL,CAAmB6I,UAAnB,IAAiC,KAAKjI,WAA1C,EAAuD;AACnD6D,gCAAgB+R,iBAAhB,CAAkC,IAAlC;AACH,aAFD,MAGK;AACD/R,gCAAgBgS,eAAhB,CAAgC,IAAhC;AACH;AAEJ;;AAED;AACA,YAAIvD,SAASvP,MAAT,GAAkB,CAAtB,EAAyB,CAExB;AACJ,KAvzDI;;AA0zDL8I,yBAAqB,6BAAUiK,aAAV,EAAyB;AAC1C;AACA;AACA;AACA;AACA;AACA;;AAEA,aAAK,IAAInY,OAAO,CAAhB,EAAmBA,QAAQ7I,SAAS8I,YAApC,EAAkDD,MAAlD,EAA0D;AACtD,gBAAI,KAAKE,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDmP,gBAAjD,EAAJ,EAAyE;AACrE,oBAAI4O,QAAQ,KAAK3W,aAAL,CAAmBmI,OAAnB,CAA2B,KAAKtH,YAAL,CAAkBtC,OAAO,CAAzB,CAA3B,EAAwDqY,MAAxD,IAAkE,CAA9E;AACA,qBAAKnY,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0Die,OAA1D,CAAkEH,aAAlE,EAAgFC,KAAhF;AACH;AAEJ;AACJ,KAz0DI;;AA20DLrN,mBAAe,yBAAY;AACvB,aAAK,IAAI/K,OAAO,CAAhB,EAAmBA,QAAQ7I,SAAS8I,YAApC,EAAkDD,MAAlD,EAA0D;AACtD,gBAAI,KAAKE,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDmP,gBAAjD,EAAJ,EAAyE;AACrE,qBAAKtJ,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,cAAvC,EAAuDie,OAAvD;AACA,qBAAKpY,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,aAAvC,EAAsDie,OAAtD;AACH;AACJ;AACJ,KAl1DI;;AAs1DLjJ,gBAAY,oBAAUkJ,YAAV,EAAwBC,SAAxB,EAAmC;AAC3C,YAAI1Z,YAAYtH,GAAGuH,QAAH,CAAYC,YAAZ,EAAhB;AACAF,kBAAUG,2BAAV,CAAsC,IAAtC,EAA4C,KAAKE,YAAjD;AACA,YAAI4B,YAAY,KAAK3G,IAAL,CAAUgE,cAAV,CAAyB,OAAzB,EAAkCA,cAAlC,CAAiD,WAAjD,CAAhB;AACA2C,kBAAU1G,YAAV,CAAuB7C,GAAGkC,KAA1B,EAAiC+M,MAAjC,GAA0C,EAA1C;AACA1F,kBAAUhB,MAAV,GAAmB,IAAnB;AACA,YAAI0Y,cAAc,EAAlB;AACA,YAAI5R,SAAS,SAATA,MAAS,GAAY;AACrB,gBAAI2R,YAAY,CAAhB,EAAmB;AACfzX,0BAAU1G,YAAV,CAAuB7C,GAAGkC,KAA1B,EAAiC+M,MAAjC,GAA0C,EAA1C;AACA,oBAAI8R,YAAJ,EAAkB;AACdA;AACH;AACDzZ,0BAAUG,2BAAV,CAAsC,IAAtC,EAA4C4H,MAA5C;AACA;AACH;;AAED4R,0BAAcA,cAAcD,SAA5B;AACA,gBAAIA,YAAY,EAAhB,EAAoB;AAChBC,8BAAc,MAAMA,WAApB;AACH;AACD1X,sBAAU1G,YAAV,CAAuB7C,GAAGkC,KAA1B,EAAiC+M,MAAjC,GAA0CgS,WAA1C;AACAD,wBAAYA,YAAY,CAAxB;AACH,SAhBD;AAiBA3R;AACA,aAAK1H,YAAL,GAAoB0H,MAApB;AACA/H,kBAAU2I,yBAAV,CAAoC,IAApC,EAA0CZ,MAA1C,EAAkD,CAAlD,EAAqDrP,GAAGkQ,KAAH,CAASC,cAA9D,EAA8E,CAA9E,EAAiF,KAAjF;AACH,KAj3DI;;AAm3DLqI,eAAW,qBAAY;AACnB,YAAIlR,YAAYtH,GAAGuH,QAAH,CAAYC,YAAZ,EAAhB;AACAF,kBAAUG,2BAAV,CAAsC,IAAtC,EAA4C,KAAKE,YAAjD;AACA,YAAI4B,YAAY,KAAK3G,IAAL,CAAUgE,cAAV,CAAyB,OAAzB,EAAkCA,cAAlC,CAAiD,WAAjD,CAAhB;AACA2C,kBAAU1G,YAAV,CAAuB7C,GAAGkC,KAA1B,EAAiC+M,MAAjC,GAA0C,EAA1C;AACH,KAx3DI;;AA03DLmF,wBAAoB,4BAAU8M,QAAV,EAAoBC,MAApB,EAA4B;AAC5C,YAAIhJ,YAAY,KAAKD,kBAArB;AACA,YAAI,CAACC,SAAL,EACI;AACJ,aAAK,IAAIvP,IAAI,CAAb,EAAgBA,IAAIuP,UAAUvK,MAA9B,EAAsChF,GAAtC,EAA2C;AACvC,gBAAIwY,aAAajJ,UAAUvP,CAAV,EAAayY,WAA9B;AACA,iBAAK,IAAInF,IAAI,CAAb,EAAgBA,IAAIkF,UAApB,EAAgClF,GAAhC,EAAqC;AACjC,oBAAIgF,YAAY/I,UAAUvP,CAAV,EAAa0Y,UAAb,CAAwBpF,CAAxB,CAAhB,EAA4C;AACxC/D,8BAAUvP,CAAV,EAAa2Y,WAAb,CAAyBrF,CAAzB,KAA+BiF,MAA/B;AACA,wBAAIhJ,UAAUvP,CAAV,EAAa2Y,WAAb,CAAyBrF,CAAzB,KAA+B,CAAnC,EAAsC;AAClC/D,kCAAUvP,CAAV,EAAa2Y,WAAb,CAAyBrF,CAAzB,IAA8B,CAA9B;AACH;AACJ;AACJ;AACJ;AACJ,KAz4DI;;AA24DL;AACAxD,0BAAqB,gCAAU;AAC3B,YAAIpW,OAAO,IAAX;AACA,YAAIkf,wBAAwB,SAAxBA,qBAAwB,GAAU;AAClC;AACAlf,iBAAKR,gBAAL,CAAsByG,MAAtB,GAA+B,KAA/B;AACAjG,iBAAKoU,mBAAL,CAAyB,IAAzB;AACA,gBAAIzB,WAAW3S,KAAK2H,aAAL,CAAmBmI,OAAnB,CAA2B9P,KAAKuI,WAAhC,CAAf;AACA,gBAAI4W,eAAe,SAAfA,YAAe,CAASjZ,IAAT,EAAc;AAC7B,oBAAGA,OAAO7I,SAAS8I,YAAnB,EAAgC;AAC5B;AACH;AACD,oBAAIiZ,KAAKzM,SAAS0M,YAAlB;AACArf,qBAAKoG,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,iBAAvC,EAA0D+e,eAA1D,CAA0E3M,SAAS0M,YAAnF,EAAgGnZ,IAAhG;AACAiZ,6BAAa,IAAEjZ,IAAf;AACH,aAPD;AAQAiZ,yBAAa,CAAb;AAEH,SAfD;AAgBAnf,aAAKR,gBAAL,CAAsByG,MAAtB,GAA+B,IAA/B;AACAjG,aAAKR,gBAAL,CAAsBe,YAAtB,CAAmC,kBAAnC,EAAuDgf,oBAAvD,CAA4EL,qBAA5E;AACH,KAh6DI;;AAk6DL;AACA/I,oBAAe,0BAAU;AACrB,YAAInW,OAAO,IAAX;AACA;;AAEA,YAAI+Q,eAAe,SAAfA,YAAe,CAAS7K,IAAT,EAAc;AAC7B,gBAAGA,OAAO7I,SAAS8I,YAAnB,EAAgC;AAC5B;AACH;AACD,gBAAI7F,OAAON,KAAKoG,cAAL,CAAoBF,IAApB,CAAX;AACA,gBAAIsZ,kBAAkBlf,KAAKgE,cAAL,CAAoB,aAApB,CAAtB;AACAkb,4BAAgBvZ,MAAhB,GAAyB,IAAzB;AACA,gBAAIwZ,SAAS,IAAb;AACA,gBAAIC,UAAU,IAAd;AACA,gBAAIC,UAAU,IAAd;AACA,gBAAIC,UAAU,IAAd;AACA,gBAAI1Z,QAAQ,CAAZ,EACA;AACIwZ,0BAAUhiB,GAAGmiB,KAAH,CAASniB,GAAGoiB,OAAH,CAAW,GAAX,EAAe,CAAf,EAAiB,CAAjB,CAAT,EAA8BpiB,GAAGqiB,MAAH,CAAU,GAAV,EAAc,CAAd,EAAiB,EAAjB,CAA9B,CAAV;AACAJ,0BAAUjiB,GAAGmiB,KAAH,CAASniB,GAAGoiB,OAAH,CAAW,GAAX,EAAe,CAAf,EAAiB,CAAjB,CAAT,EAA8BpiB,GAAGqiB,MAAH,CAAU,GAAV,EAAc,CAAd,EAAiB,CAAC,EAAlB,CAA9B,CAAV;AACAH,0BAAUliB,GAAGsiB,QAAH,CAAY,YAAI;AACtBR,oCAAgBvZ,MAAhB,GAAyB,KAAzB;AACH,iBAFS,CAAV;AAGAwZ,yBAAS/hB,GAAG6c,QAAH,CAAY7c,GAAGuiB,SAAH,CAAa,GAAb,CAAZ,EAA8BP,OAA9B,EAAsChiB,GAAGuiB,SAAH,CAAa,GAAb,CAAtC,EAAwDN,OAAxD,EAAgEC,OAAhE,CAAT;AACH,aARD,MAQM,IAAI1Z,QAAQ,CAAZ,EACN;AACIwZ,0BAAUhiB,GAAGmiB,KAAH,CAASniB,GAAGoiB,OAAH,CAAW,GAAX,EAAe,CAAf,EAAiB,CAAjB,CAAT,EAA8BpiB,GAAGqiB,MAAH,CAAU,GAAV,EAAe,CAAC,GAAhB,EAAoB,CAApB,CAA9B,CAAV;AACAJ,0BAAUjiB,GAAGmiB,KAAH,CAASniB,GAAGoiB,OAAH,CAAW,GAAX,EAAe,CAAf,EAAiB,CAAjB,CAAT,EAA8BpiB,GAAGqiB,MAAH,CAAU,GAAV,EAAe,GAAf,EAAmB,CAAnB,CAA9B,CAAV;AACAH,0BAAUliB,GAAGsiB,QAAH,CAAY,YAAI;AACtBR,oCAAgBvZ,MAAhB,GAAyB,KAAzB;AACH,iBAFS,CAAV;AAGAwZ,yBAAS/hB,GAAG6c,QAAH,CAAY7c,GAAGuiB,SAAH,CAAa,GAAb,CAAZ,EAA8BP,OAA9B,EAAsChiB,GAAGuiB,SAAH,CAAa,GAAb,CAAtC,EAAwDN,OAAxD,EAAgEC,OAAhE,CAAT;AACH,aARK,MAQA,IAAI1Z,QAAQ,CAAZ,EACN;AACIwZ,0BAAUhiB,GAAGmiB,KAAH,CAASniB,GAAGoiB,OAAH,CAAW,GAAX,EAAe,CAAf,EAAiB,CAAjB,CAAT,EAA8BpiB,GAAGqiB,MAAH,CAAU,GAAV,EAAe,CAAf,EAAiB,CAAC,EAAlB,CAA9B,CAAV;AACAJ,0BAAUjiB,GAAGmiB,KAAH,CAASniB,GAAGoiB,OAAH,CAAW,GAAX,EAAe,CAAf,EAAiB,CAAjB,CAAT,EAA8BpiB,GAAGqiB,MAAH,CAAU,GAAV,EAAe,CAAf,EAAiB,EAAjB,CAA9B,CAAV;AACAH,0BAAUliB,GAAGsiB,QAAH,CAAY,YAAI;AACtBR,oCAAgBvZ,MAAhB,GAAyB,KAAzB;AACH,iBAFS,CAAV;AAGAwZ,yBAAS/hB,GAAG6c,QAAH,CAAY7c,GAAGuiB,SAAH,CAAa,GAAb,CAAZ,EAA8BP,OAA9B,EAAsChiB,GAAGuiB,SAAH,CAAa,GAAb,CAAtC,EAAwDN,OAAxD,EAAgEC,OAAhE,CAAT;AACH,aARK,MASD,IAAI1Z,QAAQ,CAAZ,EACL;AACIwZ,0BAAUhiB,GAAGmiB,KAAH,CAASniB,GAAGoiB,OAAH,CAAW,GAAX,EAAe,CAAf,EAAiB,CAAjB,CAAT,EAA8BpiB,GAAGqiB,MAAH,CAAU,GAAV,EAAe,GAAf,EAAmB,CAAnB,CAA9B,CAAV;AACAJ,0BAAUjiB,GAAGmiB,KAAH,CAASniB,GAAGoiB,OAAH,CAAW,GAAX,EAAe,CAAf,EAAiB,CAAjB,CAAT,EAA8BpiB,GAAGqiB,MAAH,CAAU,GAAV,EAAe,CAAC,GAAhB,EAAoB,CAApB,CAA9B,CAAV;AACAH,0BAAUliB,GAAGsiB,QAAH,CAAY,YAAI;AACtBR,oCAAgBvZ,MAAhB,GAAyB,KAAzB;AACH,iBAFS,CAAV;AAGAwZ,yBAAS/hB,GAAG6c,QAAH,CAAY7c,GAAGuiB,SAAH,CAAa,GAAb,CAAZ,EAA8BP,OAA9B,EAAsChiB,GAAGuiB,SAAH,CAAa,GAAb,CAAtC,EAAwDN,OAAxD,EAAgEC,OAAhE,CAAT;AACH;AACDJ,4BAAgBhF,SAAhB,CAA0BiF,MAA1B;AACA1O,yBAAa7K,OAAO,CAApB;AACJ;AACC,SAhDD;;AAkDA6K,qBAAa,CAAb;AACH,KA19DI;;AA49DL;AACAwF,0BAAqB,gCAAU;AAC3B,YAAIvW,OAAO,IAAX;AACA,aAAK,IAAIkG,OAAO,CAAhB,EAAmBA,QAAQ7I,SAAS8I,YAApC,EAAkDD,MAAlD,EAA0D;AACtD,gBAAIyM,WAAW,KAAKhL,aAAL,CAAmBmI,OAAnB,CAA2B5J,OAAK,CAAhC,CAAf;AACA,gBAAIA,QAAM,CAAV,EAAa;AACT,qBAAKE,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuD2f,oBAAvD,CAA4EvN,SAASvB,SAArF;AACA,qBAAKhL,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuD4f,iBAAvD;AACH;AACJ;;AAGD,YAAIpP,eAAe,SAAfA,YAAe,CAAS7K,IAAT,EAAc;AAC7B,gBAAGA,OAAO7I,SAAS8I,YAAnB,EAAgC;AAC5B;AACH;AACD,gBAAIwM,WAAW3S,KAAK2H,aAAL,CAAmBmI,OAAnB,CAA2B5J,OAAK,CAAhC,CAAf;AACAlG,iBAAKoG,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD4X,gBAAjD,CAAkE,IAAlE,EAAuExF,SAASvB,SAAhF,EAA0F,IAA1F;AACAL,yBAAa7K,OAAO,CAApB;AACH,SAPD;AAQA6K,qBAAa,CAAb;AACH,KAj/DI;;AAm/DLuF,uBAAkB,2BAAS8J,MAAT,EAAgBC,KAAhB,EAAsBC,KAAtB,EAA4B;AAC1C,YAAItgB,OAAO,IAAX;AACA,YAAIqgB,QAAQA,SAAS,CAArB;AACA,aAAK,IAAIna,OAAO,CAAhB,EAAmBA,QAAQ7I,SAAS8I,YAApC,EAAkDD,MAAlD,EAA0D;AACtD,gBAAIA,QAAO,CAAX,EAAc;AACV,qBAAKE,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD6X,iBAAjD,CAAmEkI,KAAnE,EAAyED,KAAzE;AACH,aAFD,MAGA;AACIrgB,qBAAKP,iBAAL,CAAuBwG,MAAvB,GAAgCma,MAAhC;AACApgB,qBAAKN,mBAAL,CAAyBuG,MAAzB,GAAkCma,MAAlC;AACH;AACJ;AACJ,KA//DI;;AAigELtK,0BAAqB,8BAASsK,MAAT,EAAgBC,KAAhB,EAAsBC,KAAtB,EAA4B;AAC7C,YAAItgB,OAAO,IAAX;AACA,YAAIqgB,QAAQA,SAAS,CAArB;AACA,aAAKE,SAAL,GAAiB,KAAKzgB,aAAtB;;AAEA,aAAK,IAAIoG,OAAO,CAAhB,EAAmBA,QAAQ7I,SAAS8I,YAApC,EAAkDD,MAAlD,EAA0D;AACtD,gBAAIA,QAAQ,CAAZ,EAAe;AACX,qBAAKE,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDyX,oBAAjD,CAAsEsI,KAAtE,EAA4ED,KAA5E;AACH,aAFD,MAGA;AACIrgB,qBAAKT,gBAAL,CAAsB0G,MAAtB,GAA+Bma,MAA/B;AACH;AACJ;;AAED,YAAI,CAACA,MAAL,EAAY;AACR;AACH;;AAED;AACA,aAAKha,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuDigB,iBAAvD;;AAEA,aAAKC,gBAAL,GAAwB,YAAY;AAChCzgB,iBAAKugB,SAAL,IAAkB,CAAlB;AACA,gBAAIvgB,KAAKugB,SAAL,IAAkB,CAAtB,EAAyB;AACrBvgB,qBAAKL,gBAAL,CAAsBgN,MAAtB,GAA+B3M,KAAKugB,SAApC;AACH,aAFD,MAGK;AACD,oBAAI,CAACvgB,KAAKgW,OAAV,EACIhW,KAAK0gB,oBAAL;AACP;AAEJ,SAVD;AAWA,aAAKC,QAAL,CAAc,KAAKF,gBAAnB,EAAqC,CAArC,EAAwC,KAAK3gB,aAA7C,EAA4D,CAA5D;AAEH,KAniEI;;AAqiEL;AACA4gB,0BAAqB,gCAAY;AAC7B,YAAI1gB,OAAO,IAAX;AACA,aAAKgW,OAAL,GAAe,IAAf;AACA,YAAI4K,cAAc,SAAdA,WAAc,GAAU;AACxB,gBAAI5gB,KAAKugB,SAAL,IAAkB,CAAtB,EAAyB;AACrBvgB,qBAAK6gB,UAAL,CAAgB7gB,KAAKygB,gBAArB;AACH;AACDzgB,iBAAKT,gBAAL,CAAsB0G,MAAtB,GAA+B,KAA/B;AACH,SALD;;AAOA;AACA,YAAI6a,cAAc,KAAK1a,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuDwgB,kBAAvD,EAAlB;;AAEA,YAAID,YAAYxV,MAAZ,IAAoB,CAAxB,EAA2B;AACvB9N,sBAAUwK,SAAV,CAAoB,aAApB;AACA;AACH;AACD,YAAK9K,QAAQ8jB,UAAR,CAAmBF,YAAY,CAAZ,CAAnB,KAAoC5jB,QAAQ8jB,UAAR,CAAmBF,YAAY,CAAZ,CAAnB,CAArC,IAA2E5jB,QAAQ8jB,UAAR,CAAmBF,YAAY,CAAZ,CAAnB,KAAoC5jB,QAAQ8jB,UAAR,CAAmBF,YAAY,CAAZ,CAAnB,CAAnH,EACA;AACItjB,sBAAUwK,SAAV,CAAoB,aAApB;AACA;AACH;AACDzK,gBAAQ0jB,mBAAR,CAA4BH,WAA5B;AACAF;AACA;AACA,aAAKxa,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,iBAApC,EAAuD0V,oBAAvD;;AAEA,YAAI3V,OAAO,KAAK8F,cAAL,CAAoB,CAApB,CAAX;AACA,YAAIoZ,kBAAkBlf,KAAKgE,cAAL,CAAoB,aAApB,CAAtB;AACAkb,wBAAgB0B,CAAhB,GAAmB,CAAC,GAApB;AACA1B,wBAAgBvZ,MAAhB,GAAyB,IAAzB;AACAuZ,wBAAgBhF,SAAhB,CAA0B9c,GAAGqiB,MAAH,CAAU,GAAV,EAAc,CAAd,EAAgB,GAAhB,CAA1B;AACH,KAtkEI;;AAwkEL;AACAhO,qBAAiB,2BAAY;;AAEzB,YAAI8D,YAAY,KAAKD,kBAArB;AACA,YAAI,CAACC,SAAD,IAAcA,UAAUvK,MAAV,IAAoB,CAAtC,EACI;AACJ,YAAIwT,aAAa,CAAjB;AACA,YAAIqC,SAAJ;AACA,YAAIC,QAAJ;AACA,YAAIC,SAAJ;AACA,aAAK,IAAI/a,IAAI,CAAb,EAAgBA,IAAIuP,UAAUvK,MAA9B,EAAsChF,GAAtC,EAA2C;AACvC,gBAAI,KAAKuL,gBAAL,IAAyBgE,UAAUvP,CAAV,EAAagb,SAA1C,EAAqD;AACjDxC,6BAAajJ,UAAUvP,CAAV,EAAayY,WAA1B;AACAoC,4BAAYtL,UAAUvP,CAAV,EAAa0Y,UAAzB;AACAoC,2BAAWvL,UAAUvP,CAAV,EAAaib,KAAxB;AACAF,4BAAYxL,UAAUvP,CAAV,EAAa2Y,WAAzB;AACA;AACH;AACJ;;AAED;AACA,YAAIH,aAAa,CAAb,IAAkB,KAAKjgB,eAAL,CAAqBoH,MAA3C,EAAmD;AAC/C,gBAAIub,kBAAkB,KAAK3iB,eAAL,CAAqB0B,YAArB,CAAkC,iBAAlC,CAAtB;AACAihB,4BAAgBC,aAAhB,CAA8B,KAAK9Z,aAAL,CAAmBqH,OAAjD;AACAwS,4BAAgB5e,IAAhB,CAAqBue,SAArB,EAAgCC,QAAhC,EAA0CC,SAA1C;AACH;AAEJ,KAnmEI;;AAqmELhe,qBAAiB,yBAAU3B,KAAV,EAAiB;AAC9B,YAAIggB,YAAYhgB,MAAMW,IAAtB;AACA,YAAIwT,YAAY,KAAKlO,aAAL,CAAmBkO,SAAnC;AACA,YAAI,CAACA,SAAD,IAAcA,UAAUvK,MAAV,IAAoB,CAAtC,EACI;AACJ,YAAI,KAAK/C,WAAL,IAAoB,KAAKZ,aAAL,CAAmB6I,UAA3C,EAAuD;AACnD;AACH;;AAED,YAAIsO,aAAa,CAAjB;AACA,YAAIqC,SAAJ;AACA,YAAIC,QAAJ;AACA,YAAIC,SAAJ;AACA,aAAK,IAAI/a,IAAI,CAAb,EAAgBA,IAAIuP,UAAUvK,MAA9B,EAAsChF,GAAtC,EAA2C;AACvC,gBAAIuP,UAAUvP,CAAV,KAAgBob,UAAUC,SAAV,IAAuB9L,UAAUvP,CAAV,EAAagb,SAAxD,EAAmE;AAC/DxC,6BAAajJ,UAAUvP,CAAV,EAAayY,WAA1B;AACAoC,4BAAYtL,UAAUvP,CAAV,EAAa0Y,UAAzB;AACAoC,2BAAWvL,UAAUvP,CAAV,EAAaib,KAAxB;AACAF,4BAAYxL,UAAUvP,CAAV,EAAa2Y,WAAzB;AACH;AACJ;;AAED,YAAIH,aAAa,CAAjB,EAAoB;AAChB,gBAAI0C,kBAAkB,KAAK3iB,eAAL,CAAqB0B,YAArB,CAAkC,iBAAlC,CAAtB;AACAihB,4BAAgBC,aAAhB,CAA8B,KAAK9Z,aAAL,CAAmBqH,OAAjD;AACAwS,4BAAgB5e,IAAhB,CAAqBue,SAArB,EAAgCC,QAAhC,EAA0CC,SAA1C;AACA,iBAAKxiB,eAAL,CAAqBoH,MAArB,GAA8B,IAA9B;AACH,SALD,MAMK;;AAED,iBAAKpH,eAAL,CAAqBoH,MAArB,GAA8B,KAA9B;AACH;AACJ,KAroEI;;AAuoEL;AACAzD,qBAAiB,yBAAUof,IAAV,EAAgB;AAC7B,YAAIC,YAAY,CAAC,CAAjB;AACA,YAAIzZ,UAAU,KAAKvE,UAAL,EAAd;AACA,YAAIie,YAAY1Z,QAAQ+B,OAAR,CAAiByX,KAAKG,UAAL,GAAkB,OAAnC,CAAhB;AACA,YAAI,CAACD,SAAL,EAAgB;AACZ,mBADY,CACA;AACf;;AAED;AACA,YAAIE,SAASF,UAAU/Y,YAAV,EAAb;AACA,YAAIiZ,SAAS,CAAT,IAAcA,UAAU,CAA5B,EAA+B;AAAG;AAC9B;AACH;;AAED,YAAIC,aAAa,KAAK7b,cAAL,CAAoB,KAAK8B,YAAL,CAAkB8Z,MAAlB,CAApB,CAAjB;AACA,YAAIC,WAAWhc,MAAX,IAAqB,IAAzB,EAA+B;AAC3B,gBAAIic,SAAS,EAAb;AACAA,mBAAOC,UAAP,GAAoBL,UAAUM,WAAV,EAApB;AACA,gBAAIC,UAAU,KAAd;AACA,gBAAIC,UAAU,MAAd;AACA,gBAAIC,eAAeX,KAAKY,UAAL,EAAnB;AACA,gBAAIC,SAASF,aAAaG,MAAb,CAAoB,CAApB,EAAuB,CAAvB,CAAb;AACA,gBAAIC,UAAUJ,aAAaG,MAAb,CAAoB,CAApB,EAAuB,CAAvB,CAAd;AACA,gBAAID,UAAUJ,OAAd,EAAuB;AAAG;AACtB,oBAAIO,YAAYL,aAAaM,SAAb,CAAuB,CAAvB,CAAhB;AACA,oBAAIC,OAAOC,OAAOH,SAAP,CAAX;AACAV,uBAAOc,MAAP,GAAgB,CAAhB;AACAd,uBAAOe,MAAP,GAAgBH,IAAhB;AACA,oBAAIA,QAAQ,CAAR,IAAaA,OAAO3lB,QAAQ,WAAR,EAAqB+lB,iBAA7C,EAAgE;AAC5DjB,+BAAW1hB,YAAX,CAAwB,QAAxB,EAAkC4iB,gBAAlC,CAAmDL,IAAnD;AACH;AACJ,aARD,MASK,IAAIH,WAAWL,OAAf,EAAwB;AAAK;AAC9B,oBAAIM,YAAYL,aAAaM,SAAb,CAAuB,CAAvB,CAAhB;AACA,oBAAIC,OAAOC,OAAOH,SAAP,CAAX;AACH,aAHI,MAIA;AAAI;;AAELX,2BAAW1hB,YAAX,CAAwB,QAAxB,EAAkC6iB,gBAAlC,CAAmDb,YAAnD;AACAL,uBAAOc,MAAP,GAAgB,CAAhB;AACAd,uBAAOmB,aAAP,GAAuBd,YAAvB;AACA,oBAAIe,YAAY,CAAC,CAAjB;AACA,qBAAK,IAAIhd,CAAT,IAAc9I,UAAU+lB,gBAAxB,EAA0C;AACtC,wBAAIhB,gBAAgB/kB,UAAU+lB,gBAAV,CAA2Bjd,CAA3B,CAApB,EAAmD;AAC/Cgd,oCAAYhd,CAAZ;AACA;AACH;AACJ;;AAED,oBAAIX,QAAQ,CAAC,CAAb;AACA,oBAAI6d,aAAa,EAAjB;;AAEA,oBAAIC,OAAO,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,EAA0B,GAA1B,CAAX;AACA,oBAAIC,WAAW,CAAC,GAAD,EAAM,GAAN,EAAW,CAAX,EAAc,GAAd,EAAmB,CAAnB,EAAsB,CAAtB,CAAf;;AAEA,qBAAK,IAAIpd,IAAI,CAAb,EAAgBA,IAAI,CAApB,EAAuBA,GAAvB,EAA4B;AACxB,wBAAIqd,OAAO,CAAC,GAAD,GAAOtR,KAAKE,MAAL,KAAiB,CAAC,IAApC;AACA,yBAAKqR,eAAL,CAAqBD,IAArB,EAA2BF,KAAKnd,CAAL,CAA3B,EAAoCod,SAASpd,CAAT,CAApC,EAAiDA,CAAjD,EAAoDgd,SAApD;AACH;AACJ;AACJ;AACJ,KArsEI;;AAusEL;AACAM,qBAAiB,yBAAUC,OAAV,EAAmBC,OAAnB,EAA4BJ,QAA5B,EAAsC/d,KAAtC,EAA6C2d,SAA7C,EAAwD;AACrEA,oBAAY7e,SAAS6e,SAAT,CAAZ;AACA,YAAIS,WAAW1R,KAAKE,MAAL,KAAgB,EAA/B;;AAEA,YAAIyR,UAAUtmB,GAAGuH,QAAH,CAAYgf,UAAZ,EAAd;AACA,YAAIC,SAAS,IAAIxmB,GAAGQ,IAAP,EAAb;AACAgmB,eAAOje,MAAP,GAAgB,IAAhB;AACA,YAAIke,SAASD,OAAOvL,YAAP,CAAoBjb,GAAG6G,MAAvB,CAAb;AACA;AACA,YAAIwf,YAAY,CAAhB,EAAmB;AACf,gBAAIK,QAAQ,KAAK9jB,IAAL,CAAUC,YAAV,CAAuB,WAAvB,EAAoCpB,SAApC,CAA8C0M,cAA9C,CAA6D,QAA7D,CAAZ;AACAsY,mBAAO9f,WAAP,GAAqB+f,KAArB;AACH,SAHD,MAIK;AACD,gBAAIA,QAAQ,KAAK9jB,IAAL,CAAUC,YAAV,CAAuB,WAAvB,EAAoCpB,SAApC,CAA8C0M,cAA9C,CAA6D,WAA7D,CAAZ;AACAsY,mBAAO9f,WAAP,GAAqB+f,KAArB;AACH;;AAED,aAAK9jB,IAAL,CAAU+jB,QAAV,CAAmBH,MAAnB,EAA2B,GAA3B;AACAA,eAAO3L,QAAP,CAAgB,IAAhB;AACA2L,eAAOI,CAAP,GAAWN,QAAQO,KAAR,GAAgB,CAAhB,GAAoBL,OAAOM,cAAP,GAAwBD,KAAxB,GAAgC,CAApD,GAAwD,EAAnE;AACAL,eAAOhD,CAAP,GAAW4C,OAAX;;AAEA;AACAR,qBAAa,CAAb;AACA,YAAImB,WAAW,cAAenB,SAA9B;AACA,YAAIoB,YAAY,IAAIhnB,GAAGQ,IAAP,EAAhB;AACAwmB,kBAAUze,MAAV,GAAmB,IAAnB;AACA,YAAI0e,cAAcD,UAAU/L,YAAV,CAAuBjb,GAAG6G,MAA1B,CAAlB;AACAogB,oBAAYtgB,WAAZ,GAA0B,KAAK/D,IAAL,CAAUC,YAAV,CAAuB,WAAvB,EAAoCpB,SAApC,CAA8C0M,cAA9C,CAA6D4Y,QAA7D,CAA1B;AACAC,kBAAUJ,CAAV,GAAc,CAAd;AACAI,kBAAUxD,CAAV,GAAc,CAAd;AACAgD,eAAOG,QAAP,CAAgBK,SAAhB;;AAEA,YAAI/e,SAAS,CAAT,IAAcA,SAAS,CAA3B,EAA8B;AAC1Bue,mBAAO3L,QAAP,CAAgB,GAAhB;AACH,SAFD,MAGK,IAAI5S,SAAS,CAAb,EAAgB;AACjBue,mBAAO3L,QAAP,CAAgB,CAAhB;AACAsL,sBAAU,CAAC,GAAX;AACH;;AAED,YAAIe,SAASlnB,GAAGknB,MAAH,CAAUlB,QAAV,EAAoBhmB,GAAGmnB,CAAH,CAAKhB,OAAL,EAAcC,OAAd,CAApB,CAAb;AACA,YAAI7D,YAAYviB,GAAGuiB,SAAH,CAAa,GAAb,CAAhB;AACA,YAAI6E,QAAQpnB,GAAGqnB,UAAH,EAAZ;AACA,YAAIxK,WAAW7c,GAAG6c,QAAH,CAAYqK,MAAZ,EAAoB3E,SAApB,EAA+B6E,KAA/B,CAAf;AACAZ,eAAO1J,SAAP,CAAiBD,QAAjB;AAEH,KAxvEI;;AA0vEL;AACAjG,kBAAc,sBAAUtK,MAAV,EAAkBgb,OAAlB,EAA2BC,SAA3B,EAAqClR,aAArC,EAAoD;;AAE9D,YAAI,KAAKvS,WAAL,CAAiB8J,MAAjB,IAA2B,CAA/B,EAAkC;AAC9B;AACH;;AAED,YAAIpF,OAAO,KAAKgC,YAAL,CAAkB8B,MAAlB,CAAX;AACA,YAAIkb,cAAc,IAAlB;AACA,YAAIC,SAAS,IAAb;AACA,YAAIH,OAAJ,EAAa;AACT;AACH,SAFD,MAGK;AACDE,0BAAc,KAAKhd,YAAL,CAAkB6L,aAAlB,CAAd;AACAoR,qBAAS,KAAK/e,cAAL,CAAoB8e,WAApB,EAAiC3kB,YAAjC,CAA8C,cAA9C,EAA8D6kB,cAA9D,EAAT;AACH;;AAED,YAAGD,MAAH,EAAU;AACN,gBAAIE,SAAS3nB,GAAGmnB,CAAH,CAAK,CAAL,EAAQ,CAAR,CAAb;AACA,gBAAIG,WAAW9e,QAAQ,CAAvB,EAA0B;;AAEtB;AACAmf,yBAAS3nB,GAAGmnB,CAAH,CAAKM,OAAOX,cAAP,GAAwBD,KAA7B,EAAoC,CAApC,CAAT;AACH;;AAED,gBAAIe,YAAY,IAAI5nB,GAAGQ,IAAP,EAAhB;AACA,iBAAKoC,IAAL,CAAU+jB,QAAV,CAAmBiB,SAAnB,EAA8B,GAA9B;;AAEA,gBAAIC,YAAY,KAAKjlB,IAAL,CAAUklB,kBAAV,CAA6B9nB,GAAGmnB,CAAH,CAAKM,OAAOM,WAAP,EAAL,CAA7B,CAAhB;AACAH,sBAAUhB,CAAV,GAAciB,UAAUjB,CAAV,GAAce,OAAOf,CAAP,GAAW,CAAvC;AACAgB,sBAAUpE,CAAV,GAAcqE,UAAUrE,CAAV,GAAcmE,OAAOnE,CAAP,GAAW,CAAvC;AACAoE,sBAAUrf,MAAV,GAAmB,IAAnB;AACA,gBAAIyf,gBAAgBJ,UAAU3M,YAAV,CAAuBgN,YAAYC,eAAnC,CAApB;;AAEA,iBAAK,IAAItf,CAAT,IAAc,KAAK9E,WAAnB,EAAgC;AAC5B,oBAAI,KAAKA,WAAL,CAAiB8E,CAAjB,aAA+Bqf,YAAYE,gBAA/C,EAAiE;AAC7DH,kCAAcI,WAAd,GAA4B,KAAKtkB,WAAL,CAAiB8E,CAAjB,CAA5B;AACH;AACD,oBAAI,KAAK9E,WAAL,CAAiB8E,CAAjB,aAA+Bqf,YAAYI,qBAA/C,EAAsE;AAClEL,kCAAcM,gBAAd,GAAiC,KAAKxkB,WAAL,CAAiB8E,CAAjB,CAAjC;AACH;AACJ;;AAEDof,0BAAcO,YAAd,GAA6B,cAA7B;AACAP,0BAAcQ,aAAd,CAA4B,YAA5B;;AAEA,iBAAKC,mBAAL,GAA2BT,aAA3B;;AAEA,gBAAI1lB,OAAO,IAAX;AACA,gBAAIomB,WAAW,SAAXA,QAAW,GAAM;;AAEjBd,0BAAUe,gBAAV,CAA2B,IAA3B;AACA;AACArmB,qBAAKoG,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,aAAvC,EAAsDkU,OAAtD,CAA8D,IAA9D;AACA,oBAAIwQ,SAAJ,EAAe;AACXA;AACH;AACJ,aARD;AASA,iBAAKkB,mBAAL,CAAyBG,gBAAzB,CAA0CX,YAAYY,WAAZ,CAAwBC,QAAlE,EAA4EJ,QAA5E,EAAsF,IAAtF;AACH;AACJ,KAvzEI;;AAyzEL;AACA9V,sBAAiB,4BAAU;AACvB,YAAImW,eAAe,SAAfA,YAAe,CAASC,OAAT,EAAkBrkB,IAAlB,EAAuB;AACtC,gBAAIqkB,OAAJ,EAAc;AACVjpB,8BAAcwK,WAAd,GAA4B0e,aAA5B;AACA,oBAAIC,aAAaC,KAAKC,KAAL,CAAWzkB,IAAX,CAAjB;AACAgF,wBAAQ3B,GAAR,CAAY,0EAAZ;AACA2B,wBAAQ3B,GAAR,CAAYkhB,UAAZ;AACA,oBAAIvkB,OAAOukB,WAAWG,KAAX,CAAiB,CAAjB,CAAX;AACA,oBAAIC,gBAAgB3kB,KAAK4kB,OAAzB;AACA,oBAAIC,eAAe7kB,KAAK8kB,MAAxB;AACA;AACA,oBAAIC,cAAc/kB,KAAKglB,KAAvB;AACZ;AACY,oBAAIC,aAAa,IAAIpb,KAAJ,EAAjB;AACAob,2BAAW9L,IAAX,CACA;AACI+L,yBAAK,aADT;AAEIC,2BAAM,KAAKJ;AAFf,iBADA;AAKAK,mBAAGC,mBAAH,CAAuB;AACnBC,gCAAYL;AADO,iBAAvB;AAGH;AACJ,SAtBD;;AAwBA,YAAIM,aAAaC,6BAAc5f,WAAd,GAA4BiC,QAA7C;AACA,YAAG0d,UAAH,EAAe;AACX,gBAAIE,WAAWF,WAAWG,MAA1B;AACA5qB,oBAAQ,gBAAR,EAA0B8K,WAA1B,GAAwC+f,aAAxC,CAAsDF,QAAtD,EAA+DrB,YAA/D;AACH;AACJ,KAx1EI;;AA01EL;AACAlW,cAAU,oBAAY;;AAElB,aAAK8E,iBAAL,CAAuB,CAAvB;;AAEA,aAAKa,SAAL;;AAEA,aAAKrX,eAAL,CAAqBoH,MAArB,GAA8B,KAA9B;;AAEA,aAAKvH,gBAAL,CAAsB6B,YAAtB,CAAmC,kBAAnC,EAAuDgP,kBAAvD,CAA0E,IAA1E;AACA,aAAK7Q,gBAAL,CAAsB6B,YAAtB,CAAmC,kBAAnC,EAAuDuE,wBAAvD,CAAgF,IAAhF;;AAEA,aAAKxE,IAAL,CAAUgE,cAAV,CAAyB,cAAzB,EAAyC2B,MAAzC,GAAkD,KAAlD;;AAEA,aAAK3F,IAAL,CAAUgE,cAAV,CAAyB,OAAzB,EAAkC2B,MAAlC,GAA2C,KAA3C;;AAEA,aAAK,IAAIK,IAAI,CAAb,EAAgBA,KAAKjJ,SAAS8I,YAA9B,EAA4CG,GAA5C,EAAiD;AAC7C,gBAAI2hB,WAAW,KAAKtgB,aAAL,CAAmBmI,OAAnB,CAA2BxJ,CAA3B,CAAf;AACA,iBAAKF,cAAL,CAAoBE,CAApB,EAAuB/F,YAAvB,CAAoC,QAApC,EAA8C8Q,wBAA9C,CAAuE,KAAvE,EAA6E,CAA7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH;AACD,YAAI6W,cAAc,KAAKvgB,aAAL,CAAmBugB,WAArC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,YAAIloB,OAAO,IAAX;;AAGA,YAAImoB,kBAAkB,SAAlBA,eAAkB,GAAY;;AAE9B;AACA,gBAAIC,WAAWpoB,KAAK2H,aAAL,CAAmBugB,WAAnB,CAA+BE,QAA9C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,iBAAK,IAAI9hB,IAAI,CAAb,EAAgBA,IAAIjJ,SAAS8I,YAA7B,EAA2CG,GAA3C,EAAgD;AAC5C,qBAAK,IAAIsT,IAAI,CAAb,EAAgBA,IAAI5Z,KAAK2H,aAAL,CAAmBmI,OAAnB,CAA2BxJ,CAA3B,EAA8B+hB,WAAlD,EAA+DzO,GAA/D,EAAoE;AAChE,wBAAI0O,YAAYtoB,KAAK2H,aAAL,CAAmBmI,OAAnB,CAA2BxJ,CAA3B,EAA8B0M,aAA9B,CAA4C4G,CAA5C,CAAhB;AACA,wBAAI0O,UAAUrV,WAAV,IAAyB5V,SAASwV,SAAT,CAAmBC,QAAhD,EAA0D;AACtD,4BAAImV,WAAWjoB,KAAK2H,aAAL,CAAmBmI,OAAnB,CAA2BwY,UAAUngB,OAArC,CAAf;AACA,4BAAIogB,aAAa,EAAjB;AACAA,mCAAWtV,WAAX,GAAyB5V,SAASwV,SAAT,CAAmB2V,QAA5C;AACAP,iCAASjV,aAAT,CAAuBwI,IAAvB,CAA4B+M,UAA5B;AACH;AACJ;AACJ;;AAED,gBAAIE,cAAc,IAAIvc,KAAJ,EAAlB;;AAEA,gBAAIwc,mBAAmB,IAAIxc,KAAJ,EAAvB;AACA,iBAAK,IAAI5F,IAAI,CAAb,EAAgBA,IAAIjJ,SAAS8I,YAA7B,EAA2CG,GAA3C,EAAgD;AAC5C,oBAAIkE,SAASxK,KAAKoG,cAAL,CAAoBpG,KAAKkI,YAAL,CAAkB5B,CAAlB,CAApB,EAA0C/F,YAA1C,CAAuD,QAAvD,CAAb;AACA,oBAAIooB,OAAOne,OAAOoe,aAAP,EAAX;AACA,oBAAIC,UAAUre,OAAOse,UAAP,EAAd;AACAL,4BAAYjN,IAAZ,CAAiBmN,IAAjB;AACAD,iCAAiBlN,IAAjB,CAAsBqN,OAAtB;AACH;;AAGD,gBAAIE,mBAAmB,SAAnBA,gBAAmB,GAAY;AAC/B/oB,qBAAKgpB,eAAL;AACH,aAFD;AAGA;;AAEA,gBAAGhpB,KAAK4D,gBAAL,EAAH,EAA2B;;AAEvB,oBAAIqlB,eAAe,SAAfA,YAAe,CAASvC,OAAT,EAAkBrkB,IAAlB,EAAuB;AACtClF,4BAAQ,eAAR,EAAyB8K,WAAzB,GAAuC0e,aAAvC;AACA,wBAAGD,OAAH,EAAW;AACP,4BAAIE,aAAaC,KAAKC,KAAL,CAAWzkB,IAAX,CAAjB;AACA,4BAAI6mB,uBAAuBhB,YAAYiB,MAAZ,CAAmBnpB,KAAKuI,WAAxB,CAA3B;AACA,4BAAI/J,qBAAqBwB,KAAKxB,kBAAL,CAAwB+B,YAAxB,CAAqC,oBAArC,CAAzB;AACA,4BAAI6oB,aAAappB,KAAK6X,WAAL,GAAmB7X,KAAK6X,WAAxB,GAAsC7X,KAAK0X,aAAL,CAAmB2R,YAAnB,CAAgCrpB,KAAKuI,WAArC,CAAvD;AACA/J,2CAAmBoE,IAAnB,CAAwB0mB,QAAxB,EAAkClB,QAAlC,EAA4C7G,KAA5C,EAAmDgI,eAAnD,EAAoER,gBAApE,EAAsFK,UAAtF,EAAkGppB,KAAK6I,SAAL,CAAe2gB,QAAf,EAAlG,EAA6HN,oBAA7H,EAAmJtC,WAAW6C,aAA9J;AACAzpB,6BAAKxB,kBAAL,CAAwByH,MAAxB,GAAiC,IAAjC;;AAEA;AACA,4BAAGjG,KAAK6X,WAAR,EAAoB;AAChB,gCAAI6R,oBAAoB1pB,KAAKrB,iBAAL,CAAuB4B,YAAvB,CAAoC,mBAApC,CAAxB;AACAmpB,8CAAkB9mB,IAAlB,CAAuB5C,KAAK6X,WAA5B,EAAyC7X,KAAK6I,SAAL,CAAe2gB,QAAf,EAAzC,EAAoEN,oBAApE;AACAlpB,iCAAKrB,iBAAL,CAAuBsH,MAAvB,GAAgC,IAAhC;AACH;;AAED,4BAAGiiB,YAAYiB,MAAZ,CAAmBnpB,KAAKuI,WAAxB,IAAuC,CAA1C,EAA4C;;AAExC,gCAAIohB,wBAAwB,SAAxBA,qBAAwB,GAAU;AAClC,oCAAI/qB,oBAAqBoB,KAAKpB,iBAAL,CAAuB2B,YAAvB,CAAoC,mBAApC,CAAzB;AACA3B,kDAAkBgE,IAAlB,CAAuB5C,KAAK0X,aAAL,CAAmBkS,SAA1C,EAAqD,CAAC,CAAtD;AACA5pB,qCAAKpB,iBAAL,CAAuBqH,MAAvB,GAAgC,IAAhC;AACH,6BAJD;;AAMAnD,+CAAS+mB,gBAAT,CAA0B7pB,IAA1B,EAAgC2pB,qBAAhC,EAAuD,CAAvD;AACH;AACJ;AACJ,iBA5BD;AA6BAxsB,wBAAQ,gBAAR,EAA0B8K,WAA1B,GAAwC6hB,uBAAxC,CAAgEb,YAAhE;AACH,aAhCD,MAiCI;AACA5hB,wBAAQ3B,GAAR,CAAY,mBAAZ;AACA,oBAAInH,gBAAgByB,KAAKzB,aAAL,CAAmBgC,YAAnB,CAAgC,qBAAhC,CAApB;AACAhC,8BAAcqE,IAAd,CAAmB5C,KAAK2H,aAAL,CAAmBugB,WAAtC,EAAmDloB,KAAK2H,aAAL,CAAmBmI,OAAtE,EAA+E2Y,WAA/E,EAA4FC,gBAA5F,EAA6G1oB,KAAKuI,WAAlH,EAA8HwgB,gBAA9H;AACA/oB,qBAAKzB,aAAL,CAAmB0H,MAAnB,GAA4B,IAA5B;AACH;AACJ,SA3FD;;AA6FA,YAAI8jB,qBAAqB,SAArBA,kBAAqB,GAAU;AAC/B,iBAAK,IAAIzjB,IAAI,CAAb,EAAgBA,IAAIjJ,SAAS8I,YAA7B,EAA2CG,GAA3C,EAAgD;AAC5C,oBAAI0jB,cAAc9B,YAAY+B,aAAZ,CAA0B3jB,CAA1B,CAAlB;AACA,oBAAI4jB,aAAa,CAAjB;AACA,oBAAIC,aAAa,CAAjB;AACA,oBAAIhB,SAAS,CAAb;AACA,qBAAK,IAAIvP,IAAI,CAAb,EAAgBA,IAAIoQ,YAAY1e,MAAhC,EAAwCsO,GAAxC,EAA6C;AACzC,wBAAIwQ,eAAeJ,YAAYpQ,CAAZ,CAAnB;AACA,wBAAIwQ,aAAaC,WAAb,IAA4BhtB,SAASitB,SAAT,CAAmBC,cAAnD,EAAkE;AAC9DL,qCAAa,CAAb;AACAf,iCAASiB,aAAajB,MAAtB;AACA,4BAAIA,UAAS,CAAb,EAAe;AACXe,yCAAa,CAAb;AACA;AACH;AACJ;AACD,wBAAIE,aAAaC,WAAb,IAA4BhtB,SAASitB,SAAT,CAAmBE,cAAnD,EAAkE;AAC9DL,qCAAa,CAAb;AACAhB,iCAASiB,aAAajB,MAAtB;AACA,4BAAIA,UAAS,CAAb,EAAe;AACXgB,yCAAa,CAAb;AACA;AACH;AACJ;AACJ;AACD,oBAAI3f,SAASxK,KAAKoG,cAAL,CAAoBpG,KAAKkI,YAAL,CAAkB5B,IAAE,CAApB,CAApB,EAA4C/F,YAA5C,CAAyD,QAAzD,CAAb;AACA,oBAAI2pB,cAAa,CAAjB,EACI1f,OAAOmK,mBAAP,CAA2B,IAA3B,EAAgC,CAAhC,EADJ,KAEK,IAAIwV,cAAY,CAAhB,EACD3f,OAAOmK,mBAAP,CAA2B,IAA3B,EAAgC,CAAhC;AACJ,oBAAIwU,UAAQ,CAAZ,EACI3e,OAAOsM,iBAAP,CAAyBqS,MAAzB,EAAgCsB,GAAhC,EAAoC,IAApC;AAEP;AACJ,SAlCD;;AAoCA,YAAIC,mBAAmB,SAAnBA,gBAAmB,GAAY;;AAE/B,gBAAIC,YAAY,IAAIze,KAAJ,EAAhB;AACA,iBAAK,IAAI/D,UAAU,CAAnB,EAAsBA,UAAU9K,SAAS8I,YAAzC,EAAuDgC,SAAvD,EAAkE;AAC9D,oBAAIjC,OAAOlG,KAAKkI,YAAL,CAAkBC,OAAlB,CAAX;AACA,oBAAI,CAACwiB,UAAUzkB,IAAV,CAAL,EAAsB;AAClB,wBAAIlG,KAAKoG,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDmP,gBAAjD,EAAJ,EAAyE;AACrE1P,6BAAKoG,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDqqB,WAAjD,CAA6D,KAA7D;AACA,4BAAI1kB,QAAQlG,KAAKkI,YAAL,CAAkBggB,YAAY2C,UAA9B,CAAR,IAAqD3C,YAAY4C,SAAZ,IAAyBztB,SAAS0tB,OAAT,CAAiBC,KAAnG,EAA0G;AACtGhrB,iCAAKoG,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDqqB,WAAjD,CAA6D,IAA7D;AACH;AACD5qB,6BAAKoG,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiD0qB,qBAAjD,CAAuE/C,YAAYgD,WAAZ,CAAwB/iB,OAAxB,IAAmCnI,KAAK+N,UAAL,CAAgBod,KAA1H;AACAnrB,6BAAKoG,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDgQ,QAAjD;AACH;AACDoa,8BAAUzkB,IAAV,IAAkB,IAAlB;AACH;AACJ;;AAED;AACIiiB;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACH,SA3BD;;AA6BArlB,2BAAS+mB,gBAAT,CAA0B,IAA1B,EAAgCE,kBAAhC,EAAoD,GAApD;AACAjnB,2BAAS+mB,gBAAT,CAA0B,IAA1B,EAAgCa,gBAAhC,EAAkD,CAAlD;AAEH,KAjlFI;;AAmlFL;AACA1B,qBAAiB,2BAAY;;AAGzB,YAAIP,cAAc,IAAIvc,KAAJ,EAAlB;;AAEA,YAAIwc,mBAAmB,IAAIxc,KAAJ,EAAvB;AACA,aAAK,IAAI5F,IAAI,CAAb,EAAgBA,IAAIjJ,SAAS8I,YAA7B,EAA2CG,GAA3C,EAAgD;AAC5C,gBAAIkE,SAAS,KAAKpE,cAAL,CAAoB,KAAK8B,YAAL,CAAkB5B,CAAlB,CAApB,EAA0C/F,YAA1C,CAAuD,QAAvD,CAAb;AACA,gBAAIooB,OAAOne,OAAOoe,aAAP,EAAX;AACA,gBAAIC,UAAUre,OAAOse,UAAP,EAAd;AACAL,wBAAYjN,IAAZ,CAAiBmN,IAAjB;AACAD,6BAAiBlN,IAAjB,CAAsBqN,OAAtB;AACH;AACD,YAAIuC,QAAJ;AACA,YAAG,KAAKxnB,gBAAL,EAAH,EAA2B;AACvBwnB,uBAAW,KAAK5sB,kBAAL,CAAwB+B,YAAxB,CAAqC,oBAArC,EAA2D8qB,gBAA3D,EAAX;AACH,SAFD,MAGI;AACAD,uBAAW,KAAK7sB,aAAL,CAAmBgC,YAAnB,CAAgC,eAAhC,EAAiD8qB,gBAAjD,EAAX;AACH;;AAED,YAAIC,eAAe,KAAK7sB,eAAL,CAAqB8B,YAArB,CAAkC,iBAAlC,CAAnB;AACA+qB,qBAAaC,gBAAb,CAA8B,KAAK5jB,aAAL,CAAmBugB,WAAjD,EAA8D,KAAKvgB,aAAL,CAAmBmI,OAAjF,EAA0F2Y,WAA1F,EAAuGC,gBAAvG,EAAyH,KAAKpoB,IAAL,CAAUC,YAAV,CAAuB,eAAvB,EAAwCirB,YAAjK,EACI,KAAKlrB,IAAL,CAAUC,YAAV,CAAuB,eAAvB,EAAwCkrB,WAD5C,EACyD,KAAK1d,UAD9D,EAC0E,KAAKpG,aAAL,CAAmBqH,OAD7F,EACsGoc,QADtG;AAEAE,qBAAaI,MAAb;AACA,aAAKjtB,eAAL,CAAqBwH,MAArB,GAA8B,IAA9B;AACH,KA9mFI;;AAinFL;AACA9C,mBAAe,uBAAUzB,KAAV,EAAiB;AAC5B,YAAIW,OAAOX,MAAMW,IAAjB;AACA,YAAIspB,WAAWtpB,KAAKupB,OAApB;AACA,aAAK/T,WAAL,GAAmB,IAAnB;AACA,aAAK5L,cAAL,GAAsB,KAAKA,cAAL,IAAuB,IAAIC,KAAJ,EAA7C;;AAEA;AACA,aAAK,IAAIhG,OAAO,CAAhB,EAAmBA,QAAQ7I,SAAS8I,YAApC,EAAkDD,MAAlD,EAA0D;AACtD,gBAAI,KAAKE,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDmP,gBAAjD,EAAJ,EAAyE;AACrE,qBAAKtJ,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDsrB,YAAjD;;AAEA,oBAAGF,QAAH,EAAY;AAAI;AACZ,wBAAI,KAAK1f,cAAL,CAAoB/F,IAApB,CAAJ,EAA+B;AAC3B,6BAAKE,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDyL,UAAjD,CAA4D,IAA5D;AACH,qBAFD,MAGK;AACD,4BAAG9F,QAAQ,CAAX,EAAa;AACT,iCAAKE,cAAL,CAAoBF,IAApB,EAA0B3F,YAA1B,CAAuC,QAAvC,EAAiDurB,cAAjD;AACH;AACJ;AACJ;AACJ;AACJ;;AAED,aAAKvtB,aAAL,CAAmBgC,YAAnB,CAAgC,eAAhC,EAAiDwrB,aAAjD;AACA,aAAKvtB,kBAAL,CAAwB+B,YAAxB,CAAqC,oBAArC,EAA2DwrB,aAA3D;AACA,aAAKttB,eAAL,CAAqB8B,YAArB,CAAkC,iBAAlC,EAAqDyrB,cAArD;;AAEA,aAAKztB,aAAL,CAAmB0H,MAAnB,GAA4B,KAA5B;AACA,aAAKzH,kBAAL,CAAwByH,MAAxB,GAAiC,KAAjC;AACA,aAAKxH,eAAL,CAAqBwH,MAArB,GAA8B,KAA9B;;AAEA,YAAIgmB,QAAQ,KAAKpjB,SAAL,CAAegC,OAAf,EAAZ;AACA,YAAIqhB,eAAe,KAAKroB,UAAL,GAAkBqF,kBAAlB,EAAnB;AACA,YAAGyiB,QAAH,EAAY;AACR,gBAAKO,gBAAgBD,SAASC,aAAaC,SAAvC,IAAqD,KAAKvoB,gBAAL,EAAzD,EAAkF;AAC9ErG,wBAAQ6uB,kBAAR;AACA,qBAAKhmB,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,QAApC,EAA8CyrB,cAA9C;AACH,aAHD,MAIK;AACD,qBAAKK,qBAAL;;AAEA,oBAAIrsB,OAAO,IAAX;;AAEA,qBAAKM,IAAL,CAAUC,YAAV,CAAuB,iBAAvB,EAA0C8L,kBAA1C,CAA6D,IAA7D;AACA,qBAAKjG,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,QAApC,EAA8CurB,cAA9C;;AAEA,oBAAIQ,uBAAuB,SAAvBA,oBAAuB,GAAU;AACjC,wBAAGJ,gBAAgBD,QAAQC,aAAaC,SAAxC,EAAkD;AAC9CnsB,6BAAKqsB,qBAAL;AACH,qBAFD,MAGI;AACArsB,6BAAKoG,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,QAApC,EAA8CyrB,cAA9C;AACAhsB,6BAAKoG,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,QAApC,EAA8C4L,cAA9C;AACH;AACJ,iBARD;;AAUA,qBAAK7L,IAAL,CAAUC,YAAV,CAAuB,iBAAvB,EAA0CgsB,wBAA1C,CAAmED,oBAAnE;AACH;AACJ,SAzBD,MA0BI;;AAEA,iBAAKlmB,cAAL,CAAoB,CAApB,EAAuB7F,YAAvB,CAAoC,QAApC,EAA8CyL,UAA9C,CAAyD,KAAzD;AACA,gBAAII,kBAAkB,KAAK9L,IAAL,CAAUC,YAAV,CAAuB,iBAAvB,CAAtB;AACA6L,4BAAgBC,kBAAhB,CAAmC,IAAnC;AACH;AAEJ,KArrFI;;AAurFLmgB,mBAAc,yBAAU;AACpB,aAAKttB,SAAL,CAAe+G,MAAf,GAAwB,IAAxB;AACA,aAAK/G,SAAL,CAAeqB,YAAf,CAA4B,WAA5B,EAAyCksB,YAAzC;AACH,KA1rFI;;AA6rFL;AACAJ,2BAAuB,iCAAY;;AAE/B,YAAIrsB,OAAO,IAAX;AACA,YAAI0sB,YAAY,SAAZA,SAAY,CAAUC,UAAV,EAAsB;;AAElC;AACA,gBAAIA,UAAJ,EAAgB;AACZ3sB,qBAAK4sB,kBAAL;AACH,aAFD,MAGK;AACD,oBAAIC,qBAAqBnvB,GAAGovB,WAAH,CAAe9sB,KAAKhB,gBAApB,CAAzB;AACA,oBAAIqD,OAAO,EAAX;AACAA,qBAAK0qB,SAAL,GAAiB,+CAAjB;AACA1qB,qBAAK2qB,GAAL,GAAW,uBAAX;AACA3qB,qBAAK4qB,QAAL,GAAgB,mCAAhB;AACA5qB,qBAAK6qB,WAAL,GAAmB,yCAAnB;AACA7qB,qBAAK8qB,WAAL,GAAmB,YAAY;AAC3BN,uCAAmBtsB,YAAnB,CAAgC,iBAAhC,EAAmD6sB,aAAnD;AACAptB,yBAAKwsB,aAAL;AACH,iBAHD;AAIAK,mCAAmBtsB,YAAnB,CAAgC,iBAAhC,EAAmD8sB,QAAnD,CAA4DhrB,IAA5D;AACAwqB,mCAAmBS,WAAnB,CAA+B5vB,GAAGmnB,CAAH,CAAK,CAAL,EAAQ,CAAR,CAA/B;AACA7kB,qBAAKM,IAAL,CAAU+jB,QAAV,CAAmBwI,kBAAnB;AACH;AACJ,SArBD;;AAuBA,aAAKU,qBAAL,CAA2Bb,SAA3B;AACH,KAztFI;;AA2tFL;AACAE,wBAAoB,8BAAY;AAC5B,YAAI5sB,OAAO,IAAX;AACA,YAAIwtB,kBAAkB9vB,GAAGovB,WAAH,CAAe,KAAK9tB,gBAApB,CAAtB;AACA,YAAIqD,OAAO,EAAX;AACAA,aAAK0qB,SAAL,GAAiB,6CAAjB;AACA1qB,aAAK2qB,GAAL,GAAW,kCAAkC,KAAKS,mBAAvC,GAA6D,KAAxE;AACAprB,aAAK4qB,QAAL,GAAgB,mCAAhB;AACA5qB,aAAKqrB,aAAL,GAAqB,MAAM,KAAKD,mBAAhC;AACAprB,aAAKsrB,WAAL,GAAmB,wCAAnB;AACAtrB,aAAKurB,UAAL,GAAkB,oCAAoC,KAAKH,mBAAzC,GAA8D,KAAhF;AACAprB,aAAKwrB,WAAL,GAAmB,YAAY;AAC3BL,4BAAgBjtB,YAAhB,CAA6B,iBAA7B,EAAgD6sB,aAAhD;AACAptB,iBAAKwsB,aAAL;AACH,SAHD;AAIAnqB,aAAKyrB,WAAL,GAAmB,2CAAnB;AACAzrB,aAAK0rB,WAAL,GAAmB,YAAY;AAC3BP,4BAAgBjtB,YAAhB,CAA6B,iBAA7B,EAAgD6sB,aAAhD;;AAEA,gBAAI1vB,GAAGwC,GAAH,CAAO8tB,WAAP,IAAsB,YAAtB,IAAsC,gBAAgBtwB,GAAGwC,GAAH,CAAO8tB,WAAjE,EAA8E;;AAE1E;AACAvG,mBAAGwG,eAAH,CAAmB;;AAEfC,2BAAO,0BAFQ;AAGfC,8BAAU1wB,cAAc2wB,cAHT;AAIf1H,2BAJe,mBAIP2H,GAJO,EAIF;AACThnB,gCAAQ3B,GAAR,CAAY,SAAZ;AACA1F,6BAAKsuB,aAAL;AACH,qBAPc;AAQfC,wBARe,gBAQVF,GARU,EAQL;AACNhnB,gCAAQ3B,GAAR,CAAY,SAAZ;AACH;AAVc,iBAAnB;AAYH;AAEJ,SApBD;AAqBArD,aAAKmsB,UAAL,GAAkB,OAAlB;AACAnsB,aAAKosB,UAAL,GAAkB,MAAM,KAAKC,eAAL,GAAuB,KAAKC,aAAlC,CAAlB;AACAtsB,aAAKusB,UAAL,GAAkB,MAAM,KAAKF,eAA7B;;AAEAlB,wBAAgBjtB,YAAhB,CAA6B,iBAA7B,EAAgD8sB,QAAhD,CAAyDhrB,IAAzD;AACAmrB,wBAAgBF,WAAhB,CAA4B5vB,GAAGmnB,CAAH,CAAK,CAAL,EAAQ,CAAR,CAA5B;AACA,aAAKvkB,IAAL,CAAU+jB,QAAV,CAAmBmJ,eAAnB;AACH,KAvwFI;;AA2wFL;AACAD,2BAAuB,+BAAUtU,KAAV,EAAiB;AACpC,YAAIjZ,OAAO,IAAX;AACA,YAAIymB,eAAe,SAAfA,YAAe,CAAUC,OAAV,EAAmBrkB,IAAnB,EAAyB;AACxClF,oBAAQ,eAAR,EAAyB8K,WAAzB,GAAuC0e,aAAvC;AACA,gBAAID,OAAJ,EAAa;AACT,oBAAIE,aAAaC,KAAKC,KAAL,CAAWzkB,IAAX,CAAjB;AACArC,qBAAK0uB,eAAL,GAAuB9H,WAAWiI,eAAlC;AACA7uB,qBAAKytB,mBAAL,GAA2B7G,WAAWkI,WAAtC;AACA9uB,qBAAK2uB,aAAL,GAAqB/H,WAAWmI,aAAhC;AACA9V,sBAAMjZ,KAAK2uB,aAAL,GAAqB3uB,KAAK0uB,eAAhC;AACH;AACJ,SATD;AAUAvxB,gBAAQ,gBAAR,EAA0B8K,WAA1B,GAAwC+mB,eAAxC,CAAwDvI,YAAxD;AACH,KAzxFI;;AA2xFL;AACA6H,mBAAc,yBAAU;AACpB,YAAItuB,OAAO,IAAX;AACA,YAAIymB,eAAe,SAAfA,YAAe,CAASC,OAAT,EAAiBrkB,IAAjB,EAAsB;AACrClF,oBAAQ,eAAR,EAAyB8K,WAAzB,GAAuC0e,aAAvC;AACA,gBAAID,OAAJ,EAAa;AACT,oBAAIE,aAAaC,KAAKC,KAAL,CAAWzkB,IAAX,CAAjB;AACA,oBAAI4sB,UAAUrI,WAAWsI,OAAzB,CAFS,CAE0B;;AAEnC,oBAAID,WAAW,CAAf,EAAiB;AACbzxB,8BAAUwK,SAAV,CAAoB,MAApB;AACH,iBAFD,MAGK,IAAIinB,WAAW,CAAf,EAAiB;AAClB;AACA;AACA;AACA;AACAjvB,yBAAK6D,UAAL,GAAkB+G,WAAlB;AACH,iBANI,MAOA,IAAIqkB,WAAW,EAAf,EAAkB;AACnBzxB,8BAAUwK,SAAV,CAAoB,MAApB;AACH,iBAFI,MAGA,IAAIinB,WAAW,EAAf,EAAkB;AACnBzxB,8BAAUwK,SAAV,CAAoB,WAApB;AACH;AACJ;AACJ,SAvBD;AAwBA7K,gBAAQ,gBAAR,EAA0B8K,WAA1B,GAAwCknB,iBAAxC,CAA0D1I,YAA1D;AACH,KAvzFI;;AAyzFL;AACA1Z,YAAQ,gBAAUC,EAAV,EAAc,CAErB;AA5zFI,CAAT","file":"DeskScene.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\game\\desk","sourcesContent":["import { ByteArray } from \"../../common/ByteArray\"\r\nimport { TSCommon } from \"../../TSCommon\"\r\nimport { gamelibcommon } from \"../../gamelib/gamelibcommon\";\r\nimport { WeixinManager } from \"../../weixin/WeixinManager\";\r\nvar GameCfg = require(\"GameCfg\");\r\nvar GameLibSink = require(\"GameLibSink\");\r\nvar GameDefs = require(\"GameDefs\");\r\nvar Tools = require(\"Tools\");\r\nvar sendCMD = require(\"sendCMD\");\r\nvar Resources = require(\"Resources\");\r\nvar HallResources = require(\"HallResources\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        bg: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        myself: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        right: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        top: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        left: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        //游戏结束层\r\n        gameOverLayer: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        //段位赛结束层\r\n        matchGameOverLayer:{\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        //游戏结算层\r\n        gameResultLayer: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        //更多选项层\r\n        moreSettingLayer: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        //匹配赛段位晋升界面\r\n        levelUpgradeLayer:{\r\n            default: null,\r\n            type: cc.Node, \r\n        },\r\n\r\n        protectScoreLayer:{\r\n            default: null,\r\n            type: cc.Node, \r\n        },\r\n\r\n        //听牌层\r\n        listenCardLayer: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        directAtlas: {\r\n            default: null,\r\n            type: cc.SpriteAtlas,\r\n        },\r\n\r\n        //公共提示预置体\r\n        commonTipsPrefab: {\r\n            default: null,\r\n            type: cc.Prefab,\r\n        },\r\n\r\n        //商城界面\r\n        mallLayer: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        //聊天图集\r\n        chatAtlas: {\r\n            default: null,\r\n            type: cc.SpriteAtlas,\r\n        },\r\n\r\n        bgMusic: {\r\n            default: null,\r\n            url: cc.AudioClip,\r\n        },\r\n\r\n        //选牌提示界面\r\n        xuanPaiTipsLayer:{\r\n            default: null,\r\n            type: cc.Node, \r\n        },\r\n\r\n        //换牌提示界面\r\n        huanPaiTipsLayer:{\r\n            default: null,\r\n            type: cc.Node, \r\n        },\r\n\r\n        //缺一门提示界面\r\n        queYiMenTipsLayer:{\r\n            default: null,\r\n            type: cc.Node, \r\n        },\r\n\r\n        //缺一门按钮界面\r\n        queYiMenButtonLayer:{\r\n            default: null,\r\n            type: cc.Node, \r\n        },\r\n\r\n        xuanPaiTipsTimes:{\r\n            default: null,\r\n            type: cc.Label, \r\n        },\r\n\r\n        GAMETIMER_COUNT: 10,\r\n        XUANPAI_COUNT: 8,\r\n    },\r\n\r\n    onLoad: function () {\r\n\r\n        var self = this;\r\n\r\n        if (require(\"HallUtils\").isIPhoneX()) {\r\n            if (!cc.sys.isNative && cc.sys.isMobile) {\r\n                var canvasFit = this.node.getComponent(cc.Canvas);\r\n                canvasFit.fitHeight = true;\r\n                canvasFit.fitWidth = false;\r\n            }\r\n\r\n            this.loadIphoneXBgRes();\r\n        }\r\n        else{\r\n            this.loadNomalBgRes();\r\n        }\r\n\r\n        cc.loader.loadRes(\"animation/frameAction/mj_action\", function (err, clip) {\r\n            if (!err) {\r\n                self.mj_actionClip = clip;\r\n            }\r\n        })\r\n\r\n        cc.loader.loadRes(\"animation/frameAction/me_action\", function (err, clip) {\r\n            if (!err) {\r\n                self.me_actionClip = clip;\r\n            }\r\n        })\r\n\r\n        cc.loader.loadRes(\"animation/frameAction/left_action\", function (err, clip) {\r\n            if (!err) {\r\n                self.left_actionClip = clip;\r\n            }\r\n        })\r\n\r\n        cc.loader.loadRes(\"animation/frameAction/right_action\", function (err, clip) {\r\n            if (!err) {\r\n                self.right_actionClip = clip;\r\n            }\r\n        })\r\n\r\n        cc.loader.loadRes(\"animation/frameAction/top_action\", function (err, clip) {\r\n            if (!err) {\r\n                self.top_actionClip = clip;\r\n            }\r\n        })\r\n\r\n        cc.loader.loadResDir(\"animation/dragonBones/texiao_hupai\", function (err, assets) {\r\n            self.hupaiAssets = assets;\r\n        })\r\n\r\n        this.node.on(\"onUserEnterTable\", (event) => {\r\n            this.onUserEnterTable(event.detail.chair, event.detail.wUserID, event.detail.isPlayer);\r\n        });\r\n\r\n        this.node.on(\"onUserExitTable\", (event) => {\r\n            this.onUserExitTable(event.detail.chair, event.detail.wUserID, event.detail.isPlayer)\r\n        });\r\n\r\n        this.node.on(\"onPlayerStateChanged\", (event) => {\r\n            this.onPlayerStateChanged(event.detail.chair, event.detail.nOldState, event.detail.nNewState)\r\n        });\r\n\r\n        this.node.on(\"onSceneChanged\", (event) => {\r\n            this.onSceneChanged(event.detail.data);\r\n        }, this);\r\n\r\n        this.node.on(\"onGameMessage\", (event) => {\r\n            this.onGameMessage(event.detail.chair, event.detail.cCmdID, event.detail.data);\r\n        }, this);\r\n\r\n        this.node.on(\"onRecvTableChat\", (event) => {\r\n            this.onRecvTableChat(event.detail.chatMsg);\r\n        })\r\n\r\n        this.node.on(\"updateUserInfo\", (event) => {\r\n            this.updateUserInfo(event.detail.user);\r\n        })\r\n\r\n        this.init();\r\n\r\n        this.initUI();\r\n\r\n        TSCommon.addEvent(GameCfg.changeDeskBg, this.onChangeDeskBg, this);\r\n\r\n        TSCommon.addEvent(GameCfg.GAME_RESTART, this.onGameReStart, this);\r\n\r\n        TSCommon.addEvent(GameCfg.NOTIFICATION_LISTENCARD, this.judgeIsTingCard, this);\r\n\r\n        TSCommon.addEvent(GameCfg.openBgMusic, this.onPlayBgMusic, this);\r\n\r\n        TSCommon.addEvent(GameCfg.closeBgMusic, this.onCloseBgMusic, this)\r\n\r\n\r\n        TSCommon.addEvent(GameCfg.NOTIFICATION_ROBOT, this.onRobot, this)\r\n\r\n        if(this.getIsPrivateRoom()){\r\n            this.getGameLib().sitTable(this.getGameLibSink().s_nPrivateRoomTableNo,this.getGameLibSink().s_nPrivateRoomChairNo)\r\n        }\r\n        else{\r\n            this.getGameLib().autoSit();\r\n        }\r\n\r\n        \r\n        //设定游戏icon\r\n        if(this.IsCXZ()){\r\n            cc.loader.loadRes(\"texture/game/cxz_title\", cc.SpriteFrame, function (err, spriteFrame) {\r\n                \r\n                if (!err) {\r\n                    self.node.getChildByName(\"game_icon\").getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n                }\r\n            })\r\n        }\r\n\r\n        //播放背景音乐\r\n        var bgMusicOpen = parseInt(cc.sys.localStorage.getItem(\"bgMusic\") || 0);\r\n        if (bgMusicOpen) {\r\n            this.onPlayBgMusic();\r\n        }\r\n\r\n\r\n        //由于段位赛结算界面点击准备需要跳转到大厅打开匹配\r\n        G.matchGameReady = false; \r\n        // G.goldGameReady = null;\r\n\r\n        if(this.getIsPrivateRoom()){\r\n            this.moreSettingLayer.getComponent(\"MoreSettingLayer\").setChangedDeskBtnEnabled(false);\r\n        }\r\n    },\r\n\r\n\r\n    onDestroy: function () {\r\n\r\n        var scheduler = cc.director.getScheduler();\r\n\r\n        scheduler.unscheduleCallbackForTarget(this, this._signalUpdate);\r\n\r\n        scheduler.unscheduleCallbackForTarget(this, this._timerUpdate);\r\n\r\n        TSCommon.removeEvent(GameCfg.GAME_RESTART, this.onGameReStart, this);\r\n\r\n        TSCommon.removeEvent(GameCfg.changeDeskBg, this.onChangeDeskBg, this);\r\n\r\n        TSCommon.removeEvent(GameCfg.NOTIFICATION_LISTENCARD, this.judgeIsTingCard, this);\r\n\r\n        TSCommon.removeEvent(GameCfg.NOTIFICATION_ROBOT, this.onRobot, this)\r\n\r\n        this.onCloseBgMusic();\r\n\r\n        this.m_stSaveSceneData = null;\r\n\r\n        this.getGameLibSink()._clientFrameSink.m_dataEventHandler = null;\r\n        cc.log(\"exit scene\");\r\n    },\r\n\r\n\r\n    loadNomalBgRes:function(){\r\n        var self = this;\r\n        var index = cc.sys.localStorage.getItem(\"deskBg\") || 0;\r\n        cc.loader.loadRes(\"texture/game/background1\", cc.SpriteFrame, function (err, spriteFrame) {\r\n            if (!err) {\r\n                self.m_bg1Frame = spriteFrame;\r\n\r\n                self.onChangeDeskBg(null, index);\r\n            }\r\n        })\r\n\r\n        cc.loader.loadRes(\"texture/game/background2\", cc.SpriteFrame, function (err, spriteFrame) {\r\n            if (!err) {\r\n                self.m_bg2Frame = spriteFrame;\r\n                self.onChangeDeskBg(null, index);\r\n            }\r\n        })\r\n\r\n        cc.loader.loadRes(\"texture/game/background3\", cc.SpriteFrame, function (err, spriteFrame) {\r\n            if (!err) {\r\n                self.m_bg3Frame = spriteFrame;\r\n                self.onChangeDeskBg(null, index);\r\n            }\r\n        })\r\n    },\r\n\r\n    loadIphoneXBgRes:function(){\r\n        var self = this;\r\n        var index = cc.sys.localStorage.getItem(\"deskBg\") || 0;\r\n        cc.loader.loadRes(\"texture/game/background1_x\", cc.SpriteFrame, function (err, spriteFrame) {\r\n            if (!err) {\r\n                self.m_bg1Frame = spriteFrame;\r\n\r\n                self.onChangeDeskBg(null, index);\r\n            }\r\n        })\r\n\r\n        cc.loader.loadRes(\"texture/game/background2_x\", cc.SpriteFrame, function (err, spriteFrame) {\r\n            if (!err) {\r\n                self.m_bg2Frame = spriteFrame;\r\n                self.onChangeDeskBg(null, index);\r\n            }\r\n        })\r\n\r\n        cc.loader.loadRes(\"texture/game/background3\", cc.SpriteFrame, function (err, spriteFrame) {\r\n            if (!err) {\r\n                self.m_bg3Frame = spriteFrame;\r\n                self.onChangeDeskBg(null, index);\r\n            }\r\n        })\r\n    },\r\n\r\n\r\n    init: function () {\r\n        this.getGameLibSink()._clientFrameSink.m_dataEventHandler = this.node;\r\n        this.m_bIsOffLine = false;\r\n    },\r\n\r\n\r\n    //初始化UI信息\r\n    initUI: function () {\r\n        \r\n        var gameInfoNode = this.node.getChildByName(\"game_base_info\");\r\n\r\n        if(this.getIsPrivateRoom()){\r\n            gameInfoNode.getChildByName(\"gold_game_info\").active = false;\r\n            gameInfoNode.getChildByName(\"match_game_info\").active = true;\r\n        }\r\n        else{\r\n            gameInfoNode.getChildByName(\"gold_game_info\").active = true;\r\n            gameInfoNode.getChildByName(\"match_game_info\").active = false;\r\n        }\r\n\r\n        //将玩家手上的牌都设置为不可见\r\n        for (var nPos = 1; nPos <= GameDefs.PLAYER_COUNT; nPos++) {\r\n            var node = this.getPlayerByPos(nPos);\r\n            var holdCardsNode = node.getChildByName(\"holds\");\r\n            for (var i = 0; i < holdCardsNode.childrenCount; i++) {\r\n                var cardNode = holdCardsNode.children[i];\r\n                cardNode.active = false;\r\n            }\r\n\r\n            var outCardsNode = node.getChildByName(\"outcards\");\r\n            for (var i = 0; i < outCardsNode.childrenCount; i++) {\r\n                outCardsNode.children[i].active = false;\r\n            }\r\n\r\n            var outLaiziGangNode = node.getChildByName(\"zhonglaigang\");\r\n            for (var i = 0; i < outLaiziGangNode.childrenCount; i++) {\r\n                outLaiziGangNode.children[i].active = false;\r\n            }\r\n\r\n            var penggangNodes = node.getChildByName(\"penggangs\");\r\n            for (var i = 0; i < penggangNodes.childrenCount; i++) {\r\n                penggangNodes.children[i].active = false;\r\n            }\r\n\r\n            var Player = node.getComponent(\"Player\");\r\n            Player.stopWinAction();\r\n        }\r\n\r\n        var arrow = this.node.getChildByName(\"arrow\");\r\n        var diceBg = arrow.getChildByName(\"dice_bg\");\r\n        var timeLabel = arrow.getChildByName(\"timeLabel\");\r\n        diceBg.active = false;\r\n        timeLabel.active = false;\r\n\r\n        var laiziNode = this.node.getChildByName(\"laizi\");\r\n        laiziNode.active = false;\r\n\r\n\r\n        this.listenCardLayer.active = false;\r\n        this.gameOverLayer.active = false;\r\n\r\n        this.matchGameOverLayer.active = false;\r\n        this.gameResultLayer.active = false;\r\n\r\n        this.levelUpgradeLayer.active = false;\r\n\r\n        this.protectScoreLayer.active = false;\r\n\r\n        this.mallLayer.active = false;\r\n\r\n        this.showSignalUI();\r\n    },\r\n\r\n    onChangeDeskBg: function (event, setIndex) {\r\n\r\n        var index = 0;\r\n\r\n        if (!event) {\r\n            index = setIndex;\r\n        } else {\r\n            index = event.data;\r\n        }\r\n\r\n        var spriteFrame;\r\n\r\n        // cc.log(\"index ===========\", index);\r\n\r\n        if (index == 0) {\r\n            spriteFrame = this.m_bg1Frame\r\n        }\r\n        else if (index == 1) {\r\n            spriteFrame = this.m_bg2Frame\r\n        }\r\n        else if (index == 2) {\r\n            spriteFrame = this.m_bg3Frame\r\n        }\r\n        else {\r\n            console.log(\"not extra\");\r\n        }\r\n\r\n        if (!spriteFrame) {\r\n            return;\r\n        }\r\n        this.bg.getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n    },\r\n\r\n    onPlayBgMusic: function () {\r\n        if (this.bgMusic) {\r\n            this.m_bgMusicAudioID = cc.audioEngine.play(this.bgMusic, true);\r\n        }\r\n    },\r\n\r\n    onCloseBgMusic: function () {\r\n        if (this.m_bgMusicAudioID != undefined) {\r\n            cc.audioEngine.stop(this.m_bgMusicAudioID)\r\n        }\r\n    },\r\n\r\n    onRobot:function(){\r\n        if( this.m_stSceneData && this.m_stSceneData.cbPhase != GameDefs.GamePhase.PhaseEnd)\r\n        {\r\n            sendCMD.sendCMD_PO_ROBOTPLAYSTART()\r\n        }\r\n        else{\r\n            Resources.ShowToast(\"游戏还没有开始不能托管\");\r\n        }\r\n    \r\n    },\r\n\r\n    getGameLibSink: function () {\r\n        return require('GameLibSink').getInstance();\r\n    },\r\n\r\n    getGameLib: function () {\r\n        return require('GameLibSink').getInstance().getGameLib();\r\n    },\r\n\r\n    PosFromChair: function (cbChair) {\r\n        var gamelib = this.getGameLib();\r\n        var nPos = gamelib.getRelativePos(cbChair) + 1;\r\n        // cc.log(\"PosFromChair -------------- nPos === \" + nPos);\r\n\r\n        if(this.getGameLibSink().m_chairCount == 4){\r\n  \r\n            if(this.m_cbMyChair == 0 && this.IsCXZ() && nPos == 3){\r\n                nPos = 4;\r\n            }\r\n            else if(this.m_cbMyChair == 2 && this.IsCXZ() && nPos == 3){\r\n                nPos = 2;\r\n            }\r\n        }\r\n        else if(this.getGameLibSink().m_chairCount == 3){\r\n            if(nPos == 3){\r\n                nPos = 4;\r\n            }\r\n        }\r\n\r\n        return nPos;\r\n    },\r\n\r\n    ChairFromPos: function (nPos) {\r\n        if (this.IsCXZ() && nPos >= 4) {\r\n            nPos = 3;\r\n        }\r\n        var gamelib = this.getGameLib();\r\n        return gamelib.getRealChair(nPos)\r\n    },\r\n\r\n    getIsPrivateRoom: function () {\r\n        // return false;\r\n        return this.getGameLib().isInPrivateRoom();\r\n    },\r\n\r\n    sit: function () {\r\n        this.getGameLib().autoSit();\r\n    },\r\n\r\n    getPlayerByPos: function (nPos) {\r\n        if (nPos == 1) {\r\n            return this.myself;\r\n        }\r\n        else if (nPos == 2) {\r\n            return this.right;\r\n        }\r\n        else if (nPos == 3) {\r\n            return this.top;\r\n        }\r\n        else if (nPos == 4) {\r\n            return this.left;\r\n        }\r\n    },\r\n\r\n    //获取自身的信息\r\n    GetMyInfo: function () {\r\n        var gamelib = this.getGameLib();\r\n        this.m_pMyself = gamelib.getMyself();\r\n        if (this.m_pMyself != null) {\r\n            this.m_cbMyChair = this.m_pMyself.getUserChair();\r\n\r\n            //刷新相应的金币\r\n        }\r\n        else {\r\n\r\n        }\r\n    },\r\n\r\n    //表示是否是戳虾子游戏\r\n    IsCXZ: function () {\r\n\r\n        var ret = false;\r\n        var curRoom = this.getGameLib().getCurrentGameRoom();\r\n\r\n        if(curRoom){\r\n            if (curRoom.szGameRoomName && curRoom.szGameRoomName.indexOf(\"三人场\") >= 0) {\r\n                ret = true;\r\n            }\r\n        }\r\n        else{\r\n            //表示通过好友场\r\n            if( this.getGameLibSink().m_nChairCount == 3){\r\n                ret = true;\r\n            }\r\n        }\r\n\r\n        return ret;\r\n    },\r\n\r\n    //获取自己的状态\r\n    MyState: function () {\r\n        if (!this.m_pMyself) {\r\n            return gamelibcommon.USER_NO_STATUS;\r\n        }\r\n\r\n        return this.m_pMyself.getUserStatus();\r\n    },\r\n\r\n    getTotalMjCount: function () {\r\n        var total = GameDefs.MAJIANG_COUNT;\r\n        if (this.IsCXZ()) {\r\n            total = 72;       //去掉万字\r\n        }\r\n        else {\r\n            total = 108;\r\n        }\r\n\r\n        return total;\r\n    },\r\n\r\n    //获取剩余麻将数量\r\n    getRestMjCount: function () {\r\n        if (!this.m_stSceneData || !this.m_stSceneData.cbPhase)\r\n            return 0;\r\n\r\n        return this.getTotalMjCount() - (this.m_stSceneData.cbCurrentIndex + this.m_stSceneData.cbLastIndex);\r\n    },\r\n\r\n    onUserEnterTable: function (nChair, wUserID, bIsPlayer) {\r\n        // cc.log(\"----- DeskScene onUserEnterTable ------\");\r\n        if (bIsPlayer == false) {\r\n            cc.log(\"bIsPlayer == false return\");\r\n            return;\r\n        }\r\n\r\n        this.GetMyInfo();\r\n\r\n        var userInfo = this.getGameLib().getUser(wUserID);\r\n        if (userInfo == null) {\r\n            cc.log(\"userInfo is null\");\r\n            return;\r\n        }\r\n\r\n        Resources.playCommonEffect(\"enter.mp3\");\r\n\r\n        this.initAddDirection(this.PosFromChair(0) - 1)\r\n\r\n        if (nChair == this.m_cbMyChair) {\r\n            if (this.MyState() == gamelibcommon.USER_PLAY_GAME || this.MyState() == gamelibcommon.USER_OFF_LINE) {\r\n                this.m_bIsOffLine = true;\r\n            }\r\n        }\r\n\r\n        \r\n        var nPos = this.PosFromChair(nChair);\r\n        var node = this.getPlayerByPos(nPos);\r\n        var player = node.getComponent('Player');\r\n\r\n        player.Come(nPos, userInfo);\r\n    },\r\n\r\n\r\n    onUserExitTable: function (nChair, wUserID, bIsPlayer) {\r\n        if (bIsPlayer == false) {\r\n            return;\r\n        }\r\n\r\n        var nPos = this.PosFromChair(nChair);\r\n        var node = this.getPlayerByPos(nPos);\r\n        var player = node.getComponent('Player');\r\n        player.Leave(nPos);\r\n\r\n        Resources.playCommonEffect(\"exit.mp3\");\r\n\r\n        //表示如果是自己离开了\r\n        if (nChair == this.m_cbMyChair) {\r\n\r\n        }\r\n        else {\r\n\r\n            //其他人离开了\r\n        }\r\n    },\r\n\r\n\r\n    updateUserInfo: function (user) {\r\n        if (user) {\r\n            this.m_pMyself = this.getGameLib().getMyself();\r\n            if (this.m_pMyself && user.getUserDBID() == this.m_pMyself.getUserDBID()) {\r\n                this.getPlayerByPos(1).getComponent(\"Player\").refreshGold(user.getGold());\r\n                return;\r\n            }\r\n\r\n            var cbChair = user.getUserChair();\r\n            if (GameCfg.Pub_IsValidChair(cbChair)) {\r\n                this.getPlayerByPos(this.PosFromChair(cbChair)).getComponent(\"Player\").refreshGold(user.getGold());\r\n            }\r\n        }\r\n    },\r\n\r\n    //判定游戏是否正在进行中  游戏结束和游戏开始时都会返回false\r\n    getIsGameRunning: function () {\r\n        if (this.m_stSceneData) {\r\n            return this.m_stSceneData.cbPhase > GameDefs.GamePhase.PhasePlayDingque && this.m_stSceneData.cbPhase < GameDefs.GamePhase.PhaseEnd;\r\n        }\r\n\r\n        return false;\r\n    },\r\n\r\n    //判定游戏是否是换牌状态\r\n    getIsGameChangeMjing: function () {\r\n        if (this.m_stSceneData) {\r\n            return this.m_stSceneData.cbPhase == GameDefs.GamePhase.PhaseExchange;\r\n        }\r\n\r\n        return false;\r\n    },\r\n\r\n    initAddDirection: function (nMyChair) {\r\n        var directTable = [\r\n            [\r\n                [\"dong_down\"], [\"nan_right\"], [\"xi_top\"], [\"bei_left\"]\r\n            ],\r\n            [\r\n                [\"bei_down\"], [\"dong_right\"], [\"nan_top\"], [\"xi_left\"]\r\n            ],\r\n            [\r\n                [\"xi_down\"], [\"bei_right\"], [\"dong_top\"], [\"nan_left\"]\r\n            ],\r\n            [\r\n                [\"nan_down\"], [\"xi_right\"], [\"bei_top\"], [\"dong_left\"]\r\n            ]\r\n        ];\r\n\r\n        this.directTable = directTable;\r\n\r\n        var nListSize = directTable[nMyChair].length;\r\n\r\n        var arrowNode = this.node.getChildByName(\"arrow\");\r\n\r\n        var directNode = arrowNode.getChildByName(\"direction\");\r\n\r\n        for (var i = 0; i < nListSize; i++) {\r\n            var OneTable = directTable[nMyChair][i];\r\n            var strBgImgName = OneTable[0] + \"_bg\";\r\n            var strForeImgName = OneTable[0];\r\n\r\n            var bgFrame = this.directAtlas.getSpriteFrame(strBgImgName);\r\n\r\n            var foreImgFrame = this.directAtlas.getSpriteFrame(strForeImgName);\r\n\r\n            directNode.children[i].active = true;\r\n            directNode.children[i].getComponent(cc.Sprite).spriteFrame = bgFrame;\r\n            directNode.children[i + 4].getComponent(cc.Sprite).spriteFrame = foreImgFrame;\r\n        }\r\n    },\r\n\r\n    //玩家状态发生改变\r\n    onPlayerStateChanged: function (nChair, nOldState, nNewState) {\r\n        cc.log(\"当前玩家椅子号为：\" + nChair + \"  新的状态为：\" + nNewState + \"  之前的状态为：\" + nOldState);\r\n        this.GetMyInfo();\r\n\r\n        if (nChair >= GameDefs.PLAYER_COUNT)\r\n            return;\r\n\r\n\r\n        //如果是处于准备状态\r\n        if (nNewState == gamelibcommon.USER_READY_STATUS) {\r\n            if (!this.m_stSaveSceneData) {\r\n                this.getPlayerByPos(this.PosFromChair(nChair)).getComponent('Player').setIsReady(true);\r\n            }\r\n            else {\r\n                this.m_playerStatus = this.m_playerStatus || new Array();\r\n                var nPos = this.PosFromChair(nChair);\r\n                this.m_playerStatus[nPos] = true;\r\n\r\n                //判定如果之前定时器已经显示  则隐藏  如果之前定时器没有显示 则直接\r\n                if (this.MyState() == gamelibcommon.USER_READY_STATUS) {\r\n                    this.getPlayerByPos(this.PosFromChair(nChair)).getComponent('Player').hideLeaveTimer();\r\n                    this.getPlayerByPos(this.PosFromChair(nChair)).getComponent('Player').setIsReady(true);\r\n                }\r\n            }\r\n\r\n            //如果是我自己的椅子号  则将开始按钮隐藏\r\n            if (nChair == this.m_cbMyChair) {\r\n\r\n                var gamebuttonLayer = this.node.getComponent('GameButtonLayer');\r\n                gamebuttonLayer.setStartBtnVisible(false);\r\n            }\r\n\r\n        } else if (nNewState == gamelibcommon.USER_SIT_TABLE) {\r\n\r\n            this.getPlayerByPos(this.PosFromChair(nChair)).getComponent('Player').setIsReady(false);\r\n            // sendCMD.sendCMD_PO_RESTART();\r\n            // var gamebuttonLayer = this.node.getComponent('GameButtonLayer');\r\n            // gamebuttonLayer.setStartBtnVisible(false);\r\n        }\r\n        else {\r\n            this.getPlayerByPos(this.PosFromChair(nChair)).getComponent('Player').setIsReady(false);\r\n        }\r\n\r\n        //如果是处理掉线状态\r\n        if (nNewState == gamelibcommon.USER_OFF_LINE) {\r\n\r\n            this.getPlayerByPos(this.PosFromChair(nChair)).getComponent('Player').setIsoffLine(true);\r\n        }\r\n        else {\r\n            this.getPlayerByPos(this.PosFromChair(nChair)).getComponent('Player').setIsoffLine(false);\r\n        }\r\n\r\n        //如果是处于游戏中的状态\r\n        if (nNewState == gamelibcommon.USER_PLAY_GAME) {\r\n\r\n            var gamebuttonLayer = this.node.getComponent('GameButtonLayer');\r\n            gamebuttonLayer.setStartBtnVisible(false);\r\n\r\n            for (var chair = 0; chair < GameDefs.PLAYER_COUNT; chair++) {\r\n                this.getPlayerByPos(this.PosFromChair(chair)).getComponent('Player').setIsReady(false);\r\n            }\r\n        }\r\n    },\r\n\r\n    //游戏过程中设定剩余麻将显示  因为开始动画时候 不能够精确计算剩余牌数 所以次函数只适用于游戏中状态\r\n    setRestMjCount: function () {\r\n        var gameSystemNode = this.node.getChildByName(\"game_system_info\");\r\n\r\n        var restMjNum = this.getRestMjCount();\r\n        if(restMjNum < 0)\r\n            restMjNum = 108\r\n        gameSystemNode.getChildByName(\"leftMj_label\").getComponent(cc.Label).string = restMjNum;\r\n    },\r\n\r\n\r\n    showSignalUI: function () {\r\n\r\n        var scheduler = cc.director.getScheduler();\r\n        scheduler.unscheduleCallbackForTarget(this, this._signalUpdate)\r\n\r\n        var gameSystemNode = this.node.getChildByName(\"game_system_info\");\r\n\r\n        var timeLabel = gameSystemNode.getChildByName(\"time_label\");\r\n\r\n        var signalProgress = gameSystemNode.getChildByName(\"singal_progress_bar\");\r\n\r\n        gameSystemNode.getChildByName(\"leftMj_label\").getComponent(cc.Label).string = 0;\r\n\r\n        var myDate = new Date();\r\n\r\n        var update = function (dt) {\r\n            var hours = myDate.getHours();\r\n            var minutes = myDate.getMinutes();\r\n            if (minutes < 10) {\r\n                minutes = \"0\" + minutes;\r\n            }\r\n            var formatTime = hours + \":\" + minutes;\r\n            timeLabel.getComponent(cc.Label).string = formatTime;\r\n\r\n            var netLagValue = this.getGameLib().getNetLag();\r\n\r\n            var nProgress = 1;\r\n            if (netLagValue <= 50) {\r\n                nProgress = 1;\r\n            }\r\n            else if (netLagValue > 50 && netLagValue <= 150) {\r\n                nProgress = 0.8;\r\n            }\r\n            else if (netLagValue > 150 && netLagValue <= 250) {\r\n                nProgress = 0.6;\r\n            }\r\n            else if (netLagValue > 250 && netLagValue <= 350) {\r\n                nProgress = 0.4;\r\n            }\r\n            else if (netLagValue > 350 && netLagValue <= 450) {\r\n                nProgress = 0.2;\r\n            }\r\n            else {\r\n                nProgress = 0;\r\n            }\r\n            signalProgress.getComponent(cc.ProgressBar).progress = nProgress;\r\n        }\r\n\r\n        this._signalUpdate = update;\r\n\r\n        scheduler.scheduleCallbackForTarget(this, update, 1, cc.macro.REPEAT_FOREVER, 0, false);\r\n    },\r\n\r\n\r\n    setRoomInfo: function () {\r\n\r\n        if (!this.m_roomInfo) {\r\n            return;\r\n        }\r\n        var gameInfoNode = this.node.getChildByName(\"game_base_info\");\r\n\r\n        var roomScoreLabel = gameInfoNode.getChildByName(\"gold_game_info\").getChildByName(\"room_score_label\");\r\n        roomScoreLabel.getComponent(cc.Label).string = this.m_roomInfo.nTurnBasicGold + \"分\";\r\n\r\n\r\n        var roomLevelLabel = gameInfoNode.getChildByName(\"gold_game_info\").getChildByName(\"room_level_label\");\r\n\r\n        var roomLevel = \"新手场\";\r\n\r\n        var curRoom = this.getGameLib().getCurrentGameRoom();\r\n\r\n        if (curRoom) {\r\n            var dwRuleID = curRoom.dwRuleID % 10;\r\n\r\n            if (dwRuleID == 2) {\r\n                roomLevel = \"中级场\";\r\n            }\r\n            else if (dwRuleID == 3) {\r\n                roomLevel = \"高级场\";\r\n            }\r\n            else if (dwRuleID == 4) {\r\n                roomLevel = \"富豪场\";\r\n            }\r\n        }\r\n\r\n        roomLevelLabel.getComponent(cc.Label).string = roomLevel\r\n\r\n        var baseInfoBg = gameInfoNode.getChildByName(\"base_info_bg\");\r\n\r\n        var gameInfo = baseInfoBg.getChildByName(\"game_play_info\");\r\n\r\n        var gameInfoStr = \"4人场 \";\r\n\r\n        if (this.m_roomInfo.nPlayerCount == 3) {\r\n            gameInfoStr = \"3人场 \";\r\n        }\r\n\r\n        //加上玩法信息;\r\n        if (this.m_roomInfo.cbLaiType > 0) {\r\n            if (this.m_roomInfo.cbLaiType == 1) {\r\n                gameInfoStr += \" 半癞\";\r\n            }\r\n            else {\r\n                gameInfoStr += \" 无癞到底\";\r\n            }\r\n        }\r\n        else {\r\n            gameInfoStr += \" 经典玩法\";\r\n        }\r\n\r\n        gameInfo.getComponent(cc.RichText).string = gameInfoStr;\r\n    },\r\n\r\n    addLaiziInfo:function(){\r\n        var laizNode = this.node.getChildByName(\"laizi\");\r\n        var laiziInfoNode = laizNode.getChildByName(\"laizi_info\");\r\n        var laiziMj = laiziInfoNode.getChildByName(\"laizi_mj\");\r\n        var mjValue = this.m_stSceneData.cbLaizi\r\n        laiziMj.getComponent(cc.Sprite).spriteFrame = this.node.getComponent(\"MjResourceMgr\").get_face_li_SpriteFrame(\"mj1\", mjValue);\r\n    },\r\n\r\n    //增加游戏等待开始的动画\r\n    addGameWaitStartAction:function(){\r\n        this.waitStartArary = new Array();\r\n        for(var i = 1; i <= 15; i++){\r\n            \r\n        }\r\n    },\r\n\r\n    onSceneChanged: function (lpData) {\r\n        cc.log(\"======onSceneChanged length=%d\", lpData.length)\r\n\r\n        this.m_stSaveSceneData = this.m_stSceneData || {};\r\n\r\n        var ba = lpData;\r\n        this.m_stSceneData = GameDefs.GameScene(ba);\r\n\r\n        this.moreSettingLayer.getComponent(\"MoreSettingLayer\").setLeaveBtnEnabled(false);\r\n        this.moreSettingLayer.getComponent(\"MoreSettingLayer\").setChangedDeskBtnEnabled(false);\r\n        var gamebuttonLayer = this.node.getComponent('GameButtonLayer');\r\n        gamebuttonLayer.setAllOperateButtonIsVis(false);\r\n\r\n\r\n        var isSetInfo = [];\r\n        for (var cbChair = 0; cbChair < GameDefs.PLAYER_COUNT; cbChair++) {\r\n            var nPos = this.PosFromChair(cbChair);\r\n            if (this.getPlayerByPos(nPos).getComponent(\"Player\").getIsValidPlayer() && !isSetInfo[nPos]) {\r\n                var playerCardLayer = this.getPlayerByPos(nPos).getComponent('PlayerCardLayer');\r\n                // playerCardLayer.setmjLaiziValue(this.m_stSceneData.cbLaizi);\r\n                // playerCardLayer.setmjLaizipiValue(this.m_stSceneData.cbLaizipi);\r\n                playerCardLayer.setPlayerPos(nPos);\r\n                playerCardLayer.setPlayerMj(this.m_stSceneData.players[cbChair]);\r\n\r\n                //移除多种吃杠的牌的选择\r\n                if (nPos == 1) {\r\n                    playerCardLayer.removeEatOrGangMoresCardToast();\r\n                }\r\n\r\n                var outCardLayer = this.getPlayerByPos(nPos).getComponent(\"OutCardLayer\");\r\n                outCardLayer.setPlayerPos(nPos);\r\n                outCardLayer.setPlayerMj(this.m_stSceneData.players[cbChair]);\r\n                // outCardLayer.setmjLaiziValue(this.m_stSceneData.cbLaizi);\r\n                // outCardLayer.setmjLaizipiValue(this.m_stSceneData.cbLaizipi);\r\n\r\n                var huCardLayer = this.getPlayerByPos(nPos).getComponent(\"HuCardLayer\");\r\n                huCardLayer.setPlayerPos(nPos);\r\n                huCardLayer.setPlayerMj(this.m_stSceneData.players[cbChair]);\r\n\r\n                // this.getPlayerByPos(nPos).getComponent('Player').setIsRobot(this.m_stSceneData.players[cbChair].cbAutoOutCard == 1);\r\n\r\n                if (cbChair == this.m_cbMyChair) {\r\n                    var cancelRobotNode = this.node.getChildByName(\"cancel_robot\");\r\n                    var isRobot = false;//this.m_stSceneData.players[cbChair].cbAutoOutCard == 1;\r\n                    cancelRobotNode.active = isRobot ? true : false;\r\n\r\n                    var onCancelRobot = function () {\r\n                        cancelRobotNode.active = false;\r\n                    }\r\n\r\n                    this.node.getComponent('GameButtonLayer').setCancelRobotBtnCallBack(onCancelRobot)\r\n                }\r\n\r\n                isSetInfo[nPos] = true;\r\n            }\r\n        }\r\n\r\n        if (this.m_stSceneData.cbPhase == GameDefs.GamePhase.PhaseEnd) {\r\n\r\n            //上传记录给wx服务器\r\n            this.reportResultToWx();\r\n            this.gameOver();\r\n            return;\r\n        }\r\n\r\n        if (this.m_stSceneData.cbWhosTurn == this.m_cbMyChair && this.m_stSceneData.cbPhase == GameDefs.GamePhase.PhaseOutCard) {\r\n            this.getPlayerByPos(1).getComponent('PlayerCardLayer').setCanOutCard(true);\r\n        }\r\n        else {\r\n            this.getPlayerByPos(1).getComponent('PlayerCardLayer').setCanOutCard(false);\r\n        }\r\n\r\n        //当游戏状态大于开始状态  也就是游戏已经开始\r\n        if (this.m_stSceneData.cbPhase > GameDefs.GamePhase.PhaseStart) {\r\n\r\n            this.m_playerStatus = new Array();\r\n            var arrowNode = this.node.getChildByName(\"arrow\");\r\n            var diceBg = arrowNode.getChildByName(\"dice_bg\");\r\n            diceBg.active = true;\r\n\r\n            //确定癞子\r\n            // this.quedingLaizi();\r\n\r\n            // this.addLaiziInfo();\r\n\r\n            this.setRestMjCount();\r\n            //表示是断线了\r\n            if (Tools.isEmptyObject(this.m_stSaveSceneData) && this.m_bIsOffLine) {\r\n                //this.onReConnected();\r\n\r\n                if(self.m_stSceneData.LastAction.nAction != GameDefs.PlayerAction.paHu){\r\n                    this.setAllOutData();\r\n                }                \r\n            }\r\n\r\n        }\r\n        if (this.m_stSceneData.cbPhase > GameDefs.GamePhase.PhasePlayDingque) {\r\n            //防止掉线重连后定缺不显示\r\n            for (var pos = 1; pos <= GameDefs.PLAYER_COUNT; pos++) {\r\n                var nStyle = this.m_stSceneData.players[this.ChairFromPos(nPos - 1)].cbDingque;\r\n                this.getPlayerByPos(pos).getComponent('Player').setQueWanHeadIconSpIsVis(true,nStyle);\r\n            }\r\n        }\r\n\r\n\r\n        if (this.m_stSceneData.LastAction.nAction == GameDefs.PlayerAction.paOutCard) {   //表示上一个场景是出牌\r\n\r\n            this.setAllOutData();\r\n            var nPos = this.PosFromChair(this.m_stSceneData.LastAction.nChair)\r\n            this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").setActionState(GameDefs.PlayerAction.paOutCard);\r\n            this.getPlayerByPos(nPos).getComponent(\"OutCardLayer\").putOutMj(this.m_stSceneData.LastAction.nParam);\r\n\r\n            var nCardValue = this.m_stSceneData.LastAction.nParam;\r\n\r\n            Resources.playMjSoundEffect(this.getPlayerByPos(nPos).getComponent(\"Player\").getSex(), nCardValue)\r\n\r\n            //听牌处理\r\n            if (this.m_stSceneData.cbWhosTurn == this.m_cbMyChair) {\r\n                this.m_nClickCardTing = nCardValue\r\n            }\r\n            this.setTingCardLeftNum(nCardValue, 1)\r\n            this.refreshTingCard()\r\n\r\n        }\r\n        else if (this.m_stSceneData.LastAction.nAction == GameDefs.PlayerAction.paPeng) { //表示上一个场景是碰牌\r\n            this.setAllOutData();\r\n            var nPos = this.PosFromChair(this.m_stSceneData.LastAction.nChair);\r\n            this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").setActionState(GameDefs.PlayerAction.paPeng);\r\n\r\n            this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_1pen, nPos);\r\n\r\n            Resources.playCommonEffect(\"effectword.mp3\");\r\n            var randIndex = Math.floor(Math.random() * 3)\r\n            Resources.playPengEffect(this.getPlayerByPos(nPos).getComponent(\"Player\").getSex(), randIndex);\r\n\r\n            this.setTingCardLeftNum(this.m_stSceneData.cbCurrentCard, 2)\r\n            this.refreshTingCard()\r\n        }\r\n        else if (this.m_stSceneData.LastAction.nAction == GameDefs.PlayerAction.paGang) { //表示上一个场景是杠牌\r\n            this.setAllOutData();\r\n            var nPos = this.PosFromChair(this.m_stSceneData.LastAction.nChair);\r\n            this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").setActionState(GameDefs.PlayerAction.paGang);\r\n\r\n            if ((this.m_stSaveSceneData.cbLastIndex != undefined && this.m_stSceneData.cbLastIndex === this.m_stSaveSceneData.cbLastIndex) &&\r\n                this.m_stSceneData.cbPhase != GameDefs.GamePhase.PhaseEnd) {\r\n\r\n                var mjPlayer = this.m_stSceneData.players[this.m_stSceneData.LastAction.nChair];\r\n                var nWeaveType = GameDefs.WeaveType.MingGang;\r\n                for (var i = 0; i < GameDefs.MAX_WEAVE; i++) {\r\n                    if (mjPlayer.showCardSuits[i].cbWeaveKind != GameDefs.WeaveType.InvalidType) {\r\n                        nWeaveType = mjPlayer.showCardSuits[i].cbWeaveKind;\r\n                    }\r\n                }\r\n\r\n                // if (this.m_stSceneData.cbCurrentCard == GameDefs.HONG_ZHONG) {\r\n                //     this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_1zhong, nPos);\r\n                // }\r\n                // else if (this.m_stSceneData.cbCurrentCard == this.m_stSceneData.cbLaizi) {\r\n                //     this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_1lai, nPos);\r\n                // }\r\n                // else if (nWeaveType == GameDefs.WeaveType.ChaoTianMingGang || nWeaveType == GameDefs.WeaveType.ChaoTianAnGang) {\r\n                //     this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_2caotian, nPos);\r\n                // }\r\n                // else {\r\n                    this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_2gang, nPos);\r\n                    this.getPlayerByPos(nPos).getComponent('Player').playGuaFengEffects(true,nPos);\r\n                // }\r\n\r\n                Resources.playCommonEffect(\"effectword.mp3\");\r\n                Resources.playGangEffect(this.getPlayerByPos(nPos).getComponent(\"Player\").getSex(), 0);\r\n\r\n                for (var i = GameDefs.MAX_WEAVE - 1; i >= 0; i--) {\r\n                    var revealSuit = this.m_stSceneData.players[this.ChairFromPos(nPos - 1)].showCardSuits[i];\r\n                    var stRevealGang = revealSuit.cbCardData;\r\n                    if (revealSuit.cbWeaveKind == GameDefs.WeaveType.MingGang) {\r\n                        if (stRevealGang && stRevealGang.length > 0) {\r\n                            this.setTingCardLeftNum(stRevealGang[0], 3)\r\n                            this.refreshTingCard();\r\n                            break;\r\n                        }\r\n                    }\r\n                    else if (revealSuit.cbWeaveKind == GameDefs.WeaveType.XuGang) {\r\n                        if (stRevealGang && stRevealGang.length > 0) {\r\n                            this.setTingCardLeftNum(stRevealGang[0], 1)\r\n                            this.refreshTingCard();\r\n                            break;\r\n                        }\r\n                    }\r\n                    else if (revealSuit.cbWeaveKind == GameDefs.WeaveType.AnGang) {\r\n                        if (stRevealGang && stRevealGang.length > 0) {\r\n                            this.setTingCardLeftNum(stRevealGang[0], 4)\r\n                            this.refreshTingCard();\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (this.m_stSceneData.LastAction.nAction == GameDefs.PlayerAction.paEat) {  //表示上一个场景是吃牌\r\n            this.setAllOutData();\r\n            var nPos = this.PosFromChair(this.m_stSceneData.LastAction.nChair);\r\n            this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").setActionState(GameDefs.PlayerAction.paEat);\r\n            this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_2chi, nPos);\r\n        }\r\n        else if (this.m_stSceneData.LastAction.nAction == GameDefs.PlayerAction.paHu) {  //表示上一个场景是胡牌\r\n            var self = this;\r\n            var nGetPos = this.PosFromChair(this.m_stSceneData.LastAction.nChair);\r\n            var nHuCount = this.m_stSceneData.LastAction.nChair%10\r\n            var nFangPaoChair = Math.floor(self.m_stSceneData.LastAction.nChair/10) //0是放炮，1是自摸\r\n            var vHuChair = []\r\n            var nHuParam = self.m_stSceneData.LastAction.nParam\r\n            var nFangPaoReal = Math.floor(nHuParam/1000)\r\n            var nHuMoreParam = nHuParam%1000\r\n            if (nHuCount ==1){\r\n                vHuChair[0] =  nHuMoreParam%10;\r\n            }\r\n            if (nHuCount ==2){ \r\n\r\n                vHuChair[0] =  Math.floor(nHuMoreParam/10);\r\n                vHuChair[1] =  nHuMoreParam%10;\r\n            }\r\n            if (nHuCount ==3){\r\n                vHuChair[0] =  Math.floor(nHuMoreParam/100);\r\n                vHuChair[1] =  nHuMoreParam%100%10;\r\n                vHuChair[2] =  Math.floor(nHuMoreParam%100/10);\r\n            }\r\n            this.operationChangeData();\r\n\r\n            for (var i=0;i < vHuChair.length;i++){\r\n                var nPos = this.PosFromChair(vHuChair[i]);\r\n                this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").setActionState(GameDefs.PlayerAction.paHu);\r\n                \r\n                if (nFangPaoChair == 0){\r\n                    //直接播放胡牌动画\r\n                    this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_2hu, nPos);\r\n                    this.playHuEffect(vHuChair[i], false,()=>{ this.setAllOutData(); },nFangPaoReal);\r\n                }\r\n                else{\r\n                    this.setAllOutData();\r\n                    // this.playHuEffect(vHuChair[i], true);\r\n                    this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_2ZiMo, nPos);\r\n                    var playerData = this.m_stSceneData.players[vHuChair[i]]\r\n                    this.getPlayerByPos(nPos).getComponent(\"HuCardLayer\").putHuMj(true);\r\n                } \r\n\r\n                if (vHuChair[i] == this.m_cbMyChair) \r\n                    this.getPlayerByPos(1).getComponent(\"PlayerCardLayer\").setGrayForCannotUpCard(false);\r\n            \r\n            }\r\n\r\n        }   \r\n\r\n        if (this.m_stSceneData.cbPhase == GameDefs.GamePhase.PhaseStart) {\r\n            for (var nPos = 1; cbChair <= GameDefs.PLAYER_COUNT; cbChair++) {\r\n                this.getPlayerByPos(nPos).getComponent('Player').setChaDaJiaoSpIsVis(false)\r\n            }\r\n            if (Tools.isEmptyObject(this.m_stSaveSceneData) && this.m_bIsOffLine) {    //表示之前确实是掉线了\r\n\r\n            }\r\n            else {\r\n                var nBankerPos = this.PosFromChair(this.m_stSceneData.cbBanker);\r\n                this.startGameAction(this.m_stSceneData.cbFirstDice, this.m_stSceneData.cbSecondDice, nBankerPos);\r\n            }\r\n    }\r\n        else if (this.m_stSceneData.cbPhase == GameDefs.GamePhase.PhaseOutCard) {\r\n            cc.log(\"轮到当前的椅子号为\" + this.PosFromChair(this.m_stSceneData.cbWhosTurn));\r\n            var nPos = this.PosFromChair(this.m_stSceneData.cbWhosTurn);\r\n\r\n            //表示从牌墙开始处拿了一张牌\r\n            if (this.m_stSceneData.cbCurrentIndex != this.m_stSaveSceneData.cbCurrentIndex) {\r\n                this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").setActionState(GameDefs.PlayerAction.paGet1CardFromHeader);\r\n                this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").getOneMj(this.m_stSceneData.cbCurrentCard);\r\n            }\r\n            else if (this.m_stSceneData.cbLastIndex != this.m_stSaveSceneData.cbLastIndex) {\r\n                this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").setActionState(GameDefs.PlayerAction.paGet1CardFromTail);\r\n                this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").getOneMj(this.m_stSceneData.cbCurrentCard);\r\n            }\r\n            else {\r\n                //表示游戏开始时候\r\n                if (this.m_stSceneData.LastAction.nAction != GameDefs.PlayerAction.paEat &&\r\n                    this.m_stSceneData.LastAction.nAction != GameDefs.PlayerAction.paGang &&\r\n                    this.m_stSceneData.LastAction.nAction != GameDefs.PlayerAction.paPeng) {\r\n                    //为了首出手打牌,第一张牌能够能够拉开距离                  \r\n                    this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").setActionState(GameDefs.PlayerAction.paPatchFlower)\r\n                }\r\n                this.operationChangeData();\r\n            }\r\n\r\n            if (Tools.isEmptyObject(this.m_stSaveSceneData) && this.m_bIsOffLine) {    //表示之前确实是掉线了\r\n                this.operationChangeData();\r\n            }\r\n\r\n            var nPos = this.PosFromChair(this.m_stSceneData.cbWhosTurn)\r\n            this.setIsDirectionVis(nPos);\r\n\r\n            for (var pos = 1; pos <= GameDefs.PLAYER_COUNT; pos++) {\r\n                this.getPlayerByPos(pos).getComponent('Player').turnToOutPlayCardIsVis(false);\r\n            }\r\n\r\n            this.getPlayerByPos(nPos).getComponent('Player').turnToOutPlayCardIsVis(true);\r\n\r\n            this.startTimer(null, this.GAMETIMER_COUNT)\r\n\r\n            this.showChoiceButton();\r\n\r\n            this.setRestMjCount();\r\n\r\n        }\r\n        else if (this.m_stSceneData.cbPhase == GameDefs.GamePhase.PhaseWaitChoice) {\r\n            this.operationChangeData();\r\n\r\n            this.setRestMjCount();\r\n\r\n            //设定方向选择为没有方向\r\n            this.setIsDirectionVis(0);\r\n\r\n            this.showChoiceButton();\r\n\r\n            this.startTimer(null, this.GAMETIMER_COUNT - 5)\r\n\r\n            if (this.m_stSceneData.cbWhosTurn == this.m_cbMyChair) {\r\n                var mjPlayer = this.m_stSceneData.players[this.m_cbMyChair]\r\n                this.m_nClickCardTing = mjPlayer.cbHoldCards[mjPlayer.cbHoldCardCount - 1];\r\n                this.m_saveTingCardList = this.m_stSceneData.vTingList;\r\n                this.refreshTingCard();\r\n            }\r\n        }\r\n        else if (this.m_stSceneData.cbPhase == GameDefs.GamePhase.PhaseExchange){\r\n            //等待换牌\r\n            this.startTimer(null, this.GAMETIMER_COUNT - 2)\r\n            this.operationChangeData(true);\r\n            this.addThreeSelectCardUI(true,6,true);\r\n        }\r\n        else if (this.m_stSceneData.cbPhase == GameDefs.GamePhase.PhasePlayExchange){\r\n            if (!this.isClick){\r\n                //删除手牌中选择的那三张\r\n                this.getPlayerByPos(1).getComponent(\"PlayerCardLayer\").deleteThreeMjRefresh();\r\n            }\r\n            //播放换牌动画\r\n            this.stopTimer();\r\n            this.addThreeSelectCardUI(false,7,false);\r\n            this.changeMjAction();\r\n            this.exchangeCardAniation();\r\n        }\r\n        else if (this.m_stSceneData.cbPhase == GameDefs.GamePhase.PhaseDingque){\r\n            //定下缺少哪一门\r\n            this.startTimer(null, this.XUANPAI_COUNT);\r\n            this.operationChangeData();\r\n            this.addDingQueYiMenUI(true,4,true);\r\n        }\r\n        else if (this.m_stSceneData.cbPhase == GameDefs.GamePhase.PhasePlayDingque){\r\n            //播放定缺动画\r\n            this.stopTimer();\r\n            this.addDingQueYiMenUI(false,5,false)\r\n            this.dingQueYiMenAniation()\r\n            this.operationChangeData(true)\r\n        }\r\n    },\r\n\r\n    onGameMessage: function (chair, cCmdID, lpBuf) {\r\n        //cc.log(\"DeskScene --------onGameMessage =============cCmdID ==========\", cCmdID);\r\n\r\n\r\n        if (cCmdID == GameDefs.MJ_CMD_GANG) {        //杠\r\n            var gangScoreArray = new Array();\r\n            for (nChair = 0; nChair < GameDefs.PLAYER_COUNT; nChair++) {\r\n                if (lpBuf.bytesAvailable > 0) {\r\n                    var nGangScore = lpBuf.readInt();\r\n                    var nPos = this.PosFromChair(nChair);\r\n                    if (nGangScore != 0) {\r\n                        this.getPlayerByPos(nPos).getComponent(\"Player\").setTempChangeGold(nGangScore, null);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n\r\n        else if (cCmdID == GameDefs.MJ_CMD_ROOMINFO) {\r\n            this.m_roomInfo = GameDefs.ST_RoomInfo(lpBuf);\r\n\r\n            this.setRoomInfo();\r\n        }\r\n\r\n        else if (cCmdID == GameDefs.MJ_CMD_Set_XueFei) {\r\n\r\n        }\r\n\r\n        else if (cCmdID == GameDefs.MJ_CMD_AUTOOUT) {     //托管\r\n            var nChair = lpBuf.readUnsignedByte();\r\n            var nPos = this.PosFromChair(nChair);\r\n            this.getPlayerByPos(nPos).getComponent(\"Player\").setIsRobot(true);\r\n\r\n            if (nChair == this.m_cbMyChair) {\r\n                var cancelRobotNode = this.node.getChildByName(\"cancel_robot\");\r\n\r\n                cancelRobotNode.active = true;\r\n\r\n                var onCancelRobot = function () {\r\n                    cancelRobotNode.active = false;\r\n                }\r\n\r\n                this.node.getComponent('GameButtonLayer').setCancelRobotBtnCallBack(onCancelRobot)\r\n            }\r\n        }\r\n\r\n        else if (cCmdID == GameDefs.MJ_CMD_Cancel_AutoOut) {  //取消托管\r\n            var nChair = lpBuf.readUnsignedByte();\r\n            var nPos = this.PosFromChair(nChair);\r\n\r\n            this.getPlayerByPos(nPos).getComponent(\"Player\").setIsRobot(false);\r\n            if (nChair == this.m_cbMyChair) {\r\n                var cancelRobotNode = this.node.getChildByName(\"cancel_robot\");\r\n\r\n                cancelRobotNode.active = false;\r\n            }\r\n        }\r\n\r\n        else if (cCmdID == GameDefs.MSG_ROBOT_ACTIVE) {\r\n\r\n        }\r\n\r\n        else if (cCmdID == GameDefs.MJ_DISSOLVE_ROOM) {\r\n\r\n        }\r\n\r\n        else if (cCmdID == GameDefs.MJ_DISSOLVE_RESULT) {\r\n\r\n        }\r\n\r\n        else if (cCmdID == GameDefs.MJ_CMD_SETINFO) {\r\n            this.m_roomSetInfo = GameDefs.ST_SetInfo(lpBuf);\r\n\r\n           \r\n        }\r\n\r\n        else if(cCmdID == GameDefs.CMD_Notify_UpGrade){ //升段通知\r\n            this.m_nNewLevel = lpBuf.readInt();\r\n        }\r\n\r\n        else if (cCmdID == GameDefs.MJ_CMD_DissINFO) {\r\n\r\n        }\r\n\r\n        else if (cCmdID == GameDefs.MJ_CMD_Exchange) {\r\n            var nPos = this.PosFromChair(chair)\r\n            if (chair != this.m_cbMyChair){\r\n                this.getPlayerByPos(nPos).getComponent(\"Player\").setSelectCardSpIsVis(true,7);\r\n            }\r\n        }\r\n        else if (cCmdID == GameDefs.MJ_CMD_DingQue) {\r\n            var nQueMen = lpBuf.readUnsignedByte();\r\n            if (chair == this.m_cbMyChair){\r\n                this.getPlayerByPos(1).getComponent(\"Player\").setQueWanSpIsVis(true,nQueMen)\r\n                this.queYiMenTipsLayer.active = false;\r\n                this.queYiMenButtonLayer.active = false;\r\n            }\r\n            else{\r\n                var nPos = this.PosFromChair(chair)\r\n                this.getPlayerByPos(nPos).getComponent(\"Player\").setDingqueSpIsVis(true,5)\r\n            }\r\n        }\r\n        \r\n    },\r\n\r\n    //开始游戏  玩家拿牌\r\n    startGameAction: function (firstDice, secondDice, nBankerPos) {\r\n        var self = this;\r\n\r\n        var gameSystemNode = this.node.getChildByName(\"game_system_info\");\r\n\r\n        //初始化麻将数量\r\n        // gameSystemNode.getChildByName(\"leftMj_label\").getComponent(cc.Label).string = this.getTotalMjCount();\r\n\r\n        //将玩家手上的牌都设置为不可见\r\n        for (var nPos = 1; nPos <= GameDefs.PLAYER_COUNT; nPos++) {\r\n            var node = self.getPlayerByPos(nPos);\r\n            // node.getComponent(\"PlayerCardLayer\").resetAllHandCardPosWithNoDiff();\r\n            var holdCardsNode = node.getChildByName(\"holds\");\r\n            for (var i = 0; i < holdCardsNode.childrenCount; i++) {\r\n                var cardNode = holdCardsNode.children[i];\r\n                cardNode.getComponent(cc.Sprite).spriteFrame = null;\r\n                cardNode.active = true;\r\n                cardNode.setScale(1.0);\r\n            }\r\n        }\r\n\r\n        var playStartActionEnd = function (nPos) {\r\n            var holds = self.getPlayerByPos(nPos).getChildByName(\"holds\");\r\n            if (nPos == 1) {\r\n\r\n                //播一遍整理牌的动画\r\n                for (var i = 0; i < self.m_stSceneData.players[self.m_cbMyChair].cbHoldCardCount; i++) {\r\n\r\n                    var cardNode = holds.children[i];\r\n                    var animation = cardNode.addComponent(cc.Animation);\r\n\r\n                    animation.addClip(self.mj_actionClip, \"mj_action\");\r\n                    var animState = animation.play(\"mj_action\");\r\n                    if(animState){\r\n                        animState.speed = 0.9;\r\n                    }\r\n                    \r\n\r\n                    Resources.playCommonEffect(\"cleancard.mp3\");\r\n\r\n                    if (i == self.m_stSceneData.players[self.m_cbMyChair].cbHoldCardCount - 1) {\r\n                        self.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").resetAllHandCardPosWithNoDiff();\r\n                        var onEnd = function () {\r\n                            self.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").putSelfHandCards();\r\n                        };\r\n                        animation.on(\"finished\", onEnd, cardNode);\r\n                    }\r\n                }\r\n\r\n\r\n            }\r\n            else {\r\n                var chair = self.ChairFromPos(nPos - 1)\r\n\r\n                var spriteFrame;\r\n\r\n                if (nPos == 2) {\r\n                    spriteFrame = self.node.getComponent(\"MjResourceMgr\").m_mj1_back_right_frame;\r\n                }\r\n                else if (nPos == 3) {\r\n                    spriteFrame = self.node.getComponent(\"MjResourceMgr\").m_mj1_back_top_frame;\r\n                }\r\n                else if (nPos == 4) {\r\n                    spriteFrame = self.node.getComponent(\"MjResourceMgr\").m_mj1_back_left_frame;\r\n                }\r\n                else {\r\n                    console.log(\"check  the  nPos\");\r\n                }\r\n                for (var i = 0; i < GameDefs.MAX_HOLD_CARD; i++) {\r\n                    holds.children[i].active = false;\r\n                    holds.children[i].getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n                }\r\n\r\n                var cardCount = 13;\r\n                if (nPos != 2) {\r\n                    for (var i = 0; i < cardCount; i++) {\r\n                        holds.children[i].active = true;\r\n                    }\r\n                }\r\n                else {\r\n                    for (var i = GameDefs.MAX_HOLD_CARD - 1; i >= GameDefs.MAX_HOLD_CARD - cardCount; i--) {\r\n                        holds.children[i].active = true;\r\n                    }\r\n                }\r\n\r\n                // self.quedingLaizi();\r\n\r\n                // self.addLaiziInfo();\r\n            }\r\n\r\n\r\n            //然后将筛子蒙板蒙住\r\n            // var arrowNode = self.node.getChildByName(\"arrow\");\r\n            // var diceBg = arrowNode.getChildByName(\"dice_bg\");\r\n            // diceBg.active = true;\r\n\r\n            var nPlayerCount = 4;//self.m_roomInfo.nPlayerCount || 4;\r\n            gameSystemNode.getChildByName(\"leftMj_label\").getComponent(cc.Label).string = self.getTotalMjCount() - (nPlayerCount - 1) * 13 - 14;\r\n\r\n        }\r\n\r\n\r\n        var playStartAction = function (nPos) {\r\n            var holds = self.getPlayerByPos(nPos).getChildByName(\"holds\");\r\n            var groupIndex = 0;\r\n            var playGetOneGroupCardAction = function () {     //播放拿一组牌的动画\r\n\r\n                if (groupIndex >= 3) {\r\n\r\n                    //将排序过后的牌重新设定一遍                   \r\n                    playStartActionEnd(nPos);\r\n                    return;\r\n                }\r\n\r\n                var playNextGroup = false;\r\n                for (var j = 0; j < 4; j++) {\r\n                    var cardNode;\r\n                    if (nPos == 2) {\r\n                        cardNode = holds.children[13 - (groupIndex * 4 + j)];\r\n                    }\r\n                    else {\r\n                        cardNode = holds.children[groupIndex * 4 + j];\r\n                    }\r\n\r\n                    if (cardNode) {\r\n                        var animation = cardNode.addComponent(cc.Animation);\r\n\r\n\r\n                        if (nPos == 1) {\r\n                            animation.addClip(self.me_actionClip, \"me_action\");\r\n                            var animState = animation.play(\"me_action\");\r\n                            if(animState){\r\n                                animState.speed = 1.5;\r\n                            }\r\n                        }\r\n                        else if (nPos == 2) {\r\n                            animation.addClip(self.right_actionClip, \"right_action\");\r\n                            animation.play(\"right_action\");\r\n                        }\r\n                        else if (nPos == 3) {\r\n                            animation.addClip(self.top_actionClip, \"top_action\");\r\n                            animation.play(\"top_action\");\r\n                        }\r\n                        else {\r\n                            animation.addClip(self.left_actionClip, \"left_action\");\r\n                            animation.play(\"left_action\");\r\n                        }\r\n\r\n                        Resources.playCommonEffect(\"getcard.mp3\");\r\n\r\n                        var onPlayAnimatiEnd = function (event) {\r\n                            if (!playNextGroup) {\r\n\r\n                                var strCount = gameSystemNode.getChildByName(\"leftMj_label\").getComponent(cc.Label).string\r\n                                var restMjNum = strCount;\r\n                                restMjNum = restMjNum - 4;\r\n                                gameSystemNode.getChildByName(\"leftMj_label\").getComponent(cc.Label).string = restMjNum;\r\n                                if (nPos == 1) {\r\n                                    for (var index = 0; index < 4; index++) {\r\n                                        var mjValue = self.m_stSceneData.players[self.m_cbMyChair].cbHoldCards[groupIndex * 4 + index];\r\n                                        var spriteFrame = self.node.getComponent(\"MjResourceMgr\").get_face_li_SpriteFrame(\"mj1\", mjValue);\r\n                                        holds.children[groupIndex * 4 + index].getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n                                    }\r\n                                }\r\n\r\n                                groupIndex += 1;\r\n\r\n                                playNextGroup = true;\r\n                                playGetOneGroupCardAction(groupIndex);\r\n                            }\r\n                        }\r\n                        animation.on('finished', onPlayAnimatiEnd, cardNode);\r\n                    }\r\n                }\r\n            }\r\n            playGetOneGroupCardAction(groupIndex);\r\n        }\r\n\r\n        for (var nPos = 1; nPos <= GameDefs.PLAYER_COUNT; nPos++) {\r\n            if (this.getPlayerByPos(nPos).getComponent(\"Player\").getIsValidPlayer()) {\r\n                playStartAction(nPos);\r\n            }\r\n        }\r\n\r\n        Resources.playCommonEffect(\"startgame.mp3\");\r\n    },\r\n\r\n    quedingLaizi: function () {\r\n        if (this.m_stSceneData) {\r\n            var laiziNode = this.node.getChildByName(\"laizi\");\r\n            laiziNode.active = true;\r\n            var spriteFrame = this.node.getComponent(\"MjResourceMgr\").get_face_li_SpriteFrame(\"mj1\", this.m_stSceneData.cbLaizi);\r\n            laiziNode.getChildByName(\"laizi_img\").getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n        }\r\n    },\r\n\r\n    setIsDirectionVis: function (nPos) {\r\n        this.GetMyInfo();\r\n        if (this.m_cbMyChair == null) {\r\n            return;\r\n        }\r\n\r\n        var arrowNode = this.node.getChildByName(\"arrow\");\r\n\r\n        var directNode = arrowNode.getChildByName(\"direction\");\r\n\r\n\r\n        for (var i = 4; i < directNode.childrenCount; i++) {\r\n            directNode.children[i].active = false;\r\n            directNode.children[i].stopAllActions();\r\n\r\n        }\r\n\r\n        if (nPos == 0) {\r\n            return 0;\r\n        }\r\n\r\n        var direct = directNode.children[4 + nPos - 1];\r\n\r\n        direct.stopAllActions();\r\n        var act1 = cc.fadeOut(1);\r\n        var act2 = cc.fadeIn(1);\r\n        var seq = cc.sequence(act1, act2)\r\n        direct.active = true;\r\n        direct.runAction(cc.repeatForever(seq))\r\n\r\n    },\r\n\r\n    showChoiceButton: function () {\r\n        var choice = this.m_stSceneData.ChoiceAction[this.m_cbMyChair];\r\n\r\n        var myMJPlayer = this.m_stSceneData.players[this.m_cbMyChair];\r\n\r\n        var vUpCards = new Array();     //表示应该抬起的牌\r\n\r\n        var gamebuttonLayer = this.node.getComponent('GameButtonLayer');\r\n\r\n        var GameJudge = require(\"GameJudge\");\r\n\r\n        //表示能吃\r\n        if (GameDefs.PlayerAction.paEat == (choice & GameDefs.PlayerAction.paEat)) {\r\n\r\n            var nValidLen = 0;\r\n            var pEatCase = new Array();\r\n            var bIsLeft = GameJudge.CanShunLeft(this.m_stSceneData.cbCurrentCard, myMJPlayer.cbHoldCards, myMJPlayer.cbHoldCardCount, this.m_stSceneData.cbLaizi)\r\n            var bIsMiddle = GameJudge.CanShunMid(this.m_stSceneData.cbCurrentCard, myMJPlayer.cbHoldCards, myMJPlayer.cbHoldCardCount, this.m_stSceneData.cbLaizi)\r\n            var bIsRight = GameJudge.CanShunRight(this.m_stSceneData.cbCurrentCard, myMJPlayer.cbHoldCards, myMJPlayer.cbHoldCardCount, this.m_stSceneData.cbLaizi)\r\n\r\n            if (bIsLeft) {\r\n                nValidLen = nValidLen + 1\r\n                var stEat = new Array();\r\n                stEat.push(this.m_stSceneData.cbCurrentCard)\r\n                stEat.push(this.m_stSceneData.cbCurrentCard + 1)\r\n                stEat.push(this.m_stSceneData.cbCurrentCard + 2)\r\n                stEat.push(GameDefs.MJ_CMD_EATLEFT)\r\n                pEatCase.push(stEat);\r\n\r\n\r\n                vUpCards.push(this.m_stSceneData.cbCurrentCard + 1)\r\n                vUpCards.push(this.m_stSceneData.cbCurrentCard + 2)\r\n            }\r\n\r\n            if (bIsMiddle) {\r\n                nValidLen = nValidLen + 1\r\n                var stEat = new Array();\r\n                stEat.push(this.m_stSceneData.cbCurrentCard - 1)\r\n                stEat.push(this.m_stSceneData.cbCurrentCard)\r\n                stEat.push(this.m_stSceneData.cbCurrentCard + 1)\r\n                stEat.push(GameDefs.MJ_CMD_EATMID)\r\n                pEatCase.push(stEat);\r\n\r\n                vUpCards.push(this.m_stSceneData.cbCurrentCard - 1)\r\n                vUpCards.push(this.m_stSceneData.cbCurrentCard + 1)\r\n            }\r\n\r\n            if (bIsRight) {\r\n                nValidLen = nValidLen + 1\r\n                var stEat = new Array();\r\n                stEat.push(this.m_stSceneData.cbCurrentCard - 2)\r\n                stEat.push(this.m_stSceneData.cbCurrentCard - 1)\r\n                stEat.push(this.m_stSceneData.cbCurrentCard)\r\n                stEat.push(GameDefs.MJ_CMD_EATRIGHT)\r\n                pEatCase.push(stEat);\r\n\r\n                vUpCards.push(this.m_stSceneData.cbCurrentCard - 2)\r\n                vUpCards.push(this.m_stSceneData.cbCurrentCard - 1)\r\n            }\r\n\r\n            var self = this;\r\n            var onChiClickCallBack = function () {\r\n                if (nValidLen == 0) {\r\n                    return;\r\n                }\r\n                else if (nValidLen == 1) {\r\n                    sendCMD.sendCMD_PO_EAT(pEatCase[0][3])  //表明只有一种吃的选择 \r\n                }\r\n                else {\r\n                    //表明有多钟吃的选择\r\n                    self.getPlayerByPos(1).getComponent(\"PlayerCardLayer\").eatMoresCardToast(nValidLen, pEatCase, self.m_stSceneData.cbCurrentCard);\r\n                }\r\n            }\r\n            gamebuttonLayer.setChiClickBtnCallBack(onChiClickCallBack);\r\n            gamebuttonLayer.setGuoBtnVisible(true);\r\n            gamebuttonLayer.setChiBtnVisible(true);\r\n        }\r\n\r\n        //表示能碰\r\n        if (GameDefs.PlayerAction.paPeng == (choice & GameDefs.PlayerAction.paPeng)) {\r\n\r\n            gamebuttonLayer.setGuoBtnVisible(true);\r\n            gamebuttonLayer.setPengBtnVisible(true);\r\n            vUpCards.push(this.m_stSceneData.cbCurrentCard)\r\n        }\r\n\r\n        //表示能杠\r\n        if (GameDefs.PlayerAction.paGang == (choice & GameDefs.PlayerAction.paGang)) {\r\n            var nWeaveType = GameDefs.WeaveType.MingGang\r\n            var nV = -1;    //表示杠的麻将的牌值\r\n\r\n            // var chaoTianMingGangResult = GameJudge.handCardIsHaveTwoLaiZiPi(myMJPlayer, this.m_stSceneData.cbLaizipi, this.m_stSceneData.cbCurrentCard);\r\n            // var bIsChaoTianMingGang = chaoTianMingGangResult.bIsExist;\r\n            // var chaotianMingGangCard = chaoTianMingGangResult.vCardValue;\r\n\r\n\r\n            // var chaoTianAnGangResult = GameJudge.handCardIsHaveThreeLaiZiPi(myMJPlayer, this.m_stSceneData.cbLaizipi);\r\n            // var bIsChaoTianAnGang = chaoTianAnGangResult.bIsExist;\r\n            // var chaotianAnGangCard = chaoTianAnGangResult.vCardValue;\r\n\r\n            var fourSameResult = GameJudge.handCardIsHaveFourSame(myMJPlayer);\r\n            var bIsExistAnGang = fourSameResult.bIsExist;\r\n            var anGangArray = fourSameResult.vCardArray;\r\n\r\n            var threeSameResult = GameJudge.handCardIsHaveThreeSame(myMJPlayer, this.m_stSceneData.cbCurrentCard);\r\n            var bIsExistMingGang = threeSameResult.bIsExist;\r\n            var nVCard = threeSameResult.vCardValue;\r\n\r\n\r\n            var oneSameResult = GameJudge.handCardIsHaveOneSameToWave(myMJPlayer);\r\n            var bIsExistXuGang = oneSameResult.bIsExist;\r\n            var xuGangArray = oneSameResult.vCardArray;\r\n\r\n            var gangTable = new Array();\r\n            if (this.m_cbMyChair == this.m_stSceneData.cbWhosTurn) {  //当前轮到我出牌  则不可能是明杠  只有可能是暗杠和续杠\r\n                if (bIsExistAnGang) {\r\n                    nWeaveType = GameDefs.WeaveType.AnGang;\r\n                    nV = anGangArray[0]\r\n                    for (var i = 0; i < anGangArray.length; i++) {\r\n                        var anGangInfo = {};\r\n                        anGangInfo.nGangCard = anGangArray[i];\r\n                        anGangInfo.nGangType = nWeaveType;\r\n                        gangTable.push(anGangInfo);\r\n                    }\r\n                }\r\n\r\n\r\n                if (bIsExistXuGang) {\r\n                    nWeaveType = GameDefs.WeaveType.XuGang\r\n                    nV = xuGangArray[0];\r\n                    for (var i = 0; i < xuGangArray.length; i++) {\r\n                        var xuGangInfo = {};\r\n                        xuGangInfo.nGangCard = xuGangArray[i];\r\n                        xuGangInfo.nGangType = nWeaveType;\r\n                        gangTable.push(xuGangInfo);\r\n                    }\r\n                }\r\n\r\n                // if (bIsChaoTianAnGang) {\r\n                //     nWeaveType = GameDefs.WeaveType.ChaoTianAnGang\r\n                //     nV = chaotianAnGangCard;\r\n                //     gangTable.push(nV);\r\n                // }\r\n\r\n            }\r\n            else {\r\n\r\n                if (bIsExistMingGang) {\r\n                    nWeaveType = GameDefs.WeaveType.MingGang\r\n                    nV = nVCard\r\n                }\r\n\r\n                // if (bIsChaoTianMingGang) {\r\n                //     nWeaveType = GameDefs.WeaveType.ChaoTianMingGang\r\n                //     nV = chaotianMingGangCard\r\n                // }\r\n            }\r\n\r\n\r\n\r\n            var self = this;\r\n            var onGangClickCallBack = function () {\r\n                if (bIsExistMingGang && gangTable.length <= 1) {\r\n                    sendCMD.sendCMD_PO_GANG(nV, nWeaveType)\r\n                }\r\n                else if (gangTable.length <= 1) {\r\n                    sendCMD.sendCMD_PO_GANG(nV, nWeaveType)\r\n                }\r\n                else {\r\n                    //表示同时有多个牌可以杠\r\n                    self.getPlayerByPos(1).getComponent(\"PlayerCardLayer\").gangMoresCardToast(gangTable);\r\n                }\r\n            }\r\n\r\n            var onChaoTianClickCallBack = function () {\r\n                sendCMD.sendCMD_PO_GANG(nV, nWeaveType)\r\n            }\r\n\r\n            //用于多个杠的时候选择过的\r\n            var onGuoClickCallBack = function () {\r\n                var mySelectGangNode = self.getPlayerByPos(1).getChildByName(\"select_penggangs\");\r\n\r\n                //表示最开始的时候没有点过 \r\n                if (mySelectGangNode.childrenCount > 0) {\r\n                    self.getPlayerByPos(1).getComponent(\"PlayerCardLayer\").gangMoresCardToast(gangTable);\r\n                }\r\n                else {\r\n                    sendCMD.sendCMD_PO_PASS();\r\n                    var gamebuttonLayer = self.node.getComponent('GameButtonLayer');\r\n                    gamebuttonLayer.setAllOperateButtonIsVis(false);\r\n                }\r\n            }\r\n            gamebuttonLayer.setGangClickBtnCallBack(onGangClickCallBack);\r\n            gamebuttonLayer.setGuoClickBtnCallBack(onGuoClickCallBack);\r\n            gamebuttonLayer.setChaoTianClickBtnCallBack(onChaoTianClickCallBack);\r\n            gamebuttonLayer.setGuoBtnVisible(true);\r\n            // if (nWeaveType == GameDefs.WeaveType.ChaoTianAnGang || nWeaveType == GameDefs.WeaveType.ChaoTianMingGang) {\r\n            //     gamebuttonLayer.setChaoTianBtnVisible(true);\r\n            // }\r\n            // else {\r\n                gamebuttonLayer.setGangBtnVisible(true);\r\n            // }\r\n            vUpCards.push(nV)\r\n        }\r\n\r\n        //表示能胡\r\n        if (GameDefs.PlayerAction.paHu == (choice & GameDefs.PlayerAction.paHu)) {\r\n\r\n            // cc.log(\"---------------------can  hu-------------------\");\r\n            gamebuttonLayer.setGuoBtnVisible(true);\r\n            if (this.m_stSceneData.cbWhosTurn == this.m_cbMyChair) {\r\n                gamebuttonLayer.setZiMoBtnVisible(true);\r\n            }\r\n            else {\r\n                gamebuttonLayer.setHuBtnVisible(true);\r\n            }\r\n\r\n        }\r\n\r\n        //将相应的牌给提起\r\n        if (vUpCards.length > 0) {\r\n\r\n        }\r\n    },\r\n\r\n\r\n    operationChangeData: function (bFreshPutCard) {\r\n        // var nStyle = nil\r\n        // if ((self.m_stSceneData.cbPhase >= GameDefs.GamePhase.PhaseOutCard) || \r\n        //     (self.m_stSceneData.cbPhase == GameDefs.GamePhase.PhasePlayDingque)) {\r\n        //     var mjPlayer = this.m_stSceneData.players[this.m_cbMyChair]\r\n        //     nStyle = mjPlayer.cbDingque\r\n        // }\r\n\r\n        for (var nPos = 1; nPos <= GameDefs.PLAYER_COUNT; nPos++) {\r\n            if (this.getPlayerByPos(nPos).getComponent(\"Player\").getIsValidPlayer()) {\r\n                var bolHu = this.m_stSceneData.players[this.ChairFromPos(nPos - 1)].cbIsHu == 1;\r\n                this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").doCards(bFreshPutCard,bolHu);\r\n            }\r\n\r\n        }\r\n    },\r\n\r\n    setAllOutData: function () {\r\n        for (var nPos = 1; nPos <= GameDefs.PLAYER_COUNT; nPos++) {\r\n            if (this.getPlayerByPos(nPos).getComponent(\"Player\").getIsValidPlayer()) {\r\n                this.getPlayerByPos(nPos).getComponent(\"OutCardLayer\").doCards();\r\n                this.getPlayerByPos(nPos).getComponent(\"HuCardLayer\").doCards();\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n\r\n    startTimer: function (overTimeFunc, nDowntime) {\r\n        var scheduler = cc.director.getScheduler();\r\n        scheduler.unscheduleCallbackForTarget(this, this._timerUpdate)\r\n        var timeLabel = this.node.getChildByName(\"arrow\").getChildByName(\"timeLabel\");\r\n        timeLabel.getComponent(cc.Label).string = \"\";\r\n        timeLabel.active = true;\r\n        var strLeftTime = \"\";\r\n        var update = function () {\r\n            if (nDowntime < 0) {\r\n                timeLabel.getComponent(cc.Label).string = \"\";\r\n                if (overTimeFunc) {\r\n                    overTimeFunc();\r\n                }\r\n                scheduler.unscheduleCallbackForTarget(this, update)\r\n                return;\r\n            }\r\n\r\n            strLeftTime = strLeftTime = nDowntime;\r\n            if (nDowntime < 10) {\r\n                strLeftTime = \"0\" + strLeftTime;\r\n            }\r\n            timeLabel.getComponent(cc.Label).string = strLeftTime;\r\n            nDowntime = nDowntime - 1;\r\n        };\r\n        update();\r\n        this._timerUpdate = update;\r\n        scheduler.scheduleCallbackForTarget(this, update, 1, cc.macro.REPEAT_FOREVER, 0, false);\r\n    },\r\n\r\n    stopTimer: function () {\r\n        var scheduler = cc.director.getScheduler();\r\n        scheduler.unscheduleCallbackForTarget(this, this._timerUpdate)\r\n        var timeLabel = this.node.getChildByName(\"arrow\").getChildByName(\"timeLabel\");\r\n        timeLabel.getComponent(cc.Label).string = \"\";\r\n    },\r\n\r\n    setTingCardLeftNum: function (nOutCard, nCount) {\r\n        var vTingList = this.m_saveTingCardList;\r\n        if (!vTingList)\r\n            return;\r\n        for (var i = 0; i < vTingList.length; i++) {\r\n            var nTingCount = vTingList[i].cbTingCount;\r\n            for (var j = 0; j < nTingCount; j++) {\r\n                if (nOutCard == vTingList[i].cbTingCard[j]) {\r\n                    vTingList[i].cbLeftCount[j] -= nCount;\r\n                    if (vTingList[i].cbLeftCount[j] <= 0) {\r\n                        vTingList[i].cbLeftCount[j] = 0;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    //处理换牌动画\r\n    exchangeCardAniation:function(){\r\n        var self = this;\r\n        var swapCardFinshcallBack = function(){\r\n            //处理换牌后插牌动作\r\n            self.huanPaiTipsLayer.active = false;\r\n            self.operationChangeData(true)\r\n            var mjPlayer = self.m_stSceneData.players[self.m_cbMyChair];\r\n            var runActionFun = function(nPos){\r\n                if(nPos > GameDefs.PLAYER_COUNT){\r\n                    return;\r\n                }\r\n                var tb = mjPlayer.cbBeExchange;\r\n                self.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").insertThreeCard(mjPlayer.cbBeExchange,nPos);\r\n                runActionFun(1+nPos);\r\n            }\r\n            runActionFun(1);\r\n            \r\n        }\r\n        self.huanPaiTipsLayer.active = true;\r\n        self.huanPaiTipsLayer.getComponent(\"ChangeCardAction\").showShunRotateAction(swapCardFinshcallBack);\r\n    },\r\n\r\n    //播放换牌动画\r\n    changeMjAction:function(){\r\n        var self = this;\r\n        // for (var nPos = 1; nPos <= GameDefs.PLAYER_COUNT; nPos++) {\r\n\r\n        var PlayerAction = function(nPos){\r\n            if(nPos > GameDefs.PLAYER_COUNT){\r\n                return;\r\n            }\r\n            var node = self.getPlayerByPos(nPos);\r\n            var changeCardsNode = node.getChildByName(\"changecards\");\r\n            changeCardsNode.active = true;\r\n            var action = null;\r\n            var action1 = null;\r\n            var action2 = null;\r\n            var action3 = null;\r\n            if (nPos == 1)\r\n            {\r\n                action1 = cc.spawn(cc.scaleTo(0.8,0,0), cc.moveBy(0.8,0, 50));\r\n                action2 = cc.spawn(cc.scaleTo(0.7,1,1), cc.moveBy(0.7,0, -50));\r\n                action3 = cc.callFunc(()=>{\r\n                    changeCardsNode.active = false;           \r\n                });\r\n                action = cc.sequence(cc.delayTime(0.2),action1,cc.delayTime(0.2),action2,action3);\r\n            }else if (nPos == 2)\r\n            {\r\n                action1 = cc.spawn(cc.scaleTo(0.8,0,0), cc.moveBy(0.8, -140,0));\r\n                action2 = cc.spawn(cc.scaleTo(0.7,1,1), cc.moveBy(0.7, 140,0));\r\n                action3 = cc.callFunc(()=>{\r\n                    changeCardsNode.active = false;\r\n                });\r\n                action = cc.sequence(cc.delayTime(0.2),action1,cc.delayTime(0.2),action2,action3);\r\n            }else if (nPos == 3)\r\n            {\r\n                action1 = cc.spawn(cc.scaleTo(0.8,0,0), cc.moveBy(0.8, 0,-50));\r\n                action2 = cc.spawn(cc.scaleTo(0.7,1,1), cc.moveBy(0.7, 0,50));\r\n                action3 = cc.callFunc(()=>{\r\n                    changeCardsNode.active = false;\r\n                });\r\n                action = cc.sequence(cc.delayTime(0.2),action1,cc.delayTime(0.2),action2,action3);\r\n            }\r\n            else if (nPos == 4)\r\n            {\r\n                action1 = cc.spawn(cc.scaleTo(0.8,0,0), cc.moveBy(0.8, 160,0));\r\n                action2 = cc.spawn(cc.scaleTo(0.7,1,1), cc.moveBy(0.7, -160,0));\r\n                action3 = cc.callFunc(()=>{\r\n                    changeCardsNode.active = false;\r\n                });\r\n                action = cc.sequence(cc.delayTime(0.2),action1,cc.delayTime(0.2),action2,action3);\r\n            }\r\n            changeCardsNode.runAction(action);\r\n            PlayerAction(nPos + 1);\r\n        // }\r\n        }\r\n\r\n        PlayerAction(1);\r\n    },\r\n    \r\n    //设置确认定缺动画播放，顺便为自己手牌的定缺进行变灰处理\r\n    dingQueYiMenAniation:function(){\r\n        var self = this;\r\n        for (var nPos = 1; nPos <= GameDefs.PLAYER_COUNT; nPos++) {\r\n            var mjPlayer = this.m_stSceneData.players[nPos-1];\r\n            if (nPos==1) {\r\n                this.getPlayerByPos(1).getComponent(\"PlayerCardLayer\").setQueYiMenStyleType(mjPlayer.cbDingque)\r\n                this.getPlayerByPos(1).getComponent(\"PlayerCardLayer\").setQueYiMenMjGray()\r\n            }\r\n        }\r\n\r\n        \r\n        var PlayerAction = function(nPos){\r\n            if(nPos > GameDefs.PLAYER_COUNT){\r\n                return;\r\n            }\r\n            var mjPlayer = self.m_stSceneData.players[nPos-1];\r\n            self.getPlayerByPos(nPos).getComponent(\"Player\").setQueWanSpIsVis(true,mjPlayer.cbDingque,true)\r\n            PlayerAction(nPos + 1);\r\n        }\r\n        PlayerAction(1);\r\n    },\r\n\r\n    addDingQueYiMenUI:function(bIsVis,nType,bShow){\r\n        var self = this;\r\n        var nType = nType || 4;\r\n        for (var nPos = 1; nPos <= GameDefs.PLAYER_COUNT; nPos++) {\r\n            if (nPos !=1) {\r\n                this.getPlayerByPos(nPos).getComponent(\"Player\").setDingqueSpIsVis(bShow,nType);\r\n            }else\r\n            {\r\n                self.queYiMenTipsLayer.active = bIsVis;\r\n                self.queYiMenButtonLayer.active = bIsVis;\r\n            }\r\n        }\r\n    },\r\n\r\n    addThreeSelectCardUI:function(bIsVis,nType,bShow){\r\n        var self = this;\r\n        var nType = nType || 7;\r\n        this.waitTimer = this.XUANPAI_COUNT;\r\n        \r\n        for (var nPos = 1; nPos <= GameDefs.PLAYER_COUNT; nPos++) {\r\n            if (nPos != 1) {\r\n                this.getPlayerByPos(nPos).getComponent(\"Player\").setSelectCardSpIsVis(bShow,nType)\r\n            }else\r\n            {\r\n                self.xuanPaiTipsLayer.active = bIsVis;\r\n            }\r\n        }\r\n\r\n        if (!bIsVis){\r\n            return\r\n        }\r\n        \r\n        //提起三张牌（客户端指定）\r\n        this.getPlayerByPos(1).getComponent(\"PlayerCardLayer\").upThreeCardByType();\r\n\r\n        this.startXuanPaiTime = function () {\r\n            self.waitTimer -= 1;\r\n            if (self.waitTimer >= 0) {\r\n                self.xuanPaiTipsTimes.string = self.waitTimer;\r\n            }\r\n            else {\r\n                if (!self.isClick)\r\n                    self.onXuanPaiButtonClick();\r\n            }\r\n\r\n        }\r\n        this.schedule(this.startXuanPaiTime, 1, this.XUANPAI_COUNT, 0);\r\n        \r\n    },\r\n\r\n    //点击选牌按钮,把指定的三张牌传给服务器\r\n    onXuanPaiButtonClick:function () {\r\n        var self = this;\r\n        this.isClick = true;\r\n        var dealComfirm = function(){\r\n            if (self.waitTimer <= 0) {\r\n                self.unschedule(self.startXuanPaiTime);\r\n            }\r\n            self.xuanPaiTipsLayer.active = false;\r\n        }\r\n\r\n        //发送选三张牌给服务器\r\n        var vCardSpList = this.getPlayerByPos(1).getComponent(\"PlayerCardLayer\").getThreeUpCradList()\r\n        \r\n        if (vCardSpList.length!=3) {\r\n            Resources.ShowToast(\"必须选择同花色的三张牌\")\r\n            return;\r\n        }\r\n        if ((GameCfg.getMjColor(vCardSpList[0])!=GameCfg.getMjColor(vCardSpList[1]))||(GameCfg.getMjColor(vCardSpList[0])!=GameCfg.getMjColor(vCardSpList[2])))\r\n        {\r\n            Resources.ShowToast(\"必须选择同花色的三张牌\")\r\n            return;\r\n        }\r\n        sendCMD.sendCMD_PO_Exchange(vCardSpList)\r\n        dealComfirm()     \r\n        //删除手牌中选择的那三张\r\n        this.getPlayerByPos(1).getComponent(\"PlayerCardLayer\").deleteThreeMjRefresh();\r\n\r\n        var node = this.getPlayerByPos(1);\r\n        var changeCardsNode = node.getChildByName(\"changecards\");\r\n        changeCardsNode.y =-200;\r\n        changeCardsNode.active = true;\r\n        changeCardsNode.runAction(cc.moveBy(0.5,0,195));\r\n    },\r\n\r\n    //刷新听牌显示\r\n    refreshTingCard: function () {\r\n\r\n        var vTingList = this.m_saveTingCardList;\r\n        if (!vTingList || vTingList.length == 0)\r\n            return;\r\n        var nTingCount = 0;\r\n        var vTingCard;\r\n        var vTingFan;\r\n        var vTingLeft;\r\n        for (var i = 0; i < vTingList.length; i++) {\r\n            if (this.m_nClickCardTing == vTingList[i].cbOutCard) {\r\n                nTingCount = vTingList[i].cbTingCount\r\n                vTingCard = vTingList[i].cbTingCard\r\n                vTingFan = vTingList[i].cbFan\r\n                vTingLeft = vTingList[i].cbLeftCount\r\n                break\r\n            }\r\n        }\r\n\r\n        //如果听牌数目大于0\r\n        if (nTingCount > 0 && this.listenCardLayer.active) {\r\n            var ListenCardLayer = this.listenCardLayer.getComponent(\"ListenCardLayer\");\r\n            ListenCardLayer.setlaiziValue(this.m_stSceneData.cbLaizi);\r\n            ListenCardLayer.init(vTingCard, vTingFan, vTingLeft)\r\n        }\r\n\r\n    },\r\n\r\n    judgeIsTingCard: function (event) {\r\n        var vCardList = event.data;\r\n        var vTingList = this.m_stSceneData.vTingList;\r\n        if (!vTingList || vTingList.length == 0)\r\n            return;\r\n        if (this.m_cbMyChair != this.m_stSceneData.cbWhosTurn) {\r\n            return;\r\n        }\r\n\r\n        var nTingCount = 0;\r\n        var vTingCard;\r\n        var vTingFan;\r\n        var vTingLeft;\r\n        for (var i = 0; i < vTingList.length; i++) {\r\n            if (vTingList[i] && vCardList.cardValue == vTingList[i].cbOutCard) {\r\n                nTingCount = vTingList[i].cbTingCount;\r\n                vTingCard = vTingList[i].cbTingCard;\r\n                vTingFan = vTingList[i].cbFan;\r\n                vTingLeft = vTingList[i].cbLeftCount;\r\n            }\r\n        }\r\n\r\n        if (nTingCount > 0) {\r\n            var ListenCardLayer = this.listenCardLayer.getComponent(\"ListenCardLayer\");\r\n            ListenCardLayer.setlaiziValue(this.m_stSceneData.cbLaizi);\r\n            ListenCardLayer.init(vTingCard, vTingFan, vTingLeft)\r\n            this.listenCardLayer.active = true;\r\n        }\r\n        else {\r\n\r\n            this.listenCardLayer.active = false;\r\n        }\r\n    },\r\n\r\n    //收到表情和快捷聊天的消息\r\n    onRecvTableChat: function (chat) {\r\n        var chatChair = -1;\r\n        var gamelib = this.getGameLib();\r\n        var tableUser = gamelib.getUser((chat._dwSpeaker % 0x10000));\r\n        if (!tableUser) {\r\n            return;     //无此用户\r\n        }\r\n\r\n        //发送聊天的椅子号\r\n        var iChair = tableUser.getUserChair();\r\n        if (iChair < 0 || iChair >= 4) {  //判定是否是无效的椅子号\r\n            return;\r\n        }\r\n\r\n        var playerNode = this.getPlayerByPos(this.PosFromChair(iChair))\r\n        if (playerNode.active == true) {\r\n            var stChat = {}\r\n            stChat.szNickname = tableUser.getUserName()\r\n            var sysHead = \"--:\"\r\n            var vipHead = \"v--:\"\r\n            var speakContent = chat.getChatMsg()\r\n            var szHead = speakContent.substr(0, 3)\r\n            var szHead2 = speakContent.substr(0, 4)\r\n            if (szHead == sysHead) {  //显示表情\r\n                var faceIndex = speakContent.substring(3);\r\n                var face = Number(faceIndex);\r\n                stChat.cbType = 0;\r\n                stChat.cbFace = face;\r\n                if (face >= 0 && face < require(\"Resources\").FACE_CHAT_MAX_NUM) {\r\n                    playerNode.getComponent(\"Player\").showChatFaceInfo(face);\r\n                }\r\n            }\r\n            else if (szHead2 == vipHead) {    //显示vip表情\r\n                var faceIndex = speakContent.substring(4);\r\n                var face = Number(faceIndex);\r\n            }\r\n            else {   //显示文字\r\n\r\n                playerNode.getComponent(\"Player\").showChatTextInfo(speakContent);\r\n                stChat.cbType = 2;\r\n                stChat.szChatContent = speakContent\r\n                var wordIndex = -1;\r\n                for (var i in Resources.QUICK_SEND_CHATS) {\r\n                    if (speakContent == Resources.QUICK_SEND_CHATS[i]) {\r\n                        wordIndex = i;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                var index = -1;\r\n                var effectFile = \"\";\r\n\r\n                var posY = [326, 280, 214, 234, 192, 118];\r\n                var moveTime = [1.5, 2.5, 2, 2.5, 1, 2];\r\n\r\n                for (var i = 0; i < 6; i++) {\r\n                    var posX = -640 + Math.random() * (-1920);\r\n                    this.showScrollWords(posX, posY[i], moveTime[i], i, wordIndex);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    //展示弹幕信息\r\n    showScrollWords: function (moveToX, moveToY, moveTime, index, wordIndex) {\r\n        wordIndex = parseInt(wordIndex);\r\n        var bgRandom = Math.random() * 10;\r\n\r\n        var winSize = cc.director.getWinSize();\r\n        var bgNode = new cc.Node();\r\n        bgNode.active = true;\r\n        var sprite = bgNode.addComponent(cc.Sprite);\r\n        //取深颜色背景\r\n        if (bgRandom <= 5) {\r\n            var frame = this.node.getComponent(\"DeskScene\").chatAtlas.getSpriteFrame(\"deepBg\");\r\n            sprite.spriteFrame = frame;\r\n        }\r\n        else {\r\n            var frame = this.node.getComponent(\"DeskScene\").chatAtlas.getSpriteFrame(\"shallowBg\")\r\n            sprite.spriteFrame = frame;\r\n        }\r\n\r\n        this.node.addChild(bgNode, 100);\r\n        bgNode.setScale(0.85);\r\n        bgNode.x = winSize.width / 2 + bgNode.getContentSize().width / 2 + 20;\r\n        bgNode.y = moveToY;\r\n\r\n        // cc.log(\"-------- bg create finish --------\");\r\n        wordIndex += 1;\r\n        var textWord = \"text_word\" + (wordIndex);\r\n        var wordsNode = new cc.Node();\r\n        wordsNode.active = true;\r\n        var wordsSprite = wordsNode.addComponent(cc.Sprite);\r\n        wordsSprite.spriteFrame = this.node.getComponent(\"DeskScene\").chatAtlas.getSpriteFrame(textWord)\r\n        wordsNode.x = 0;\r\n        wordsNode.y = 0;\r\n        bgNode.addChild(wordsNode);\r\n\r\n        if (index == 1 || index == 4) {\r\n            bgNode.setScale(0.7);\r\n        }\r\n        else if (index == 5) {\r\n            bgNode.setScale(1);\r\n            moveToX = -280;\r\n        }\r\n\r\n        var moveTo = cc.moveTo(moveTime, cc.p(moveToX, moveToY));\r\n        var delayTime = cc.delayTime(0.8);\r\n        var clean = cc.removeSelf();\r\n        var sequence = cc.sequence(moveTo, delayTime, clean);\r\n        bgNode.runAction(sequence);\r\n\r\n    },\r\n\r\n    //播放胡牌特效\r\n    playHuEffect: function (nChair, bIsZimo, onPlayEnd,nFangPaoChair) {\r\n\r\n        if (this.hupaiAssets.length <= 0) {\r\n            return;\r\n        }\r\n\r\n        var nPos = this.PosFromChair(nChair);\r\n        var nFangPaoPos = null;\r\n        var mjNode = null;\r\n        if (bIsZimo) {\r\n            // mjNode = this.getPlayerByPos(nPos).getComponent(\"PlayerCardLayer\").getLastHandCard();\r\n        }\r\n        else {\r\n            nFangPaoPos = this.PosFromChair(nFangPaoChair);\r\n            mjNode = this.getPlayerByPos(nFangPaoPos).getComponent(\"OutCardLayer\").getLastOutCard();\r\n        }\r\n\r\n        if(mjNode){\r\n            var offset = cc.p(0, 0)\r\n            if (bIsZimo && nPos == 1) {\r\n\r\n                //因为自己面前的牌的anchorPoint为cc.p(0, 0.5);\r\n                offset = cc.p(mjNode.getContentSize().width, 0);\r\n            }\r\n\r\n            var hupaiNode = new cc.Node();\r\n            this.node.addChild(hupaiNode, 100);\r\n\r\n            var convetPos = this.node.convertToNodeSpace(cc.p(mjNode.getPosition()));\r\n            hupaiNode.x = convetPos.x + offset.x / 2;\r\n            hupaiNode.y = convetPos.y + offset.y / 2;\r\n            hupaiNode.active = true;\r\n            var dragonDisplay = hupaiNode.addComponent(dragonBones.ArmatureDisplay);\r\n\r\n            for (var i in this.hupaiAssets) {\r\n                if (this.hupaiAssets[i] instanceof dragonBones.DragonBonesAsset) {\r\n                    dragonDisplay.dragonAsset = this.hupaiAssets[i];\r\n                }\r\n                if (this.hupaiAssets[i] instanceof dragonBones.DragonBonesAtlasAsset) {\r\n                    dragonDisplay.dragonAtlasAsset = this.hupaiAssets[i];\r\n                }\r\n            }\r\n\r\n            dragonDisplay.armatureName = 'armatureName';\r\n            dragonDisplay.playAnimation('Animation2');\r\n\r\n            this.m_hupaiActionmature = dragonDisplay;\r\n\r\n            var self = this;\r\n            var callback = () => {\r\n\r\n                hupaiNode.removeFromParent(true);\r\n                //点炮之后在我胡牌位置出现一张新的牌\r\n                self.getPlayerByPos(nPos).getComponent(\"HuCardLayer\").putHuMj(true);\r\n                if (onPlayEnd) {\r\n                    onPlayEnd();\r\n                }\r\n            };\r\n            this.m_hupaiActionmature.addEventListener(dragonBones.EventObject.COMPLETE, callback, this)\r\n        }\r\n    },\r\n\r\n    //上传游戏结果给微信服务器\r\n    reportResultToWx:function(){\r\n        var callBackFunc = function(success, data){\r\n            if (success)  {\r\n                HallResources.getInstance().removeLoading();\r\n                var jsonObject = JSON.parse(data)\r\n                console.log(\"-----------------WxFriendsScoreRank.aspx返回数据----------------------------\")\r\n                console.log(jsonObject)\r\n                var data = jsonObject.table[0]\r\n                var playerRankNum = data.RankNum;\r\n                var playerOpenID = data.OpenID\r\n                // var playerUserId = data.UserID\r\n                var playerScore = data.Score\r\n\t\t\t\t// 这里去将用户数据上报（排行榜要用）\r\n                var kvDataList = new Array();\r\n                kvDataList.push(\r\n                {\r\n                    key: \"playerScore\",\r\n                    value:\"\" + playerScore\r\n                });\r\n                wx.setUserCloudStorage({\r\n                    KVDataList: kvDataList\r\n                })\r\n            }\r\n        };\r\n\r\n        var wxUserInfo = WeixinManager.getInstance().userInfo;\r\n        if(wxUserInfo) {\r\n            var myOpenId = wxUserInfo.openid;\r\n            require('HallWebRequest').getInstance().getPlayerData(myOpenId,callBackFunc);\r\n        }\r\n    },\r\n\r\n    //游戏结束\r\n    gameOver: function () {\r\n\r\n        this.setIsDirectionVis(0);\r\n\r\n        this.stopTimer();\r\n\r\n        this.listenCardLayer.active = false;\r\n\r\n        this.moreSettingLayer.getComponent(\"MoreSettingLayer\").setLeaveBtnEnabled(true);\r\n        this.moreSettingLayer.getComponent(\"MoreSettingLayer\").setChangedDeskBtnEnabled(true);\r\n\r\n        this.node.getChildByName(\"cancel_robot\").active = false;\r\n\r\n        this.node.getChildByName(\"laizi\").active = false;\r\n\r\n        for (var i = 1; i <= GameDefs.PLAYER_COUNT; i++) {\r\n            var stPlayer = this.m_stSceneData.players[i];\r\n            this.getPlayerByPos(i).getComponent('Player').setQueWanHeadIconSpIsVis(false,0);\r\n            // for (var j = 0; j < stPlayer.showCardSuits; j++) {\r\n            //     var weaveItem = stPlayer.showCardSuits[j];\r\n            //     if (weaveItem.cbWeaveKind == GameDefs.WeaveType.MingGang) {\r\n            //         var stPlayer2 = this.m_stSceneData.players[weaveItem.cbChair + 1];\r\n            //         var tWeaveItem = {}\r\n            //         tWeaveItem.cbWeaveKind = GameDefs.WeaveType.FangGang;\r\n            //         console.log(\"获得stPlayer2.showCardSuits的长度\"+stPlayer2.showCardSuits.length);\r\n            //         stPlayer2.showCardSuits[stPlayer2.showCardSuits.length] = tWeaveItem;\r\n            //     }\r\n            // }\r\n        }\r\n        var stWinStruct = this.m_stSceneData.stWinStruct\r\n\r\n        // if (stWinStruct.cbEndType == GameDefs.EndType.Fangpao) {  //放炮\r\n        //     var nPos = this.PosFromChair(stWinStruct.cbFangpaoChair);\r\n        //     this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_2FanPao, nPos);\r\n        //     for (var cbChair = 0; cbChair < GameDefs.PLAYER_COUNT; cbChair++) {\r\n        //         if (stWinStruct.cbWinChair >= 0 && stWinStruct.cbWinChair < GameDefs.PLAYER_COUNT) {\r\n        //             var nPos = this.PosFromChair(stWinStruct.cbWinChair);\r\n        //             this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_2hu, nPos);\r\n        //             Resources.playHuEffect(this.getPlayerByPos(nPos).getComponent(\"Player\").getSex(), 0);\r\n\r\n        //             if (stWinStruct.cbWinChair == this.m_cbMyChair) {\r\n        //                 Resources.playCommonEffect(\"shootingwin.mp3\");\r\n        //             }\r\n        //             else {\r\n        //                 Resources.playCommonEffect(\"shootinglost.mp3\");\r\n        //             }\r\n        //         }\r\n        //     }\r\n\r\n        //     Resources.playCommonEffect(\"effectword.mp3\");\r\n        // }\r\n        // else if (stWinStruct.cbEndType == GameDefs.EndType.Zimo) {    //自摸\r\n        //     Resources.playCommonEffect(\"effectword.mp3\");\r\n        //     var nPos = this.PosFromChair(stWinStruct.cbWinChair);\r\n        //     this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_2ZiMo, nPos);\r\n\r\n        //     var randIndex = Math.floor(Math.random() * 2);\r\n        //     Resources.PlayZiMoEffect(this.getPlayerByPos(nPos).getComponent(\"Player\").getSex(), randIndex);\r\n\r\n        //     if (stWinStruct.cbWinChair == this.m_cbMyChair) {\r\n        //         Resources.playCommonEffect(\"zimowin.mp3\");\r\n        //     }\r\n        //     else {\r\n        //         Resources.playCommonEffect(\"zimolost.mp3\");\r\n        //     }\r\n        // }\r\n        // else if (stWinStruct.cbEndType == GameDefs.EndType.Liuju) {   //流局\r\n\r\n        //     if (this.m_stSceneData.cbBanker >= 0 && this.m_stSceneData.cbBanker <= 3) {\r\n        //         var nPos = this.PosFromChair(this.m_stSceneData.cbBanker);\r\n        //         this.getPlayerByPos(nPos).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_2LiuJu, nPos);\r\n        //     }\r\n        //     else {\r\n        //         this.getPlayerByPos(1).getComponent('Player').playOperateEffects(GameCfg.EffectList.No_2LiuJu, 1);\r\n        //     }\r\n\r\n        //     Resources.playCommonEffect(\"smellvillage.mp3\");\r\n        // }\r\n        // else if (stWinStruct.cbEndType == GameDefs.EndType.Jiesan) {  //解散\r\n\r\n        // }\r\n\r\n        var self = this;\r\n\r\n\r\n        var playHuEffectEnd = function () {\r\n\r\n            // var bIsLiuju = self.m_stSceneData.stWinStruct.cbEndType == GameDefs.EndType.Liuju;\r\n            var cbHuType = self.m_stSceneData.stWinStruct.cbHuType;\r\n            // var cbFan = (bIsLiuju) ? 0 : self.m_stSceneData.stWinStruct.cbFan[self.m_stSceneData.stWinStruct.cbWinChair];\r\n            // var laiyouCardValue;\r\n            // var cbLastIndex = self.m_stSceneData.cbLastIndex;\r\n            // var MJWall = self.m_stSceneData.stWinStruct.cbWall;\r\n            // var nMjSize = self.m_stSceneData.stWinStruct.cbWallCount;\r\n\r\n            // if(nMjSize > 0){\r\n            //     var bIsWallLastOne = ((cbLastIndex % 2 != 0) ? true : false);\r\n            //     if (bIsWallLastOne) {\r\n            //         laiyouCardValue = MJWall[nMjSize - 1];\r\n            //     }\r\n            //     else {\r\n            //         laiyouCardValue = MJWall[nMjSize - 2];\r\n            //     }\r\n\r\n            // for (var i = 0; i < GameDefs.PLAYER_COUNT; i++) {\r\n            //     self.m_stSceneData.stWinStruct.nScore[i] += self.m_roomInfo.nCost;\r\n            // }\r\n    \r\n            for (var i = 0; i < GameDefs.PLAYER_COUNT; i++) {\r\n                for (var j = 0; j < self.m_stSceneData.players[i].nWeaveCount; j++) {\r\n                    var weaveItem = self.m_stSceneData.players[i].showCardSuits[j];\r\n                    if (weaveItem.cbWeaveKind == GameDefs.WeaveType.MingGang) {\r\n                        var stPlayer = self.m_stSceneData.players[weaveItem.cbChair];\r\n                        var tWeaveItem = {};\r\n                        tWeaveItem.cbWeaveKind = GameDefs.WeaveType.FangGang;\r\n                        stPlayer.showCardSuits.push(tWeaveItem);\r\n                    }\r\n                }\r\n            }\r\n    \r\n            var playersName = new Array();\r\n    \r\n            var playerAvatorUrls = new Array();\r\n            for (var i = 0; i < GameDefs.PLAYER_COUNT; i++) {\r\n                var player = self.getPlayerByPos(self.PosFromChair(i)).getComponent('Player');\r\n                var name = player.getPlayerName();\r\n                var faceUrl = player.getFaceUrl();\r\n                playersName.push(name);\r\n                playerAvatorUrls.push(faceUrl);\r\n            }\r\n\r\n\r\n            var showDetailResult = function () {\r\n                self.showResultLayer();\r\n            }\r\n            // }\r\n\r\n            if(self.getIsPrivateRoom()){\r\n\r\n                var httpCallback = function(success, data){\r\n                    require('HallResources').getInstance().removeLoading();\r\n                    if(success){\r\n                        var jsonObject = JSON.parse(data);\r\n                        var myselfWinOrLoseScore = stWinStruct.nScore[self.m_cbMyChair];\r\n                        var matchGameOverLayer = self.matchGameOverLayer.getComponent(\"MatchGameOverLayer\");\r\n                        var matchLevel = self.m_nNewLevel ? self.m_nNewLevel : self.m_roomSetInfo.cbGradeIndex[self.m_cbMyChair]\r\n                        matchGameOverLayer.init(bIsLiuju, cbHuType, cbFan, laiyouCardValue, showDetailResult, matchLevel, self.m_pMyself.getScore(), myselfWinOrLoseScore, jsonObject.ContinuityWin);\r\n                        self.matchGameOverLayer.active = true;\r\n\r\n                        //表示升段了\r\n                        if(self.m_nNewLevel){\r\n                            var upgradelevelLayer = self.levelUpgradeLayer.getComponent(\"UpgradeLevelLayer\");\r\n                            upgradelevelLayer.init(self.m_nNewLevel, self.m_pMyself.getScore(), myselfWinOrLoseScore);\r\n                            self.levelUpgradeLayer.active = true;\r\n                        }\r\n\r\n                        if(stWinStruct.nScore[self.m_cbMyChair] < 0){\r\n\r\n                            var showProtectScoreLayer = function(){\r\n                                var protectScoreLayer =  self.protectScoreLayer.getComponent(\"ProtectScoreLayer\");\r\n                                protectScoreLayer.init(self.m_roomSetInfo.szBatchID, -1);\r\n                                self.protectScoreLayer.active = true;\r\n                            };\r\n\r\n                            TSCommon.performWithDelay(self, showProtectScoreLayer, 1);                   \r\n                        }\r\n                    }\r\n                }\r\n                require('HallWebRequest').getInstance().getContinuityWinGetInfo(httpCallback)\r\n            }\r\n            else{\r\n                console.log(\"进入结算-------------\")\r\n                var gameOverLayer = self.gameOverLayer.getComponent(\"XueLiuGameOverLayer\");\r\n                gameOverLayer.init(self.m_stSceneData.stWinStruct, self.m_stSceneData.players, playersName, playerAvatorUrls,self.m_cbMyChair,showDetailResult);\r\n                self.gameOverLayer.active = true;\r\n            }  \r\n        };\r\n\r\n        var chaDaJiaoAndHuaZhu = function(){\r\n            for (var i = 0; i < GameDefs.PLAYER_COUNT; i++) {\r\n                var vSinleScore = stWinStruct.stSingleScore[i]\r\n                var nChaDaJiao = 0\r\n                var nChaHuaZhu = 0\r\n                var nScore = 0\r\n                for (var j = 0; j < vSinleScore.length; j++) {\r\n                    var stSinleScore = vSinleScore[j];\r\n                    if (stSinleScore.cbScoreType == GameDefs.scoreType.scoreChaDaJiao){\r\n                        nChaDaJiao = 1;\r\n                        nScore = stSinleScore.nScore;\r\n                        if (nScore >=0){\r\n                            nChaDaJiao = 0;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (stSinleScore.cbScoreType == GameDefs.scoreType.ScoreChaHuaZhu){\r\n                        nChaHuaZhu = 1;\r\n                        nScore = stSinleScore.nScore;\r\n                        if (nScore >=0){\r\n                            nChaHuaZhu = 0;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                var player = self.getPlayerByPos(self.PosFromChair(i-1)).getComponent('Player');\r\n                if (nChaDaJiao== 1) \r\n                    player.setChaDaJiaoSpIsVis(true,8)\r\n                else if (nChaHuaZhu==1) \r\n                    player.setChaDaJiaoSpIsVis(true,9)\r\n                if (nScore!=0) \r\n                    player.setTempChangeGold(nScore,nil,true)\r\n                \r\n            }\r\n        };\r\n\r\n        var gameOverCallback = function () {\r\n\r\n            var isSetting = new Array();\r\n            for (var cbChair = 0; cbChair < GameDefs.PLAYER_COUNT; cbChair++) {\r\n                var nPos = self.PosFromChair(cbChair);\r\n                if (!isSetting[nPos]) {\r\n                    if (self.getPlayerByPos(nPos).getComponent('Player').getIsValidPlayer()) {\r\n                        self.getPlayerByPos(nPos).getComponent('Player').setIsWinner(false);\r\n                        if (nPos == self.PosFromChair(stWinStruct.cbWinChair) && stWinStruct.cbEndType != GameDefs.EndType.Liuju) {\r\n                            self.getPlayerByPos(nPos).getComponent('Player').setIsWinner(true);\r\n                        }\r\n                        self.getPlayerByPos(nPos).getComponent('Player').setLastGoldOnGameOver(stWinStruct.nFinalScore[cbChair] + self.m_roomInfo.nCost);\r\n                        self.getPlayerByPos(nPos).getComponent('Player').gameOver();\r\n                    }\r\n                    isSetting[nPos] = true;\r\n                }\r\n            }\r\n\r\n            // if (stWinStruct.cbEndType == GameDefs.EndType.Liuju) {\r\n                playHuEffectEnd();\r\n            // }\r\n            // else if (stWinStruct.cbEndType == GameDefs.EndType.Fangpao) {\r\n            //     self.playHuEffect(stWinStruct.cbFangpaoChair, false, playHuEffectEnd)\r\n            // }\r\n            // else if (stWinStruct.cbEndType == GameDefs.EndType.Zimo) {\r\n            //     self.playHuEffect(stWinStruct.cbWinChair, true, playHuEffectEnd)\r\n            // }\r\n        }\r\n        \r\n        TSCommon.performWithDelay(this, chaDaJiaoAndHuaZhu, 0.1);\r\n        TSCommon.performWithDelay(this, gameOverCallback, 1);\r\n\r\n    },\r\n\r\n    //展示游戏结算界面\r\n    showResultLayer: function () {\r\n\r\n        \r\n        var playersName = new Array();\r\n    \r\n        var playerAvatorUrls = new Array();\r\n        for (var i = 0; i < GameDefs.PLAYER_COUNT; i++) {\r\n            var player = this.getPlayerByPos(this.PosFromChair(i)).getComponent('Player');\r\n            var name = player.getPlayerName();\r\n            var faceUrl = player.getFaceUrl();\r\n            playersName.push(name);\r\n            playerAvatorUrls.push(faceUrl);\r\n        }\r\n        var leftTime; \r\n        if(this.getIsPrivateRoom()){\r\n            leftTime = this.matchGameOverLayer.getComponent(\"MatchGameOverLayer\").getLeftLeaveTime();\r\n        }\r\n        else{\r\n            leftTime = this.gameOverLayer.getComponent(\"GameOverLayer\").getLeftLeaveTime();\r\n        }\r\n        \r\n        var gameOverView = this.gameResultLayer.getComponent(\"GameResultLayer\");\r\n        gameOverView.setWinStructInfo(this.m_stSceneData.stWinStruct, this.m_stSceneData.players, playersName, playerAvatorUrls, this.node.getComponent('MjResourceMgr').mj1_face_dao,\r\n            this.node.getComponent('MjResourceMgr').mj1_face_li, this.m_roomInfo, this.m_stSceneData.cbLaizi, leftTime);\r\n        gameOverView.loadUI();\r\n        this.gameResultLayer.active = true;\r\n    },\r\n\r\n\r\n    //游戏重新开始\r\n    onGameReStart: function (event) {\r\n        var data = event.data;\r\n        var bIsReady = data.isReady;\r\n        this.m_nNewLevel = null;\r\n        this.m_playerStatus = this.m_playerStatus || new Array();\r\n\r\n        // 清除桌面上的东西 然后重新部分初始化\r\n        for (var nPos = 1; nPos <= GameDefs.PLAYER_COUNT; nPos++) {\r\n            if (this.getPlayerByPos(nPos).getComponent(\"Player\").getIsValidPlayer()) {\r\n                this.getPlayerByPos(nPos).getComponent(\"Player\").cleanPlayers();\r\n                \r\n                if(bIsReady){   //是否需要准备  需要准备则说明是游戏结束后点击开始按钮  不需要准备则说明只是换桌\r\n                    if (this.m_playerStatus[nPos]) {\r\n                        this.getPlayerByPos(nPos).getComponent(\"Player\").setIsReady(true);\r\n                    }\r\n                    else {\r\n                        if(nPos != 1){\r\n                            this.getPlayerByPos(nPos).getComponent(\"Player\").showLeaveTimer();\r\n                        }                    \r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        this.gameOverLayer.getComponent(\"GameOverLayer\").stopLeftTimer();\r\n        this.matchGameOverLayer.getComponent(\"MatchGameOverLayer\").stopLeftTimer();\r\n        this.gameResultLayer.getComponent(\"GameResultLayer\").stopLeaveTimer();\r\n\r\n        this.gameOverLayer.active = false;\r\n        this.matchGameOverLayer.active = false;\r\n        this.gameResultLayer.active = false;\r\n\r\n        var nGold = this.m_pMyself.getGold();\r\n        var pCurrentRoom = this.getGameLib().getCurrentGameRoom()\r\n        if(bIsReady){\r\n            if ((pCurrentRoom && nGold >= pCurrentRoom.dwMinGold) || this.getIsPrivateRoom()) {\r\n                sendCMD.sendCMD_PO_RESTART();\r\n                this.getPlayerByPos(1).getComponent(\"Player\").stopLeaveTimer();\r\n            }\r\n            else {\r\n                this.showGoldNotEnoughTips();\r\n    \r\n                var self = this;\r\n    \r\n                this.node.getComponent(\"GameButtonLayer\").setStartBtnVisible(true);\r\n                this.getPlayerByPos(1).getComponent(\"Player\").showLeaveTimer();\r\n    \r\n                var startClickedCallback = function(){\r\n                    if(pCurrentRoom && nGold < pCurrentRoom.dwMinGold){\r\n                        self.showGoldNotEnoughTips();\r\n                    }\r\n                    else{\r\n                        self.getPlayerByPos(1).getComponent(\"Player\").stopLeaveTimer();\r\n                        self.getPlayerByPos(1).getComponent(\"Player\").hideLeaveTimer();\r\n                    }\r\n                };\r\n    \r\n                this.node.getComponent(\"GameButtonLayer\").setStartClickBtnCallBack(startClickedCallback);\r\n            }\r\n        }\r\n        else{\r\n\r\n            this.getPlayerByPos(1).getComponent(\"Player\").setIsReady(false);\r\n            var gamebuttonLayer = this.node.getComponent('GameButtonLayer');\r\n            gamebuttonLayer.setStartBtnVisible(true);\r\n        }\r\n        \r\n    },\r\n\r\n    showMallLayer:function(){\r\n        this.mallLayer.active = true;\r\n        this.mallLayer.getComponent(\"MallLayer\").showGoldNode();\r\n    },\r\n\r\n\r\n    //弹出金币不足的提示\r\n    showGoldNotEnoughTips: function () {\r\n\r\n        var self = this;\r\n        var getReward = function (leftReward) {\r\n\r\n            //如果剩余奖励\r\n            if (leftReward) {\r\n                self.showRuptRewardTips();\r\n            }\r\n            else {\r\n                var goldNotEnoughLayer = cc.instantiate(self.commonTipsPrefab);\r\n                var data = {};\r\n                data.titleIcon = \"texture/commonRes/frameTips/coinNoEnoughTitle\";\r\n                data.msg = \"您的金币已不足以继续游戏，请前往商城购买。\";\r\n                data.showIcon = \"texture/commonRes/frameTips/jinbi\";\r\n                data.buttonIcon1 = \"texture/commonRes/frameTips/goToMallBtn\";\r\n                data.button1Func = function () {\r\n                    goldNotEnoughLayer.getComponent(\"commonTipsLayer\").clickCloseBtn();\r\n                    self.showMallLayer();\r\n                };\r\n                goldNotEnoughLayer.getComponent(\"commonTipsLayer\").initData(data);\r\n                goldNotEnoughLayer.setPosition(cc.p(0, 0));\r\n                self.node.addChild(goldNotEnoughLayer);\r\n            }\r\n        }\r\n\r\n        this.requestRuptRewardInfo(getReward)\r\n    },\r\n\r\n    //弹出破产奖励提示界面\r\n    showRuptRewardTips: function () {\r\n        var self = this;\r\n        var ruptRewardLayer = cc.instantiate(this.commonTipsPrefab);\r\n        var data = {};\r\n        data.titleIcon = \"texture/commonRes/frameTips/friendHelpTitle\";\r\n        data.msg = \"不好了！破产了！快点请求好友接济！分享给任意好友，立即领取\" + this.bankruptAwardAmount + \"金币！\";\r\n        data.showIcon = \"texture/commonRes/frameTips/jinbi\";\r\n        data.showIconLabel = \"*\" + this.bankruptAwardAmount;\r\n        data.buttonIcon2 = \"texture/commonRes/frameTips/mallBuyBtn\";\r\n        data.womenThink = \"不好了，破产了！快点请求好友接济！\\n分享给任意好友，立即领取\" + this.bankruptAwardAmount +\"金币！\";\r\n        data.button2Func = function () {\r\n            ruptRewardLayer.getComponent(\"commonTipsLayer\").clickCloseBtn();\r\n            self.showMallLayer();\r\n        };\r\n        data.buttonIcon3 = \"texture/commonRes/frameTips/quickShareBtn\";\r\n        data.button3Func = function () {\r\n            ruptRewardLayer.getComponent(\"commonTipsLayer\").clickCloseBtn();\r\n            \r\n            if (cc.sys.browserType == \"mqqbrowser\" || \"wechatgame\" == cc.sys.browserType) {\r\n\r\n                //主动拉起分享接口\r\n                wx.shareAppMessage({\r\n\r\n                    title: \"不好了！我在晃晃麻将里裤衩都快输掉了，求接济啊！\",\r\n                    imageUrl: HallResources.rupShareImgUrl,\r\n                    success(res) {\r\n                        console.log(\"转发成功!!!\")\r\n                        self.getRuptReward();\r\n                    },\r\n                    fail(res) {\r\n                        console.log(\"转发失败!!!\")\r\n                    }\r\n                })\r\n            }\r\n\r\n        };\r\n        data.otherText1 = \"今日次数：\";\r\n        data.otherText2 = \"\" + (this.totalAwardTimes - this.curAwardTimes);\r\n        data.otherText3 = \"/\" + this.totalAwardTimes;\r\n\r\n        ruptRewardLayer.getComponent(\"commonTipsLayer\").initData(data);\r\n        ruptRewardLayer.setPosition(cc.p(0, 0));\r\n        this.node.addChild(ruptRewardLayer);\r\n    },\r\n\r\n\r\n\r\n    //请求破产的奖励信息\r\n    requestRuptRewardInfo: function (onEnd) {\r\n        var self = this;\r\n        var callBackFunc = function (success, data) {\r\n            require('HallResources').getInstance().removeLoading();\r\n            if (success) {                \r\n                var jsonObject = JSON.parse(data)\r\n                self.totalAwardTimes = jsonObject.TotalAwardTimes;\r\n                self.bankruptAwardAmount = jsonObject.AwardAmount;\r\n                self.curAwardTimes = jsonObject.CurAwardTimes;\r\n                onEnd(self.curAwardTimes < self.totalAwardTimes);\r\n            }\r\n        };\r\n        require('HallWebRequest').getInstance().getBankruptInfo(callBackFunc);\r\n    },\r\n\r\n    //获取破产奖励\r\n    getRuptReward:function(){\r\n        var self = this;\r\n        var callBackFunc = function(success,data){\r\n            require('HallResources').getInstance().removeLoading();\r\n            if (success) {\r\n                var jsonObject = JSON.parse(data)\r\n                var backMsg = jsonObject.RetCode;  //(0=失败 1=领取成功 11=密码错误 12=已达到领取次数上限)\r\n                \r\n                if (backMsg == 0){\r\n                    Resources.ShowToast(\"领取失败\");\r\n                }\r\n                else if (backMsg == 1){\r\n                    // var nPreGold = require(\"HallControl\").getInstance().getPublicUserInfo().nGold\r\n                    // var nNewGold = parseInt(self.bankruptAwardAmount) + parseInt(nPreGold);\r\n                    // require(\"HallControl\").getInstance().getPublicUserInfo().nGold = nNewGold\r\n                    // self.getPlayerByPos(1).getComponent(\"Player\").refreshGold(nNewGold);\r\n                    self.getGameLib().refreshGold();\r\n                }\r\n                else if (backMsg == 11){\r\n                    Resources.ShowToast(\"密码错误\");\r\n                }\r\n                else if (backMsg == 12){\r\n                    Resources.ShowToast(\"已达到领取次数上限\");\r\n                }\r\n            }\r\n        };\r\n        require('HallWebRequest').getInstance().getBankruptReward(callBackFunc);\r\n    },\r\n\r\n    //update\r\n    update: function (dt) {\r\n\r\n    },\r\n});\r\n"]}