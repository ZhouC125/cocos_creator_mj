{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\activity\\dailyLogin/assets\\scripts\\hall\\activity\\dailyLogin\\dailyLoginLayer.js"],"names":["HallResources","require","dailyLoginLayer","cc","Class","extends","Component","properties","bg","default","type","Node","hasGetPrefab","Prefab","todayBtnPrefab","tomorrowPrefab","onLoad","node","on","EventType","TOUCH_START","onTouch","event","poisition","touch","getLocation","locationInNode","convertToNodeSpace","s","getContentSize","rect","width","height","rectContainsPoint","closeAndChangeScaleAction","initData","data","bolClick","removeAllChildren","todayDay","i","length","hassign","item","instantiate","parent","getComponent","x","y","setPosition","clickGetRewardBtn","start","self","callBackFunc","bolSuccess","getInstance","removeLoading","jsonObject","JSON","parse","console","log","backData","table","allData","moneytype","MoneyType","retcode","RetCode","wantamount","WantAmount","goldData","getPublicUserInfo","nGold","parseInt","TSCommon","dispatchEvent","onGoldOrDiamondChanged","onShowFlyMessage","onClearDailyLoginRedPoint","sendDailyCheck","action1","scaleTo","action2","fadeOut","action3","callFunc","active","onChangeShadow","sequence","runAction","clickCloseBtn","playCloseEffect","module","exports"],"mappings":"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","file":"dailyLoginLayer.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\scripts\\hall\\activity\\dailyLogin","sourcesContent":["import {TSCommon} from \"TSCommon\";\r\nvar HallResources = require(\"HallResources\");\r\nvar dailyLoginLayer = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        bg: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        hasGetPrefab:{\r\n            default: null,\r\n            type: cc.Prefab,\r\n        },\r\n        todayBtnPrefab:{\r\n            default: null,\r\n            type: cc.Prefab,\r\n        },\r\n        tomorrowPrefab:{\r\n            default: null,\r\n            type: cc.Prefab,\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad: function () {\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouch, this);\r\n    },\r\n\r\n    onTouch: function (event) {\r\n        var poisition = event.touch.getLocation();\r\n        var locationInNode = this.bg.convertToNodeSpace(poisition);\r\n        var s = this.bg.getContentSize();\r\n        var rect = cc.rect(0, 0, s.width, s.height);\r\n        if (cc.rectContainsPoint(rect, locationInNode)) {\r\n            // this.node.active = true;\r\n        }\r\n        else {\r\n            // this.node.active = false;\r\n            this.closeAndChangeScaleAction();\r\n        }\r\n    },\r\n\r\n    initData:function(data,bolClick)\r\n    {\r\n        this.bg.removeAllChildren();\r\n        var todayDay = 0;\r\n        for(var i=0; i<data.length; i++){\r\n            if (data[i].hassign == 0){\r\n                todayDay = i;\r\n                break;\r\n            } \r\n        }\r\n        for(var i=0; i<todayDay; i++){\r\n            var item = cc.instantiate(this.hasGetPrefab);\r\n            item.parent = this.bg;\r\n            item.getComponent(\"dailyHasGetItem\").initData(data[i]);      \r\n            var x = -410 + i*138;\r\n            var y = -30; \r\n            item.setPosition(x,y);\r\n        }\r\n        \r\n        if (bolClick == 0){\r\n            todayDay = todayDay - 1;\r\n        }\r\n        else{\r\n            var item = cc.instantiate(this.todayBtnPrefab);\r\n            item.parent = this.bg;\r\n            item.getComponent(\"dailyGetButtonItem\").initData(data[i],this.clickGetRewardBtn);      \r\n            var x = 230 + todayDay*138;\r\n            var y = 270; \r\n            item.setPosition(x,y);\r\n        }\r\n        \r\n\r\n        for(var i=todayDay+1; i<data.length; i++){\r\n            var item = cc.instantiate(this.tomorrowPrefab);\r\n            item.parent = this.bg;\r\n            item.getComponent(\"dailyTomorrowItem\").initData(data[i]);      \r\n            var x = -410 + i*138;\r\n            var y = -30; \r\n            item.setPosition(x,y);\r\n        }\r\n    },\r\n\r\n    start: function () {\r\n\r\n    },\r\n\r\n    clickGetRewardBtn:function (){\r\n        var self = this;\r\n        var callBackFunc = function(bolSuccess,data){\r\n            if (bolSuccess) {\r\n                require('HallResources').getInstance().removeLoading();\r\n                // var XmlToJson = require('XmlToJson');\r\n                // var xmlToJson = new XmlToJson();\r\n                // var jsonData = JSON.stringify(xmlToJson.parse(data));\r\n                // var jsonObject = JSON.parse(jsonData)\r\n                var jsonObject = JSON.parse(data)\r\n                console.log(\"-----------------DailySignInfo.aspx返回数据----------------------------\")\r\n                console.log(jsonObject)\r\n                var backData = jsonObject.table[0];\r\n                var allData = [];\r\n                allData.moneytype = backData.MoneyType;\r\n                allData.retcode = backData.RetCode;\r\n                allData.wantamount = backData.WantAmount;\r\n                if (allData.retcode == 1){\r\n                    // self.node.parent.parent.active = false;\r\n                    self.node.parent.parent.getComponent(\"dailyLoginLayer\").closeAndChangeScaleAction();\r\n                    var goldData = require(\"HallControl\").getInstance().getPublicUserInfo().nGold\r\n                    require(\"HallControl\").getInstance().getPublicUserInfo().nGold = parseInt(allData.wantamount) + parseInt(goldData);\r\n\r\n                    TSCommon.dispatchEvent(HallResources.onGoldOrDiamondChanged,true);\r\n                    TSCommon.dispatchEvent(HallResources.onShowFlyMessage,[\"+\"+allData.wantamount,\"texture/hallRes/roomInfo/gold\"]);\r\n                    TSCommon.dispatchEvent(HallResources.onClearDailyLoginRedPoint,true);\r\n                }\r\n                else if(allData.retcode == 11) {\r\n                    console.log(\"身份验证不通过\");\r\n                }\r\n                else if(allData.retcode == 12) {\r\n                    console.log(\"今天已经签到过\");\r\n                }\r\n                else if(allData.retcode == 13) {\r\n                    console.log(\"签到错误\");\r\n                }\r\n            \r\n               \r\n            }\r\n        };\r\n        require('HallWebRequest').getInstance().sendDailyCheck(callBackFunc);\r\n    },\r\n\r\n    closeAndChangeScaleAction(){\r\n        var self = this;\r\n        // self.node.active = false;\r\n        var action1 = cc.scaleTo(0.2, 0.3, 0.3);\r\n        var action2 =cc.fadeOut(0.01);\r\n        \r\n        var action3 = cc.callFunc(function(){\r\n            self.node.active = false;\r\n            \r\n            TSCommon.dispatchEvent(HallResources.onChangeShadow,false);\r\n        });\r\n        var sequence = cc.sequence(action1, action2, action3);\r\n        this.node.runAction(sequence);\r\n    },\r\n\r\n\r\n    clickCloseBtn: function () {\r\n        HallResources.getInstance().playCloseEffect();\r\n        // this.node.active = false;\r\n        this.closeAndChangeScaleAction();\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n\r\nmodule.exports = dailyLoginLayer;"]}