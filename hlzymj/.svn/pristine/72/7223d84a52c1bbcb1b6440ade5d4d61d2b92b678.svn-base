{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\hall/assets\\scripts\\hall\\UserInfoLayer.js"],"names":["HallResources","require","UserInfoLayer","cc","Class","extends","Component","properties","bg","default","type","Node","headIcon","Sprite","nameText","Label","id","totalMatch","highestWinningStreak","winningrate","playerId","playerName","onLoad","self","node","on","EventType","TOUCH_START","onTouch","publicUserInfo","getInstance","getPublicUserInfo","string","userDBID","nickName","weixinUserInfo","WeixinManager","userInfo","avatarUrl","imgurl","loader","load","err","texture","spriteFrame","SpriteFrame","event","poisition","touch","getLocation","locationInNode","convertToNodeSpace","s","getContentSize","rect","width","height","rectContainsPoint","stopPropagation","closeAndChangeScaleAction","start","action1","scaleTo","action2","fadeOut","action3","callFunc","active","TSCommon","dispatchEvent","onChangeShadow","sequence","runAction","clickCloseBtn","playCloseEffect","initData","totalCount","continueWinCount","winRate","clickShowRankBtn","parent","getComponent","onClicShrinkBtn","module","exports"],"mappings":"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","file":"UserInfoLayer.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\hall","sourcesContent":["import {WeixinManager} from \"../hall/weixin/WeixinManager\";\r\nimport {TSCommon} from \"TSCommon\";\r\nvar HallResources = require(\"HallResources\");\r\nvar UserInfoLayer = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        bg: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        headIcon: {\r\n            default: null,\r\n            type: cc.Sprite\r\n        },\r\n\r\n        nameText: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        id: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        totalMatch: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        highestWinningStreak: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        winningrate: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        playerId:{\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n        playerName:{\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad: function () {\r\n        var self = this;\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouch, this);\r\n        var publicUserInfo = require(\"HallControl\").getInstance().getPublicUserInfo();\r\n        this.playerId.string = \"ID：\"+publicUserInfo.userDBID;\r\n        this.playerName.string = \"昵称：\"+publicUserInfo.nickName;\r\n\r\n       //if(cc.sys.browserType == \"mqqbrowser\" || \"wechatgame\" == cc.sys.browserType){\r\n            var weixinUserInfo = WeixinManager.getInstance().userInfo;\r\n            if(weixinUserInfo && weixinUserInfo.avatarUrl){\r\n                var imgurl=weixinUserInfo.avatarUrl+\"?aaa=aa.jpg\";\r\n                cc.loader.load(imgurl, function(err, texture){\r\n                    self.headIcon.spriteFrame = new cc.SpriteFrame(texture);\r\n                    // self.headIcon.node.setScale(0.9);\r\n                \r\n                });\r\n            }\r\n        },\r\n   \r\n   // },\r\n\r\n    onTouch: function (event) {\r\n        var poisition = event.touch.getLocation();\r\n        var locationInNode = this.bg.convertToNodeSpace(poisition);\r\n        var s = this.bg.getContentSize();\r\n        var rect = cc.rect(0, 0, s.width, s.height);\r\n        if (cc.rectContainsPoint(rect, locationInNode)) {\r\n            // this.node.active = true;\r\n        }\r\n        else {\r\n            event.stopPropagation();\r\n            // this.node.active = false;\r\n            this.closeAndChangeScaleAction();\r\n        }\r\n    },\r\n\r\n    start: function () {\r\n\r\n    },\r\n\r\n    closeAndChangeScaleAction(){\r\n        var self = this;\r\n        // self.node.active = false;\r\n        var action1 = cc.scaleTo(0.2, 0.3, 0.3);\r\n        var action2 =cc.fadeOut(0.01);\r\n        \r\n        var action3 = cc.callFunc(function(){\r\n            self.node.active = false;\r\n            TSCommon.dispatchEvent(HallResources.onChangeShadow,false);\r\n        });\r\n        var sequence = cc.sequence(action1, action2, action3);\r\n        this.node.runAction(sequence);\r\n    },\r\n\r\n    clickCloseBtn: function () {\r\n        HallResources.getInstance().playCloseEffect();\r\n        this.closeAndChangeScaleAction();\r\n        // this.node.active = false;\r\n    },\r\n\r\n    initData: function (totalCount,continueWinCount,winRate) {\r\n        this.totalMatch.string = totalCount;\r\n        this.highestWinningStreak.string = continueWinCount;\r\n        this.winningrate.string = winRate + \"%\";\r\n    },\r\n\r\n    clickShowRankBtn: function () {\r\n        this.node.active = false;\r\n        \r\n        TSCommon.dispatchEvent(HallResources.onChangeShadow,false);\r\n        this.node.parent.getComponent(\"HallPlatformInfo\").onClicShrinkBtn();\r\n    },\r\n    // update (dt) {},\r\n});\r\n\r\nmodule.exports = UserInfoLayer;"]}